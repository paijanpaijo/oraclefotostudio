<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Oracle Pro Foto Studio by Basmedias</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.0/FileSaver.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/heic2any@0.0.4/dist/heic2any.min.js"></script>
    <style>
        /* --- General Styles --- */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc; /* slate-50 */
            color: #1f2937; /* gray-800 */
        }
        
        /* Sidebar Layout */
        .app-container {
            display: flex;
            min-height: 100vh;
            gap: 0;
        }

        .sidebar {
            width: 280px;
            background: linear-gradient(180deg, #ffffff 0%, #f8fafc 100%);
            border-right: 2px solid #e2e8f0;
            position: fixed;
            left: 0;
            top: 0;
            height: 100vh;
            overflow-y: auto;
            overflow-x: hidden;
            padding: 1.5rem 1rem;
            box-shadow: 2px 0 10px rgba(0, 0, 0, 0.05);
            z-index: 1000;
            transition: transform 0.3s ease, width 0.3s ease;
        }

        .sidebar.collapsed {
            transform: translateX(-280px);
        }

        .main-content-wrapper {
            margin-left: 280px;
            flex: 1;
            padding: 2rem;
            width: calc(100% - 280px);
            transition: margin-left 0.3s ease, width 0.3s ease;
        }

        .main-content-wrapper.expanded {
            margin-left: 0;
            width: 100%;
        }

        .toggle-sidebar-btn {
            position: fixed;
            left: 290px;
            top: 1.5rem;
            z-index: 1001;
            background: white;
            border: 2px solid #e2e8f0;
            border-radius: 0.5rem;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            color: #64748b;
        }

        .toggle-sidebar-btn:hover {
            background: #0ea5e9;
            color: white;
            border-color: #0ea5e9;
            box-shadow: 0 4px 12px rgba(14, 165, 233, 0.3);
        }

        .toggle-sidebar-btn.collapsed {
            left: 10px;
        }

        .toggle-sidebar-btn i {
            transition: transform 0.3s ease;
        }

        .toggle-sidebar-btn.collapsed i {
            transform: rotate(180deg);
        }

        .main-tab-btn {
            background-color: transparent;
            color: #64748b;
            border-left: 3px solid transparent;
            transition: all 0.3s ease;
            width: 100%;
            text-align: left;
            padding: 0.875rem 1rem;
            margin: 0.25rem 0;
            border-radius: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-size: 0.95rem;
        }

        .main-tab-btn:hover {
            background-color: #f1f5f9;
            color: #0ea5e9;
            transform: translateX(4px);
        }

        .main-tab-btn.active {
            color: #0ea5e9;
            background-color: #e0f2fe;
            border-left-color: #0ea5e9;
            font-weight: 600;
        }

        .main-tab-btn i {
            font-size: 1.1rem;
            width: 20px;
            text-align: center;
        }

        .hidden {
            display: none;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Custom scrollbar for sidebar */
        .sidebar::-webkit-scrollbar {
            width: 6px;
        }
        .sidebar::-webkit-scrollbar-track {
            background: #f1f5f9;
            border-radius: 4px;
        }
        .sidebar::-webkit-scrollbar-thumb {
            background: #0ea5e9;
            border-radius: 4px;
        }
        .sidebar::-webkit-scrollbar-thumb:hover {
            background: #0284c7;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .sidebar {
                width: 70px;
                padding: 1rem 0.5rem;
            }
            .sidebar.collapsed {
                transform: translateX(-70px);
            }
            .main-content-wrapper {
                margin-left: 70px;
                width: calc(100% - 70px);
                padding: 1rem;
            }
            .main-tab-btn {
                padding: 0.75rem 0.5rem;
                justify-content: center;
                font-size: 0;
            }
            .main-tab-btn i {
                font-size: 1.25rem;
                margin: 0;
            }
            .main-tab-btn .btn-text {
                display: none;
            }
            .toggle-sidebar-btn {
                left: 80px;
                top: 1rem;
                width: 36px;
                height: 36px;
            }
            .toggle-sidebar-btn.collapsed {
                left: 10px;
            }
            .sidebar .text-center h1 {
                font-size: 0;
                height: 0;
                margin: 0;
            }
            .sidebar .text-center p {
                display: none;
            }
            .sidebar .border-b-2 {
                border: none;
                padding: 0;
                margin-bottom: 1rem;
            }
        }

        /* --- STYLES FOR TAB 1: MINIATURE ME --- */
        #content-miniature {
            font-family: 'Poppins', sans-serif;
            background-color: #eef2ff;
            color: #1e3a8a;
            background-image: 
                radial-gradient(#a5b4fc 1px, transparent 1px);
            background-size: 20px 20px;
            padding: 2rem;
            border-radius: 1rem;
        }
        #content-miniature .container { max-width: 1200px; margin: auto; }
        #content-miniature .glassmorphism {
            background: rgba(224, 231, 255, 0.5);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        #content-miniature .loader {
            border: 5px solid #f0f0f0;
            border-top: 5px solid #4f46e5;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
        }
        #content-miniature .image-uploader-box { border: 2px dashed #a5b4fc; }
        #content-miniature .image-uploader-box:hover { background-color: rgba(224, 231, 255, 0.5); }
        #content-miniature textarea { background-color: rgba(255,255,255,0.5); border: 2px solid #a5b4fc; }
        #content-miniature textarea:focus { outline: none; border-color: #4f46e5; box-shadow: 0 0 0 2px rgba(79, 70, 229, 0.3); }
        #content-miniature .orientation-btn { background-color: white; border: 2px solid #e0e7ff; }
        #content-miniature .orientation-btn.selected { background-color: #4f46e5; color: white; border-color: #4338ca; }
        #content-miniature .ratio-btn-mini { background-color: white; border: 2px solid #e0e7ff; padding: 0.75rem; border-radius: 0.5rem; font-weight: 500; transition: all 0.3s; cursor: pointer; display: flex; align-items: center; justify-content: center; }
        #content-miniature .ratio-btn-mini:hover { border-color: #4f46e5; background-color: rgba(224, 231, 255, 0.5); }
        #content-miniature .ratio-btn-mini.selected { background-color: #4f46e5; color: white; border-color: #4338ca; box-shadow: 0 4px 12px rgba(79, 70, 229, 0.3); }

        /* --- STYLES FOR TAB 2: HALU IDOL --- */
        #content-halu {
            font-family: 'Inter', sans-serif;
            background-color: #fdf2f8;
            color: #374151;
            padding: 2rem;
            border-radius: 1rem;
            position: relative;
            overflow: hidden;
        }
        #content-halu .card { background-color: #ffffff; border: 1px solid #fbcfe8; box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1); }
        #content-halu .btn-primary { background-color: #ec4899; color: white; }
        #content-halu .btn-primary:hover { background-color: #db2777; box-shadow: 0 0 15px #ec4899; }
        #content-halu .loader { border: 3px solid rgba(236, 72, 153, 0.5); border-left-color: #db2777; animation: spin 1s linear infinite; }
        #content-halu .file-input-label {
            border: 2px dashed #f9a8d4;
            background-color: white;
            padding: 2rem;
            transition: all 0.3s ease;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        }
        #content-halu .file-input-label:hover {
            border-color: #ec4899;
            background-color: #fff1f7;
            box-shadow: 0 0 15px rgba(236, 72, 153, 0.4);
            transform: translateY(-2px);
        }
        #content-halu .b-roll-card:hover { transform: translateY(-5px); box-shadow: 0 0 20px rgba(236, 72, 153, 0.5); }
        #content-halu .hearts-container { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; }
        #content-halu .heart { position: absolute; width: 20px; height: 20px; background-color: #ec4899; transform: rotate(-45deg); animation: fly 10s linear infinite; bottom: -50px; }
        #content-halu .heart::before, #content-halu .heart::after { content: ''; position: absolute; width: 20px; height: 20px; background-color: #ec4899; border-radius: 50%; }
        #content-halu .heart::before { top: -10px; left: 0; }
        #content-halu .heart::after { top: 0; left: 10px; }
        @keyframes fly { 0% { transform: translateY(0) rotate(-45deg) scale(0.5); opacity: 1; } 100% { transform: translateY(-120vh) rotate(-45deg) scale(1.2); opacity: 0; } }

        #content-halu .orientation-btn { background-color: white; border: 2px solid #f9a8d4; }
        #content-halu .orientation-btn.selected { background-color: #ec4899; color: white; border-color: #db2777; }
        #content-halu .ratio-btn-halu { background-color: white; border: 2px solid #f9a8d4; padding: 0.75rem; border-radius: 0.5rem; font-weight: 500; transition: all 0.3s; cursor: pointer; display: flex; align-items: center; justify-content: center; }
        #content-halu .ratio-btn-halu:hover { border-color: #ec4899; background-color: #fdf2f8; }
        #content-halu .ratio-btn-halu.selected { background-color: #ec4899; color: white; border-color: #db2777; box-shadow: 0 4px 12px rgba(236, 72, 153, 0.3); }

        /* --- STYLES FOR TAB 3: AFFILIATE GO --- */
        #content-affiliate { font-family: 'Inter', sans-serif; background-color: #f0f9ff; color: #374151; padding: 2rem; border-radius: 1rem; }
        #content-affiliate .card { background-color: #ffffff; border: 1px solid #e2e8f0; border-radius: 0.75rem; }
        #content-affiliate .tab-btn { background-color: transparent; color: #6b7280; border-bottom: 2px solid transparent; transition: color 0.3s, border-color 0.3s; }
        #content-affiliate .tab-btn.active { color: #06b6d4; border-color: #06b6d4; }
        #content-affiliate .btn-primary { background-color: #06b6d4; color: white; transition: background-color 0.3s; }
        #content-affiliate .btn-primary:hover { background-color: #0891b2; }
        #content-affiliate .btn-primary:disabled { background-color: #e2e8f0; color: #94a3b8; cursor: not-allowed; }
        #content-affiliate .loader { border: 3px solid rgba(6, 182, 212, 0.5); border-left-color: #e5e7eb; width: 24px; height: 24px; border-radius: 50%; animation: spin 1s linear infinite; }
        #content-affiliate .tryon-loader { border-top: 5px solid #06b6d4; border-radius: 50%; width: 50px; height: 50px; animation: spin 1s linear infinite; }
        #content-affiliate .file-input-label { cursor: pointer; border: 2px dashed #94a3b8; padding: 1.5rem; display: flex; flex-direction: column; align-items: center; justify-content: center; transition: border-color 0.3s, background-color 0.3s; }
        #content-affiliate .file-input-label:hover { border-color: #64748b; background-color: #f1f5f9; }
        #content-affiliate .result-card { transition: transform 0.3s, box-shadow 0.3s; }
        #content-affiliate .result-card:hover { transform: translateY(-5px); box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05); }
        #content-affiliate .upload-box { border: 2px dashed #94a3b8; transition: all 0.3s ease; }
        #content-affiliate .upload-box.dragging { border-color: #06b6d4; background-color: #f1f5f9; }
        #content-affiliate .orientation-btn { background-color: white; border: 2px solid #e2e8f0; }
        #content-affiliate .orientation-btn.selected { background-color: #06b6d4; color: white; border-color: #0891b2; }
        #content-affiliate .ratio-btn-broll { background-color: white; border: 2px solid #e2e8f0; padding: 0.75rem; border-radius: 0.5rem; font-weight: 500; transition: all 0.3s; cursor: pointer; display: flex; align-items: center; justify-content: center; }
        #content-affiliate .ratio-btn-broll:hover { border-color: #06b6d4; background-color: #f0f9ff; }
        #content-affiliate .ratio-btn-broll.selected { background-color: #06b6d4; color: white; border-color: #0891b2; box-shadow: 0 4px 12px rgba(6, 182, 212, 0.3); }
        #content-affiliate .upload-box img { max-height: 100%; max-width: 100%; object-fit: contain; }
        #content-affiliate #poses-poseListContainer::-webkit-scrollbar { width: 8px; }
        #content-affiliate #poses-poseListContainer::-webkit-scrollbar-track { background: #e2e8f0; }
        #content-affiliate #poses-poseListContainer::-webkit-scrollbar-thumb { background: #06b6d4; border-radius: 4px; }
        
        /* --- STYLES FOR TAB 4: FAMILY PHOTO --- */
        #content-family { background-color: #f0f4f8; color: #2c3e50; padding: 2rem; border-radius: 1rem; }
        #content-family .file-input-wrapper { position: relative; width: 120px; height: 120px; background-color: #f7f9fc; border-radius: 1rem; cursor: pointer; overflow: hidden; border: 2px dashed #95a5a6; display: flex; justify-content: center; align-items: center; transition: all 0.3s ease; }
        #content-family .file-input-wrapper:hover { border-color: #3498db; background-color: #eaf4fa; }
        #content-family .file-input { position: absolute; top: 0; left: 0; width: 100%; height: 100%; opacity: 0; cursor: pointer; }
        #content-family .file-preview { position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover; }
        #content-family .delete-btn { position: absolute; top: 5px; right: 5px; width: 24px; height: 24px; background-color: #e74c3c; color: white; border-radius: 50%; display: none; justify-content: center; align-items: center; font-size: 1rem; font-weight: bold; cursor: pointer; z-index: 10; transition: transform 0.2s ease; }
        #content-family .file-input-wrapper.has-photo .delete-btn { display: flex; }
        #content-family .delete-btn:hover { transform: scale(1.1); }
        #content-family .add-photo-btn { background-color: #d1e7dd; color: #28a745; border-radius: 1rem; width: 120px; height: 120px; display: flex; justify-content: center; align-items: center; font-size: 2.5rem; transition: transform 0.2s ease, background-color 0.2s ease; }
        #content-family .add-photo-btn:hover { transform: scale(1.05); background-color: #c3e6cb; }
        #content-family .theme-btn { padding: 0.5rem 0.75rem; border-radius: 0.5rem; font-weight: 500; cursor: pointer; transition: all 0.2s ease; background-color: white; color: #374151; border: 1px solid #e5e7eb; }
        #content-family .theme-btn:hover { background-color: #f0fdfa; border-color: #14b8a6; transform: translateY(-1px); }
        #content-family .theme-btn.active { background: linear-gradient(135deg, #14b8a6, #0d9488); color: white; border-color: #0d9488; box-shadow: 0 2px 8px rgba(20, 184, 166, 0.3); }
        #content-family .spinner { border: 4px solid rgba(0, 0, 0, 0.1); border-left-color: #14b8a6; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; }
        #content-family .image-card { display: flex; flex-direction: column; align-items: center; gap: 0.5rem; width: 100%; background-color: white; padding: 0.75rem; border-radius: 1rem; box-shadow: 0 4px 12px rgba(0,0,0,0.08); animation: fadeIn 0.5s ease-in-out forwards; opacity: 0; transform: translateY(20px); transition: transform 0.3s ease, box-shadow 0.3s ease; }
        #content-family .image-card:hover { transform: translateY(-4px); box-shadow: 0 8px 20px rgba(0,0,0,0.12); }
        @keyframes fadeIn { to { opacity: 1; transform: translateY(0); } }
        #content-family .generated-image { width: 100%; border-radius: 0.75rem; transition: transform 0.3s ease; }
        #content-family .download-btn { width: 100%; padding: 0.5rem; background: linear-gradient(135deg, #14b8a6, #0d9488); color: white; font-weight: 600; border-radius: 0.5rem; cursor: pointer; transition: all 0.2s ease; box-shadow: 0 2px 6px rgba(20, 184, 166, 0.3); }
        #content-family .download-btn:hover { transform: translateY(-1px); box-shadow: 0 4px 12px rgba(20, 184, 166, 0.4); }
        #content-family .modal-container { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.5); justify-content: center; align-items: center; z-index: 1000; }
        #content-family .modal-content { background: white; padding: 2rem; border-radius: 1rem; max-width: 400px; text-align: center; box-shadow: 0 5px 15px rgba(0,0,0,0.3); }
        #content-family .modal-button { margin-top: 1rem; padding: 0.5rem 1rem; background-color: #e74c3c; color: white; border-radius: 9999px; cursor: pointer; }
        #content-family .option-btn-family { background-color: white; border: 2px solid #ccfbf1; padding: 0.75rem; border-radius: 0.75rem; font-weight: 500; transition: all 0.3s; cursor: pointer; display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center; }
        #content-family .option-btn-family:hover { border-color: #14b8a6; background-color: #f0fdfa; transform: translateY(-2px); box-shadow: 0 4px 12px rgba(20, 184, 166, 0.15); }
        #content-family .option-btn-family.selected { background: linear-gradient(135deg, #14b8a6, #0d9488); color: white; border-color: #0d9488; box-shadow: 0 4px 12px rgba(20, 184, 166, 0.3); }

        /* --- STYLES FOR TAB 5: FOOD SELFIE --- */
        #content-food-selfie {
            font-family: 'Poppins', sans-serif;
            background-color: #eef2ff;
            color: #1e3a8a;
            background-image: 
                radial-gradient(#a5b4fc 1px, transparent 1px),
                url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"><text x="10" y="30" font-family="Arial" font-size="20" fill="rgba(165, 180, 252, 0.2)">ü•ê</text><text x="60" y="70" font-family="Arial" font-size="20" fill="rgba(165, 180, 252, 0.2)">üçú</text></svg>'),
                url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="80" height="80" viewBox="0 0 80 80"><text x="50" y="20" font-family="Arial" font-size="20" fill="rgba(165, 180, 252, 0.2)">üç∞</text><text x="10" y="60" font-family="Arial" font-size="20" fill="rgba(165, 180, 252, 0.2)">üçï</text></svg>');
            background-size: 20px 20px, 100px 100px, 80px 80px;
            padding: 2rem;
            border-radius: 1rem;
        }
        #content-food-selfie .container { max-width: 1200px; margin: auto; }
        #content-food-selfie .glassmorphism {
            background: rgba(224, 231, 255, 0.5);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        #content-food-selfie .loader {
            border: 5px solid #f0f0f0;
            border-top: 5px solid #4f46e5;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
        }
        #content-food-selfie .orientation-btn { background-color: white; border: 2px solid #e0e7ff; }
        #content-food-selfie .orientation-btn.selected { background-color: #4f46e5; color: white; border-color: #4338ca; }
        #content-food-selfie .ratio-btn-food { background-color: white; border: 2px solid #e0e7ff; padding: 0.75rem; border-radius: 0.5rem; font-weight: 500; transition: all 0.3s; cursor: pointer; display: flex; align-items: center; justify-content: center; }
        #content-food-selfie .ratio-btn-food:hover { border-color: #4f46e5; background-color: rgba(224, 231, 255, 0.5); }
        #content-food-selfie .ratio-btn-food.selected { background-color: #4f46e5; color: white; border-color: #4338ca; box-shadow: 0 4px 12px rgba(79, 70, 229, 0.3); }
        #content-food-selfie .image-uploader-box {
            border: 2px dashed #a5b4fc;
            padding: 1.5rem;
            text-align: center;
            border-radius: 0.75rem;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        #content-food-selfie .image-uploader-box:hover {
            background-color: rgba(224, 231, 255, 0.5);
        }
        #content-food-selfie .theme-btn {
            background-color: white;
            border: 2px solid #e0e7ff;
            border-radius: 0.75rem;
            padding: 0.75rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            cursor: pointer;
            transition: all 0.2s ease-in-out;
            text-align: center;
            font-size: 0.8rem;
            font-weight: 500;
            color: #1e3a8a;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        #content-food-selfie .theme-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        #content-food-selfie .theme-btn.selected {
            background-color: #4f46e5;
            color: white;
            border-color: #4338ca;
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 6px 12px rgba(59, 130, 246, 0.3);
        }
        #content-food-selfie .theme-btn i {
            font-size: 1.5rem;
            margin-bottom: 4px;
        }

        /* --- STYLES FOR TAB 6: NEW BORN STUDIO --- */
        #content-new-born {
            background-color: #f3f4f6; /* bg-gray-100 */
            color: #374151; /* text-gray-800 */
        }
        #content-new-born .custom-loader {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: 
                radial-gradient(farthest-side,#766DF4 94%,#0000) top/8px 8px no-repeat,
                conic-gradient(#0000 30%,#766DF4);
            -webkit-mask: radial-gradient(farthest-side,#0000 calc(100% - 8px),#000 0);
            animation: newborn-loader-spin 1s infinite linear;
        }
        @keyframes newborn-loader-spin {
            100%{transform: rotate(1turn)}
        }
        #content-new-born .option-btn-newborn { background-color: white; border: 2px solid #e0e7ff; padding: 0.75rem; border-radius: 0.75rem; font-weight: 500; transition: all 0.3s; cursor: pointer; display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center; }
        #content-new-born .option-btn-newborn:hover { border-color: #6366f1; background-color: #eef2ff; transform: translateY(-2px); box-shadow: 0 4px 12px rgba(99, 102, 241, 0.15); }
        #content-new-born .option-btn-newborn.selected { background: linear-gradient(135deg, #6366f1, #8b5cf6); color: white; border-color: #4f46e5; box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3); }


        /* Universal Modal for all tabs */
        .modal-backdrop { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.7); display: flex; align-items: center; justify-content: center; z-index: 50; opacity: 0; pointer-events: none; transition: opacity 0.3s ease; }
        .modal-backdrop.visible { opacity: 1; pointer-events: auto; }
        .modal-content-universal { background-color: #ffffff; padding: 2rem; border-radius: 0.75rem; width: 90%; max-width: 500px; transform: scale(0.95); transition: transform 0.3s ease; }
        .modal-backdrop.visible .modal-content-universal { transform: scale(1); }

        /* Orientation Label Style */
        .orientation-label:has(input:checked) {
            border-color: #6366f1; /* Indigo-500 */
            background-color: #eef2ff; /* Indigo-50 */
        }

        /* Floating Support Button */
        #support-button {
            position: fixed;
            bottom: 1.5rem;
            right: 1.5rem;
            z-index: 40;
            transition: transform 0.3s ease;
        }
        #support-button:hover {
            transform: scale(1.1);
        }

        /* --- STYLES FOR TAB 7: FOTO PROFESI ANAK --- */
        #content-profesi-anak {
            background-color: #111827; /* bg-gray-900 */
            color: #f9fafb; /* text-white */
            font-family: 'Inter', sans-serif;
            padding: 2rem;
            border-radius: 1rem;
        }
        #content-profesi-anak .profesi-card {
            background-color: rgba(31, 41, 55, 0.5); /* bg-gray-800/50 */
            backdrop-filter: blur(4px);
            border: 1px solid #374151; /* border-gray-700 */
        }
        #content-profesi-anak .profesi-input, #content-profesi-anak .profesi-select {
            background-color: #374151; /* bg-gray-700 */
            border: 1px solid #4b5563; /* border-gray-600 */
            color: #f9fafb; /* text-white */
        }
        #content-profesi-anak .profesi-input:focus, #content-profesi-anak .profesi-select:focus {
            ring-offset-color: #111827;
            --tw-ring-color: #ec4899; /* ring-pink-500 */
        }
        #content-profesi-anak .profesi-upload-area {
            border-color: #4b5563; /* border-gray-600 */
            background-color: rgba(17, 24, 39, 0.5); /* bg-gray-900/50 */
        }
         #content-profesi-anak .profesi-upload-area:hover {
            border-color: #ec4899; /* border-pink-500 */
        }
        #content-profesi-anak .profesi-generate-btn {
            background-image: linear-gradient(to right, var(--tw-gradient-stops));
            --tw-gradient-from: #a855f7; /* from-purple-500 */
            --tw-gradient-to: #ec4899; /* to-pink-500 */
            --tw-gradient-stops: var(--tw-gradient-from), var(--tw-gradient-to);
        }
        #content-profesi-anak .profesi-generate-btn:hover {
            --tw-gradient-from: #9333ea; /* from-purple-600 */
            --tw-gradient-to: #db2777; /* to-pink-600 */
        }
        #content-profesi-anak .profesi-loader-spinner svg {
            width: 2.5rem;
            height: 2.5rem;
            color: white;
        }
        #content-profesi-anak .option-btn-profesi { background-color: #374151; border: 2px solid #4b5563; padding: 0.75rem; border-radius: 0.75rem; font-weight: 500; transition: all 0.3s; cursor: pointer; display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center; color: #f9fafb; }
        #content-profesi-anak .option-btn-profesi:hover { border-color: #ec4899; background-color: #4b5563; transform: translateY(-2px); box-shadow: 0 4px 12px rgba(236, 72, 153, 0.15); }
        #content-profesi-anak .option-btn-profesi.selected { background: linear-gradient(135deg, #a855f7, #ec4899); color: white; border-color: #db2777; box-shadow: 0 4px 12px rgba(236, 72, 153, 0.3); }

        /* --- STYLES FOR TAB 8: STORY UPDATE GENERATOR --- */
        #content-story-update {
          background-color: #f3f4f6; /* bg-gray-100 */
        }
        #content-story-update .loader {
          border-top-color: #3498db;
          -webkit-animation: story-update-spin 1s linear infinite;
          animation: story-update-spin 1s linear infinite;
        }
        @-webkit-keyframes story-update-spin {
          0% { -webkit-transform: rotate(0deg); }
          100% { -webkit-transform: rotate(360deg); }
        }
        @keyframes story-update-spin {
          0% { transform: rotate(0deg); }
          100% { transform: rotate(360deg); }
        }
        #content-story-update .custom-select {
          -webkit-appearance: none;
          -moz-appearance: none;
          appearance: none;
          background-image: url('data:image/svg+xml;charset=UTF-8,<svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="%23333" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"></polyline></svg>');
          background-repeat: no-repeat;
          background-position: right 1rem center;
          background-size: 1em;
        }
        #content-story-update .action-btn {
          -webkit-tap-highlight-color: transparent;
          user-select: none;
          touch-action: manipulation;
        }
        #content-story-update .action-btn * {
          pointer-events: none;
        }

        /* --- STYLES FOR TAB 9: WEDDING PHOTO --- */
        #content-wedding {
            font-family: 'Montserrat', sans-serif;
            overflow-x: hidden;
            background-color: #fdf2f8; /* bg-rose-50 */
        }
        #content-wedding .font-title {
            font-family: 'Dancing Script', cursive;
        }
        #content-wedding .hearts-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            overflow: hidden;
            z-index: 0;
        }
        #content-wedding .heart {
            position: absolute;
            bottom: -50px;
            font-size: 2rem;
            color: #ff7e9f;
            animation: wedding-floatUp 10s linear infinite;
            opacity: 0;
        }
        @keyframes wedding-floatUp {
            0% {
                transform: translateY(0);
                opacity: 0.7;
            }
            100% {
                transform: translateY(-100vh);
                opacity: 0;
            }
        }
        #content-wedding .image-preview {
            width: 128px;
            height: 128px;
            border: 2px dashed #ddd;
            border-radius: 0.75rem;
            background-color: #f8f9fa;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            background-size: cover;
            background-position: center;
        }
        #content-wedding .image-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        #content-wedding .image-preview-placeholder {
            font-size: 3rem;
            color: #ddd;
        }
        #content-wedding .generated-image-container {
            position: relative;
            overflow: hidden;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }
        #content-wedding .generated-image-container:hover {
            transform: scale(1.05);
        }
        #content-wedding .generated-image-container.vertical {
            aspect-ratio: 9 / 16;
        }
        #content-wedding .generated-image-container.horizontal {
            aspect-ratio: 16 / 9;
        }
        #content-wedding .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #f472b6;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        #content-wedding .download-btn {
            position: absolute;
            top: 8px;
            right: 8px;
            background-color: rgba(0, 0, 0, 0.6);
            color: white;
            border-radius: 50%;
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            text-decoration: none;
            opacity: 0; /* Hidden on desktop by default */
            transition: opacity 0.3s ease;
            z-index: 10;
        }
        #content-wedding .generated-image-container:hover .download-btn {
            opacity: 1; /* Show on hover */
        }
        /* Always show on touch devices (mobile) */
        @media (hover: none) {
            #content-wedding .download-btn {
                opacity: 1;
            }
        }

        /* --- STYLES FOR TAB 10: VEO GENERATOR --- */
        #content-veo {
            background-color: #eef2ff; /* A neutral, light background */
            padding: 1rem;
            border-radius: 1rem;
        }

        /* --- STYLES FOR TAB: OPAL IMAGE TO VIDEO --- */
        #content-opal {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc;
            padding: 2rem;
        }
        #content-opal .container {
            animation: fadeInUp 0.6s ease-out;
        }
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* --- STYLES FOR TAB 11: VOICE OVER GENERATOR --- */
        #content-voice-over {
            background-color: #f0f4f8;
            background-image: linear-gradient(to bottom right, #dbeafe, #f3f4f6);
            padding: 1rem;
            border-radius: 1rem;
        }
        #content-voice-over .loader {
            display: flex;
            align-items: flex-end;
            height: 32px;
        }
        #content-voice-over .loader .bar {
            width: 5px;
            margin: 0 2px;
            background-color: #2563eb;
            border-radius: 3px;
            animation: voice-wave 1.2s ease-in-out infinite;
        }
        #content-voice-over .loader .bar:nth-child(1) { height: 10px; animation-delay: 0s; }
        #content-voice-over .loader .bar:nth-child(2) { height: 20px; animation-delay: 0.1s; }
        #content-voice-over .loader .bar:nth-child(3) { height: 25px; animation-delay: 0.2s; }
        #content-voice-over .loader .bar:nth-child(4) { height: 20px; animation-delay: 0.3s; }
        #content-voice-over .loader .bar:nth-child(5) { height: 10px; animation-delay: 0.4s; }

        @keyframes voice-wave {
            0%, 100% { transform: scaleY(0.2); }
            50% { transform: scaleY(1); }
        }
        #content-voice-over .btn {
            font-weight: 600;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            transition: all 0.3s;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
        }
        #content-voice-over .btn:hover {
            transform: scale(1.05);
        }
        #content-voice-over .btn:focus {
            outline: none;
            box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.5);
        }
        #content-voice-over .btn-primary { background-color: #1d4ed8; color: white; }
        #content-voice-over .btn-primary:hover { background-color: #1e40af; }
        #content-voice-over .btn-secondary { background-color: #4b5563; color: white; }
        #content-voice-over .btn-secondary:hover { background-color: #374151; }
        #content-voice-over .voice-item {
            -webkit-tap-highlight-color: transparent;
            user-select: none;
            touch-action: manipulation;
        }
        #content-voice-over .voice-item.selected { background-color: #dbeafe; border-color: #2563eb; box-shadow: 0 0 0 2px #93c5fd; }
        #content-voice-over .voice-item * {
            pointer-events: none;
        }
        #content-voice-over .preview-btn {
            pointer-events: auto;
        }
        #content-voice-over #vo-voice-list {
            -webkit-overflow-scrolling: touch;
        }
        #content-voice-over .history-btn {
            -webkit-tap-highlight-color: transparent;
            user-select: none;
            touch-action: manipulation;
        }
        #content-voice-over .history-btn i {
            pointer-events: none;
        }
        #content-voice-over .preview-loader {
            width: 16px; height: 16px; border: 2px solid #9ca3af;
            border-top-color: #2563eb; border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }
        #content-voice-over input[type="range"] {
            -webkit-appearance: none; appearance: none; width: 100%; height: 8px;
            background: #d1d5db; border-radius: 5px; outline: none; transition: background 0.3s;
        }
        #content-voice-over input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none; appearance: none; width: 20px; height: 20px;
            background: #2563eb; border-radius: 50%; cursor: pointer;
            border: 2px solid white; box-shadow: 0 0 5px rgba(0,0,0,0.2);
        }
        #content-voice-over input[type="range"]::-moz-range-thumb {
            width: 20px; height: 20px; background: #2563eb; border-radius: 50%;
            cursor: pointer; border: 2px solid white; box-shadow: 0 0 5px rgba(0,0,0,0.2);
        }
        #content-voice-over #audio-container.playing {
            animation: pulse-blue 2s infinite;
            border-radius: 0.5rem;
        }
        @keyframes pulse-blue {
            0% { box-shadow: 0 0 0 0 rgba(37, 99, 235, 0.4); }
            70% { box-shadow: 0 0 0 12px rgba(37, 99, 235, 0); }
            100% { box-shadow: 0 0 0 0 rgba(37, 99, 235, 0); }
        }

        /* --- STYLES FOR VIDEO ANALYZER --- */
        #content-video-analyzer .glass-card {
            background: rgba(31, 41, 55, 0.6);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 1.5rem;
        }
        #content-video-analyzer .btn-primary {
            background: linear-gradient(90deg, #3b82f6, #8b5cf6);
            transition: all 0.3s ease;
        }
        #content-video-analyzer .btn-primary:hover {
            box-shadow: 0 0 20px rgba(139, 92, 246, 0.6);
            transform: translateY(-2px);
        }
        #content-video-analyzer .btn-secondary {
            background-color: #374151;
            transition: background-color 0.3s ease;
        }
        #content-video-analyzer .btn-secondary:hover {
            background-color: #4b5563;
        }
        #content-video-analyzer ::-webkit-scrollbar {
            width: 8px;
        }
        #content-video-analyzer ::-webkit-scrollbar-track {
            background: #1f2937;
        }
        #content-video-analyzer ::-webkit-scrollbar-thumb {
            background: #4b5563;
            border-radius: 4px;
        }
        #content-video-analyzer ::-webkit-scrollbar-thumb:hover {
            background: #6b7280;
        }
        #content-video-analyzer #video-preview {
            max-height: 400px;
        }

        /* --- STYLES FOR TAB 12: STICKER TEMPEL --- */
        #content-sticker {
            background-color: #f0f9ff;
            padding: 1rem;
            border-radius: 1rem;
            overflow: hidden;
            position: relative;
        }
        #content-sticker .decorative-shape {
            position: absolute;
            opacity: 0.5;
            z-index: 0;
        }
        #content-sticker .shape-1 { top: 10%; left: 5%; width: 150px; height: 150px; background: #a7f3d0; border-radius: 50%; filter: blur(40px); }
        #content-sticker .shape-2 { bottom: 15%; right: 10%; width: 200px; height: 200px; background: #fbcfe8; border-radius: 50%; filter: blur(50px); }
        #content-sticker .shape-3 { top: 20%; right: 15%; width: 100px; height: 100px; background: #fef08a; border-radius: 50%; filter: blur(30px); }

        #content-sticker .main-container-sticker {
            position: relative;
            z-index: 1;
        }

        #content-sticker .loader-sticker {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #38bdf8;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        #content-sticker .img-preview-container {
            width: 100%;
            padding-top: 100%;
            position: relative;
            background-color: #e5e7eb;
            overflow: hidden;
        }
        #content-sticker .img-preview, #content-sticker #sticker-output-area-content {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: contain;
        }
        #content-sticker #sticker-output-area-content {
           display: flex;
           align-items: center;
           justify-content: center;
        }
        #content-sticker #sticker-sticker-wrapper {
            position: absolute;
            cursor: move;
        }
        #content-sticker #sticker-resize-handle {
            position: absolute;
            bottom: -8px;
            right: -8px;
            width: 20px;
            height: 20px;
            background-color: white;
            border: 2px solid #f472b6;
            border-radius: 50%;
            cursor: nwse-resize;
        }
        #content-sticker input[type=range] { -webkit-appearance: none; width: 100%; background: transparent; }
        #content-sticker input[type=range]:focus { outline: none; }
        #content-sticker input[type=range]::-webkit-slider-runnable-track { width: 100%; height: 8px; cursor: pointer; background: #cbd5e1; border-radius: 5px; }
        #content-sticker input[type=range]::-webkit-slider-thumb { height: 20px; width: 20px; border-radius: 50%; background: #f472b6; cursor: pointer; -webkit-appearance: none; margin-top: -6px; }

        /* --- STYLES FOR TAB 13: HAIR GENERATOR --- */
        #content-hair-generator {
            background-color: #111827;
            color: #ffffff;
            padding: 1rem;
            border-radius: 1rem;
            min-height: calc(100vh - 200px);
        }
        #content-hair-generator .control-panel {
            background-color: rgba(3, 7, 18, 0.5);
            border-right: 1px solid #1f2937;
        }
        #content-hair-generator .hair-loader {
            border: 4px solid #1f2937;
            border-top: 4px solid #3b82f6;
            border-radius: 50%;
            width: 48px;
            height: 48px;
            animation: spin 1s linear infinite;
        }
        #content-hair-generator select {
            background-color: #1f2937;
            border: 1px solid #374151;
            color: white;
        }
        #content-hair-generator select:focus {
            ring: 2px;
            ring-color: #3b82f6;
            outline: none;
        }
        #content-hair-generator .gender-btn {
            transition: all 0.3s;
        }
        #content-hair-generator .gender-btn.active {
            background-color: #2563eb;
            color: white;
        }
        #content-hair-generator .image-placeholder {
            background-color: #1f2937;
            border: 2px dashed #374151;
        }
        #content-hair-generator .result-image {
            max-height: 70vh;
            background-color: #1f2937;
        }

        /* --- STYLES FOR TAB 14: POV TANGAN --- */
        #content-pov-tangan {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #ffffff;
            padding: 2rem;
            border-radius: 1rem;
            min-height: calc(100vh - 200px);
        }
        #content-pov-tangan .card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 1rem;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            padding: 2rem;
            color: #1f2937;
        }
        #content-pov-tangan .upload-area {
            border: 3px dashed #667eea;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            border-radius: 1rem;
            padding: 3rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        #content-pov-tangan .upload-area:hover {
            border-color: #764ba2;
            background: linear-gradient(135deg, #e0c3fc 0%, #8ec5fc 100%);
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
        }
        #content-pov-tangan .upload-area.has-image {
            padding: 0;
            border-style: solid;
            border-width: 3px;
        }
        #content-pov-tangan .preview-image {
            width: 100%;
            height: 300px;
            object-fit: cover;
            border-radius: 0.75rem;
        }
        #content-pov-tangan .btn-generate {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 1rem 2.5rem;
            border-radius: 9999px;
            font-weight: 700;
            font-size: 1.1rem;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }
        #content-pov-tangan .btn-generate:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
        }
        #content-pov-tangan .btn-generate:disabled {
            background: #9ca3af;
            cursor: not-allowed;
            transform: none;
        }
        #content-pov-tangan .ratio-btn-pov {
            background-color: white;
            border: 2px solid #cbd5e1;
            padding: 0.75rem;
            border-radius: 0.5rem;
            font-weight: 500;
            transition: all 0.3s;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        #content-pov-tangan .ratio-btn-pov:hover {
            border-color: #667eea;
            background-color: #eef2ff;
        }
        #content-pov-tangan .ratio-btn-pov.selected {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-color: #667eea;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }
        #content-pov-tangan .hand-count-btn-pov {
            background-color: white;
            border: 2px solid #cbd5e1;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: 500;
            transition: all 0.3s;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            -webkit-tap-highlight-color: transparent;
            user-select: none;
            touch-action: manipulation;
        }
        #content-pov-tangan .hand-count-btn-pov:hover {
            border-color: #667eea;
            background-color: #eef2ff;
            transform: translateY(-2px);
        }
        #content-pov-tangan .hand-count-btn-pov.selected {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-color: #667eea;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }
        #content-pov-tangan .hand-count-btn-pov * {
            pointer-events: none;
        }
        #content-pov-tangan .pov-loader {
            border: 5px solid rgba(255, 255, 255, 0.3);
            border-top: 5px solid #667eea;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            animation: spin 1s linear infinite;
        }
        #content-pov-tangan .result-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 1.5rem;
        }
        #content-pov-tangan .result-card {
            background: white;
            border-radius: 1rem;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            position: relative;
        }
        #content-pov-tangan .result-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 12px 30px rgba(102, 126, 234, 0.3);
        }
        #content-pov-tangan .result-card img {
            width: 100%;
            height: 250px;
            object-fit: cover;
        }
        #content-pov-tangan .download-btn-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(to top, rgba(0, 0, 0, 0.8) 0%, transparent 100%);
            padding: 1rem;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        #content-pov-tangan .result-card:hover .download-btn-overlay {
            opacity: 1;
        }
        #content-pov-tangan .download-icon {
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            transition: transform 0.2s ease;
        }
        #content-pov-tangan .download-icon:hover {
            transform: scale(1.2);
        }
        #content-pov-tangan .image-counter {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            background: rgba(102, 126, 234, 0.9);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        /* --- STYLES FOR MOCKUP STUDIO --- */
        #content-mockup-studio {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 2rem 1rem;
        }

        #content-mockup-studio .card {
            background: white;
            border-radius: 1rem;
            padding: 2rem;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }

        #content-mockup-studio .upload-area {
            border: 3px dashed #cbd5e1;
            border-radius: 1rem;
            padding: 3rem 2rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            min-height: 200px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        #content-mockup-studio .upload-area:hover {
            border-color: #667eea;
            background: linear-gradient(135deg, #eef2ff 0%, #e0e7ff 100%);
            transform: translateY(-2px);
        }

        #content-mockup-studio .upload-area.has-image {
            border-color: #10b981;
            background: white;
        }

        #content-mockup-studio .preview-image {
            max-width: 100%;
            max-height: 300px;
            border-radius: 0.75rem;
            object-fit: contain;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        #content-mockup-studio .btn-generate {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            font-size: 1.125rem;
            font-weight: 700;
            padding: 1rem 3rem;
            border-radius: 9999px;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
        }

        #content-mockup-studio .btn-generate:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 30px rgba(102, 126, 234, 0.5);
        }

        #content-mockup-studio .btn-generate:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        #content-mockup-studio .ratio-btn-mockup {
            background-color: white;
            border: 2px solid #cbd5e1;
            padding: 0.75rem;
            border-radius: 0.5rem;
            font-weight: 500;
            transition: all 0.3s;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        #content-mockup-studio .ratio-btn-mockup:hover {
            border-color: #667eea;
            background-color: #eef2ff;
        }

        #content-mockup-studio .ratio-btn-mockup.selected {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-color: #667eea;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        #content-mockup-studio .pov-loader {
            width: 60px;
            height: 60px;
            border: 5px solid #e5e7eb;
            border-top-color: #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        #content-mockup-studio .result-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 1.5rem;
            margin-top: 2rem;
        }

        #content-mockup-studio .result-card {
            position: relative;
            border-radius: 1rem;
            overflow: hidden;
            background: white;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }

        #content-mockup-studio .result-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 12px 30px rgba(102, 126, 234, 0.3);
        }

        #content-mockup-studio .result-card img {
            width: 100%;
            height: 280px;
            object-fit: cover;
        }

        #content-mockup-studio .result-card-actions {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(to top, rgba(0,0,0,0.8) 0%, transparent 100%);
            padding: 1.5rem 1rem 1rem;
            display: flex;
            justify-content: center;
            gap: 0.5rem;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        #content-mockup-studio .result-card:hover .result-card-actions {
            opacity: 1;
        }

        #content-mockup-studio .btn-preview {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            color: white;
            padding: 0.5rem 1.25rem;
            border-radius: 9999px;
            border: none;
            cursor: pointer;
            font-size: 0.875rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.3s ease;
            box-shadow: 0 4px 10px rgba(59, 130, 246, 0.3);
        }

        #content-mockup-studio .btn-preview:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 15px rgba(59, 130, 246, 0.5);
        }

        #content-mockup-studio .btn-download {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            padding: 0.5rem 1.25rem;
            border-radius: 9999px;
            border: none;
            cursor: pointer;
            font-size: 0.875rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.3s ease;
            box-shadow: 0 4px 10px rgba(16, 185, 129, 0.3);
        }

        #content-mockup-studio .btn-download:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 15px rgba(16, 185, 129, 0.5);
        }

        #content-mockup-studio .image-counter {
            position: absolute;
            top: 0.75rem;
            right: 0.75rem;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 0.375rem 1rem;
            border-radius: 9999px;
            font-size: 0.875rem;
            font-weight: 700;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        }

        /* Image Preview Modal */
        .image-preview-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            z-index: 9999;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .image-preview-modal.show {
            opacity: 1;
        }

        .image-preview-modal.closing {
            opacity: 0;
        }

        .preview-modal-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.95);
            cursor: pointer;
        }

        .preview-modal-content {
            position: relative;
            max-width: 95vw;
            max-height: 95vh;
            z-index: 10000;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .preview-modal-image {
            max-width: 100%;
            max-height: 95vh;
            object-fit: contain;
            border-radius: 0.5rem;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        }

        .preview-close-btn {
            position: absolute;
            top: -3rem;
            right: 0;
            background: rgba(255, 255, 255, 0.9);
            color: #1f2937;
            border: none;
            width: 2.5rem;
            height: 2.5rem;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
            transition: all 0.2s ease;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            z-index: 10001;
        }

        .preview-close-btn:hover {
            background: white;
            transform: scale(1.1);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.4);
        }

        .preview-close-btn:active {
            transform: scale(0.95);
        }

        /* Mobile responsive */
        @media (max-width: 768px) {
            .preview-close-btn {
                top: 1rem;
                right: 1rem;
                width: 3rem;
                height: 3rem;
                font-size: 1.5rem;
                background: rgba(255, 255, 255, 0.95);
            }

            .preview-modal-image {
                max-width: 100vw;
                max-height: 100vh;
                border-radius: 0;
            }

            .preview-modal-content {
                max-width: 100vw;
                max-height: 100vh;
            }
        }

        /* Menu Category Styles */
        .menu-category {
            margin-top: 1.5rem;
            padding-top: 1rem;
            border-top: 2px solid #e2e8f0;
        }

        .menu-category:first-child {
            margin-top: 0;
            padding-top: 0;
            border-top: none;
        }

        .menu-category-title {
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: #64748b;
            padding: 0 0.75rem;
            margin-bottom: 0.5rem;
        }

        /* Umrah/Haji & Passport Photo Styles */
        .upload-box-umrah,
        .upload-box-passport {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .upload-box-umrah:hover,
        .upload-box-passport:hover {
            border-color: #F59E0B;
            background: linear-gradient(135deg, #FEF3C7 0%, #FDE68A 100%);
            box-shadow: 0 10px 30px rgba(245, 158, 11, 0.2);
        }
        .option-btn-umrah,
        .option-btn-passport {
            padding: 0.75rem 1.25rem;
            border-radius: 0.75rem;
            border: 2px solid #e5e7eb;
            background-color: white;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            text-align: center;
            font-weight: 500;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
            position: relative;
            overflow: hidden;
        }
        .option-btn-umrah::before,
        .option-btn-passport::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: linear-gradient(135deg, #F59E0B 0%, #FB923C 100%);
            transform: translate(-50%, -50%);
            transition: width 0.5s ease, height 0.5s ease;
            opacity: 0.1;
            z-index: 0;
        }
        .option-btn-umrah.selected,
        .option-btn-passport.selected {
            background: linear-gradient(135deg, #FEF3C7 0%, #FCD34D 100%);
            border-color: #F59E0B;
            color: #D97706;
            font-weight: 700;
            box-shadow: 0 4px 16px rgba(245, 158, 11, 0.3);
            transform: translateY(-2px);
        }
        .option-btn-umrah.selected::before,
        .option-btn-passport.selected::before {
            width: 300px;
            height: 300px;
        }
        .option-btn-umrah:hover:not(.selected),
        .option-btn-passport:hover:not(.selected) {
            border-color: #F59E0B;
            background-color: #FFFBEB;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(245, 158, 11, 0.2);
        }
        .option-btn-umrah i,
        .option-btn-passport i {
            position: relative;
            z-index: 1;
        }
        .option-btn-umrah span,
        .option-btn-passport span {
            position: relative;
            z-index: 1;
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .loader-icon-umrah,
        .loader-icon-passport {
            display: inline-block;
            border: 2px solid rgba(0,0,0,0.1);
            border-left-color: #F59E0B;
            border-radius: 50%;
            width: 1rem;
            height: 1rem;
            animation: spin 0.8s linear infinite;
        }

        /* Photo Booth Styles */
        .upload-box-booth {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .upload-box-booth:hover {
            border-color: #9333ea;
            background: linear-gradient(135deg, #f3e8ff 0%, #fce7f3 100%);
            box-shadow: 0 10px 30px rgba(147, 51, 234, 0.2);
        }
        .option-btn-booth {
            padding: 0.75rem 1rem;
            border-radius: 0.75rem;
            border: 2px solid #e5e7eb;
            background-color: white;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            text-align: center;
            font-weight: 500;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
            position: relative;
            overflow: hidden;
            font-size: 0.875rem;
        }
        .option-btn-booth::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: linear-gradient(135deg, #9333ea 0%, #ec4899 100%);
            transform: translate(-50%, -50%);
            transition: width 0.5s ease, height 0.5s ease;
            opacity: 0.1;
            z-index: 0;
        }
        .option-btn-booth.selected {
            background: linear-gradient(135deg, #f3e8ff 0%, #fce7f3 100%);
            border-color: #9333ea;
            color: #7c3aed;
            font-weight: 700;
            box-shadow: 0 4px 16px rgba(147, 51, 234, 0.3);
            transform: translateY(-2px);
        }
        .option-btn-booth.selected::before {
            width: 300px;
            height: 300px;
        }
        .option-btn-booth:hover:not(.selected) {
            border-color: #9333ea;
            background-color: #faf5ff;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(147, 51, 234, 0.2);
        }
        .option-btn-booth i,
        .option-btn-booth span {
            position: relative;
            z-index: 1;
        }

        /* Expression Changer Styles */
        .upload-box-expression {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .upload-box-expression:hover {
            border-color: #3b82f6;
            background: linear-gradient(135deg, #dbeafe 0%, #e0f2fe 100%);
            box-shadow: 0 10px 30px rgba(59, 130, 246, 0.2);
        }
        .option-btn-expression {
            padding: 0.75rem 1rem;
            border-radius: 0.75rem;
            border: 2px solid #e5e7eb;
            background-color: white;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            text-align: center;
            font-weight: 500;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
            position: relative;
            overflow: hidden;
            font-size: 0.875rem;
        }
        .option-btn-expression::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: linear-gradient(135deg, #3b82f6 0%, #06b6d4 100%);
            transform: translate(-50%, -50%);
            transition: width 0.5s ease, height 0.5s ease;
            opacity: 0.1;
            z-index: 0;
        }
        .option-btn-expression.selected {
            background: linear-gradient(135deg, #dbeafe 0%, #e0f2fe 100%);
            border-color: #3b82f6;
            color: #1e40af;
            font-weight: 700;
            box-shadow: 0 4px 16px rgba(59, 130, 246, 0.3);
            transform: translateY(-2px);
        }
        .option-btn-expression.selected::before {
            width: 300px;
            height: 300px;
        }
        .option-btn-expression:hover:not(.selected) {
            border-color: #3b82f6;
            background-color: #eff6ff;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(59, 130, 246, 0.2);
        }
        .option-btn-expression i,
        .option-btn-expression span {
            position: relative;
            z-index: 1;
        }

        /* Professional Headshot Styles */
        .upload-box-headshot {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .upload-box-headshot:hover {
            border-color: #4f46e5;
            background: linear-gradient(135deg, #eef2ff 0%, #dbeafe 100%);
            box-shadow: 0 10px 30px rgba(79, 70, 229, 0.2);
        }
        .option-btn-headshot {
            padding: 0.75rem 1rem;
            border-radius: 0.75rem;
            border: 2px solid #e5e7eb;
            background-color: white;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            text-align: center;
            font-weight: 500;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
            position: relative;
            overflow: hidden;
            font-size: 0.875rem;
        }
        .option-btn-headshot::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: linear-gradient(135deg, #4f46e5 0%, #1e40af 100%);
            transform: translate(-50%, -50%);
            transition: width 0.5s ease, height 0.5s ease;
            opacity: 0.1;
            z-index: 0;
        }
        .option-btn-headshot.selected {
            background: linear-gradient(135deg, #eef2ff 0%, #dbeafe 100%);
            border-color: #4f46e5;
            color: #3730a3;
            font-weight: 700;
            box-shadow: 0 4px 16px rgba(79, 70, 229, 0.3);
            transform: translateY(-2px);
        }
        .option-btn-headshot.selected::before {
            width: 300px;
            height: 300px;
        }
        .option-btn-headshot:hover:not(.selected) {
            border-color: #4f46e5;
            background-color: #f5f3ff;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(79, 70, 229, 0.2);
        }
        .option-btn-headshot i,
        .option-btn-headshot span {
            position: relative;
            z-index: 1;
        }

        /* Face Swap Styles */
        .upload-box-faceswap {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            -webkit-tap-highlight-color: transparent;
            user-select: none;
        }
        .upload-box-faceswap:hover {
            border-color: #f97316;
            background: linear-gradient(135deg, #ffedd5 0%, #fed7aa 100%);
            box-shadow: 0 10px 30px rgba(249, 115, 22, 0.2);
            transform: translateY(-2px);
        }
        .option-btn-faceswap {
            padding: 0.75rem 1rem;
            border-radius: 0.75rem;
            border: 2px solid #e5e7eb;
            background-color: white;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            text-align: center;
            font-weight: 500;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
            position: relative;
            overflow: hidden;
            font-size: 0.875rem;
            -webkit-tap-highlight-color: transparent;
            user-select: none;
            touch-action: manipulation;
        }
        .option-btn-faceswap * {
            pointer-events: none;
        }
        .option-btn-faceswap::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: linear-gradient(135deg, #f97316 0%, #ea580c 100%);
            transform: translate(-50%, -50%);
            transition: width 0.5s ease, height 0.5s ease;
            opacity: 0.1;
            z-index: 0;
        }
        .option-btn-faceswap.selected {
            background: linear-gradient(135deg, #ffedd5 0%, #fed7aa 100%);
            border-color: #f97316;
            color: #c2410c;
            font-weight: 700;
            box-shadow: 0 4px 16px rgba(249, 115, 22, 0.3);
            transform: translateY(-2px);
        }
        .option-btn-faceswap.selected::before {
            width: 300px;
            height: 300px;
        }
        .option-btn-faceswap:hover:not(.selected) {
            border-color: #f97316;
            background-color: #ffedd5;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(249, 115, 22, 0.2);
        }
        .option-btn-faceswap:active {
            transform: scale(0.98);
        }
        .option-btn-faceswap i,
        .option-btn-faceswap span {
            position: relative;
            z-index: 1;
        }

        /* Background Remover Styles */
        .upload-box-bgremover {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            -webkit-tap-highlight-color: transparent;
            user-select: none;
        }
        .upload-box-bgremover:hover {
            border-color: #10b981;
            background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%);
            box-shadow: 0 10px 30px rgba(16, 185, 129, 0.2);
            transform: translateY(-2px);
        }
        .option-btn-bgremover {
            padding: 0.75rem 1rem;
            border-radius: 0.75rem;
            border: 2px solid #e5e7eb;
            background-color: white;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            text-align: center;
            font-weight: 500;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
            position: relative;
            overflow: hidden;
            font-size: 0.875rem;
            -webkit-tap-highlight-color: transparent;
            user-select: none;
            touch-action: manipulation;
        }
        .option-btn-bgremover * {
            pointer-events: none;
        }
        .option-btn-bgremover::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            transform: translate(-50%, -50%);
            transition: width 0.5s ease, height 0.5s ease;
            opacity: 0.1;
            z-index: 0;
        }
        .option-btn-bgremover.selected {
            background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%);
            border-color: #10b981;
            color: #047857;
            font-weight: 700;
            box-shadow: 0 4px 16px rgba(16, 185, 129, 0.3);
            transform: translateY(-2px);
        }
        .option-btn-bgremover.selected::before {
            width: 300px;
            height: 300px;
        }
        .option-btn-bgremover:hover:not(.selected) {
            border-color: #10b981;
            background-color: #d1fae5;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(16, 185, 129, 0.2);
        }
        .option-btn-bgremover:active {
            transform: scale(0.98);
        }
        .option-btn-bgremover i,
        .option-btn-bgremover span {
            position: relative;
            z-index: 1;
        }

        /* Photo Extender Styles */
        .upload-box-extender {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            -webkit-tap-highlight-color: transparent;
            user-select: none;
        }
        .upload-box-extender:hover {
            border-color: #0ea5e9;
            background: linear-gradient(135deg, #e0f2fe 0%, #bae6fd 100%);
            box-shadow: 0 10px 30px rgba(14, 165, 233, 0.2);
            transform: translateY(-2px);
        }
        .option-btn-extender {
            padding: 0.75rem 1rem;
            border-radius: 0.75rem;
            border: 2px solid #e5e7eb;
            background-color: white;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            text-align: center;
            font-weight: 500;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
            position: relative;
            overflow: hidden;
            font-size: 0.875rem;
            -webkit-tap-highlight-color: transparent;
            user-select: none;
            touch-action: manipulation;
        }
        .option-btn-extender * {
            pointer-events: none;
        }
        .option-btn-extender::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: linear-gradient(135deg, #0ea5e9 0%, #0284c7 100%);
            transform: translate(-50%, -50%);
            transition: width 0.5s ease, height 0.5s ease;
            opacity: 0.1;
            z-index: 0;
        }
        .option-btn-extender.selected {
            background: linear-gradient(135deg, #e0f2fe 0%, #bae6fd 100%);
            border-color: #0ea5e9;
            color: #0c4a6e;
            font-weight: 700;
            box-shadow: 0 4px 16px rgba(14, 165, 233, 0.3);
            transform: translateY(-2px);
        }
        .option-btn-extender.selected::before {
            width: 300px;
            height: 300px;
        }
        .option-btn-extender:hover:not(.selected) {
            border-color: #0ea5e9;
            background-color: #e0f2fe;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(14, 165, 233, 0.2);
        }
        .option-btn-extender:active {
            transform: scale(0.98);
        }
        .option-btn-extender i,
        .option-btn-extender span {
            position: relative;
            z-index: 1;
        }

        /* Photo Extender Action Buttons - Mobile Friendly */
        #extender-results-grid .action-btn {
            -webkit-tap-highlight-color: transparent;
            user-select: none;
            touch-action: manipulation;
        }
        #extender-results-grid .action-btn * {
            pointer-events: none;
        }

        /* Story Board Styles */
        .upload-box-storyboard {
            transition: all 0.3s ease;
        }
        .upload-box-storyboard:hover {
            transform: translateY(-2px);
            box-shadow: 0 20px 40px rgba(139, 92, 246, 0.3);
        }
        .option-btn-storyboard {
            position: relative;
            padding: 0.75rem 1.5rem;
            border-radius: 0.75rem;
            border: 2px solid #e2e8f0;
            background: white;
            color: #64748b;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            overflow: hidden;
            -webkit-tap-highlight-color: transparent;
            user-select: none;
            touch-action: manipulation;
        }
        .option-btn-storyboard::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(139, 92, 246, 0.1);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }
        .option-btn-storyboard:hover::before {
            width: 300px;
            height: 300px;
        }
        .option-btn-storyboard:hover {
            border-color: #8b5cf6;
            color: #8b5cf6;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(139, 92, 246, 0.2);
        }
        .option-btn-storyboard.selected {
            background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
            border-color: #8b5cf6;
            color: white;
            box-shadow: 0 8px 16px rgba(139, 92, 246, 0.4);
        }
        .option-btn-storyboard:active {
            transform: scale(0.98);
        }
        .option-btn-storyboard * {
            pointer-events: none;
        }
        .option-btn-storyboard i,
        .option-btn-storyboard span {
            position: relative;
            z-index: 1;
        }

        /* Story Board Action Buttons - Mobile Friendly */
        #storyboard-results-grid .action-btn {
            -webkit-tap-highlight-color: transparent;
            user-select: none;
            touch-action: manipulation;
        }
        #storyboard-results-grid .action-btn * {
            pointer-events: none;
        }

        /* Twibon Styles */
        .upload-box-twibon {
            transition: all 0.3s ease;
        }
        .upload-box-twibon:hover {
            transform: translateY(-2px);
            box-shadow: 0 20px 40px rgba(244, 63, 94, 0.3);
        }
        .option-btn-twibon {
            position: relative;
            padding: 0.75rem 1.5rem;
            border-radius: 0.75rem;
            border: 2px solid #e2e8f0;
            background: white;
            color: #64748b;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            overflow: hidden;
            -webkit-tap-highlight-color: transparent;
            user-select: none;
            touch-action: manipulation;
        }
        .option-btn-twibon::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(244, 63, 94, 0.1);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }
        .option-btn-twibon:hover::before {
            width: 300px;
            height: 300px;
        }
        .option-btn-twibon:hover {
            border-color: #f43f5e;
            color: #f43f5e;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(244, 63, 94, 0.2);
        }
        .option-btn-twibon.selected {
            background: linear-gradient(135deg, #f43f5e 0%, #e11d48 100%);
            border-color: #f43f5e;
            color: white;
            box-shadow: 0 8px 16px rgba(244, 63, 94, 0.4);
        }
        .option-btn-twibon:active {
            transform: scale(0.98);
        }
        .option-btn-twibon * {
            pointer-events: none;
        }
        .option-btn-twibon i,
        .option-btn-twibon span {
            position: relative;
            z-index: 1;
        }
        .frame-thumbnail {
            position: relative;
            border-radius: 0.5rem;
            overflow: hidden;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 3px solid transparent;
        }
        .frame-thumbnail:hover {
            transform: scale(1.05);
            box-shadow: 0 8px 20px rgba(244, 63, 94, 0.3);
        }
        .frame-thumbnail.selected {
            border-color: #f43f5e;
            box-shadow: 0 8px 20px rgba(244, 63, 94, 0.5);
        }

        /* Karikatur Styles */
        .upload-box-karikatur {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .upload-box-karikatur:hover {
            border-color: #f97316;
            background: linear-gradient(135deg, #fff7ed 0%, #fef3c7 100%);
            box-shadow: 0 10px 30px rgba(249, 115, 22, 0.2);
            transform: translateY(-2px);
        }
        .option-btn-karikatur {
            position: relative;
            padding: 0.75rem 1.5rem;
            border-radius: 0.75rem;
            border: 2px solid #e5e7eb;
            background-color: white;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            text-align: center;
            font-weight: 500;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
            overflow: hidden;
            font-size: 0.875rem;
            -webkit-tap-highlight-color: transparent;
            user-select: none;
            touch-action: manipulation;
        }
        .option-btn-karikatur::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: linear-gradient(135deg, #f97316 0%, #fbbf24 100%);
            transform: translate(-50%, -50%);
            transition: width 0.5s ease, height 0.5s ease;
            opacity: 0.1;
            z-index: 0;
        }
        .option-btn-karikatur.selected {
            background: linear-gradient(135deg, #fff7ed 0%, #fef3c7 100%);
            border-color: #f97316;
            color: #ea580c;
            font-weight: 700;
            box-shadow: 0 4px 16px rgba(249, 115, 22, 0.3);
            transform: translateY(-2px);
        }
        .option-btn-karikatur.selected::before {
            width: 300px;
            height: 300px;
        }
        .option-btn-karikatur:hover:not(.selected) {
            border-color: #f97316;
            background-color: #fffbeb;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(249, 115, 22, 0.2);
        }
        .option-btn-karikatur:active {
            transform: scale(0.98);
        }
        .option-btn-karikatur * {
            pointer-events: none;
        }
        .option-btn-karikatur i,
        .option-btn-karikatur span {
            position: relative;
            z-index: 1;
        }

        /* Karikatur Action Buttons - Mobile Friendly */
        #karikatur-results-grid .action-btn {
            -webkit-tap-highlight-color: transparent;
            user-select: none;
            touch-action: manipulation;
        }
        #karikatur-results-grid .action-btn * {
            pointer-events: none;
        }

        /* Photo Editor Styles */
        .upload-box-photoeditor {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .upload-box-photoeditor:hover {
            border-color: #8b5cf6;
            background: linear-gradient(135deg, #faf5ff 0%, #f3e8ff 100%);
            box-shadow: 0 10px 30px rgba(139, 92, 246, 0.2);
            transform: translateY(-2px);
        }
        .preset-btn-photoeditor {
            position: relative;
            padding: 0.75rem 1rem;
            border-radius: 0.75rem;
            border: 2px solid #e5e7eb;
            background-color: white;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            text-align: center;
            font-weight: 500;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
            overflow: hidden;
            font-size: 0.875rem;
            -webkit-tap-highlight-color: transparent;
            user-select: none;
            touch-action: manipulation;
        }
        .preset-btn-photoeditor::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: linear-gradient(135deg, #8b5cf6 0%, #a78bfa 100%);
            transform: translate(-50%, -50%);
            transition: width 0.5s ease, height 0.5s ease;
            opacity: 0.1;
            z-index: 0;
        }
        .preset-btn-photoeditor.selected {
            background: linear-gradient(135deg, #faf5ff 0%, #f3e8ff 100%);
            border-color: #8b5cf6;
            color: #7c3aed;
            font-weight: 700;
            box-shadow: 0 4px 16px rgba(139, 92, 246, 0.3);
            transform: translateY(-2px);
        }
        .preset-btn-photoeditor.selected::before {
            width: 300px;
            height: 300px;
        }
        .preset-btn-photoeditor:hover:not(.selected) {
            border-color: #8b5cf6;
            background-color: #faf5ff;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(139, 92, 246, 0.2);
        }
        .preset-btn-photoeditor:active {
            transform: scale(0.98);
        }
        .preset-btn-photoeditor * {
            pointer-events: none;
        }
        .preset-btn-photoeditor i,
        .preset-btn-photoeditor span {
            position: relative;
            z-index: 1;
        }

        /* Photo Editor Slider Styles */
        .slider-photoeditor {
            -webkit-appearance: none;
            appearance: none;
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: linear-gradient(to right, #e5e7eb 0%, #8b5cf6 50%, #e5e7eb 100%);
            outline: none;
            transition: all 0.3s;
        }
        .slider-photoeditor::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(139, 92, 246, 0.4);
            transition: all 0.3s;
        }
        .slider-photoeditor::-webkit-slider-thumb:hover {
            transform: scale(1.2);
            box-shadow: 0 4px 12px rgba(139, 92, 246, 0.6);
        }
        .slider-photoeditor::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
            cursor: pointer;
            border: none;
            box-shadow: 0 2px 8px rgba(139, 92, 246, 0.4);
            transition: all 0.3s;
        }
        .slider-photoeditor::-moz-range-thumb:hover {
            transform: scale(1.2);
            box-shadow: 0 4px 12px rgba(139, 92, 246, 0.6);
        }

        /* Photo Editor Action Buttons - Mobile Friendly */
        #photoeditor-results-grid .action-btn {
            -webkit-tap-highlight-color: transparent;
            user-select: none;
            touch-action: manipulation;
        }
        #photoeditor-results-grid .action-btn * {
            pointer-events: none;
        }

        /* Photo Editor Compare View */
        .compare-slider-container {
            position: relative;
            overflow: hidden;
            border-radius: 0.75rem;
        }
        .compare-slider {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 4px;
            height: 100%;
            background: white;
            cursor: ew-resize;
            z-index: 10;
            box-shadow: 0 0 10px rgba(0,0,0,0.3);
        }
        .compare-slider::before {
            content: '‚Üî';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            font-size: 20px;
        }

        /* Photo Editor Canvas - Keep original size internally, scale display with CSS */
        #photoeditor-canvas {
            display: block;
            max-width: 100%;
            height: auto;
            object-fit: contain;
            image-rendering: -webkit-optimize-contrast;
            image-rendering: crisp-edges;
        }

        /* AI Beauty Editor Styles */
        .upload-box-beauty {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .upload-box-beauty:hover {
            border-color: #ec4899;
            background: linear-gradient(135deg, #fdf2f8 0%, #fce7f3 100%);
            box-shadow: 0 10px 30px rgba(236, 72, 153, 0.2);
            transform: translateY(-2px);
        }
        .beauty-option-btn {
            position: relative;
            padding: 0.75rem 1rem;
            border-radius: 0.75rem;
            border: 2px solid #e5e7eb;
            background-color: white;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            text-align: center;
            font-weight: 500;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
            overflow: hidden;
            font-size: 0.875rem;
            -webkit-tap-highlight-color: transparent;
            user-select: none;
            touch-action: manipulation;
        }
        .beauty-option-btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: linear-gradient(135deg, #ec4899 0%, #f472b6 100%);
            transform: translate(-50%, -50%);
            transition: width 0.5s ease, height 0.5s ease;
            opacity: 0.1;
            z-index: 0;
        }
        .beauty-option-btn.selected {
            background: linear-gradient(135deg, #fdf2f8 0%, #fce7f3 100%);
            border-color: #ec4899;
            color: #db2777;
            font-weight: 700;
            box-shadow: 0 4px 16px rgba(236, 72, 153, 0.3);
            transform: translateY(-2px);
        }
        .beauty-option-btn.selected::before {
            width: 300px;
            height: 300px;
        }
        .beauty-option-btn:hover:not(.selected) {
            border-color: #ec4899;
            background-color: #fef3f9;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(236, 72, 153, 0.2);
        }
        .beauty-option-btn:active {
            transform: scale(0.98);
        }
        .beauty-option-btn * {
            pointer-events: none;
        }
        .beauty-option-btn i,
        .beauty-option-btn span {
            position: relative;
            z-index: 1;
        }

        /* Beauty Intensity Slider */
        .beauty-intensity-slider {
            -webkit-appearance: none;
            appearance: none;
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: linear-gradient(to right, #e5e7eb 0%, #ec4899 50%, #e5e7eb 100%);
            outline: none;
            transition: all 0.3s;
        }
        .beauty-intensity-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: linear-gradient(135deg, #ec4899 0%, #db2777 100%);
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(236, 72, 153, 0.4);
            transition: all 0.3s;
        }
        .beauty-intensity-slider::-webkit-slider-thumb:hover {
            transform: scale(1.2);
            box-shadow: 0 4px 12px rgba(236, 72, 153, 0.6);
        }
        .beauty-intensity-slider::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: linear-gradient(135deg, #ec4899 0%, #db2777 100%);
            cursor: pointer;
            border: none;
            box-shadow: 0 2px 8px rgba(236, 72, 153, 0.4);
            transition: all 0.3s;
        }
        .beauty-intensity-slider::-moz-range-thumb:hover {
            transform: scale(1.2);
            box-shadow: 0 4px 12px rgba(236, 72, 153, 0.6);
        }

        /* AI Beauty Editor Action Buttons - Mobile Friendly */
        #beauty-results-grid .action-btn {
            -webkit-tap-highlight-color: transparent;
            user-select: none;
            touch-action: manipulation;
        }
        #beauty-results-grid .action-btn * {
            pointer-events: none;
        }

        /* Desain Rumah Styles */
        .upload-box-desain {
            transition: all 0.3s ease;
        }
        .upload-box-desain:hover {
            border-color: #0EA5E9;
            background-color: #E0F2FE;
        }
        .option-btn-desain,
        .checkbox-btn-desain {
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            border: 1px solid #d1d5db;
            background-color: white;
            cursor: pointer;
            transition: all 0.2s ease-in-out;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            text-align: center;
        }
        .option-btn-desain.selected,
        .checkbox-btn-desain.selected {
            background-color: #E0F2FE;
            border-color: #0EA5E9;
            color: #0284C7;
            font-weight: 600;
        }
        .option-btn-desain:hover:not(.selected),
        .checkbox-btn-desain:hover:not(.selected) {
            border-color: #0EA5E9;
            background-color: #F0F9FF;
        }

        /* Sketsa Gambar Styles */
        .upload-box-sketsa {
            transition: all 0.3s ease;
        }
        .upload-box-sketsa:hover {
            border-color: #8B5CF6;
            background-color: #F3E8FF;
        }
        .option-btn-sketsa {
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            border: 1px solid #d1d5db;
            background-color: white;
            cursor: pointer;
            transition: all 0.2s ease-in-out;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            text-align: center;
        }
        .option-btn-sketsa.selected {
            background-color: #F3E8FF;
            border-color: #8B5CF6;
            color: #7C3AED;
            font-weight: 600;
        }
        .option-btn-sketsa:hover:not(.selected) {
            border-color: #8B5CF6;
            background-color: #FAF5FF;
        }

        /* --- BIKIN CAROUSEL TAB SPECIFIC STYLES --- */
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 28px;
        }
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 28px;
        }
        .slider:before {
            position: absolute;
            content: "";
            height: 20px;
            width: 20px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        input:checked + .slider {
            background-color: #14b8a6;
        }
        input:checked + .slider:before {
            transform: translateX(22px);
        }

        .carousel-container {
            position: relative;
            overflow: hidden;
            border-radius: 0.75rem;
        }
        .carousel-slides {
            display: flex;
            transition: transform 0.5s ease-in-out;
        }
        .carousel-slide {
            flex: 0 0 100%;
            width: 100%;
            position: relative;
        }
        .carousel-slide img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
        }
        .carousel-nav {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background-color: rgba(0, 0, 0, 0.4);
            color: white;
            -webkit-tap-highlight-color: transparent;
            user-select: none;
            touch-action: manipulation;
            border: none;
            border-radius: 50%;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: background-color 0.2s;
            z-index: 10;
        }
        .carousel-nav:hover { background-color: rgba(0, 0, 0, 0.7); }
        .carousel-nav.prev { left: 8px; }
        .carousel-nav.next { right: 8px; }
        .carousel-dots {
            position: absolute;
            bottom: 10px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 6px;
        }
        .carousel-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background-color: rgba(255, 255, 255, 0.5);
            transition: background-color 0.3s;
            cursor: pointer;
            -webkit-tap-highlight-color: transparent;
            user-select: none;
            touch-action: manipulation;
        }
        .carousel-dot.active {
            background-color: white;
        }

        /* Carousel Download Button - Mobile Friendly */
        .crsl-open-download-btn {
            display: inline-flex;
            align-items: center;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            cursor: pointer;
            transition: all 0.2s ease;
            -webkit-tap-highlight-color: transparent;
            user-select: none;
            touch-action: manipulation;
            border: none;
            background: transparent;
        }

        .crsl-open-download-btn * {
            pointer-events: none;
        }

        .crsl-open-download-btn:hover {
            transform: translateY(-1px);
        }

        .crsl-open-download-btn:active {
            transform: scale(0.98);
        }

        .crsl-tooltip {
            position: absolute;
            bottom: calc(100% + 8px);
            left: 50%;
            transform: translateX(-50%);
            background-color: #012633;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            font-size: 0.8rem;
            font-weight: 500;
            white-space: nowrap;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease, transform 0.3s ease;
            transform-origin: bottom center;
            scale: 0.9;
        }
        .crsl-tooltip.visible {
            opacity: 1;
            pointer-events: auto;
            scale: 1;
        }
        .crsl-tooltip::after {
            content: '';
            position: absolute;
            top: 100%;
            left: 50%;
            margin-left: -5px;
            border-width: 5px;
            border-style: solid;
            border-color: #012633 transparent transparent transparent;
        }

        /* Carousel Option Buttons Styling */
        #content-bikin-carousel .option-btn {
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            border: 2px solid #d1d5db;
            background-color: white;
            cursor: pointer;
            transition: all 0.2s ease-in-out;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            text-align: center;
            font-weight: 500;
            color: #6b7280;
            -webkit-tap-highlight-color: transparent;
            user-select: none;
            touch-action: manipulation;
        }

        #content-bikin-carousel .option-btn * {
            pointer-events: none;
        }

        /* Vertical layout for aspect ratio buttons */
        #content-bikin-carousel .option-btn.flex-col {
            flex-direction: column;
            gap: 0.25rem;
            padding: 0.5rem 0.25rem;
        }

        #content-bikin-carousel .option-btn:hover {
            border-color: #EC4899;
            background-color: #FCE7F3;
            color: #DB2777;
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(236, 72, 153, 0.1);
        }

        #content-bikin-carousel .option-btn.selected {
            background: linear-gradient(135deg, #FCE7F3 0%, #FBCFE8 100%);
            border-color: #EC4899;
            color: #DB2777;
            font-weight: 600;
            box-shadow: 0 2px 8px rgba(236, 72, 153, 0.2);
        }

        #content-bikin-carousel .option-btn:active {
            transform: translateY(0);
            box-shadow: 0 1px 2px rgba(236, 72, 153, 0.1);
        }

        /* Carousel Input Fields Styling */
        #content-bikin-carousel input[type="text"],
        #content-bikin-carousel textarea {
            border: 2px solid #e5e7eb;
            transition: all 0.2s ease-in-out;
        }

        #content-bikin-carousel input[type="text"]:focus,
        #content-bikin-carousel textarea:focus {
            border-color: #EC4899;
            box-shadow: 0 0 0 3px rgba(236, 72, 153, 0.1);
            outline: none;
        }

        #content-bikin-carousel input[type="text"]:hover,
        #content-bikin-carousel textarea:hover {
            border-color: #cbd5e1;
        }

        /* Carousel Button Enhancements */
        #crsl-auto-btn,
        #crsl-auto-script-btn,
        #crsl-generate-btn,
        #crsl-remove-btn {
            -webkit-tap-highlight-color: transparent;
            user-select: none;
            touch-action: manipulation;
        }

        #crsl-auto-btn *,
        #crsl-auto-script-btn *,
        #crsl-generate-btn *,
        #crsl-remove-btn * {
            pointer-events: none;
        }

        #crsl-auto-script-btn:not(:disabled):hover,
        #crsl-generate-btn:not(:disabled):hover {
            transform: translateY(-2px);
        }

        #crsl-auto-script-btn:not(:disabled):active,
        #crsl-generate-btn:not(:disabled):active {
            transform: translateY(0);
        }

        /* Carousel Toggle Switch Enhancement */
        #content-bikin-carousel .toggle-switch {
            cursor: pointer;
            transition: all 0.2s ease;
        }

        #content-bikin-carousel .toggle-switch:hover .slider {
            box-shadow: 0 0 0 4px rgba(20, 184, 166, 0.1);
        }

        #content-bikin-carousel .slider {
            transition: all 0.3s ease;
        }

        @media (min-width: 1024px) {
            .desktop-carousel-frame {
                max-width: 400px;
                margin: 1rem auto;
                padding: 0.75rem;
                background-color: white;
                border-radius: 1.5rem;
                border: 1px solid #d1d5db;
                box-shadow: 0 10px 25px -5px rgba(0,0,0,0.1), 0 8px 10px -6px rgba(0,0,0,0.1);
                overflow: hidden;
            }
            .desktop-carousel-frame .carousel-container {
                border-radius: 1rem;
            }
        }

        /* ==================== LOGO GENERATOR STYLES ==================== */

        /* Logo Generator Color Scheme - Professional Gradient */
        :root {
            --logo-primary: #7C3AED;
            --logo-secondary: #EC4899;
            --logo-light: #F3E8FF;
            --logo-dark: #6D28D9;
        }

        /* Upload Box Styles */
        .upload-box-logo,
        .upload-box-logo-ref {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .upload-box-logo:hover,
        .upload-box-logo-ref:hover {
            border-color: var(--logo-primary);
            background: linear-gradient(135deg, #F3E8FF 0%, #FCE7F3 100%);
            box-shadow: 0 10px 30px rgba(124, 58, 237, 0.2);
            transform: translateY(-2px);
        }

        /* Option Button Styles for Logo Generator */
        .option-btn-logo {
            padding: 0.75rem 1rem;
            border: 2px solid #e5e7eb;
            border-radius: 0.75rem;
            background-color: white;
            color: #374151;
            font-weight: 600;
            font-size: 0.875rem;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            text-align: center;
        }

        .option-btn-logo:hover {
            border-color: var(--logo-primary);
            background-color: var(--logo-light);
            color: var(--logo-dark);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(124, 58, 237, 0.15);
        }

        .option-btn-logo.selected {
            background: linear-gradient(135deg, #F3E8FF 0%, #FCE7F3 100%);
            border-color: var(--logo-primary);
            color: var(--logo-dark);
            font-weight: 700;
            box-shadow: 0 4px 16px rgba(124, 58, 237, 0.3);
        }

        /* Checkbox Button for Logo Generator */
        .checkbox-btn-logo {
            padding: 0.75rem 1rem;
            border: 2px solid #e5e7eb;
            border-radius: 0.75rem;
            background-color: white;
            color: #374151;
            font-weight: 600;
            font-size: 0.875rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .checkbox-btn-logo:hover {
            border-color: var(--logo-primary);
            background-color: var(--logo-light);
            color: var(--logo-dark);
        }

        .checkbox-btn-logo.active {
            background: linear-gradient(135deg, var(--logo-primary), var(--logo-secondary));
            border-color: var(--logo-primary);
            color: white;
            box-shadow: 0 4px 12px rgba(124, 58, 237, 0.3);
        }

        .checkbox-btn-logo.active i {
            display: inline-block;
        }

        /* Logo Preview Card */
        .logo-preview-card {
            position: relative;
            border-radius: 1rem;
            overflow: hidden;
            background: white;
            border: 2px solid #e5e7eb;
            transition: all 0.3s ease;
        }

        .logo-preview-card:hover {
            border-color: var(--logo-primary);
            box-shadow: 0 10px 30px rgba(124, 58, 237, 0.2);
            transform: translateY(-4px);
        }

        /* Logo Mockup Tabs */
        .logo-mockup-tab {
            padding: 0.75rem 1.5rem;
            border: none;
            background: transparent;
            color: #6b7280;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            border-bottom: 3px solid transparent;
        }

        .logo-mockup-tab:hover {
            color: var(--logo-primary);
            background: rgba(124, 58, 237, 0.05);
        }

        .logo-mockup-tab.active {
            color: var(--logo-primary);
            border-bottom-color: var(--logo-primary);
            background: rgba(124, 58, 237, 0.1);
        }

        /* Logo Color Palette */
        .logo-color-chip {
            width: 3rem;
            height: 3rem;
            border-radius: 0.75rem;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 3px solid transparent;
            position: relative;
        }

        .logo-color-chip:hover {
            transform: scale(1.1);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        .logo-color-chip.selected {
            border-color: white;
            box-shadow: 0 0 0 3px var(--logo-primary);
            transform: scale(1.15);
        }

        .logo-color-chip.selected::after {
            content: '‚úì';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 1.25rem;
            font-weight: bold;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        /* Photo Restoration Buttons */
        .pr-intensity-btn, .pr-ratio-btn {
            padding: 0.75rem;
            border: 2px solid #d1d5db;
            border-radius: 0.75rem;
            background: white;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.25rem;
            font-size: 0.875rem;
            font-weight: 600;
            color: #6b7280;
        }

        .pr-intensity-btn:hover, .pr-ratio-btn:hover {
            border-color: #f59e0b;
            background: #fffbeb;
            transform: translateY(-2px);
        }

        .pr-intensity-btn.active, .pr-ratio-btn.active {
            border-color: #f59e0b;
            background: linear-gradient(135deg, #d97706, #f59e0b);
            color: white;
            box-shadow: 0 4px 12px rgba(245, 158, 11, 0.3);
        }

        .pr-intensity-btn i, .pr-ratio-btn i {
            font-size: 1.25rem;
        }

        /* Logo Generator Button */
        #logo-generate-btn {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        #logo-generate-btn:not(:disabled):hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(124, 58, 237, 0.3);
        }

        #logo-generate-btn:not(:disabled):active {
            transform: translateY(0);
        }

        /* Logo Info Badge */
        .logo-info-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: linear-gradient(135deg, #F3E8FF 0%, #FCE7F3 100%);
            border: 2px solid var(--logo-primary);
            border-radius: 9999px;
            color: var(--logo-dark);
            font-size: 0.875rem;
            font-weight: 600;
        }

        /* Logo Variation Badge */
        .logo-variation-badge {
            position: absolute;
            top: 0.5rem;
            left: 0.5rem;
            background: linear-gradient(135deg, var(--logo-primary), var(--logo-secondary));
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 700;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
            z-index: 10;
        }

        /* Affiliate & E-Commerce Button Styles */
        .desc-platform-btn, .desc-length-btn,
        .tiktok-type-btn, .tiktok-duration-btn,
        .story-tone-btn, .story-length-btn {
            padding: 0.75rem 1rem;
            border-radius: 0.5rem;
            border: 2px solid #d1d5db;
            background-color: white;
            cursor: pointer;
            transition: all 0.2s ease-in-out;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            font-weight: 500;
            color: #6b7280;
        }

        .desc-platform-btn:hover, .desc-length-btn:hover,
        .tiktok-type-btn:hover, .tiktok-duration-btn:hover,
        .story-tone-btn:hover, .story-length-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .desc-platform-btn.active, .desc-length-btn.active {
            background: linear-gradient(135deg, #fed7aa 0%, #fdba74 100%);
            border-color: #f97316;
            color: #7c2d12;
            font-weight: 600;
            box-shadow: 0 2px 8px rgba(249, 115, 22, 0.3);
        }

        .tiktok-type-btn.active, .tiktok-duration-btn.active {
            background: linear-gradient(135deg, #fbcfe8 0%, #f9a8d4 100%);
            border-color: #ec4899;
            color: #831843;
            font-weight: 600;
            box-shadow: 0 2px 8px rgba(236, 72, 153, 0.3);
        }

        .story-tone-btn.active, .story-length-btn.active {
            background: linear-gradient(135deg, #bfdbfe 0%, #93c5fd 100%);
            border-color: #3b82f6;
            color: #1e3a8a;
            font-weight: 600;
            box-shadow: 0 2px 8px rgba(59, 130, 246, 0.3);
        }

        .desc-platform-btn:active, .desc-length-btn:active,
        .tiktok-type-btn:active, .tiktok-duration-btn:active,
        .story-tone-btn:active, .story-length-btn:active {
            transform: translateY(0);
        }

        /* Poster Generator Styles */
        .upload-box-poster {
            border: 3px dashed #D1D5DB;
            border-radius: 1rem;
            padding: 2rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.05) 0%, rgba(236, 72, 153, 0.05) 100%);
        }

        .upload-box-poster:hover {
            border-color: #8B5CF6;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(139, 92, 246, 0.2);
        }

        .poster-color-btn,
        .poster-style-btn,
        .poster-size-btn,
        .poster-count-btn {
            padding: 0.75rem;
            border-radius: 0.5rem;
            border: 2px solid #E5E7EB;
            background-color: white;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 500;
            color: #6B7280;
            position: relative;
        }

        .poster-color-btn {
            height: 3rem;
            border: none;
            position: relative;
            overflow: hidden;
        }

        .poster-color-btn::before {
            content: '';
            position: absolute;
            inset: 0;
            border-radius: 0.5rem;
            padding: 2px;
            background: linear-gradient(135deg, transparent, rgba(255,255,255,0.3));
            -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
            -webkit-mask-composite: xor;
            mask-composite: exclude;
        }

        .poster-color-btn.active::after {
            content: '\2713';
            position: absolute;
            top: 0.25rem;
            right: 0.25rem;
            width: 1.25rem;
            height: 1.25rem;
            background: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            color: #8B5CF6;
            font-weight: bold;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .poster-style-btn:hover,
        .poster-size-btn:hover,
        .poster-count-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            border-color: #8B5CF6;
        }

        .poster-style-btn.active,
        .poster-size-btn.active,
        .poster-count-btn.active {
            background: linear-gradient(135deg, #8B5CF6 0%, #EC4899 100%);
            border-color: #8B5CF6;
            color: white;
            font-weight: 600;
            box-shadow: 0 4px 12px rgba(139, 92, 246, 0.4);
        }

        .poster-color-btn:active,
        .poster-style-btn:active,
        .poster-size-btn:active,
        .poster-count-btn:active {
            transform: scale(0.95);
        }

        /* Object Remover Styles */
        .upload-box-remover {
            border: 3px dashed #D1D5DB;
            border-radius: 1rem;
            padding: 2rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.05) 0%, rgba(220, 38, 38, 0.05) 100%);
        }

        .upload-box-remover:hover {
            border-color: #EF4444;
            border-style: solid;
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(239, 68, 68, 0.15);
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.08) 0%, rgba(220, 38, 38, 0.08) 100%);
        }

        .remover-mode-btn {
            padding: 0.75rem 1.5rem;
            border-radius: 0.75rem;
            border: 2px solid #E5E7EB;
            background-color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            position: relative;
            overflow: hidden;
        }

        .remover-mode-btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(239, 68, 68, 0.1);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        .remover-mode-btn:hover::before {
            width: 300px;
            height: 300px;
        }

        .remover-mode-btn.active {
            background: linear-gradient(135deg, #EF4444 0%, #DC2626 100%);
            color: white;
            border-color: #DC2626;
            box-shadow: 0 4px 12px rgba(239, 68, 68, 0.4);
        }

        .remover-mode-btn:active {
            transform: scale(0.95);
        }

        #remover-canvas-container {
            position: relative;
            display: inline-block;
            max-width: 100%;
            border-radius: 1rem;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        #remover-canvas {
            display: block;
            max-width: 100%;
            height: auto;
            cursor: crosshair;
        }

        .brush-size-slider {
            width: 100%;
            height: 8px;
            border-radius: 4px;
            background: linear-gradient(to right, #FEE2E2, #EF4444);
            outline: none;
            -webkit-appearance: none;
        }

        .brush-size-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #EF4444;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(239, 68, 68, 0.4);
        }

        .brush-size-slider::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #EF4444;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(239, 68, 68, 0.4);
        }

        .remover-tool-btn {
            padding: 0.75rem 1rem;
            border-radius: 0.5rem;
            border: 2px solid #E5E7EB;
            background-color: white;
            cursor: pointer;
            transition: all 0.2s ease;
            font-weight: 600;
        }

        .remover-tool-btn:hover {
            border-color: #EF4444;
            background-color: #FEF2F2;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(239, 68, 68, 0.15);
        }

        .remover-tool-btn:active {
            transform: translateY(0);
        }

        .remover-tool-btn.danger {
            background: linear-gradient(135deg, #DC2626 0%, #B91C1C 100%);
            color: white;
            border-color: #B91C1C;
        }

        .remover-tool-btn.danger:hover {
            background: linear-gradient(135deg, #B91C1C 0%, #991B1B 100%);
            box-shadow: 0 4px 12px rgba(220, 38, 38, 0.3);
        }

        .remover-variation-btn {
            padding: 0.75rem 1.5rem;
            border-radius: 0.75rem;
            border: 2px solid #E5E7EB;
            background-color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
        }

        .remover-variation-btn.active {
            background: linear-gradient(135deg, #EF4444 0%, #DC2626 100%);
            color: white;
            border-color: #DC2626;
            box-shadow: 0 4px 12px rgba(239, 68, 68, 0.4);
        }

        .remover-variation-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        /* NEW Badge for Tabs */
        .new-badge {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            margin-left: 0.5rem;
            padding: 0.125rem 0.5rem;
            background: linear-gradient(135deg, #f59e0b 0%, #ef4444 100%);
            color: white;
            border-radius: 9999px;
            font-size: 0.625rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            box-shadow: 0 2px 6px rgba(239, 68, 68, 0.3);
            animation: pulse-badge 2s ease-in-out infinite;
        }

        @keyframes pulse-badge {
            0%, 100% {
                box-shadow: 0 2px 6px rgba(239, 68, 68, 0.3);
                transform: scale(1);
            }
            50% {
                box-shadow: 0 2px 12px rgba(239, 68, 68, 0.5);
                transform: scale(1.05);
            }
        }

        .main-tab-btn .new-badge {
            margin-left: auto;
        }

        .mobile-tab-btn .new-badge {
            position: absolute;
            top: 0.25rem;
            right: 0.25rem;
            padding: 0.0625rem 0.25rem;
            font-size: 0.5rem;
        }

        /* Logo Download Action Buttons */
        .logo-action-btn {
            background: linear-gradient(135deg, var(--logo-primary), var(--logo-secondary));
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            font-weight: 600;
            transition: all 0.3s ease;
            border: none;
            cursor: pointer;
            -webkit-tap-highlight-color: transparent;
            user-select: none;
            touch-action: manipulation;
        }

        .logo-action-btn * {
            pointer-events: none;
        }

        .logo-action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(124, 58, 237, 0.4);
        }

        .logo-action-btn:active {
            transform: scale(0.98);
        }

        /* Animated Loader for Logo Generator */
        .loader-icon-logo {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(124, 58, 237, 0.1);
            border-top-color: var(--logo-primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Logo Generator Input Focus States */
        #content-logo-generator input[type="text"]:focus,
        #content-logo-generator textarea:focus {
            border-color: var(--logo-primary);
            box-shadow: 0 0 0 3px rgba(124, 58, 237, 0.1);
            outline: none;
        }

        /* Logo AI Suggestion Tooltip */
        .logo-ai-tooltip {
            position: relative;
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
            padding: 0.25rem 0.5rem;
            background: linear-gradient(135deg, #FEF3C7, #FDE68A);
            border-radius: 0.5rem;
            font-size: 0.75rem;
            font-weight: 600;
            color: #92400E;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        /* ==================== MASCOT GENERATOR STYLES ==================== */

        /* Mascot Generator Color Scheme - Playful & Fun */
        :root {
            --mascot-primary: #F59E0B;
            --mascot-secondary: #EF4444;
            --mascot-light: #FEF3C7;
            --mascot-dark: #D97706;
        }

        /* Upload Box Styles */
        .upload-box-mascot,
        .upload-box-mascot-ref {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .upload-box-mascot:hover,
        .upload-box-mascot-ref:hover {
            border-color: var(--mascot-primary);
            background: linear-gradient(135deg, #FEF3C7 0%, #FEE2E2 100%);
            box-shadow: 0 10px 30px rgba(245, 158, 11, 0.2);
            transform: translateY(-2px);
        }

        /* Option Button Styles for Mascot Generator */
        .option-btn-mascot {
            padding: 0.75rem 1rem;
            border: 2px solid #e5e7eb;
            border-radius: 0.75rem;
            background-color: white;
            color: #374151;
            font-weight: 600;
            font-size: 0.875rem;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            text-align: center;
        }

        .option-btn-mascot:hover {
            border-color: var(--mascot-primary);
            background-color: var(--mascot-light);
            color: var(--mascot-dark);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(245, 158, 11, 0.15);
        }

        .option-btn-mascot.selected {
            background: linear-gradient(135deg, #FEF3C7 0%, #FEE2E2 100%);
            border-color: var(--mascot-primary);
            color: var(--mascot-dark);
            font-weight: 700;
            box-shadow: 0 4px 16px rgba(245, 158, 11, 0.3);
        }

        /* Checkbox Button for Mascot Generator */
        .checkbox-btn-mascot {
            padding: 0.75rem 1rem;
            border: 2px solid #e5e7eb;
            border-radius: 0.75rem;
            background-color: white;
            color: #374151;
            font-weight: 600;
            font-size: 0.875rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .checkbox-btn-mascot:hover {
            border-color: var(--mascot-primary);
            background-color: var(--mascot-light);
            color: var(--mascot-dark);
        }

        .checkbox-btn-mascot.active {
            background: linear-gradient(135deg, var(--mascot-primary), var(--mascot-secondary));
            border-color: var(--mascot-primary);
            color: white;
            box-shadow: 0 4px 12px rgba(245, 158, 11, 0.3);
        }

        .checkbox-btn-mascot.active i {
            display: inline-block;
        }

        /* Mascot Preview Card */
        .mascot-preview-card {
            position: relative;
            border-radius: 1rem;
            overflow: hidden;
            background: white;
            border: 2px solid #e5e7eb;
            transition: all 0.3s ease;
        }

        .mascot-preview-card:hover {
            border-color: var(--mascot-primary);
            box-shadow: 0 10px 30px rgba(245, 158, 11, 0.2);
            transform: translateY(-4px);
        }

        /* Mascot Variation Badge */
        .mascot-variation-badge {
            position: absolute;
            top: 0.5rem;
            left: 0.5rem;
            background: linear-gradient(135deg, var(--mascot-primary), var(--mascot-secondary));
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 700;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
            z-index: 10;
        }

        /* Mascot Action Buttons */
        .mascot-action-btn {
            background: linear-gradient(135deg, var(--mascot-primary), var(--mascot-secondary));
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            font-weight: 600;
            transition: all 0.3s ease;
            border: none;
            cursor: pointer;
        }

        .mascot-action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(245, 158, 11, 0.4);
        }

        /* Animated Loader for Mascot Generator */
        .loader-icon-mascot {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(245, 158, 11, 0.1);
            border-top-color: var(--mascot-primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        /* Mascot Generator Button */
        #mascot-generate-btn {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        #mascot-generate-btn:not(:disabled):hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(245, 158, 11, 0.3);
        }

        #mascot-generate-btn:not(:disabled):active {
            transform: translateY(0);
        }

        /* Mascot Info Badge */
        .mascot-info-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: linear-gradient(135deg, #FEF3C7 0%, #FEE2E2 100%);
            border: 2px solid var(--mascot-primary);
            border-radius: 9999px;
            color: var(--mascot-dark);
            font-size: 0.875rem;
            font-weight: 600;
        }

        /* Mascot Generator Input Focus States */
        #content-mascot-generator input[type="text"]:focus,
        #content-mascot-generator textarea:focus {
            border-color: var(--mascot-primary);
            box-shadow: 0 0 0 3px rgba(245, 158, 11, 0.1);
            outline: none;
        }

        /* Mascot Character Trait Tags */
        .mascot-trait-tag {
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
            padding: 0.375rem 0.75rem;
            background: linear-gradient(135deg, #FEF3C7, #FDE68A);
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
            color: #92400E;
            border: 1px solid #F59E0B;
        }

        /* Reference vs Generated Comparison */
        .mascot-comparison-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            padding: 1rem;
            background: linear-gradient(135deg, #FEF3C7 0%, #FEE2E2 100%);
            border-radius: 1rem;
            border: 2px dashed var(--mascot-primary);
        }

        .mascot-comparison-label {
            text-align: center;
            font-weight: 700;
            color: var(--mascot-dark);
            font-size: 0.875rem;
            margin-bottom: 0.5rem;
        }

        /* --- MOBILE BOTTOM NAVIGATION --- */
        .mobile-bottom-nav {
            display: none;
        }

        @media (max-width: 768px) {
            /* Hide sidebar on mobile */
            .sidebar {
                display: none;
            }

            /* Show bottom navigation */
            .mobile-bottom-nav {
                display: block;
                position: fixed;
                bottom: 0;
                left: 0;
                right: 0;
                background: linear-gradient(180deg, #ffffff 0%, #f8fafc 100%);
                border-top: 2px solid #e2e8f0;
                box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
                z-index: 1000;
                padding: 0.5rem 0;
                overflow-x: auto;
                overflow-y: hidden;
                -webkit-overflow-scrolling: touch;
            }

            /* Hide scrollbar but keep functionality */
            .mobile-bottom-nav::-webkit-scrollbar {
                display: none;
            }
            .mobile-bottom-nav {
                -ms-overflow-style: none;
                scrollbar-width: none;
            }

            /* Container for tabs */
            .mobile-tabs-container {
                display: flex;
                gap: 0.5rem;
                padding: 0 1rem;
                min-width: min-content;
            }

            /* Mobile tab button style */
            .mobile-tab-btn {
                flex-shrink: 0;
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                gap: 0.25rem;
                padding: 0.5rem 1rem;
                background: white;
                border: 2px solid #e2e8f0;
                border-radius: 0.75rem;
                cursor: pointer;
                transition: all 0.2s ease;
                min-width: 80px;
                text-decoration: none;
                color: #64748b;
            }

            .mobile-tab-btn i {
                font-size: 1.25rem;
            }

            .mobile-tab-btn span {
                font-size: 0.7rem;
                font-weight: 500;
                white-space: nowrap;
            }

            .mobile-tab-btn.active {
                background: linear-gradient(135deg, #0ea5e9 0%, #06b6d4 100%);
                border-color: #0ea5e9;
                color: white;
                box-shadow: 0 4px 12px rgba(14, 165, 233, 0.3);
            }

            .mobile-tab-btn:not(.active):hover {
                border-color: #0ea5e9;
                background-color: #f0f9ff;
                color: #0284c7;
            }

            /* Adjust main content wrapper for mobile */
            .main-content-wrapper {
                margin-left: 0;
                width: 100%;
                padding: 1rem;
                padding-bottom: 5rem; /* Space for bottom nav */
            }

            /* Hide toggle sidebar button on mobile */
            .toggle-sidebar-btn {
                display: none;
            }

            /* Mobile header */
            .mobile-header {
                display: block;
                position: sticky;
                top: 0;
                z-index: 999;
                background: linear-gradient(135deg, #0ea5e9 0%, #06b6d4 100%);
                padding: 1rem;
                text-align: center;
                box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            }

            .mobile-header h1 {
                color: white;
                font-size: 1.25rem;
                font-weight: 700;
                margin: 0;
            }
        }

        /* Desktop: hide mobile header */
        .mobile-header {
            display: none;
        }

        /* Action Buttons - Professional Styling */
        .action-btn {
            position: relative;
            overflow: hidden;
            font-weight: 600;
            letter-spacing: 0.025em;
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            cursor: pointer;
            -webkit-tap-highlight-color: transparent;
            user-select: none;
            -webkit-user-select: none;
            touch-action: manipulation;
        }

        .action-btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            transform: translate(-50%, -50%);
            transition: width 0.4s ease, height 0.4s ease;
            pointer-events: none;
        }

        .action-btn:hover::before {
            width: 300px;
            height: 300px;
        }

        .action-btn svg {
            position: relative;
            z-index: 1;
            filter: drop-shadow(0 1px 2px rgba(0, 0, 0, 0.2));
            pointer-events: none;
        }

        .action-btn i {
            position: relative;
            z-index: 1;
            filter: drop-shadow(0 1px 2px rgba(0, 0, 0, 0.2));
            pointer-events: none;
        }

        .action-btn span {
            position: relative;
            z-index: 1;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
            pointer-events: none;
        }

        .action-btn * {
            pointer-events: none;
        }

        /* Enhanced result card hover effects */
        .result-card .group:hover {
            transform: translateY(-2px);
            transition: transform 0.2s ease;
        }

        .result-card img {
            transition: transform 0.3s ease;
        }

        .result-card .group:hover img {
            transform: scale(1.02);
        }

        /* Smooth focus effects for accessibility */
        .action-btn:focus {
            outline: 2px solid rgba(255, 255, 255, 0.8);
            outline-offset: 2px;
        }

        .action-btn:active {
            transform: scale(0.95);
        }

        /* Professional Upload Area Styling */
        .file-input-label {
            position: relative;
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            border: 2px dashed #cbd5e1;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
            overflow: hidden;
        }

        .file-input-label::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.05) 0%, rgba(168, 85, 247, 0.05) 100%);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .file-input-label:hover {
            border-color: #818cf8;
            background: linear-gradient(135deg, #ffffff 0%, #f1f5f9 100%);
            transform: translateY(-2px);
            box-shadow: 0 10px 25px -5px rgba(99, 102, 241, 0.1), 0 8px 10px -6px rgba(99, 102, 241, 0.1);
        }

        .file-input-label:hover::before {
            opacity: 1;
        }

        .file-input-label svg {
            transition: all 0.3s ease;
        }

        .file-input-label:hover svg {
            transform: scale(1.1) translateY(-4px);
            color: #818cf8;
        }

        /* Modern Input Fields */
        textarea, input[type="text"] {
            transition: all 0.3s ease;
        }

        textarea:focus, input[type="text"]:focus {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.15);
        }

        /* Button Secondary Enhancement */
        .btn-secondary {
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .btn-secondary::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            transform: translate(-50%, -50%);
            transition: width 0.4s ease, height 0.4s ease;
        }

        .btn-secondary:hover::before {
            width: 300px;
            height: 300px;
        }

        .btn-secondary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(99, 102, 241, 0.2);
        }

        .btn-secondary:active {
            transform: translateY(0);
        }

        /* Button Primary Enhancement */
        .btn-primary {
            position: relative;
            overflow: hidden;
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .btn-primary::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            transform: translate(-50%, -50%);
            transition: width 0.5s ease, height 0.5s ease;
        }

        .btn-primary:hover::after {
            width: 400px;
            height: 400px;
        }

        .btn-primary:hover {
            transform: translateY(-3px) scale(1.02);
            box-shadow: 0 12px 24px rgba(99, 102, 241, 0.3), 0 8px 12px rgba(139, 92, 246, 0.2);
        }

        .btn-primary:active {
            transform: translateY(-1px) scale(0.98);
        }

        .btn-primary:disabled {
            background: linear-gradient(135deg, #cbd5e1 0%, #94a3b8 100%);
            cursor: not-allowed;
            transform: none !important;
            box-shadow: none !important;
        }

        /* Card Enhancement for Input Panels */
        .card {
            transition: all 0.3s ease;
            border: 1px solid rgba(226, 232, 240, 0.8);
        }

        .card:hover {
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.08), 0 8px 16px rgba(0, 0, 0, 0.04);
            border-color: rgba(99, 102, 241, 0.2);
        }

        /* Loading State */
        .loader {
            border: 3px solid #f3f4f6;
            border-top: 3px solid #6366f1;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Image Preview Enhancement */
        #review-image-preview-container .relative,
        #ads-image-preview-container .relative {
            transition: all 0.3s ease;
        }

        #review-image-preview-container .relative:hover,
        #ads-image-preview-container .relative:hover {
            transform: translateY(-4px) scale(1.05);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.15);
        }

        #review-image-preview-container img,
        #ads-image-preview-container img {
            transition: all 0.3s ease;
        }

        /* Orientation Button Styling */
        .orientation-label {
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .orientation-label:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.15);
            border-color: #818cf8 !important;
        }

        .orientation-label:has(input:checked) {
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            color: white;
            border-color: #6366f1 !important;
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
        }

        /* Smooth Transitions for All Interactive Elements */
        * {
            -webkit-tap-highlight-color: transparent;
        }

        button, a, input, textarea, select {
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* Professional Pulse Animation for Loading */
        @keyframes professional-pulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.6;
            }
        }

        .animate-pulse {
            animation: professional-pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }

        /* Chatbot Styling */
        #chat-container {
            scroll-behavior: smooth;
        }

        #chat-container::-webkit-scrollbar {
            width: 8px;
        }

        #chat-container::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }

        #chat-container::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, #667eea, #764ba2);
            border-radius: 10px;
        }

        #chat-container::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(180deg, #764ba2, #667eea);
        }

        .chat-message {
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .quick-question-btn {
            transition: all 0.2s ease;
        }

        .quick-question-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        .quick-question-btn:active {
            transform: translateY(0);
        }

        /* Bounce animation for thinking indicator */
        @keyframes bounce {
            0%, 80%, 100% {
                transform: translateY(0);
            }
            40% {
                transform: translateY(-8px);
            }
        }

        .animate-bounce {
            animation: bounce 1s infinite;
        }
    </style>
</head>
<body>
    <!-- Mobile Header -->
    <div class="mobile-header">
        <h1><i class="fas fa-magic"></i> Oracle Foto Studio <span class="text-xs bg-gradient-to-r from-sky-500 to-violet-500 text-white px-2 py-1 rounded-full">V16</span></h1>
        <p class="text-xs text-gray-400 mt-1">by Basmedia</p>
    </div>

    <div class="app-container">
        <!-- Vertical Sidebar Navigation -->
        <aside class="sidebar">
            <div class="text-center mb-6 pb-4 border-b-2 border-slate-200">
                <h1 class="text-lg font-bold text-transparent bg-clip-text bg-gradient-to-r from-sky-500 to-violet-500">
                    Oracle Foto Studio
                </h1>
                <p class="text-xs text-gray-500 mt-1">by Basmedia</p>
                <div class="mt-2">
                    <span class="text-xs bg-gradient-to-r from-sky-500 to-violet-500 text-white px-3 py-1 rounded-full font-semibold shadow-lg">V16</span>
                </div>
            </div>

            <nav class="flex flex-col gap-1">
                <!-- BERANDA Tab -->
                <button data-tab="beranda" class="main-tab-btn active" style="margin-bottom: 1rem; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; font-weight: 600; box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);">
                    <i class="fas fa-home"></i>
                    <span class="btn-text">Beranda</span>
                </button>

                <!-- PHOTO STUDIO Category -->
                <div class="menu-category">
                    <div class="menu-category-title">
                        <i class="fas fa-camera mr-1"></i> Photo Studio
                    </div>
                    <button data-tab="mockup-studio" class="main-tab-btn">
                        <i class="fas fa-palette"></i>
                        <span class="btn-text">Mockup Studio</span>
                    </button>
                    <button data-tab="pov-tangan" class="main-tab-btn">
                        <i class="fas fa-hand-holding"></i>
                        <span class="btn-text">POV Tangan</span>
                    </button>
                </div>

                <!-- UGC CONTENT Category -->
                <div class="menu-category">
                    <div class="menu-category-title">
                        <i class="fas fa-fire mr-1"></i> UGC Content Affiliate GO
                    </div>
                    <button data-tab="affiliate" class="main-tab-btn">
                        <i class="fas fa-rocket"></i>
                        <span class="btn-text">Foto Produk Affiliate</span>
                    </button>
                    <button data-tab="virtual-tryon" class="main-tab-btn">
                        <i class="fas fa-tshirt"></i>
                        <span class="btn-text">Virtual Try-On</span>
                    </button>
                    <button data-tab="pose-fashion" class="main-tab-btn">
                        <i class="fas fa-user-tie"></i>
                        <span class="btn-text">Pose Fashion</span>
                    </button>
                    <button data-tab="food-selfie" class="main-tab-btn">
                        <i class="fas fa-utensils"></i>
                        <span class="btn-text">Food Selfie</span>
                    </button>
                    <button data-tab="product-review" class="main-tab-btn">
                        <i class="fas fa-star-half-alt"></i>
                        <span class="btn-text">Product Review</span>
                    </button>
                    <button data-tab="product-ads" class="main-tab-btn">
                        <i class="fas fa-bullhorn"></i>
                        <span class="btn-text">Iklan Produk</span>
                    </button>
                    <button data-tab="professional-headshot" class="main-tab-btn">
                        <i class="fas fa-user-tie"></i>
                        <span class="btn-text">Professional Headshot</span>
                        <span class="new-badge">NEW</span>
                    </button>
                </div>

                <!-- AFFILIATE & E-COMMERCE Category -->
                <div class="menu-category">
                    <div class="menu-category-title">
                        <i class="fas fa-shopping-cart mr-1"></i> Affiliate & E-Commerce
                    </div>
                    <button data-tab="deskripsi-produk" class="main-tab-btn">
                        <i class="fas fa-tags"></i>
                        <span class="btn-text">Deskripsi Produk SEO</span>
                    </button>
                    <button data-tab="ide-konten-tiktok" class="main-tab-btn">
                        <i class="fab fa-tiktok"></i>
                        <span class="btn-text">Ide Konten TikTok</span>
                    </button>
                    <button data-tab="script-story-iklan" class="main-tab-btn">
                        <i class="fas fa-book-open"></i>
                        <span class="btn-text">Script Story Iklan</span>
                    </button>
                </div>

                <!-- ALAT BISNIS Category -->
                <div class="menu-category">
                    <div class="menu-category-title">
                        <i class="fas fa-briefcase mr-1"></i> Alat Bisnis
                    </div>
                    <button data-tab="rencana-bisnis" class="main-tab-btn">
                        <i class="fas fa-chart-line"></i>
                        <span class="btn-text">Rencana Bisnis & SWOT</span>
                    </button>
                    <button data-tab="hr-assistant" class="main-tab-btn">
                        <i class="fas fa-users"></i>
                        <span class="btn-text">HR Assistant</span>
                    </button>
                    <button data-tab="konten-marketing" class="main-tab-btn">
                        <i class="fas fa-bullhorn"></i>
                        <span class="btn-text">Konten Marketing</span>
                    </button>
                    <button data-tab="riset-pasar" class="main-tab-btn">
                        <i class="fas fa-search-dollar"></i>
                        <span class="btn-text">Riset Pasar & Ide</span>
                    </button>
                    <button data-tab="financial-forecast" class="main-tab-btn">
                        <i class="fas fa-calculator"></i>
                        <span class="btn-text">Simulasi Anggaran</span>
                    </button>
                </div>

                <!-- FAMILY & LIFESTYLE Category -->
                <div class="menu-category">
                    <div class="menu-category-title">
                        <i class="fas fa-home mr-1"></i> Family & Lifestyle
                    </div>
                    <button data-tab="family" class="main-tab-btn">
                        <i class="fas fa-users"></i>
                        <span class="btn-text">Foto Keluarga</span>
                    </button>
                    <button data-tab="new-born" class="main-tab-btn">
                        <i class="fas fa-baby"></i>
                        <span class="btn-text">New Born Studio</span>
                    </button>
                    <button data-tab="profesi-anak" class="main-tab-btn">
                        <i class="fas fa-user-tie"></i>
                        <span class="btn-text">Foto Profesi Anak</span>
                    </button>
                    <button data-tab="wedding" class="main-tab-btn">
                        <i class="fas fa-ring"></i>
                        <span class="btn-text">Wedding</span>
                    </button>
                    <button data-tab="umrah-haji" class="main-tab-btn">
                        <i class="fas fa-kaaba"></i>
                        <span class="btn-text">Foto Umrah/Haji</span>
                    </button>
                    <button data-tab="passport-photo" class="main-tab-btn">
                        <i class="fas fa-id-card"></i>
                        <span class="btn-text">Pas Foto Warna</span>
                    </button>
                    <button data-tab="photo-booth" class="main-tab-btn">
                        <i class="fas fa-camera-retro"></i>
                        <span class="btn-text">Photo Booth</span>
                        <span class="new-badge">NEW</span>
                    </button>
                    <button data-tab="desain-rumah" class="main-tab-btn">
                        <i class="fas fa-home"></i>
                        <span class="btn-text">Desain Rumah</span>
                    </button>
                    <button data-tab="sketsa-gambar" class="main-tab-btn">
                        <i class="fas fa-pencil-ruler"></i>
                        <span class="btn-text">Sketsa Gambar</span>
                    </button>
                    <button data-tab="bikin-carousel" class="main-tab-btn">
                        <i class="fas fa-images"></i>
                        <span class="btn-text">Bikin Carousel</span>
                    </button>
                </div>

                <!-- CREATIVE TOOLS Category -->
                <div class="menu-category">
                    <div class="menu-category-title">
                        <i class="fas fa-magic mr-1"></i> Creative Tools
                    </div>
                    <button data-tab="miniature" class="main-tab-btn">
                        <i class="fas fa-user-astronaut"></i>
                        <span class="btn-text">Miniature Me</span>
                    </button>
                    <button data-tab="karikatur" class="main-tab-btn">
                        <i class="fas fa-palette"></i>
                        <span class="btn-text">Karikatur Generator</span>
                        <span class="new-badge">NEW</span>
                    </button>
                    <button data-tab="photo-editor" class="main-tab-btn">
                        <i class="fas fa-sliders-h"></i>
                        <span class="btn-text">Photo Editor Pro</span>
                        <span class="new-badge">NEW</span>
                    </button>
                    <button data-tab="ai-beauty" class="main-tab-btn">
                        <i class="fas fa-wand-magic-sparkles"></i>
                        <span class="btn-text">AI Beauty Editor</span>
                        <span class="new-badge">NEW</span>
                    </button>
                    <button data-tab="halu" class="main-tab-btn">
                        <i class="fas fa-heart"></i>
                        <span class="btn-text">Halu Idol</span>
                    </button>
                    <button data-tab="sticker" class="main-tab-btn">
                        <i class="fas fa-star"></i>
                        <span class="btn-text">Sticker Tempel</span>
                    </button>
                    <button data-tab="hair-generator" class="main-tab-btn">
                        <i class="fas fa-cut"></i>
                        <span class="btn-text">Hair Generator</span>
                    </button>
                    <button data-tab="expression-changer" class="main-tab-btn">
                        <i class="fas fa-face-laugh-beam"></i>
                        <span class="btn-text">Expression Changer</span>
                    </button>
                    <button data-tab="face-swap" class="main-tab-btn">
                        <i class="fas fa-face-grin-stars"></i>
                        <span class="btn-text">Face Swap</span>
                        <span class="new-badge">NEW</span>
                    </button>
                    <button data-tab="bg-remover" class="main-tab-btn">
                        <i class="fas fa-scissors"></i>
                        <span class="btn-text">Hapus Background</span>
                        <span class="new-badge">NEW</span>
                    </button>
                    <button data-tab="photo-extender" class="main-tab-btn">
                        <i class="fas fa-expand-arrows-alt"></i>
                        <span class="btn-text">Perluas Foto</span>
                        <span class="new-badge">NEW</span>
                    </button>
                    <button data-tab="story-board" class="main-tab-btn">
                        <i class="fas fa-film"></i>
                        <span class="btn-text">Story Board</span>
                        <span class="new-badge">NEW</span>
                    </button>
                    <button data-tab="twibon" class="main-tab-btn">
                        <i class="fas fa-image"></i>
                        <span class="btn-text">Twibon Frame</span>
                        <span class="new-badge">NEW</span>
                    </button>
                    <button data-tab="story-update" class="main-tab-btn">
                        <i class="fas fa-camera-retro"></i>
                        <span class="btn-text">Story Update</span>
                    </button>
                    <button data-tab="photo-angle" class="main-tab-btn">
                        <i class="fas fa-cube"></i>
                        <span class="btn-text">Photo Angle</span>
                        <span class="new-badge">NEW</span>
                    </button>
                    <button data-tab="style-matcher" class="main-tab-btn">
                        <i class="fas fa-magic"></i>
                        <span class="btn-text">Style Matcher</span>
                        <span class="new-badge">NEW</span>
                    </button>
                    <button data-tab="thumbnail-generator" class="main-tab-btn">
                        <i class="fas fa-rectangle-ad"></i>
                        <span class="btn-text">Thumbnail Pro</span>
                        <span class="new-badge">NEW</span>
                    </button>
                    <button data-tab="cover-photo-generator" class="main-tab-btn">
                        <i class="fas fa-image-portrait"></i>
                        <span class="btn-text">Foto sampul IG & Tiktok</span>
                        <span class="new-badge">NEW</span>
                    </button>
                    <button data-tab="photo-restoration" class="main-tab-btn">
                        <i class="fas fa-clock-rotate-left"></i>
                        <span class="btn-text">Restorasi Foto</span>
                        <span class="new-badge">NEW</span>
                    </button>
                    <button data-tab="object-remover" class="main-tab-btn">
                        <i class="fas fa-eraser"></i>
                        <span class="btn-text">Hapus Object</span>
                        <span class="new-badge">NEW</span>
                    </button>
                    <button data-tab="logo-generator" class="main-tab-btn">
                        <i class="fas fa-palette"></i>
                        <span class="btn-text">Logo Generator</span>
                        <span class="new-badge">NEW</span>
                    </button>
                    <button data-tab="mascot-generator" class="main-tab-btn">
                        <i class="fas fa-dragon"></i>
                        <span class="btn-text">Mascot Generator</span>
                        <span class="new-badge">NEW</span>
                    </button>
                    <button data-tab="poster-generator" class="main-tab-btn">
                        <i class="fas fa-image"></i>
                        <span class="btn-text">Poster Generator</span>
                        <span class="new-badge">NEW</span>
                    </button>
                </div>

                <!-- VIDEO & AUDIO Category -->
                <div class="menu-category">
                    <div class="menu-category-title">
                        <i class="fas fa-film mr-1"></i> Video & Audio
                    </div>
                    <button data-tab="veo" class="main-tab-btn">
                        <i class="fas fa-video"></i>
                        <span class="btn-text">VEO Generator</span>
                    </button>
                    <button data-tab="opal" class="main-tab-btn">
                        <i class="fas fa-magic"></i>
                        <span class="btn-text">Opal Image to Video</span>
                    </button>
                    <button data-tab="voice-over" class="main-tab-btn">
                        <i class="fas fa-microphone"></i>
                        <span class="btn-text">Voice Over</span>
                    </button>
                    <button data-tab="video-analyzer" class="main-tab-btn">
                        <i class="fas fa-film"></i>
                        <span class="btn-text">Video Analyzer</span>
                    </button>
                </div>
            </nav>
        </aside>

        <!-- Toggle Sidebar Button -->
        <button id="toggle-sidebar-btn" class="toggle-sidebar-btn" title="Toggle Sidebar">
            <i class="fas fa-chevron-left"></i>
        </button>

        <!-- Main Content Wrapper -->
        <main class="main-content-wrapper" id="main-content-wrapper">
            <header class="text-center mb-8" id="main-header">
                <h2 class="text-3xl sm:text-4xl lg:text-5xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-sky-500 to-violet-500">
                    Selamat Datang
                </h2>
                <p class="text-base text-gray-500 mt-2">
                    Semua kebutuhan kreasi foto AI Anda dalam satu tempat.
                </p>
            </header>

    <!-- Main Tab Content Containers -->
    <div id="main-tab-content">
        <!-- TAB BERANDA: LOGIN SCREEN -->
        <div id="content-beranda" class="main-content-panel">
            <!-- Tampilan Form Login (Jika belum login) -->
            <div id="login-view" class="container mx-auto max-w-md mt-10 md:mt-20">
                <div class="card p-8 shadow-2xl rounded-3xl border-2 border-purple-100 text-center bg-white relative overflow-hidden">
                    <!-- Hiasan Background -->
                    <div class="absolute top-0 left-0 w-full h-2 bg-gradient-to-r from-sky-500 to-violet-500"></div>
                    
                    <div class="w-20 h-20 bg-gradient-to-br from-sky-500 to-violet-500 rounded-2xl mx-auto flex items-center justify-center shadow-lg mb-6 transform rotate-3">
                        <i class="fas fa-lock text-4xl text-white -rotate-3"></i>
                    </div>
                    <h2 class="text-3xl font-bold text-gray-800 mb-2">Login Akses</h2>
                    <p class="text-gray-500 mb-8 text-sm">Aplikasi ini bersifat privat. Silakan masuk menggunakan email yang telah didaftarkan.</p>

                    <div class="space-y-5 text-left relative z-10">
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Alamat Email <span class="text-red-500">*</span></label>
                            <div class="relative">
                                <i class="fas fa-envelope absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                                <input type="email" id="login-email-input" class="w-full pl-11 pr-4 py-4 border-2 border-gray-300 rounded-xl focus:border-violet-500 focus:ring-2 focus:ring-violet-200 transition-all outline-none" placeholder="Masukkan email Anda...">
                            </div>
                        </div>
                        <button id="login-submit-btn" class="w-full bg-gradient-to-r from-sky-500 to-violet-600 hover:from-sky-600 hover:to-violet-700 text-white font-bold py-4 px-6 rounded-xl shadow-lg transform hover:scale-[1.02] transition-all flex items-center justify-center">
                            <i class="fas fa-sign-in-alt mr-2"></i> Masuk Sekarang
                        </button>
                        <p id="login-error-msg" class="text-red-500 text-sm text-center hidden font-medium bg-red-50 p-3 rounded-lg border border-red-200">
                            <i class="fas fa-exclamation-triangle mr-1"></i> Email tidak terdaftar. Lakukan Pembelian Dulu!
                        </p>
                    </div>
                </div>
            </div>

            <!-- Tampilan Welcome (Jika sudah berhasil login) -->
            <div id="welcome-view" class="container mx-auto max-w-5xl hidden">
                <header class="text-center mb-8 bg-white p-10 rounded-3xl shadow-xl border border-gray-100">
                    <div class="w-24 h-24 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-6">
                        <i class="fas fa-check-circle text-6xl text-green-500"></i>
                    </div>
                    <h1 class="text-4xl md:text-5xl font-bold mb-4 text-transparent bg-clip-text bg-gradient-to-r from-sky-500 to-violet-600">
                        Login Berhasil!
                    </h1>
                    <p class="text-xl text-gray-700">
                        Selamat datang kembali, <strong id="welcome-user-email" class="text-violet-600"></strong>
                    </p>
                    <p class="text-gray-500 mt-4 max-w-2xl mx-auto">
                        Anda sekarang memiliki akses penuh ke 50+ fitur AI Generator di Oracle Foto Studio. Silakan pilih alat yang ingin Anda gunakan melalui menu navigasi di samping (atau di bawah untuk pengguna HP).
                    </p>
                    <button id="logout-btn" class="mt-8 bg-gray-100 hover:bg-red-50 text-gray-600 hover:text-red-600 font-semibold py-2 px-6 rounded-full transition-colors border border-gray-200 hover:border-red-200 text-sm">
                        <i class="fas fa-sign-out-alt mr-1"></i> Keluar
                    </button>
                </header>
            </div>
        </div>

        <!-- TAB 0: MOCKUP STUDIO -->
        <div id="content-mockup-studio" class="main-content-panel hidden">
            <div class="container mx-auto max-w-7xl">
                <header class="text-center mb-8">
                    <h1 class="text-4xl md:text-5xl font-bold mb-3 drop-shadow-lg">
                        <i class="fas fa-palette mr-3"></i>Mockup Studio
                    </h1>
                    <p class="text-lg opacity-90">
                        Buat 7 mockup profesional dari design Anda dengan berbagai template
                    </p>
                    <p class="text-sm opacity-75 mt-2">
                        Upload design ‚Üí Pilih template mockup atau tema ‚Üí Dapatkan hasil mockup realistis!
                    </p>
                </header>

                <div class="card mb-8">
                    <!-- Upload Design Section -->
                    <div class="mb-6">
                        <h2 class="text-2xl font-bold mb-4 text-gray-800">
                            <i class="fas fa-cloud-upload-alt mr-2"></i>Upload Design/Artwork
                        </h2>
                        <div id="mockup-upload-area" class="upload-area cursor-pointer">
                            <div id="mockup-upload-placeholder" style="display: block;">
                                <i class="fas fa-images text-6xl text-purple-500 mb-4"></i>
                                <p class="text-xl font-semibold text-gray-700 mb-2">
                                    Klik atau drag design Anda di sini
                                </p>
                                <p class="text-sm text-gray-500">
                                    Format: JPG, PNG, WEBP (Max 10MB)
                                </p>
                            </div>
                            <div id="mockup-preview-container" class="hidden">
                                <img id="mockup-preview-image" alt="Preview" class="preview-image" />
                            </div>
                        </div>
                        <input
                            type="file"
                            id="mockup-design-input"
                            accept="image/*"
                            class="hidden"
                        />
                    </div>

                    <!-- Mockup Template Reference Section (Optional) -->
                    <div class="mb-6">
                        <h3 class="text-xl font-bold mb-3 text-gray-800">
                            <i class="fas fa-image mr-2"></i>Template Mockup Referensi (Opsional)
                        </h3>
                        <div id="mockup-template-upload-area" class="upload-area cursor-pointer" style="min-height: 150px;">
                            <div id="mockup-template-placeholder" style="display: block;">
                                <i class="fas fa-file-image text-4xl text-indigo-500 mb-3"></i>
                                <p class="text-lg font-semibold text-gray-700 mb-1">
                                    Upload foto template mockup (Opsional)
                                </p>
                                <p class="text-xs text-gray-500">
                                    Design akan ditempelkan ke template ini
                                </p>
                            </div>
                            <div id="mockup-template-preview-container" class="hidden relative">
                                <img id="mockup-template-preview-image" alt="Template Preview" class="preview-image" />
                                <button id="mockup-template-remove-btn" class="absolute top-2 right-2 bg-red-500 hover:bg-red-600 text-white rounded-full w-8 h-8 flex items-center justify-center transition-all">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                        </div>
                        <input
                            type="file"
                            id="mockup-template-input"
                            accept="image/*"
                            class="hidden"
                        />
                        <p class="text-xs text-gray-500 mt-2">
                            <i class="fas fa-lightbulb mr-1"></i>
                            Tips: Upload foto template (contoh: foto kaos, gelas, poster, dll). Design akan ditempelkan secara realistis
                        </p>
                    </div>

                    <!-- Mockup Theme Input Section (Optional) -->
                    <div class="mb-6">
                        <h3 class="text-xl font-bold mb-3 text-gray-800">
                            <i class="fas fa-magic mr-2"></i>Tema Mockup Manual (Opsional)
                        </h3>
                        <input
                            type="text"
                            id="mockup-theme-input"
                            placeholder="Contoh: gelas, kaos, poster, mug, buku, smartphone, tote bag, dll..."
                            class="w-full p-4 border-2 border-purple-200 rounded-lg focus:border-purple-500 focus:ring-2 focus:ring-purple-200 transition-all"
                        />
                        <p class="text-xs text-gray-500 mt-2">
                            <i class="fas fa-info-circle mr-1"></i>
                            Tips: Sebutkan jenis mockup yang Anda inginkan. Kosongkan untuk variasi otomatis
                        </p>
                    </div>

                    <!-- Aspect Ratio Selection -->
                    <div class="mb-6">
                        <h3 class="text-xl font-bold mb-3 text-gray-800">
                            <i class="fas fa-expand-arrows-alt mr-2"></i>Rasio Aspek
                        </h3>
                        <div id="mockup-ratio-selection" class="grid grid-cols-2 sm:grid-cols-4 gap-3">
                            <button type="button" data-ratio="1:1" class="ratio-btn-mockup">
                                <i class="fas fa-square mr-2"></i>1:1
                            </button>
                            <button type="button" data-ratio="16:9" class="ratio-btn-mockup selected">
                                <i class="fas fa-rectangle-landscape mr-2"></i>16:9
                            </button>
                            <button type="button" data-ratio="3:4" class="ratio-btn-mockup">
                                <i class="fas fa-rectangle-portrait mr-2"></i>3:4
                            </button>
                            <button type="button" data-ratio="9:16" class="ratio-btn-mockup">
                                <i class="fas fa-mobile-alt mr-2"></i>9:16
                            </button>
                        </div>
                        <p class="text-xs text-gray-500 mt-2">
                            <i class="fas fa-lightbulb mr-1"></i>
                            Pilih rasio aspek untuk semua mockup yang akan di-generate
                        </p>
                    </div>

                    <!-- Generate Button -->
                    <div class="text-center">
                        <button
                            id="mockup-generate-btn"
                            class="btn-generate disabled:opacity-50"
                            disabled
                        >
                            <i class="fas fa-magic mr-3"></i>
                            Generate 7 Mockup
                        </button>
                    </div>
                </div>

                <!-- Loading Section -->
                <div id="mockup-loading-section" class="hidden text-center py-12">
                    <div class="card inline-block">
                        <div class="flex flex-col items-center">
                            <div class="pov-loader mb-6"></div>
                            <h3 class="text-2xl font-bold text-gray-800 mb-2">
                                Sedang Membuat Mockup...
                            </h3>
                            <p class="text-gray-600 mb-4">
                                Mohon tunggu, AI sedang menghasilkan <span id="mockup-progress-text">0/7</span> mockup
                            </p>
                            <div class="w-full max-w-md bg-gray-200 rounded-full h-3">
                                <div
                                    id="mockup-progress-bar"
                                    class="bg-gradient-to-r from-purple-500 to-indigo-600 h-3 rounded-full transition-all duration-300"
                                    style="width: 0%"
                                ></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Results Section -->
                <div id="mockup-results-section" class="hidden">
                    <div class="card">
                        <div class="flex justify-between items-center mb-6">
                            <h2 class="text-3xl font-bold text-gray-800">
                                <i class="fas fa-check-circle text-green-500 mr-2"></i>
                                Hasil Mockup (<span id="mockup-result-count">0</span> mockup)
                            </h2>
                            <button
                                id="mockup-download-all-btn"
                                class="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-6 rounded-full transition-all"
                            >
                                <i class="fas fa-download mr-2"></i>
                                Download Semua
                            </button>
                        </div>
                        <div id="mockup-results-grid" class="result-grid">
                            <!-- Results will be inserted here -->
                        </div>
                    </div>
                </div>

                <!-- Error Section -->
                <div id="mockup-error-section" class="hidden">
                    <div class="card bg-red-50 border-2 border-red-300">
                        <div class="flex items-start">
                            <i class="fas fa-exclamation-triangle text-red-500 text-3xl mr-4 mt-1"></i>
                            <div>
                                <h3 class="text-xl font-bold text-red-800 mb-2">Terjadi Kesalahan</h3>
                                <p id="mockup-error-message" class="text-red-700"></p>
                                <button
                                    id="mockup-retry-btn"
                                    class="mt-4 bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-6 rounded-lg transition-all"
                                >
                                    <i class="fas fa-redo mr-2"></i>Coba Lagi
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- TAB 1: MINIATURE ME -->
        <div id="content-miniature" class="main-content-panel hidden">
            <!-- Content from Miniature Me HTML body goes here -->
            <div class="container mx-auto">
                <header class="text-center mb-8">
                    <h1 class="text-4xl md:text-5xl font-bold text-[#1e3a8a]">Miniature Me</h1>
                    <p class="text-lg text-gray-600 mt-2">Ubah fotomu menjadi miniatur AI yang unik ‚ú®</p>
                </header>

                <main class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <div id="miniature-result-container" class="w-full p-6 md:p-8 rounded-2xl shadow-lg glassmorphism flex flex-col justify-center items-center text-center min-h-[400px]">
                        <div id="miniature-placeholder-result">
                            <i class="fas fa-user-astronaut text-8xl text-[#a5b4fc]"></i>
                            <p class="mt-4 text-xl text-gray-600">20 Pilihan miniatur AI akan muncul di sini</p>
                        </div>
                        <div id="miniature-loader" class="hidden flex-col items-center">
                            <div class="loader"></div>
                            <p class="mt-4 text-lg text-gray-700">AI sedang menyusutkan Anda... Mohon tunggu!</p>
                        </div>
                        <div id="miniature-result-content" class="hidden w-full grid grid-cols-2 sm:grid-cols-4 gap-4"></div>
                        <div id="miniature-error-message" class="hidden text-red-600"></div>
                    </div>

                    <div class="w-full p-6 md:p-8 rounded-2xl shadow-lg glassmorphism">
                        <div>
                            <label class="block text-xl font-semibold mb-3 text-[#1e3a8a]">1. Unggah Fotomu (Wajib)</label>
                            <div id="miniature-person-image-uploader" class="image-uploader-box rounded-lg p-6 text-center cursor-pointer transition-colors">
                                <input type="file" id="miniature-person-file-input" class="hidden" accept="image/*">
                                <div id="miniature-person-upload-prompt">
                                    <i class="fas fa-user-circle text-4xl text-[#a5b4fc] mb-2"></i>
                                    <p class="text-gray-700">Klik atau seret fotomu ke sini</p>
                                </div>
                                <img id="miniature-person-image-preview" src="" alt="Pratinjau Foto" class="hidden max-h-80 mx-auto rounded-lg shadow-lg">
                            </div>
                        </div>

                        <div class="mt-6">
                            <label class="block text-xl font-semibold mb-3 text-[#1e3a8a]">2. Pilih Rasio Aspek</label>
                            <div id="miniature-ratio-selection" class="grid grid-cols-2 sm:grid-cols-4 gap-3">
                                <button type="button" data-ratio="1:1" class="ratio-btn-mini">
                                    <i class="fas fa-square mr-2"></i>1:1
                                </button>
                                <button type="button" data-ratio="16:9" class="ratio-btn-mini selected">
                                    <i class="fas fa-rectangle-landscape mr-2"></i>16:9
                                </button>
                                <button type="button" data-ratio="3:4" class="ratio-btn-mini">
                                    <i class="fas fa-rectangle-portrait mr-2"></i>3:4
                                </button>
                                <button type="button" data-ratio="9:16" class="ratio-btn-mini">
                                    <i class="fas fa-mobile-alt mr-2"></i>9:16
                                </button>
                            </div>
                        </div>

                        <div class="mt-6">
                            <label for="miniature-manual-prompt" class="block text-xl font-semibold mb-2 text-[#1e3a8a]">3. Tulis Prompt Manual (Opsional)</label>
                            <p class="text-sm text-gray-600 mb-3">Tambahkan detail spesifik untuk semua gambar.</p>
                            <textarea id="miniature-manual-prompt" class="w-full p-3 rounded-lg border-2 min-h-[100px]" placeholder="Contoh: cute chibi style, ultra realistic, 8k"></textarea>
                        </div>

                        <div class="mt-8">
                            <button id="miniature-generate-btn" class="w-full bg-[#4f46e5] text-white py-4 px-6 rounded-lg text-lg font-bold hover:bg-[#4338ca] transition-transform transform hover:scale-105 shadow-md disabled:opacity-50 disabled:cursor-not-allowed disabled:scale-100" disabled>
                                <i class="fas fa-magic mr-2"></i>Generate 6 Miniatur
                            </button>
                        </div>
                    </div>
                </main>
            </div>
        </div>

        <!-- KARIKATUR GENERATOR -->
        <div id="content-karikatur" class="main-content-panel hidden">
            <div class="container mx-auto px-4 py-8">
                <header class="text-center mb-8">
                    <h1 class="text-4xl md:text-5xl font-bold bg-gradient-to-r from-orange-600 to-yellow-500 bg-clip-text text-transparent">Karikatur Generator</h1>
                    <p class="text-lg text-gray-600 mt-2">Ubah fotomu menjadi berbagai style karikatur profesional dengan AI üé®</p>
                </header>

                <main class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <!-- Left Panel: Configuration -->
                    <div class="w-full p-6 md:p-8 rounded-2xl shadow-lg bg-white">
                        <!-- Step 1: Upload Photo -->
                        <div class="mb-6">
                            <div class="flex items-center gap-3 mb-3">
                                <div class="flex items-center justify-center w-8 h-8 rounded-full bg-gradient-to-br from-orange-500 to-yellow-500 text-white font-bold text-sm shadow-lg">1</div>
                                <label class="text-xl font-semibold text-gray-800">Unggah Foto</label>
                            </div>
                            <label for="karikatur-image-input" class="upload-box-karikatur block relative border-3 border-dashed border-gray-300 rounded-xl p-8 text-center cursor-pointer bg-gradient-to-br from-orange-50 to-yellow-50 hover:shadow-xl transition-all">
                                <input type="file" id="karikatur-image-input" class="hidden" accept="image/png, image/jpeg, image/webp, image/heic, .heic">
                                <div id="karikatur-upload-prompt">
                                    <i class="fas fa-image text-5xl text-orange-400 mb-3"></i>
                                    <p class="text-gray-700 font-semibold">Klik atau seret foto di sini</p>
                                    <p class="text-sm text-gray-500 mt-1">PNG, JPG, WEBP, HEIC</p>
                                </div>
                                <img id="karikatur-image-preview" src="" alt="Preview" class="hidden w-full h-auto rounded-lg">
                            </label>
                            <!-- Mobile-only preview -->
                            <div id="karikatur-preview-container" class="mt-3 hidden lg:hidden">
                                <img id="karikatur-mobile-preview" src="" alt="Preview" class="w-full rounded-lg shadow-lg max-h-48 object-cover">
                                <button id="karikatur-remove-preview" class="mt-2 w-full bg-red-600 hover:bg-red-700 text-white text-sm py-2 px-3 rounded-lg transition-colors">
                                    <i class="fas fa-times mr-1"></i> Hapus Foto
                                </button>
                            </div>
                        </div>

                        <!-- Step 2: Caricature Style -->
                        <div class="mb-6">
                            <div class="flex items-center gap-3 mb-3">
                                <div class="flex items-center justify-center w-8 h-8 rounded-full bg-gradient-to-br from-orange-500 to-yellow-500 text-white font-bold text-sm shadow-lg">2</div>
                                <label class="text-xl font-semibold text-gray-800">Style Karikatur</label>
                            </div>
                            <div id="karikatur-style-options" class="grid grid-cols-2 sm:grid-cols-3 gap-3">
                                <button type="button" data-style="anime" class="option-btn-karikatur selected">
                                    <i class="fas fa-dragon mr-2"></i>
                                    <span>Anime/Manga</span>
                                </button>
                                <button type="button" data-style="cartoon" class="option-btn-karikatur">
                                    <i class="fas fa-laugh-squint mr-2"></i>
                                    <span>Cartoon Western</span>
                                </button>
                                <button type="button" data-style="pixar" class="option-btn-karikatur">
                                    <i class="fas fa-cube mr-2"></i>
                                    <span>Pixar 3D</span>
                                </button>
                                <button type="button" data-style="comic" class="option-btn-karikatur">
                                    <i class="fas fa-book mr-2"></i>
                                    <span>Comic Book</span>
                                </button>
                                <button type="button" data-style="watercolor" class="option-btn-karikatur">
                                    <i class="fas fa-paintbrush mr-2"></i>
                                    <span>Watercolor</span>
                                </button>
                                <button type="button" data-style="digital" class="option-btn-karikatur">
                                    <i class="fas fa-desktop mr-2"></i>
                                    <span>Digital Art</span>
                                </button>
                                <button type="button" data-style="sketch" class="option-btn-karikatur">
                                    <i class="fas fa-pencil mr-2"></i>
                                    <span>Sketch</span>
                                </button>
                                <button type="button" data-style="popart" class="option-btn-karikatur">
                                    <i class="fas fa-fire mr-2"></i>
                                    <span>Pop Art</span>
                                </button>
                                <button type="button" data-style="chibi" class="option-btn-karikatur">
                                    <i class="fas fa-baby mr-2"></i>
                                    <span>Chibi/Cute</span>
                                </button>
                                <button type="button" data-style="realistic" class="option-btn-karikatur">
                                    <i class="fas fa-camera mr-2"></i>
                                    <span>Realistic</span>
                                </button>
                                <button type="button" data-style="vector" class="option-btn-karikatur">
                                    <i class="fas fa-bezier-curve mr-2"></i>
                                    <span>Vector Art</span>
                                </button>
                                <button type="button" data-style="custom" class="option-btn-karikatur">
                                    <i class="fas fa-pen-fancy mr-2"></i>
                                    <span>Custom</span>
                                </button>
                            </div>
                            <div id="karikatur-custom-style-container" class="mt-3 hidden">
                                <input type="text" id="karikatur-custom-style" class="w-full px-4 py-2 border-2 border-orange-300 rounded-lg focus:border-orange-500 focus:outline-none" placeholder="Masukkan style custom, contoh: disney style, ghibli style">
                            </div>
                        </div>

                        <!-- Step 3: Exaggeration Level -->
                        <div class="mb-6">
                            <div class="flex items-center gap-3 mb-3">
                                <div class="flex items-center justify-center w-8 h-8 rounded-full bg-gradient-to-br from-orange-500 to-yellow-500 text-white font-bold text-sm shadow-lg">3</div>
                                <label class="text-xl font-semibold text-gray-800">Tingkat Exaggeration</label>
                            </div>
                            <div id="karikatur-exaggeration-options" class="grid grid-cols-3 gap-3">
                                <button type="button" data-exaggeration="subtle" class="option-btn-karikatur">
                                    <span>Subtle</span>
                                </button>
                                <button type="button" data-exaggeration="moderate" class="option-btn-karikatur selected">
                                    <span>Moderate</span>
                                </button>
                                <button type="button" data-exaggeration="extreme" class="option-btn-karikatur">
                                    <span>Extreme</span>
                                </button>
                            </div>
                        </div>

                        <!-- Step 4: Background Style -->
                        <div class="mb-6">
                            <div class="flex items-center gap-3 mb-3">
                                <div class="flex items-center justify-center w-8 h-8 rounded-full bg-gradient-to-br from-orange-500 to-yellow-500 text-white font-bold text-sm shadow-lg">4</div>
                                <label class="text-xl font-semibold text-gray-800">Background</label>
                            </div>
                            <div id="karikatur-background-options" class="grid grid-cols-2 sm:grid-cols-4 gap-3">
                                <button type="button" data-background="transparent" class="option-btn-karikatur selected">
                                    <span>Transparan</span>
                                </button>
                                <button type="button" data-background="solid" class="option-btn-karikatur">
                                    <span>Solid Color</span>
                                </button>
                                <button type="button" data-background="gradient" class="option-btn-karikatur">
                                    <span>Gradient</span>
                                </button>
                                <button type="button" data-background="scene" class="option-btn-karikatur">
                                    <span>Scene</span>
                                </button>
                            </div>
                            <div id="karikatur-background-detail-container" class="mt-3 hidden">
                                <input type="text" id="karikatur-background-detail" class="w-full px-4 py-2 border-2 border-orange-300 rounded-lg focus:border-orange-500 focus:outline-none" placeholder="Deskripsikan background yang diinginkan">
                            </div>
                        </div>

                        <!-- Step 5: Aspect Ratio -->
                        <div class="mb-6">
                            <div class="flex items-center gap-3 mb-3">
                                <div class="flex items-center justify-center w-8 h-8 rounded-full bg-gradient-to-br from-orange-500 to-yellow-500 text-white font-bold text-sm shadow-lg">5</div>
                                <label class="text-xl font-semibold text-gray-800">Aspect Ratio</label>
                            </div>
                            <div id="karikatur-ratio-options" class="grid grid-cols-2 sm:grid-cols-5 gap-3">
                                <button type="button" data-ratio="1:1" class="option-btn-karikatur">
                                    <i class="fas fa-square mr-2"></i>
                                    <span>1:1</span>
                                </button>
                                <button type="button" data-ratio="3:4" class="option-btn-karikatur selected">
                                    <i class="fas fa-portrait mr-2"></i>
                                    <span>3:4</span>
                                </button>
                                <button type="button" data-ratio="4:5" class="option-btn-karikatur">
                                    <i class="fas fa-rectangle-portrait mr-2"></i>
                                    <span>4:5</span>
                                </button>
                                <button type="button" data-ratio="9:16" class="option-btn-karikatur">
                                    <i class="fas fa-mobile-alt mr-2"></i>
                                    <span>9:16</span>
                                </button>
                                <button type="button" data-ratio="16:9" class="option-btn-karikatur">
                                    <i class="fas fa-tv mr-2"></i>
                                    <span>16:9</span>
                                </button>
                            </div>
                        </div>

                        <!-- Step 6: Number of Variations -->
                        <div class="mb-6">
                            <div class="flex items-center gap-3 mb-3">
                                <div class="flex items-center justify-center w-8 h-8 rounded-full bg-gradient-to-br from-orange-500 to-yellow-500 text-white font-bold text-sm shadow-lg">6</div>
                                <label class="text-xl font-semibold text-gray-800">Jumlah Variasi</label>
                            </div>
                            <div id="karikatur-count-options" class="grid grid-cols-3 gap-3">
                                <button type="button" data-count="4" class="option-btn-karikatur selected">
                                    <span>4 Gambar</span>
                                </button>
                                <button type="button" data-count="6" class="option-btn-karikatur">
                                    <span>6 Gambar</span>
                                </button>
                                <button type="button" data-count="8" class="option-btn-karikatur">
                                    <span>8 Gambar</span>
                                </button>
                            </div>
                        </div>

                        <!-- Step 7: Generate Button -->
                        <div class="mb-4">
                            <div class="flex items-center gap-3 mb-3">
                                <div class="flex items-center justify-center w-8 h-8 rounded-full bg-gradient-to-br from-orange-500 to-yellow-500 text-white font-bold text-sm shadow-lg">7</div>
                                <label class="text-xl font-semibold text-gray-800">Generate</label>
                            </div>
                            <button id="karikatur-generate-btn" class="w-full bg-gradient-to-r from-orange-600 to-yellow-500 hover:from-orange-700 hover:to-yellow-600 text-white py-4 px-6 rounded-xl text-lg font-bold transition-all duration-300 shadow-lg hover:shadow-xl hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed disabled:scale-100" disabled>
                                <i class="fas fa-palette mr-2"></i>
                                <span>Generate Karikatur</span>
                            </button>
                        </div>
                    </div>

                    <!-- Right Panel: Results -->
                    <div class="w-full p-6 md:p-8 rounded-2xl shadow-lg bg-white">
                        <div class="flex items-center justify-between mb-6">
                            <h2 class="text-2xl font-bold text-gray-800">
                                <i class="fas fa-images text-orange-500 mr-2"></i>
                                Hasil Karikatur
                            </h2>
                            <button id="karikatur-download-all-btn" class="hidden bg-gradient-to-r from-orange-600 to-yellow-500 hover:from-orange-700 hover:to-yellow-600 text-white px-4 py-2 rounded-lg font-semibold shadow-md hover:shadow-lg transition-all duration-300">
                                <i class="fas fa-download mr-2"></i>
                                <span>Download Semua</span>
                            </button>
                        </div>

                        <div id="karikatur-placeholder" class="flex flex-col items-center justify-center min-h-[500px] text-center">
                            <i class="fas fa-palette text-8xl text-orange-300 mb-4"></i>
                            <p class="text-xl text-gray-600">Karikatur akan muncul di sini</p>
                            <p class="text-sm text-gray-500 mt-2">Unggah foto dan pilih style untuk memulai</p>
                        </div>

                        <div id="karikatur-results-grid" class="hidden grid grid-cols-2 gap-4 max-h-[70vh] md:max-h-96 overflow-y-auto" style="-webkit-overflow-scrolling: touch;"></div>
                    </div>
                </main>
            </div>
        </div>

        <!-- PHOTO EDITOR PRO -->
        <div id="content-photo-editor" class="main-content-panel hidden">
            <div class="container mx-auto px-4 py-8">
                <header class="text-center mb-8">
                    <h1 class="text-4xl md:text-5xl font-bold bg-gradient-to-r from-purple-600 to-violet-500 bg-clip-text text-transparent">Photo Editor Pro</h1>
                    <p class="text-lg text-gray-600 mt-2">Edit foto dengan preset profesional ala Lightroom ‚ú®üì∏</p>
                </header>

                <main class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                    <!-- Left Panel: Upload & Preview -->
                    <div class="lg:col-span-2 space-y-6">
                        <!-- Upload Section -->
                        <div class="w-full p-6 md:p-8 rounded-2xl shadow-lg bg-white">
                            <div class="flex items-center gap-3 mb-4">
                                <div class="flex items-center justify-center w-8 h-8 rounded-full bg-gradient-to-br from-purple-500 to-violet-500 text-white font-bold text-sm shadow-lg">1</div>
                                <label class="text-xl font-semibold text-gray-800">Unggah Foto</label>
                            </div>
                            <label for="photoeditor-image-input" class="upload-box-photoeditor block relative border-3 border-dashed border-gray-300 rounded-xl p-8 text-center cursor-pointer bg-gradient-to-br from-purple-50 to-violet-50 hover:shadow-xl transition-all">
                                <input type="file" id="photoeditor-image-input" class="hidden" accept="image/png, image/jpeg, image/webp, image/heic, .heic">
                                <div id="photoeditor-upload-prompt">
                                    <i class="fas fa-images text-5xl text-purple-400 mb-3"></i>
                                    <p class="text-gray-700 font-semibold">Klik atau seret foto di sini</p>
                                    <p class="text-sm text-gray-500 mt-1">PNG, JPG, WEBP, HEIC</p>
                                </div>
                                <img id="photoeditor-image-preview" src="" alt="Preview" class="hidden w-full h-auto rounded-lg">
                            </label>
                            <!-- Mobile-only preview -->
                            <div id="photoeditor-preview-container" class="mt-3 hidden lg:hidden">
                                <img id="photoeditor-mobile-preview" src="" alt="Preview" class="w-full rounded-lg shadow-lg max-h-48 object-cover">
                                <button id="photoeditor-remove-preview" class="mt-2 w-full bg-red-600 hover:bg-red-700 text-white text-sm py-2 px-3 rounded-lg transition-colors">
                                    <i class="fas fa-times mr-1"></i> Hapus Foto
                                </button>
                            </div>
                        </div>

                        <!-- Preview/Result Section -->
                        <div class="w-full p-6 md:p-8 rounded-2xl shadow-lg bg-white">
                            <div class="flex items-center justify-between mb-4">
                                <h2 class="text-2xl font-bold text-gray-800">
                                    <i class="fas fa-image text-purple-500 mr-2"></i>
                                    Preview
                                </h2>
                                <button id="photoeditor-apply-btn" class="hidden bg-gradient-to-r from-purple-600 to-violet-500 hover:from-purple-700 hover:to-violet-600 text-white px-4 py-2 rounded-lg font-semibold shadow-md hover:shadow-lg transition-all duration-300">
                                    <i class="fas fa-magic mr-2"></i>
                                    <span>Apply Edit</span>
                                </button>
                            </div>

                            <div id="photoeditor-placeholder" class="flex flex-col items-center justify-center min-h-[400px] text-center">
                                <i class="fas fa-sliders-h text-8xl text-purple-300 mb-4"></i>
                                <p class="text-xl text-gray-600">Preview akan muncul di sini</p>
                                <p class="text-sm text-gray-500 mt-2">Unggah foto untuk mulai editing</p>
                            </div>

                            <div id="photoeditor-preview-area" class="hidden">
                                <canvas id="photoeditor-canvas" class="w-full rounded-lg shadow-lg"></canvas>
                                <p class="text-xs text-gray-500 text-center mt-2">
                                    <i class="fas fa-info-circle mr-1"></i>
                                    Preview di-scale untuk tampilan, download akan menggunakan ukuran original
                                </p>
                                <div class="mt-4 flex flex-wrap gap-2 justify-center">
                                    <button id="photoeditor-reset-btn" class="bg-gray-200 hover:bg-gray-300 text-gray-800 px-4 py-2 rounded-lg font-semibold transition-colors">
                                        <i class="fas fa-undo mr-2"></i>Reset
                                    </button>
                                    <button id="photoeditor-download-btn" class="bg-gradient-to-r from-purple-600 to-violet-500 hover:from-purple-700 hover:to-violet-600 text-white px-4 py-2 rounded-lg font-semibold shadow-md hover:shadow-lg transition-all">
                                        <i class="fas fa-download mr-2"></i>Download Original Size
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Right Panel: Controls -->
                    <div class="space-y-6">
                        <!-- Preset Filters -->
                        <div class="w-full p-6 rounded-2xl shadow-lg bg-white">
                            <div class="flex items-center gap-3 mb-4">
                                <div class="flex items-center justify-center w-8 h-8 rounded-full bg-gradient-to-br from-purple-500 to-violet-500 text-white font-bold text-sm shadow-lg">2</div>
                                <label class="text-xl font-semibold text-gray-800">Preset Filters</label>
                            </div>
                            <div id="photoeditor-preset-options" class="grid grid-cols-2 gap-2 max-h-[400px] overflow-y-auto pr-2" style="-webkit-overflow-scrolling: touch;">
                                <button type="button" data-preset="none" class="preset-btn-photoeditor selected">
                                    <span>Original</span>
                                </button>
                                <button type="button" data-preset="cinematic" class="preset-btn-photoeditor">
                                    <span>Cinematic</span>
                                </button>
                                <button type="button" data-preset="vintage" class="preset-btn-photoeditor">
                                    <span>Vintage</span>
                                </button>
                                <button type="button" data-preset="moody" class="preset-btn-photoeditor">
                                    <span>Moody</span>
                                </button>
                                <button type="button" data-preset="vibrant" class="preset-btn-photoeditor">
                                    <span>Vibrant</span>
                                </button>
                                <button type="button" data-preset="warm" class="preset-btn-photoeditor">
                                    <span>Warm Glow</span>
                                </button>
                                <button type="button" data-preset="cool" class="preset-btn-photoeditor">
                                    <span>Cool Tone</span>
                                </button>
                                <button type="button" data-preset="bw" class="preset-btn-photoeditor">
                                    <span>B&W Classic</span>
                                </button>
                                <button type="button" data-preset="sepia" class="preset-btn-photoeditor">
                                    <span>Sepia</span>
                                </button>
                                <button type="button" data-preset="dramatic" class="preset-btn-photoeditor">
                                    <span>Dramatic</span>
                                </button>
                                <button type="button" data-preset="soft" class="preset-btn-photoeditor">
                                    <span>Soft Dream</span>
                                </button>
                                <button type="button" data-preset="hdr" class="preset-btn-photoeditor">
                                    <span>HDR</span>
                                </button>
                                <button type="button" data-preset="golden" class="preset-btn-photoeditor">
                                    <span>Golden Hour</span>
                                </button>
                                <button type="button" data-preset="film" class="preset-btn-photoeditor">
                                    <span>Film Grain</span>
                                </button>
                                <button type="button" data-preset="neon" class="preset-btn-photoeditor">
                                    <span>Neon</span>
                                </button>
                                <button type="button" data-preset="pastel" class="preset-btn-photoeditor">
                                    <span>Pastel</span>
                                </button>
                                <button type="button" data-preset="urban" class="preset-btn-photoeditor">
                                    <span>Urban</span>
                                </button>
                                <button type="button" data-preset="sunset" class="preset-btn-photoeditor">
                                    <span>Sunset</span>
                                </button>
                                <button type="button" data-preset="portrait" class="preset-btn-photoeditor">
                                    <span>Portrait Pro</span>
                                </button>
                                <button type="button" data-preset="landscape" class="preset-btn-photoeditor">
                                    <span>Landscape</span>
                                </button>
                            </div>
                        </div>

                        <!-- Manual Adjustments -->
                        <div class="w-full p-6 rounded-2xl shadow-lg bg-white">
                            <div class="flex items-center gap-3 mb-4">
                                <div class="flex items-center justify-center w-8 h-8 rounded-full bg-gradient-to-br from-purple-500 to-violet-500 text-white font-bold text-sm shadow-lg">3</div>
                                <label class="text-xl font-semibold text-gray-800">Manual Adjust</label>
                            </div>
                            <div class="space-y-4">
                                <!-- Brightness -->
                                <div>
                                    <div class="flex justify-between items-center mb-2">
                                        <label class="text-sm font-medium text-gray-700">Brightness</label>
                                        <span id="photoeditor-brightness-value" class="text-sm font-bold text-purple-600">0</span>
                                    </div>
                                    <input type="range" id="photoeditor-brightness" class="slider-photoeditor" min="-100" max="100" value="0" step="1">
                                </div>

                                <!-- Contrast -->
                                <div>
                                    <div class="flex justify-between items-center mb-2">
                                        <label class="text-sm font-medium text-gray-700">Contrast</label>
                                        <span id="photoeditor-contrast-value" class="text-sm font-bold text-purple-600">0</span>
                                    </div>
                                    <input type="range" id="photoeditor-contrast" class="slider-photoeditor" min="-100" max="100" value="0" step="1">
                                </div>

                                <!-- Saturation -->
                                <div>
                                    <div class="flex justify-between items-center mb-2">
                                        <label class="text-sm font-medium text-gray-700">Saturation</label>
                                        <span id="photoeditor-saturation-value" class="text-sm font-bold text-purple-600">0</span>
                                    </div>
                                    <input type="range" id="photoeditor-saturation" class="slider-photoeditor" min="-100" max="100" value="0" step="1">
                                </div>

                                <!-- Warmth/Temperature -->
                                <div>
                                    <div class="flex justify-between items-center mb-2">
                                        <label class="text-sm font-medium text-gray-700">Warmth</label>
                                        <span id="photoeditor-warmth-value" class="text-sm font-bold text-purple-600">0</span>
                                    </div>
                                    <input type="range" id="photoeditor-warmth" class="slider-photoeditor" min="-100" max="100" value="0" step="1">
                                </div>

                                <!-- Highlights -->
                                <div>
                                    <div class="flex justify-between items-center mb-2">
                                        <label class="text-sm font-medium text-gray-700">Highlights</label>
                                        <span id="photoeditor-highlights-value" class="text-sm font-bold text-purple-600">0</span>
                                    </div>
                                    <input type="range" id="photoeditor-highlights" class="slider-photoeditor" min="-100" max="100" value="0" step="1">
                                </div>

                                <!-- Shadows -->
                                <div>
                                    <div class="flex justify-between items-center mb-2">
                                        <label class="text-sm font-medium text-gray-700">Shadows</label>
                                        <span id="photoeditor-shadows-value" class="text-sm font-bold text-purple-600">0</span>
                                    </div>
                                    <input type="range" id="photoeditor-shadows" class="slider-photoeditor" min="-100" max="100" value="0" step="1">
                                </div>

                                <!-- Sharpness -->
                                <div>
                                    <div class="flex justify-between items-center mb-2">
                                        <label class="text-sm font-medium text-gray-700">Sharpness</label>
                                        <span id="photoeditor-sharpness-value" class="text-sm font-bold text-purple-600">0</span>
                                    </div>
                                    <input type="range" id="photoeditor-sharpness" class="slider-photoeditor" min="0" max="100" value="0" step="1">
                                </div>

                                <!-- Vignette -->
                                <div>
                                    <div class="flex justify-between items-center mb-2">
                                        <label class="text-sm font-medium text-gray-700">Vignette</label>
                                        <span id="photoeditor-vignette-value" class="text-sm font-bold text-purple-600">0</span>
                                    </div>
                                    <input type="range" id="photoeditor-vignette" class="slider-photoeditor" min="0" max="100" value="0" step="1">
                                </div>
                            </div>
                        </div>
                    </div>
                </main>
            </div>
        </div>

        <!-- AI BEAUTY EDITOR -->
        <div id="content-ai-beauty" class="main-content-panel hidden">
            <div class="container mx-auto px-4 py-8">
                <header class="text-center mb-8">
                    <h1 class="text-4xl md:text-5xl font-bold bg-gradient-to-r from-pink-600 to-rose-500 bg-clip-text text-transparent">AI Beauty Editor</h1>
                    <p class="text-lg text-gray-600 mt-2">Percantik wajah & tubuh dengan AI profesional üíÑ‚ú®</p>
                </header>

                <main class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <!-- Left Panel: Configuration -->
                    <div class="w-full p-6 md:p-8 rounded-2xl shadow-lg bg-white">
                        <!-- Step 1: Upload Photo -->
                        <div class="mb-6">
                            <div class="flex items-center gap-3 mb-3">
                                <div class="flex items-center justify-center w-8 h-8 rounded-full bg-gradient-to-br from-pink-500 to-rose-500 text-white font-bold text-sm shadow-lg">1</div>
                                <label class="text-xl font-semibold text-gray-800">Unggah Foto</label>
                            </div>
                            <label for="beauty-image-input" class="upload-box-beauty block relative border-3 border-dashed border-gray-300 rounded-xl p-8 text-center cursor-pointer bg-gradient-to-br from-pink-50 to-rose-50 hover:shadow-xl transition-all">
                                <input type="file" id="beauty-image-input" class="hidden" accept="image/png, image/jpeg, image/webp, image/heic, .heic">
                                <div id="beauty-upload-prompt">
                                    <i class="fas fa-user-circle text-5xl text-pink-400 mb-3"></i>
                                    <p class="text-gray-700 font-semibold">Klik atau seret foto di sini</p>
                                    <p class="text-sm text-gray-500 mt-1">PNG, JPG, WEBP, HEIC</p>
                                </div>
                                <img id="beauty-image-preview" src="" alt="Preview" class="hidden w-full h-auto rounded-lg">
                            </label>
                            <!-- Mobile-only preview -->
                            <div id="beauty-preview-container" class="mt-3 hidden lg:hidden">
                                <img id="beauty-mobile-preview" src="" alt="Preview" class="w-full rounded-lg shadow-lg max-h-48 object-cover">
                                <button id="beauty-remove-preview" class="mt-2 w-full bg-red-600 hover:bg-red-700 text-white text-sm py-2 px-3 rounded-lg transition-colors">
                                    <i class="fas fa-times mr-1"></i> Hapus Foto
                                </button>
                            </div>
                        </div>

                        <!-- Step 2: Beauty Features -->
                        <div class="mb-6">
                            <div class="flex items-center gap-3 mb-3">
                                <div class="flex items-center justify-center w-8 h-8 rounded-full bg-gradient-to-br from-pink-500 to-rose-500 text-white font-bold text-sm shadow-lg">2</div>
                                <label class="text-xl font-semibold text-gray-800">Pilih Fitur Beauty</label>
                            </div>
                            <div id="beauty-feature-options" class="grid grid-cols-2 sm:grid-cols-2 gap-3">
                                <button type="button" data-feature="smooth-skin" class="beauty-option-btn">
                                    <i class="fas fa-sparkles mr-2"></i>
                                    <span>Smooth Skin</span>
                                </button>
                                <button type="button" data-feature="brighten-face" class="beauty-option-btn">
                                    <i class="fas fa-sun mr-2"></i>
                                    <span>Brighten Face</span>
                                </button>
                                <button type="button" data-feature="big-eyes" class="beauty-option-btn">
                                    <i class="fas fa-eye mr-2"></i>
                                    <span>Big Eyes</span>
                                </button>
                                <button type="button" data-feature="slim-face" class="beauty-option-btn">
                                    <i class="fas fa-star mr-2"></i>
                                    <span>Slim Face</span>
                                </button>
                                <button type="button" data-feature="sharp-nose" class="beauty-option-btn">
                                    <i class="fas fa-italic mr-2"></i>
                                    <span>Sharp Nose</span>
                                </button>
                                <button type="button" data-feature="white-teeth" class="beauty-option-btn">
                                    <i class="fas fa-teeth mr-2"></i>
                                    <span>White Teeth</span>
                                </button>
                                <button type="button" data-feature="slim-body" class="beauty-option-btn">
                                    <i class="fas fa-person mr-2"></i>
                                    <span>Slim Body</span>
                                </button>
                                <button type="button" data-feature="defined-jawline" class="beauty-option-btn">
                                    <i class="fas fa-grip-lines mr-2"></i>
                                    <span>Jawline</span>
                                </button>
                                <button type="button" data-feature="remove-blemish" class="beauty-option-btn">
                                    <i class="fas fa-eraser mr-2"></i>
                                    <span>Remove Blemish</span>
                                </button>
                                <button type="button" data-feature="natural-makeup" class="beauty-option-btn">
                                    <i class="fas fa-paint-brush mr-2"></i>
                                    <span>Natural Makeup</span>
                                </button>
                                <button type="button" data-feature="glam-makeup" class="beauty-option-btn">
                                    <i class="fas fa-crown mr-2"></i>
                                    <span>Glam Makeup</span>
                                </button>
                                <button type="button" data-feature="full-beauty" class="beauty-option-btn">
                                    <i class="fas fa-wand-magic-sparkles mr-2"></i>
                                    <span>Full Beauty</span>
                                </button>
                            </div>
                        </div>

                        <!-- Step 3: Custom Beauty Request (Optional) -->
                        <div class="mb-6">
                            <div class="flex items-center gap-3 mb-3">
                                <div class="flex items-center justify-center w-8 h-8 rounded-full bg-gradient-to-br from-pink-500 to-rose-500 text-white font-bold text-sm shadow-lg">3</div>
                                <label class="text-xl font-semibold text-gray-800">Custom Request (Optional)</label>
                            </div>
                            <textarea id="beauty-custom-request" class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-pink-500 focus:outline-none resize-none" rows="3" placeholder="Ketik keinginan custom Anda di sini, contoh: 'buat mata lebih tajam dan bibir lebih merah', 'kulit lebih glowing dan pipi lebih chubby', dll."></textarea>
                            <p class="text-xs text-gray-500 mt-1">
                                <i class="fas fa-info-circle mr-1"></i>
                                Opsional - Anda bisa menambahkan request custom selain fitur yang dipilih di atas
                            </p>
                        </div>

                        <!-- Step 4: Intensity Level -->
                        <div class="mb-6">
                            <div class="flex items-center gap-3 mb-3">
                                <div class="flex items-center justify-center w-8 h-8 rounded-full bg-gradient-to-br from-pink-500 to-rose-500 text-white font-bold text-sm shadow-lg">4</div>
                                <label class="text-xl font-semibold text-gray-800">Intensity</label>
                            </div>
                            <div id="beauty-intensity-options" class="grid grid-cols-3 gap-3">
                                <button type="button" data-intensity="subtle" class="beauty-option-btn">
                                    <span>Subtle</span>
                                </button>
                                <button type="button" data-intensity="moderate" class="beauty-option-btn selected">
                                    <span>Moderate</span>
                                </button>
                                <button type="button" data-intensity="strong" class="beauty-option-btn">
                                    <span>Strong</span>
                                </button>
                            </div>
                        </div>

                        <!-- Step 5: Aspect Ratio -->
                        <div class="mb-6">
                            <div class="flex items-center gap-3 mb-3">
                                <div class="flex items-center justify-center w-8 h-8 rounded-full bg-gradient-to-br from-pink-500 to-rose-500 text-white font-bold text-sm shadow-lg">5</div>
                                <label class="text-xl font-semibold text-gray-800">Aspect Ratio</label>
                            </div>
                            <div id="beauty-ratio-options" class="grid grid-cols-2 sm:grid-cols-5 gap-3">
                                <button type="button" data-ratio="1:1" class="beauty-option-btn">
                                    <i class="fas fa-square mr-2"></i>
                                    <span>1:1</span>
                                </button>
                                <button type="button" data-ratio="3:4" class="beauty-option-btn selected">
                                    <i class="fas fa-portrait mr-2"></i>
                                    <span>3:4</span>
                                </button>
                                <button type="button" data-ratio="4:5" class="beauty-option-btn">
                                    <i class="fas fa-rectangle-portrait mr-2"></i>
                                    <span>4:5</span>
                                </button>
                                <button type="button" data-ratio="9:16" class="beauty-option-btn">
                                    <i class="fas fa-mobile-alt mr-2"></i>
                                    <span>9:16</span>
                                </button>
                                <button type="button" data-ratio="16:9" class="beauty-option-btn">
                                    <i class="fas fa-tv mr-2"></i>
                                    <span>16:9</span>
                                </button>
                            </div>
                        </div>

                        <!-- Step 6: Number of Variations -->
                        <div class="mb-6">
                            <div class="flex items-center gap-3 mb-3">
                                <div class="flex items-center justify-center w-8 h-8 rounded-full bg-gradient-to-br from-pink-500 to-rose-500 text-white font-bold text-sm shadow-lg">6</div>
                                <label class="text-xl font-semibold text-gray-800">Jumlah Variasi</label>
                            </div>
                            <div id="beauty-count-options" class="grid grid-cols-3 gap-3">
                                <button type="button" data-count="4" class="beauty-option-btn selected">
                                    <span>4 Gambar</span>
                                </button>
                                <button type="button" data-count="6" class="beauty-option-btn">
                                    <span>6 Gambar</span>
                                </button>
                                <button type="button" data-count="8" class="beauty-option-btn">
                                    <span>8 Gambar</span>
                                </button>
                            </div>
                        </div>

                        <!-- Step 7: Generate Button -->
                        <div class="mb-4">
                            <div class="flex items-center gap-3 mb-3">
                                <div class="flex items-center justify-center w-8 h-8 rounded-full bg-gradient-to-br from-pink-500 to-rose-500 text-white font-bold text-sm shadow-lg">7</div>
                                <label class="text-xl font-semibold text-gray-800">Generate</label>
                            </div>
                            <button id="beauty-generate-btn" class="w-full bg-gradient-to-r from-pink-600 to-rose-500 hover:from-pink-700 hover:to-rose-600 text-white py-4 px-6 rounded-xl text-lg font-bold transition-all duration-300 shadow-lg hover:shadow-xl hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed disabled:scale-100" disabled>
                                <i class="fas fa-wand-magic-sparkles mr-2"></i>
                                <span>Apply Beauty Effect</span>
                            </button>
                        </div>
                    </div>

                    <!-- Right Panel: Results -->
                    <div class="w-full p-6 md:p-8 rounded-2xl shadow-lg bg-white">
                        <div class="flex items-center justify-between mb-6">
                            <h2 class="text-2xl font-bold text-gray-800">
                                <i class="fas fa-images text-pink-500 mr-2"></i>
                                Hasil Beauty
                            </h2>
                            <button id="beauty-download-all-btn" class="hidden bg-gradient-to-r from-pink-600 to-rose-500 hover:from-pink-700 hover:to-rose-600 text-white px-4 py-2 rounded-lg font-semibold shadow-md hover:shadow-lg transition-all duration-300">
                                <i class="fas fa-download mr-2"></i>
                                <span>Download Semua</span>
                            </button>
                        </div>

                        <div id="beauty-placeholder" class="flex flex-col items-center justify-center min-h-[500px] text-center">
                            <i class="fas fa-wand-magic-sparkles text-8xl text-pink-300 mb-4"></i>
                            <p class="text-xl text-gray-600">Hasil beauty akan muncul di sini</p>
                            <p class="text-sm text-gray-500 mt-2">Unggah foto dan pilih fitur beauty untuk memulai</p>
                        </div>

                        <div id="beauty-results-grid" class="hidden grid grid-cols-2 gap-4 max-h-[70vh] md:max-h-96 overflow-y-auto" style="-webkit-overflow-scrolling: touch;"></div>
                    </div>
                </main>
            </div>
        </div>

        <!-- TAB 2: HALU IDOL -->
        <div id="content-halu" class="main-content-panel hidden">
            <div class="hearts-container"></div>
             <main class="flex flex-col lg:flex-row gap-8">
                <div class="card p-6 w-full lg:w-1/3 lg:max-w-sm flex-shrink-0 self-start">
                    <div class="flex flex-col gap-6">
                        <div>
                            <h2 class="text-xl font-semibold mb-3 text-gray-800">1. Unggah Fotomu</h2>
                            <div id="halu-image-upload-area">
                                <label for="halu-image-input" class="file-input-label rounded-lg text-center text-gray-500 cursor-pointer flex flex-col items-center justify-center">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="w-12 h-12 mb-3 text-pink-300" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" /></svg>
                                    <span class="font-semibold text-gray-700">Pilih Fotomu</span>
                                    <span class="text-xs text-gray-400 mt-1">Klik atau seret gambar</span>
                                </label>
                                <input type="file" id="halu-image-input" class="hidden" accept="image/png, image/jpeg, image/webp">
                            </div>
                            <div id="halu-image-preview-container" class="hidden mt-4 relative">
                                <img id="halu-image-preview" src="#" alt="Pratinjau Fotomu" class="rounded-lg w-full h-auto object-contain">
                                <button id="halu-remove-image-btn" class="absolute top-2 right-2 bg-red-600 text-white rounded-full p-1.5 hover:bg-red-700"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button>
                            </div>
                        </div>
                        
                        <div>
                            <h2 class="text-xl font-semibold mb-3 text-gray-800">2. Unggah Foto Idolamu</h2>
                            <div id="halu-idol-image-upload-area">
                                <label for="halu-idol-image-input" class="file-input-label rounded-lg text-center text-gray-500 cursor-pointer flex flex-col items-center justify-center">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="w-12 h-12 mb-3 text-pink-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" />
                                    </svg>
                                    <span class="font-semibold text-gray-700">Pilih Foto Idolamu</span>
                                     <span class="text-xs text-gray-400 mt-1">Klik atau seret gambar</span>
                                </label>
                                <input type="file" id="halu-idol-image-input" class="hidden" accept="image/png, image/jpeg, image/webp">
                            </div>
                            <div id="halu-idol-image-preview-container" class="hidden mt-4 relative">
                                <img id="halu-idol-image-preview" src="#" alt="Pratinjau Idola" class="rounded-lg w-full h-auto object-contain">
                                <button id="halu-remove-idol-image-btn" class="absolute top-2 right-2 bg-red-600 text-white rounded-full p-1.5 hover:bg-red-700"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button>
                            </div>
                        </div>

                        <div>
                            <h2 class="text-xl font-semibold mb-3 text-gray-800">3. Pilih Rasio Aspek</h2>
                            <div id="halu-ratio-selection" class="grid grid-cols-2 sm:grid-cols-4 gap-3">
                                <button type="button" data-ratio="1:1" class="ratio-btn-halu">
                                    <i class="fas fa-square mr-2"></i>1:1
                                </button>
                                <button type="button" data-ratio="16:9" class="ratio-btn-halu selected">
                                    <i class="fas fa-rectangle-landscape mr-2"></i>16:9
                                </button>
                                <button type="button" data-ratio="3:4" class="ratio-btn-halu">
                                    <i class="fas fa-rectangle-portrait mr-2"></i>3:4
                                </button>
                                <button type="button" data-ratio="9:16" class="ratio-btn-halu">
                                    <i class="fas fa-mobile-alt mr-2"></i>9:16
                                </button>
                            </div>
                        </div>

                        <div>
                            <h2 class="text-xl font-semibold mb-3 text-gray-800">4. Deskripsi Momen <span class="text-sm text-gray-400">(Opsional)</span></h2>
                            <textarea id="halu-moment-desc-input" rows="3" class="w-full p-3 bg-pink-50 border-pink-200 text-gray-800 rounded-lg" placeholder="Contoh: Kencan pertama..."></textarea>
                        </div>
                        
                        <div>
                            <h2 class="text-xl font-semibold mb-3 text-gray-800">5. Gaya Foto <span class="text-sm text-gray-400">(Opsional)</span></h2>
                            <textarea id="halu-photo-style-input" rows="3" class="w-full p-3 bg-pink-50 border-pink-200 text-gray-800 rounded-lg" placeholder="Contoh: Gaya foto polaroid..."></textarea>
                        </div>

                        <button id="halu-generate-btn" class="w-full btn-primary font-bold py-3 px-4 rounded-lg flex items-center justify-center text-lg" disabled>
                            <span>Buat 6 Foto Halu</span>
                        </button>
                    </div>
                </div>
                <div class="flex-grow">
                    <div id="halu-b-roll-grid" class="grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-3 gap-6"></div>
                </div>
            </main>
        </div>

        <!-- TAB 3: AFFILIATE GO -->
        <!-- TAB: FOTO PRODUK (AffiliateGo) -->
        <div id="content-affiliate" class="main-content-panel hidden">
                <main class="flex flex-col lg:flex-row gap-8">
                    <!-- Kolom Input -->
                    <div class="card p-6 w-full lg:w-1/3 lg:max-w-sm flex-shrink-0 self-start">
                        <div class="flex flex-col gap-6">
                            <div>
                                <h2 class="text-xl font-semibold mb-3 text-gray-800">1. Unggah Gambar Produk</h2>
                                <div id="broll-image-upload-area">
                                    <label for="broll-image-input" class="file-input-label rounded-lg text-center text-gray-500">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="w-10 h-10 mb-2" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 002-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>
                                        <span>Pilih Gambar Produk (Bisa lebih dari 1)</span>
                                    </label>
                                    <input type="file" id="broll-image-input" class="hidden" accept="image/png, image/jpeg, image/webp" multiple>
                                </div>
                                <div id="broll-image-preview-container" class="hidden mt-4 grid grid-cols-3 gap-2">
                                    <!-- Product images will be added here dynamically -->
                                </div>
                            </div>
                            
                            <div>
                                <div class="flex justify-between items-center mb-3">
                                    <h2 class="text-xl font-semibold text-gray-800">2. Deskripsi Produk</h2>
                                    <button id="broll-generate-desc-btn" class="btn-secondary text-sm font-semibold py-1 px-3 rounded-md flex items-center" disabled> ‚ú® Buat Deskripsi </button>
                                </div>
                                <textarea id="broll-product-desc-input" rows="4" class="w-full p-3 bg-white border border-gray-300 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-cyan-500 transition" placeholder="Contoh: Smartwatch X200 tahan air dengan GPS..."></textarea>
                            </div>

                            <div>
                                <h2 class="text-xl font-semibold mb-3 text-gray-800">3. Unggah Foto Model <span class="text-sm text-gray-500">(Opsional)</span></h2>
                                <div id="broll-model-image-upload-area">
                                    <label for="broll-model-image-input" class="file-input-label rounded-lg text-center text-gray-500">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="w-10 h-10 mb-2" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" /></svg>
                                        <span>Pilih Foto Model</span>
                                    </label>
                                    <input type="file" id="broll-model-image-input" class="hidden" accept="image/png, image/jpeg, image/webp">
                                </div>
                                <div id="broll-model-image-preview-container" class="hidden mt-4 relative">
                                    <img id="broll-model-image-preview" src="#" alt="Pratinjau Model" class="rounded-lg w-full h-auto object-contain">
                                    <button id="broll-remove-model-image-btn" class="absolute top-2 right-2 bg-red-500 text-white rounded-full p-1.5 hover:bg-red-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button>
                                </div>
                            </div>

                            <div>
                                <h2 class="text-xl font-semibold mb-3 text-gray-800">4. Tema Foto <span class="text-sm text-gray-500">(Opsional)</span></h2>
                                <textarea id="broll-photo-theme-input" rows="3" class="w-full p-3 bg-white border border-gray-300 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-cyan-500 transition" placeholder="Contoh: Minimalis & bersih, nuansa alam tropis..."></textarea>
                            </div>

                            <div>
                                <h2 class="text-xl font-semibold mb-3 text-gray-800">5. Unggah Background <span class="text-sm text-gray-500">(Opsional)</span></h2>
                                <div id="broll-background-image-upload-area">
                                    <label for="broll-background-image-input" class="file-input-label rounded-lg text-center text-gray-500">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="w-10 h-10 mb-2" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>
                                        <span>Pilih Background Custom</span>
                                    </label>
                                    <input type="file" id="broll-background-image-input" class="hidden" accept="image/png, image/jpeg, image/webp">
                                </div>
                                <div id="broll-background-image-preview-container" class="hidden mt-4 relative">
                                    <img id="broll-background-image-preview" src="#" alt="Pratinjau Background" class="rounded-lg w-full h-auto object-contain">
                                    <button id="broll-remove-background-image-btn" class="absolute top-2 right-2 bg-red-500 text-white rounded-full p-1.5 hover:bg-red-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button>
                                </div>
                            </div>

                            <div class="mt-6">
                                <h2 class="text-xl font-semibold mb-3 text-gray-800">6. Rasio Aspek</h2>
                                <div id="broll-ratio-selection" class="grid grid-cols-2 sm:grid-cols-4 gap-3">
                                    <button type="button" data-ratio="1:1" class="ratio-btn-broll">
                                        <i class="fas fa-square mr-2"></i>1:1
                                    </button>
                                    <button type="button" data-ratio="16:9" class="ratio-btn-broll selected">
                                        <i class="fas fa-rectangle-landscape mr-2"></i>16:9
                                    </button>
                                    <button type="button" data-ratio="3:4" class="ratio-btn-broll">
                                        <i class="fas fa-rectangle-portrait mr-2"></i>3:4
                                    </button>
                                    <button type="button" data-ratio="9:16" class="ratio-btn-broll">
                                        <i class="fas fa-mobile-alt mr-2"></i>9:16
                                    </button>
                                </div>
                            </div>

                            <div class="mt-6">
                                <h2 class="text-xl font-semibold mb-3 text-gray-800">7. Jumlah Foto</h2>
                                <div id="broll-count-selection" class="grid grid-cols-3 gap-3">
                                    <button type="button" data-count="7" class="ratio-btn-broll selected">
                                        <i class="fas fa-images mr-2"></i>7 Foto
                                    </button>
                                    <button type="button" data-count="14" class="ratio-btn-broll">
                                        <i class="fas fa-images mr-2"></i>14 Foto
                                    </button>
                                    <button type="button" data-count="20" class="ratio-btn-broll">
                                        <i class="fas fa-images mr-2"></i>20 Foto
                                    </button>
                                </div>
                            </div>

                            <button id="broll-generate-btn" class="w-full btn-primary font-bold py-3 px-4 rounded-lg flex items-center justify-center text-lg mt-6" disabled>
                                <span>Buat <span id="broll-count-text">7</span> Pose Produk</span>
                            </button>
                        </div>
                    </div>
                    <div class="flex-grow">
                        <!-- Results Header with Download All -->
                        <div id="broll-results-header" class="hidden mb-4 flex items-center justify-between">
                            <h3 class="text-xl font-bold text-gray-800">
                                <span id="broll-result-count">0</span> Foto Berhasil Di-generate
                            </h3>
                            <button id="broll-download-all-btn" class="btn-primary px-6 py-2 rounded-lg flex items-center gap-2">
                                <i class="fas fa-download"></i>
                                Download Semua
                            </button>
                        </div>
                        <div id="broll-b-roll-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 2xl:grid-cols-5 gap-4"></div>
                    </div>
                </main>
        </div>

        <!-- TAB: VIRTUAL TRY-ON -->
        <div id="content-virtual-tryon" class="main-content-panel hidden">
                 <main class="w-full flex-grow grid grid-cols-1 lg:grid-cols-3 gap-6">
                    <div class="lg:col-span-2 grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="bg-white p-4 rounded-xl shadow-lg flex flex-col">
                            <h2 class="text-xl font-semibold mb-3 text-center text-gray-700">1. Unggah Foto Produk</h2>
                            <div id="tryon-product-upload-box" class="upload-box w-full h-64 sm:h-80 flex-grow rounded-lg flex items-center justify-center cursor-pointer relative overflow-hidden">
                                <div id="tryon-product-placeholder" class="text-center text-gray-400">
                                    <svg class="mx-auto h-12 w-12" stroke="currentColor" fill="none" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"></path></svg>
                                    <p class="mt-2">Seret & lepas atau klik</p>
                                </div>
                                <img id="tryon-product-preview" class="hidden absolute top-0 left-0 w-full h-full" alt="Pratinjau Produk">
                            </div>
                            <input type="file" id="tryon-product-input" class="hidden" accept="image/*">
                        </div>
                        <div class="bg-white p-4 rounded-xl shadow-lg flex flex-col">
                            <h2 class="text-xl font-semibold mb-3 text-center text-gray-700">2. Unggah Foto Model</h2>
                            <div id="tryon-model-upload-box" class="upload-box w-full h-64 sm:h-80 flex-grow rounded-lg flex items-center justify-center cursor-pointer relative overflow-hidden">
                                <div id="tryon-model-placeholder" class="text-center text-gray-400">
                                    <svg class="mx-auto h-12 w-12" stroke="currentColor" fill="none" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M5.121 17.804A13.937 13.937 0 0112 16c2.5 0 4.847.655 6.879 1.804M15 10a3 3 0 11-6 0 3 3 0 016 0zm6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                                    <p class="mt-2">Seret & lepas atau klik</p>
                                </div>
                                <img id="tryon-model-preview" class="hidden absolute top-0 left-0 w-full h-full" alt="Pratinjau Model">
                            </div>
                            <input type="file" id="tryon-model-input" class="hidden" accept="image/*">
                        </div>
                    </div>
                    <div class="lg:col-span-1 bg-white p-4 rounded-xl shadow-lg flex flex-col">
                        <h2 class="text-xl font-semibold mb-3 text-center text-gray-700">3. Hasil Generate AI</h2>
                        <div id="tryon-output-box" class="w-full h-full min-h-[300px] flex-grow rounded-lg bg-gray-100 flex items-center justify-center overflow-hidden relative">
                            <div id="tryon-output-placeholder" class="text-center text-gray-400">
                                <svg class="mx-auto h-16 w-16" stroke="currentColor" fill="none" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path></svg>
                                <p class="mt-2">Hasil akan muncul di sini</p>
                            </div>
                            <div id="tryon-loader" class="hidden text-center">
                                <div class="tryon-loader mx-auto"></div>
                                <p class="mt-4 text-gray-400">AI sedang bekerja...</p>
                            </div>
                            <img id="tryon-result-image" class="hidden w-full h-full object-contain" alt="Hasil Generate AI">
                            <div id="tryon-output-controls" class="absolute bottom-0 left-0 right-0 hidden flex justify-between items-center bg-black bg-opacity-60 p-2">
                                <p id="tryon-image-dimensions" class="text-sm text-gray-200 font-mono"></p>
                                <button id="tryon-download-btn" class="bg-cyan-600 hover:bg-cyan-700 text-white font-bold py-2 px-4 rounded-full text-sm">Unduh</button>
                            </div>
                        </div>
                    </div>
                </main>
                <footer class="w-full max-w-6xl mx-auto mt-6 text-center">
                    <button id="tryon-generate-btn" class="bg-gradient-to-r from-teal-500 to-lime-500 hover:from-teal-600 hover:to-lime-600 text-white font-bold py-3 px-12 rounded-full shadow-lg transform hover:scale-105 transition-all disabled:opacity-50 disabled:cursor-not-allowed">Generate Gambar</button>
                    <p id="tryon-status-message" class="text-red-500 mt-4 h-6"></p>
                </footer>
        </div>

        <!-- TAB: POSE FASHION -->
        <div id="content-pose-fashion" class="main-content-panel hidden">
                <div class="bg-white rounded-2xl shadow-2xl p-6 md:p-10 w-full max-w-4xl mx-auto border border-slate-200">
                    <div id="poses-errorContainer" class="hidden bg-red-100 border border-red-500 text-red-700 px-4 py-3 rounded-lg relative mb-6">
                        <strong class="font-bold">Oops! </strong>
                        <span class="block sm:inline" id="poses-errorMessage">Terjadi kesalahan.</span>
                    </div>
                    <div class="bg-gray-100/50 border-2 border-dashed border-gray-300 rounded-xl p-8 text-center cursor-pointer hover:border-cyan-500 transition-colors" id="poses-uploadArea">
                        <label for="poses-imageUpload" class="cursor-pointer">
                            <div class="flex flex-col items-center justify-center">
                                <svg xmlns="http://www.w3.org/2000/svg" class="w-16 h-16 text-gray-400 mb-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242M12 12v9"/><path d="m16 16-4-4-4 4"/></svg>
                                <p class="font-semibold text-lg">Klik atau seret gambar</p>
                                <p class="text-sm text-gray-500 mt-1">PNG, JPG, atau WEBP (Maks. 5MB)</p>
                            </div>
                            <input type="file" id="poses-imageUpload" class="hidden" accept="image/png, image/jpeg, image/webp">
                        </label>
                    </div>
                    <div id="poses-previewContainer" class="hidden mt-6 text-center">
                        <p class="font-semibold mb-2">Gambar yang diunggah:</p>
                        <div class="relative inline-block border-2 border-gray-300 rounded-xl p-2">
                            <img id="poses-imagePreview" src="" alt="Pratinjau Gambar" class="max-h-40 rounded-lg mx-auto">
                        </div>
                        <p id="poses-fileName" class="text-sm text-gray-500 mt-2"></p>
                    </div>

                    <!-- Custom Pose Input -->
                    <div class="mt-8">
                        <label for="poses-customPoseInput" class="block text-left mb-2">
                            <h3 class="text-xl font-bold text-gray-800 flex items-center">
                                <i class="fas fa-magic mr-2 text-cyan-600"></i>Custom Pose (Opsional)
                            </h3>
                            <p class="text-sm text-gray-600 mt-1">Tulis deskripsi pose yang Anda inginkan. Jika kosong, akan menggunakan pose default.</p>
                        </label>
                        <textarea
                            id="poses-customPoseInput"
                            rows="4"
                            placeholder="pose tinju"
                            class="w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:border-cyan-500 focus:outline-none transition-colors resize-none text-sm"
                        ></textarea>
                        <p class="text-xs text-gray-500 mt-2 flex items-start">
                            <i class="fas fa-lightbulb mr-2 text-yellow-500 mt-0.5"></i>
                            <span><strong>Tips:</strong> Jelaskan pose dengan detail dalam bahasa Inggris untuk hasil terbaik. Contoh: "confident standing pose with arms crossed", "elegant sitting pose on chair", "dynamic action pose", dll.</span>
                        </p>
                    </div>

                    <div class="mt-6 text-center">
                        <button id="poses-selectPoseBtn" disabled class="bg-cyan-600 text-white font-bold py-3 px-8 rounded-lg hover:bg-cyan-700 disabled:bg-gray-300 shadow-lg transition-all hover:shadow-xl active:scale-95">
                            <span class="flex items-center justify-center">
                                <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 mr-2" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m3 16 2 2 4-4"/><path d="m3 12 2 2 4-4"/><path d="M10 6h11"/><path d="M10 12h11"/><path d="M10 18h11"/></svg>
                                Pilih 6 Pose
                            </span>
                        </button>
                    </div>
                    <div id="poses-resultsContainer" class="hidden mt-10">
                        <div class="mb-4 flex items-center justify-between">
                            <h2 class="text-2xl font-bold text-gray-800">Hasil Pose...</h2>
                            <button id="poses-download-all-btn" class="hidden btn-primary px-6 py-2 rounded-lg flex items-center gap-2">
                                <i class="fas fa-download"></i>
                                Download Semua
                            </button>
                        </div>
                        <div id="poses-resultsGrid" class="grid grid-cols-2 md:grid-cols-3 gap-4 md:gap-6"></div>
                    </div>
                </div>
        </div>
        
        <!-- TAB 4: FAMILY PHOTO -->
        <div id="content-family" class="main-content-panel hidden">
            <div class="container mx-auto max-w-7xl">
                <header class="text-center mb-10">
                    <div class="inline-flex items-center gap-3 mb-4">
                        <div class="w-14 h-14 rounded-2xl flex items-center justify-center shadow-lg" style="background: linear-gradient(135deg, #14b8a6 0%, #0d9488 100%);">
                            <i class="fas fa-users text-white text-2xl"></i>
                        </div>
                        <div class="flex flex-col items-start">
                            <h1 class="text-4xl md:text-5xl font-bold text-transparent bg-clip-text" style="background: linear-gradient(135deg, #14b8a6 0%, #0d9488 100%); -webkit-background-clip: text; background-clip: text;">
                                Family Photo Generator
                            </h1>
                            <span class="text-xs font-semibold px-3 py-1 rounded-full mt-1" style="background: linear-gradient(135deg, #14b8a6 0%, #0d9488 100%); color: white;">‚ú® AI Powered</span>
                        </div>
                    </div>
                    <p class="text-base md:text-lg text-gray-600 max-w-2xl mx-auto leading-relaxed">
                        Ciptakan foto keluarga yang sempurna dengan AI. Pilih tema favorit dan buat kenangan indah bersama keluarga.
                    </p>
                    <div class="mt-6 inline-flex items-center gap-2 px-5 py-3 rounded-xl border-2 shadow-sm" style="border-color: #14b8a6; background: linear-gradient(135deg, #ccfbf1 0%, #f0fdfa 100%);">
                        <i class="fas fa-bolt" style="color: #14b8a6;"></i>
                        <span class="text-sm font-medium" style="color: #0d9488;">Generate 6 foto sekaligus dalam hitungan detik</span>
                    </div>
                </header>

                <div class="flex flex-col lg:flex-row gap-8 w-full">
                    <div class="w-full lg:w-5/12 flex-shrink-0">
                        <div class="card p-8 sticky top-6 shadow-xl rounded-2xl border" style="border-color: #ccfbf1; background: linear-gradient(to bottom, #ffffff 0%, #fafcfc 100%);">
                            <div class="flex flex-col gap-6">
                                <div>
                                    <div class="flex items-center gap-3 mb-4">
                                        <div class="w-10 h-10 rounded-xl flex items-center justify-center font-bold text-white shadow-md" style="background: linear-gradient(135deg, #14b8a6 0%, #0d9488 100%);">
                                            1
                                        </div>
                                        <h3 class="text-lg font-bold text-gray-800">Unggah Foto Keluarga</h3>
                                    </div>
                                    <div id="family-file-input-area" class="flex flex-wrap gap-4">
                                        <div class="file-input-wrapper">
                                            <input type="file" accept="image/*" class="file-input" data-index="0">
                                            <img class="file-preview hidden">
                                            <span class="text-gray-500 text-center text-sm">Tambahkan Foto</span>
                                            <button class="delete-btn" onclick="familyDeletePhoto(event, 0)">√ó</button>
                                        </div>
                                        <div class="file-input-wrapper">
                                            <input type="file" accept="image/*" class="file-input" data-index="1">
                                            <img class="file-preview hidden">
                                            <span class="text-gray-500 text-center text-sm">Tambahkan Foto</span>
                                            <button class="delete-btn" onclick="familyDeletePhoto(event, 1)">√ó</button>
                                        </div>
                                    </div>
                                    <button id="family-add-photo-btn" class="add-photo-btn mt-4">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="w-10 h-10" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" /></svg>
                                    </button>
                                </div>

                                <div>
                                    <div class="flex items-center gap-3 mb-4">
                                        <div class="w-10 h-10 rounded-xl flex items-center justify-center font-bold text-white shadow-md" style="background: linear-gradient(135deg, #14b8a6 0%, #0d9488 100%);">
                                            2
                                        </div>
                                        <h3 class="text-lg font-bold text-gray-800">Pilih Rasio Gambar</h3>
                                    </div>
                                    <div id="family-ratio-options" class="grid grid-cols-2 sm:grid-cols-4 gap-3">
                                        <button type="button" data-value="1:1" class="option-btn-family">
                                            <i class="fas fa-square mr-2"></i>1:1
                                        </button>
                                        <button type="button" data-value="16:9" class="option-btn-family">
                                            <i class="fas fa-rectangle-landscape mr-2"></i>16:9
                                        </button>
                                        <button type="button" data-value="3:4" class="option-btn-family selected">
                                            <i class="fas fa-rectangle-portrait mr-2"></i>3:4
                                        </button>
                                        <button type="button" data-value="9:16" class="option-btn-family">
                                            <i class="fas fa-mobile-alt mr-2"></i>9:16
                                        </button>
                                    </div>
                                </div>

                                <div>
                                    <div class="flex items-center gap-3 mb-4">
                                        <div class="w-10 h-10 rounded-xl flex items-center justify-center font-bold text-white shadow-md" style="background: linear-gradient(135deg, #14b8a6 0%, #0d9488 100%);">
                                            3
                                        </div>
                                        <h3 class="text-lg font-bold text-gray-800">Pilih Tema</h3>
                                    </div>
                                    <div class="max-h-96 overflow-y-auto pr-2 space-y-3">
                                        <div>
                                            <h4 class="text-sm font-semibold text-teal-600 mb-2">Tema Populer</h4>
                                            <div class="grid grid-cols-2 md:grid-cols-3 gap-2">
                                                <button class="theme-btn text-xs" data-theme="foto realistis keluarga di pantai saat matahari terbenam"><i class="fas fa-umbrella-beach mr-1"></i>Pantai</button>
                                                <button class="theme-btn text-xs" data-theme="foto realistis keluarga di taman saat piknik"><i class="fas fa-tree mr-1"></i>Piknik</button>
                                                <button class="theme-btn text-xs" data-theme="foto realistis keluarga di gunung dengan pemandangan pegunungan"><i class="fas fa-mountain mr-1"></i>Gunung</button>
                                                <button class="theme-btn text-xs" data-theme="foto realistis keluarga di ruang tamu yang nyaman dengan perapian"><i class="fas fa-couch mr-1"></i>Ruang Tamu</button>
                                                <button class="theme-btn text-xs" data-theme="foto realistis keluarga di studio foto profesional"><i class="fas fa-camera mr-1"></i>Studio Foto</button>
                                                <button class="theme-btn text-xs" data-theme="foto realistis keluarga saat melaksanakan ibadah haji atau umroh di Mekah"><i class="fas fa-kaaba mr-1"></i>Umroh/Haji</button>
                                            </div>
                                        </div>
                                        <div>
                                            <h4 class="text-sm font-semibold text-teal-600 mb-2">Tema Fantasi</h4>
                                            <div class="grid grid-cols-2 md:grid-cols-3 gap-2">
                                                <button class="theme-btn text-xs" data-theme="foto realistis keluarga bergaya mafia elegan di era 1920-an"><i class="fas fa-user-secret mr-1"></i>Mafia</button>
                                                <button class="theme-btn text-xs" data-theme="foto realistis keluarga bergaya agen rahasia di markas bawah tanah"><i class="fas fa-user-ninja mr-1"></i>Agen Rahasia</button>
                                                <button class="theme-btn text-xs" data-theme="foto realistis keluarga bergaya pejuang abad pertengahan di kastil kuno"><i class="fas fa-chess-rook mr-1"></i>Abad Pertengahan</button>
                                                <button class="theme-btn text-xs" data-theme="foto realistis keluarga bergaya bajak laut di kapal di tengah lautan badai"><i class="fas fa-skull-crossbones mr-1"></i>Bajak Laut</button>
                                                <button class="theme-btn text-xs" data-theme="foto realistis keluarga bergaya ksatria fantasi di hutan ajaib"><i class="fas fa-dragon mr-1"></i>Ksatria</button>
                                                <button class="theme-btn text-xs" data-theme="foto realistis keluarga bergaya pahlawan super siap bertarung di kota metropolitan"><i class="fas fa-bolt mr-1"></i>Super Hero</button>
                                                <button class="theme-btn text-xs" data-theme="foto realistis keluarga bergaya cyberpunk di kota neon"><i class="fas fa-robot mr-1"></i>Cyberpunk</button>
                                                <button class="theme-btn text-xs" data-theme="foto realistis keluarga bergaya astronot di stasiun luar angkasa"><i class="fas fa-rocket mr-1"></i>Astronot</button>
                                                <button class="theme-btn text-xs" data-theme="foto realistis keluarga bergaya raja dan ratu di istana megah"><i class="fas fa-crown mr-1"></i>Raja/Ratu</button>
                                            </div>
                                        </div>
                                        <button id="family-random-theme-btn" class="w-full theme-btn text-sm py-3" style="background: linear-gradient(135deg, #14b8a6, #0d9488); color: white;">
                                            <i class="fas fa-dice mr-2"></i>Tema Acak
                                        </button>
                                    </div>
                                    <div class="mt-4">
                                        <label class="text-sm font-semibold text-gray-600 mb-2 block">Atau Tulis Tema Custom (Opsional)</label>
                                        <textarea id="family-custom-theme-input" rows="3" class="w-full p-3 border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-teal-500 focus:border-teal-500 transition resize-none text-sm" placeholder="Contoh: keluarga di taman bunga dengan suasana musim semi..."></textarea>
                                        <p class="text-xs text-gray-400 mt-1">üí° Kosongkan jika ingin menggunakan tema yang dipilih di atas</p>
                                    </div>
                                </div>

                                <button id="family-generate-btn" class="w-full text-white font-bold py-4 px-8 rounded-2xl flex items-center justify-center text-lg shadow-xl hover:shadow-2xl hover:-translate-y-1 hover:scale-[1.02] transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none relative overflow-hidden group" style="background: linear-gradient(135deg, #14b8a6 0%, #0d9488 100%);">
                                    <div class="absolute inset-0 bg-white opacity-0 group-hover:opacity-20 transition-opacity duration-300"></div>
                                    <i class="fas fa-sparkles mr-3 text-xl relative z-10"></i>
                                    <span class="relative z-10">Buat 6 Foto Keluarga</span>
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="w-full lg:w-7/12 flex flex-col">
                        <div class="card p-8 h-full flex flex-col shadow-xl rounded-2xl border" style="border-color: #ccfbf1; background: linear-gradient(to bottom, #ffffff 0%, #fafcfc 100%);">
                            <div id="loading-indicator" class="hidden flex-col items-center justify-center flex-grow">
                                <div class="spinner"></div>
                                <span class="mt-4 text-lg text-gray-600">Membuat foto keluarga Anda...</span>
                            </div>
                            <div id="family-results-header" class="hidden mb-6 flex items-center justify-between">
                                <h3 class="text-xl font-bold" style="color: #0d9488;">
                                    <i class="fas fa-check-circle mr-2"></i>
                                    <span id="family-result-count">6</span> Foto Berhasil Dibuat
                                </h3>
                                <button id="family-download-all-btn" class="px-6 py-2 rounded-lg flex items-center gap-2 font-semibold text-white shadow-lg hover:shadow-xl hover:-translate-y-0.5 transition-all" style="background: linear-gradient(135deg, #14b8a6, #0d9488);">
                                    <i class="fas fa-download"></i>
                                    Download Semua
                                </button>
                            </div>
                            <div id="result-image-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
                            <div id="family-results-placeholder" class="flex flex-grow flex-col items-center justify-center text-center">
                                <div class="w-28 h-28 rounded-3xl flex items-center justify-center mb-6 shadow-lg" style="background: linear-gradient(135deg, #ccfbf1 0%, #99f6e4 100%);">
                                    <i class="fas fa-images text-6xl" style="color: #14b8a6;"></i>
                                </div>
                                <h3 class="font-bold text-2xl mb-3" style="color: #0d9488;">Hasil Foto Keluarga Anda</h3>
                                <p class="text-gray-500 text-base max-w-md">Unggah foto keluarga dan pilih tema favorit. Hasil 6 foto akan muncul di sini dengan kualitas profesional.</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="family-custom-modal" class="modal-container">
                    <div class="modal-content">
                        <p id="family-modal-message">Pesan peringatan.</p>
                        <button class="modal-button" onclick="familyCloseModal()">Tutup</button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- TAB 5: FOOD SELFIE -->
        <div id="content-food-selfie" class="main-content-panel hidden">
            <div class="container mx-auto">
                <header class="text-center mb-8">
                    <h1 class="text-4xl md:text-5xl font-bold text-[#1e3a8a]">Food Selfie</h1>
                    <p class="text-lg text-gray-600 mt-2">Ubah foto makananmu menjadi karya seni AI ‚ú®</p>
                </header>

                <main class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <!-- Kolom Hasil -->
                    <div id="food-selfie-result-container" class="w-full p-6 md:p-8 rounded-2xl shadow-lg glassmorphism flex flex-col justify-center items-center text-center min-h-[400px]">
                        <div id="food-selfie-placeholder-result">
                            <i class="fas fa-images text-8xl text-[#a5b4fc]"></i>
                            <p class="mt-4 text-xl text-gray-600">7 Gambar AI akan muncul di sini</p>
                        </div>
                        <div id="food-selfie-loader" class="hidden flex-col items-center">
                            <div class="loader"></div>
                            <p class="mt-4 text-lg text-gray-700">AI sedang memasak hidangan Anda... Mohon tunggu!</p>
                        </div>
                        <div id="food-selfie-results-header" class="hidden mb-4 w-full flex items-center justify-between">
                            <h3 class="text-xl font-bold text-gray-800">
                                <span id="food-selfie-result-count">0</span> Foto Berhasil Di-generate
                            </h3>
                            <button id="food-selfie-download-all-btn" class="btn-primary px-6 py-2 rounded-lg flex items-center gap-2">
                                <i class="fas fa-download"></i>
                                Download Semua
                            </button>
                        </div>
                        <div id="food-selfie-result-content" class="hidden w-full grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6">
                                <!-- 7 Hasil akan dimasukkan di sini oleh JS -->
                        </div>
                        <div id="food-selfie-error-message" class="hidden text-red-600"></div>
                    </div>

                    <!-- Kolom Kontrol -->
                    <div class="w-full p-6 md:p-8 rounded-2xl shadow-lg glassmorphism">
                        <!-- 1. Upload Foto Makanan -->
                        <div>
                            <label class="block text-xl font-semibold mb-3 text-[#1e3a8a]">1. Unggah Foto Makanan (Wajib)</label>
                            <div id="food-selfie-food-image-uploader" class="image-uploader-box">
                                <input type="file" id="food-selfie-food-file-input" class="hidden" accept="image/*">
                                <div id="food-selfie-food-upload-prompt">
                                    <i class="fas fa-utensils text-4xl text-[#a5b4fc] mb-2"></i>
                                    <p class="text-gray-700">Klik atau seret foto makanan utama</p>
                                </div>
                                <img id="food-selfie-food-image-preview" src="" alt="Pratinjau Makanan" class="hidden max-h-80 mx-auto rounded-lg shadow-lg">
                            </div>
                        </div>

                        <div class="mt-6">
                            <label class="block text-xl font-semibold mb-3 text-[#1e3a8a]">2. Pilih Rasio Aspek</label>
                            <div id="food-selfie-ratio-selection" class="grid grid-cols-2 sm:grid-cols-4 gap-3">
                                <button type="button" data-ratio="1:1" class="ratio-btn-food">
                                    <i class="fas fa-square mr-2"></i>1:1
                                </button>
                                <button type="button" data-ratio="16:9" class="ratio-btn-food selected">
                                    <i class="fas fa-rectangle-landscape mr-2"></i>16:9
                                </button>
                                <button type="button" data-ratio="3:4" class="ratio-btn-food">
                                    <i class="fas fa-rectangle-portrait mr-2"></i>3:4
                                </button>
                                <button type="button" data-ratio="9:16" class="ratio-btn-food">
                                    <i class="fas fa-mobile-alt mr-2"></i>9:16
                                </button>
                            </div>
                        </div>

                        <!-- 2. Pilih Tema -->
                        <div class="mt-6">
                             <label class="block text-xl font-semibold text-[#1e3a8a] mb-3">3. Pilih Tema (Opsional)</label>
                             <div id="food-selfie-theme-selection" class="grid grid-cols-3 gap-3">
                                 <button class="theme-btn" data-theme="in a professional restaurant setting"><i class="fas fa-concierge-bell"></i><span>Restoran</span></button>
                                 <button class="theme-btn" data-theme="in a professional photo studio with a clean background"><i class="fas fa-camera-retro"></i><span>Studio</span></button>
                                 <button class="theme-btn" data-theme="in a setting that matches the food's theme and origin"><i class="fas fa-leaf"></i><span>Tematik</span></button>
                                 <button class="theme-btn" data-theme="in a cozy, homestyle kitchen or dining setting"><i class="fas fa-house-chimney"></i><span>Rumahan</span></button>
                                 <button class="theme-btn" data-theme="in an outdoor picnic setting with natural light"><i class="fas fa-sun"></i><span>Piknik</span></button>
                                 <button class="theme-btn" data-theme=""><i class="fas fa-ban"></i><span>Tanpa Tema</span></button>
                             </div>
                             <p class="text-xs text-gray-600 mt-2">Jika tanpa tema, AI akan fokus pada referensi komposisi atau membuat gaya umum.</p>
                        </div>

                        <!-- 3. Upload Gambar Referensi (Opsional) -->
                        <div class="mt-6">
                            <label class="block text-xl font-semibold mb-2 text-[#1e3a8a]">4. Referensi Komposisi (Opsional)</label>
                            <p class="text-sm text-gray-600 mb-3">Unggah gambar acuan untuk komposisi & latar belakang.</p>
                            <div id="food-selfie-style-image-uploader" class="image-uploader-box">
                                <input type="file" id="food-selfie-style-file-input" class="hidden" accept="image/*">
                                <div id="food-selfie-style-upload-prompt">
                                    <i class="fas fa-palette text-4xl text-[#a5b4fc] mb-2"></i>
                                    <p class="text-gray-700">Klik atau seret foto referensi</p>
                                </div>
                                <img id="food-selfie-style-image-preview" src="" alt="Pratinjau Gaya" class="hidden max-h-80 mx-auto rounded-lg shadow-lg">
                            </div>
                        </div>

                        <!-- Tombol Generate -->
                        <div class="mt-8">
                            <button id="food-selfie-generate-btn" class="w-full bg-[#4f46e5] text-white py-4 px-6 rounded-lg text-lg font-bold hover:bg-[#4338ca] transition-transform transform hover:scale-105 shadow-md disabled:opacity-50 disabled:cursor-not-allowed disabled:scale-100" disabled>
                                <i class="fas fa-magic mr-2"></i>Generate 7 Gambar
                            </button>
                        </div>
                    </div>
                </main>
            </div>
        </div>

        <!-- TAB: PRODUCT REVIEW GENERATOR -->
        <div id="content-product-review" class="main-content-panel hidden">
            <div class="container mx-auto p-4 md:p-8 max-w-7xl">
                <header class="text-center mb-8">
                    <h1 class="text-4xl sm:text-5xl lg:text-6xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-indigo-500 via-purple-500 to-pink-500">
                        Generator Review Produk
                    </h1>
                    <p class="text-lg text-gray-500 mt-2 max-w-3xl mx-auto">
                        Solusi AI untuk konten review produk afiliasi Anda.
                    </p>
                </header>

                <main class="flex flex-col lg:flex-row gap-8">
                    <!-- Input Column -->
                    <div class="card p-6 w-full lg:w-1/3 lg:max-w-sm flex-shrink-0 self-start bg-white rounded-2xl shadow-lg">
                        <div class="flex flex-col gap-6">
                            <div>
                                <div class="flex items-center gap-2 mb-3">
                                    <div class="flex items-center justify-center w-8 h-8 rounded-full bg-gradient-to-br from-indigo-500 to-purple-600 text-white font-bold text-sm shadow-lg">1</div>
                                    <h2 class="text-xl font-semibold text-gray-800">Unggah Gambar Produk</h2>
                                </div>
                                <div id="review-image-upload-area">
                                    <label for="review-image-input" class="file-input-label rounded-xl p-8 text-center text-gray-500 flex flex-col items-center justify-center min-h-[140px]">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="w-12 h-12 mb-3" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>
                                        <span class="font-medium text-base">Klik atau seret gambar ke sini</span>
                                        <span class="text-xs mt-2 text-gray-400">PNG, JPG, WEBP (Bisa lebih dari satu)</span>
                                    </label>
                                    <input type="file" id="review-image-input" class="hidden" accept="image/png, image/jpeg, image/webp" multiple>
                                </div>
                                <div id="review-image-preview-container" class="hidden mt-4 grid grid-cols-3 gap-2">
                                    <!-- Previews will be added here -->
                                </div>
                            </div>

                            <div>
                                <div class="flex items-center justify-between mb-3">
                                    <div class="flex items-center gap-2">
                                        <div class="flex items-center justify-center w-8 h-8 rounded-full bg-gradient-to-br from-indigo-500 to-purple-600 text-white font-bold text-sm shadow-lg">2</div>
                                        <h2 class="text-xl font-semibold text-gray-800">Deskripsi Produk</h2>
                                    </div>
                                    <button id="review-generate-desc-btn" class="btn-secondary text-xs font-semibold py-2 px-3 rounded-lg flex items-center gap-1 shadow-sm" disabled>
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor"><path d="M13 7H7v6h6V7z"/><path fill-rule="evenodd" d="M7 2a1 1 0 012 0v1h2V2a1 1 0 112 0v1h2a2 2 0 012 2v2h1a1 1 0 110 2h-1v2h1a1 1 0 110 2h-1v2a2 2 0 01-2 2h-2v1a1 1 0 11-2 0v-1H9v1a1 1 0 11-2 0v-1H5a2 2 0 01-2-2v-2H2a1 1 0 110-2h1V9H2a1 1 0 010-2h1V5a2 2 0 012-2h2V2zM5 5h10v10H5V5z" clip-rule="evenodd"/></svg>
                                        <span>AI Generate</span>
                                    </button>
                                </div>
                                <textarea id="review-product-desc-input" rows="4" class="w-full p-4 bg-white border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition resize-none" placeholder="Deskripsikan produk Anda secara detail... atau gunakan AI Generate"></textarea>
                                <p class="text-xs text-gray-400 mt-2">üí° Tip: Deskripsi detail menghasilkan review yang lebih berkualitas</p>
                            </div>

                            <div>
                                <div class="flex items-center gap-2 mb-3">
                                    <div class="flex items-center justify-center w-8 h-8 rounded-full bg-gradient-to-br from-indigo-500 to-purple-600 text-white font-bold text-sm shadow-lg">3</div>
                                    <h2 class="text-xl font-semibold text-gray-800">Foto Model <span class="text-sm text-gray-400">(Opsional)</span></h2>
                                </div>
                                <div id="review-model-image-upload-area">
                                    <label for="review-model-image-input" class="file-input-label rounded-xl p-6 text-center text-gray-500 flex flex-col items-center justify-center min-h-[120px]">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="w-10 h-10 mb-2" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" /></svg>
                                        <span class="font-medium">Klik untuk pilih foto model</span>
                                    </label>
                                    <input type="file" id="review-model-image-input" class="hidden" accept="image/png, image/jpeg, image/webp">
                                </div>
                                <div id="review-model-image-preview-container" class="hidden mt-4 relative">
                                    <img id="review-model-image-preview" src="#" alt="Pratinjau Model" class="rounded-xl w-full h-auto object-contain shadow-md">
                                    <button id="review-remove-model-image-btn" class="absolute top-2 right-2 bg-red-500 text-white rounded-full p-2 hover:bg-red-600 transition-all shadow-lg hover:shadow-xl active:scale-95"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button>
                                </div>
                                <p class="text-xs text-gray-400 mt-2">üé≠ Upload foto model untuk hasil lebih personal</p>
                            </div>

                            <div>
                                <div class="flex items-center gap-2 mb-3">
                                    <div class="flex items-center justify-center w-8 h-8 rounded-full bg-gradient-to-br from-indigo-500 to-purple-600 text-white font-bold text-sm shadow-lg">4</div>
                                    <h2 class="text-xl font-semibold text-gray-800">Tema Foto <span class="text-sm text-gray-400">(Opsional)</span></h2>
                                </div>
                                <textarea id="review-photo-theme-input" rows="3" class="w-full p-4 bg-white border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition resize-none" placeholder="Contoh: Minimalis & bersih, nuansa alam tropis, futuristik dengan neon..."></textarea>
                                <p class="text-xs text-gray-400 mt-2">üé® Tentukan style visual untuk hasil lebih menarik</p>
                            </div>

                            <div>
                                <div class="flex items-center gap-2 mb-3">
                                    <div class="flex items-center justify-center w-8 h-8 rounded-full bg-gradient-to-br from-indigo-500 to-purple-600 text-white font-bold text-sm shadow-lg">5</div>
                                    <h2 class="text-xl font-semibold text-gray-800">Aspect Ratio</h2>
                                </div>
                                <div id="review-ratio-selection" class="grid grid-cols-2 gap-3">
                                    <button type="button" class="ratio-btn-review flex items-center gap-2 p-3 border-2 border-gray-300 rounded-xl hover:border-indigo-500 transition-all" data-ratio="1:1">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="16" height="16" x="4" y="4" rx="2"></rect></svg>
                                        <span class="font-medium text-sm">1:1 Square</span>
                                    </button>
                                    <button type="button" class="ratio-btn-review selected flex items-center gap-2 p-3 border-2 border-indigo-500 rounded-xl hover:border-indigo-500 transition-all bg-gradient-to-br from-indigo-500 to-purple-600 text-white shadow-lg" data-ratio="16:9">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="18" height="12" x="3" y="6" rx="2"></rect></svg>
                                        <span class="font-medium text-sm">16:9 Landscape</span>
                                    </button>
                                    <button type="button" class="ratio-btn-review flex items-center gap-2 p-3 border-2 border-gray-300 rounded-xl hover:border-indigo-500 transition-all" data-ratio="3:4">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="14" height="18" x="5" y="3" rx="2"></rect></svg>
                                        <span class="font-medium text-sm">3:4 Portrait</span>
                                    </button>
                                    <button type="button" class="ratio-btn-review flex items-center gap-2 p-3 border-2 border-gray-300 rounded-xl hover:border-indigo-500 transition-all" data-ratio="9:16">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="12" height="20" x="6" y="2" rx="2"></rect></svg>
                                        <span class="font-medium text-sm">9:16 Story</span>
                                    </button>
                                </div>
                            </div>

                            <button id="review-generate-btn" class="w-full btn-primary font-bold py-4 px-6 rounded-xl flex items-center justify-center text-lg shadow-xl" disabled>
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" /></svg>
                                <span>Buat 10 Scene Review</span>
                            </button>
                        </div>
                    </div>

                    <!-- Output Grid -->
                    <div class="flex-grow">
                        <div id="review-b-roll-grid" class="grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-3 gap-6">
                             <!-- Placeholders loaded by JS -->
                        </div>
                    </div>
                </main>
            </div>
        </div>

        <!-- TAB: PRODUCT ADS GENERATOR -->
        <div id="content-product-ads" class="main-content-panel hidden">
            <div class="container mx-auto p-4 md:p-8 max-w-7xl">
                <header class="text-center mb-8">
                    <h1 class="text-4xl sm:text-5xl lg:text-6xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-indigo-500 via-purple-500 to-pink-500">
                        Generator Story Iklan
                    </h1>
                    <p class="text-lg text-gray-500 mt-2 max-w-3xl mx-auto">
                        Solusi AI untuk konten promosi brand Anda.
                    </p>
                </header>

                <main class="flex flex-col lg:flex-row gap-8">
                    <!-- Input Column -->
                    <div class="card p-6 w-full lg:w-1/3 lg:max-w-sm flex-shrink-0 self-start bg-white rounded-2xl shadow-lg">
                        <div class="flex flex-col gap-6">
                            <div>
                                <div class="flex items-center gap-2 mb-3">
                                    <div class="flex items-center justify-center w-8 h-8 rounded-full bg-gradient-to-br from-pink-500 to-purple-600 text-white font-bold text-sm shadow-lg">1</div>
                                    <h2 class="text-xl font-semibold text-gray-800">Unggah Gambar Produk</h2>
                                </div>
                                <div id="ads-image-upload-area">
                                    <label for="ads-image-input" class="file-input-label rounded-xl p-8 text-center text-gray-500 flex flex-col items-center justify-center min-h-[140px]">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="w-12 h-12 mb-3" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>
                                        <span class="font-medium text-base">Klik atau seret gambar ke sini</span>
                                        <span class="text-xs mt-2 text-gray-400">PNG, JPG, WEBP (Bisa lebih dari satu)</span>
                                    </label>
                                    <input type="file" id="ads-image-input" class="hidden" accept="image/png, image/jpeg, image/webp" multiple>
                                </div>
                                <div id="ads-image-preview-container" class="hidden mt-4 grid grid-cols-3 gap-2">
                                    <!-- Previews will be added here -->
                                </div>
                            </div>

                            <div>
                                <div class="flex items-center justify-between mb-3">
                                    <div class="flex items-center gap-2">
                                        <div class="flex items-center justify-center w-8 h-8 rounded-full bg-gradient-to-br from-pink-500 to-purple-600 text-white font-bold text-sm shadow-lg">2</div>
                                        <h2 class="text-xl font-semibold text-gray-800">Deskripsi Produk</h2>
                                    </div>
                                    <button id="ads-generate-desc-btn" class="btn-secondary text-xs font-semibold py-2 px-3 rounded-lg flex items-center gap-1 shadow-sm" disabled>
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor"><path d="M13 7H7v6h6V7z"/><path fill-rule="evenodd" d="M7 2a1 1 0 012 0v1h2V2a1 1 0 112 0v1h2a2 2 0 012 2v2h1a1 1 0 110 2h-1v2h1a1 1 0 110 2h-1v2a2 2 0 01-2 2h-2v1a1 1 0 11-2 0v-1H9v1a1 1 0 11-2 0v-1H5a2 2 0 01-2-2v-2H2a1 1 0 110-2h1V9H2a1 1 0 010-2h1V5a2 2 0 012-2h2V2zM5 5h10v10H5V5z" clip-rule="evenodd"/></svg>
                                        <span>AI Generate</span>
                                    </button>
                                </div>
                                <textarea id="ads-product-desc-input" rows="4" class="w-full p-4 bg-white border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-pink-500 focus:border-pink-500 transition resize-none" placeholder="Deskripsikan produk Anda secara detail... atau gunakan AI Generate"></textarea>
                                <p class="text-xs text-gray-400 mt-2">üí° Tip: Deskripsi detail menghasilkan iklan yang lebih menarik</p>
                            </div>

                            <div>
                                <div class="flex items-center gap-2 mb-3">
                                    <div class="flex items-center justify-center w-8 h-8 rounded-full bg-gradient-to-br from-pink-500 to-purple-600 text-white font-bold text-sm shadow-lg">3</div>
                                    <h2 class="text-xl font-semibold text-gray-800">Foto Model <span class="text-sm text-gray-400">(Opsional)</span></h2>
                                </div>
                                <div id="ads-model-image-upload-area">
                                    <label for="ads-model-image-input" class="file-input-label rounded-xl p-6 text-center text-gray-500 flex flex-col items-center justify-center min-h-[120px]">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="w-10 h-10 mb-2" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" /></svg>
                                        <span class="font-medium">Klik untuk pilih foto model</span>
                                    </label>
                                    <input type="file" id="ads-model-image-input" class="hidden" accept="image/png, image/jpeg, image/webp">
                                </div>
                                <div id="ads-model-image-preview-container" class="hidden mt-4 relative">
                                    <img id="ads-model-image-preview" src="#" alt="Pratinjau Model" class="rounded-xl w-full h-auto object-contain shadow-md">
                                    <button id="ads-remove-model-image-btn" class="absolute top-2 right-2 bg-red-500 text-white rounded-full p-2 hover:bg-red-600 transition-all shadow-lg hover:shadow-xl active:scale-95"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button>
                                </div>
                                <p class="text-xs text-gray-400 mt-2">üé≠ Upload foto model untuk hasil lebih personal</p>
                            </div>

                            <div>
                                <div class="flex items-center gap-2 mb-3">
                                    <div class="flex items-center justify-center w-8 h-8 rounded-full bg-gradient-to-br from-pink-500 to-purple-600 text-white font-bold text-sm shadow-lg">4</div>
                                    <h2 class="text-xl font-semibold text-gray-800">Tema Foto <span class="text-sm text-gray-400">(Opsional)</span></h2>
                                </div>
                                <textarea id="ads-photo-theme-input" rows="3" class="w-full p-4 bg-white border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-pink-500 focus:border-pink-500 transition resize-none" placeholder="Contoh: Minimalis & bersih, nuansa alam tropis, futuristik dengan neon..."></textarea>
                                <p class="text-xs text-gray-400 mt-2">üé® Tentukan style visual untuk hasil lebih menarik</p>
                            </div>

                            <div>
                                <div class="flex items-center gap-2 mb-3">
                                    <div class="flex items-center justify-center w-8 h-8 rounded-full bg-gradient-to-br from-pink-500 to-purple-600 text-white font-bold text-sm shadow-lg">5</div>
                                    <h2 class="text-xl font-semibold text-gray-800">Pilih Suara Narator</h2>
                                </div>
                                <select id="ads-narrator-voice" class="w-full p-4 bg-white border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-pink-500 focus:border-pink-500 transition cursor-pointer">
                                    <option value="Puck" data-desc="Ceria & Enerjik (Pria)">üéôÔ∏è Puck - Pria, Ceria & Enerjik</option>
                                    <option value="Kore" data-desc="Tegas & Profesional (Wanita)">üéôÔ∏è Kore - Wanita, Tegas & Profesional</option>
                                    <option value="Zephyr" data-desc="Cerah & Ramah (Wanita)">üéôÔ∏è Zephyr - Wanita, Cerah & Ramah</option>
                                    <option value="Fenrir" data-desc="Bersemangat & Antusias (Pria)">üéôÔ∏è Fenrir - Pria, Bersemangat & Antusias</option>
                                    <option value="Achird" data-desc="Hangat & Bersahabat (Pria)">üéôÔ∏è Achird - Pria, Hangat & Bersahabat</option>
                                    <option value="Charon" data-desc="Informatif & Jelas (Pria)">üéôÔ∏è Charon - Pria, Informatif & Jelas</option>
                                    <option value="Sadachbia" data-desc="Hidup & Dinamis (Pria)">üéôÔ∏è Sadachbia - Pria, Hidup & Dinamis</option>
                                    <option value="Sulafat" data-desc="Hangat & Menenangkan (Wanita)">üéôÔ∏è Sulafat - Wanita, Hangat & Menenangkan</option>
                                    <option value="Aoede" data-desc="Lancar & Santai (Wanita)">üéôÔ∏è Aoede - Wanita, Lancar & Santai</option>
                                    <option value="Gacrux" data-desc="Dewasa & Bijak (Wanita)">üéôÔ∏è Gacrux - Wanita, Dewasa & Bijak</option>
                                </select>
                                <p class="text-xs text-gray-400 mt-2">üé¨ Pilih narator sesuai target audiens iklan</p>
                            </div>

                            <div>
                                <div class="flex items-center gap-2 mb-3">
                                    <div class="flex items-center justify-center w-8 h-8 rounded-full bg-gradient-to-br from-pink-500 to-purple-600 text-white font-bold text-sm shadow-lg">6</div>
                                    <h2 class="text-xl font-semibold text-gray-800">Pilih Rasio Aspek</h2>
                                </div>
                                <div id="ads-ratio-selection" class="grid grid-cols-2 gap-3">
                                    <button type="button" class="ratio-btn-ads flex flex-col items-center justify-center p-4 border-2 border-gray-200 rounded-xl cursor-pointer transition hover:border-pink-400 hover:shadow-md active:scale-95" data-ratio="1:1">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mb-2"><rect width="12" height="12" x="6" y="6" rx="2"></rect></svg>
                                        <span class="font-medium text-sm">1:1 Square</span>
                                    </button>
                                    <button type="button" class="ratio-btn-ads selected flex flex-col items-center justify-center p-4 border-2 rounded-xl cursor-pointer transition hover:shadow-md active:scale-95" data-ratio="16:9" style="border-color: #ec4899; background: linear-gradient(135deg, #ec4899, #8b5cf6); color: white; box-shadow: 0 4px 12px rgba(236, 72, 153, 0.3);">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mb-2"><rect width="18" height="12" x="3" y="6" rx="2"></rect></svg>
                                        <span class="font-medium text-sm">16:9 Landscape</span>
                                    </button>
                                    <button type="button" class="ratio-btn-ads flex flex-col items-center justify-center p-4 border-2 border-gray-200 rounded-xl cursor-pointer transition hover:border-pink-400 hover:shadow-md active:scale-95" data-ratio="3:4">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mb-2"><rect width="12" height="16" x="6" y="4" rx="2"></rect></svg>
                                        <span class="font-medium text-sm">3:4 Portrait</span>
                                    </button>
                                    <button type="button" class="ratio-btn-ads flex flex-col items-center justify-center p-4 border-2 border-gray-200 rounded-xl cursor-pointer transition hover:border-pink-400 hover:shadow-md active:scale-95" data-ratio="9:16">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mb-2"><rect width="10" height="18" x="7" y="3" rx="2"></rect></svg>
                                        <span class="font-medium text-sm">9:16 Story</span>
                                    </button>
                                </div>
                            </div>

                            <button id="ads-generate-btn" class="w-full btn-primary font-bold py-4 px-6 rounded-xl flex items-center justify-center text-lg shadow-xl" disabled>
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" /></svg>
                                <span>Buat 10 Scene Iklan</span>
                            </button>
                        </div>
                    </div>

                    <!-- Output Grid -->
                    <div class="flex-grow">
                        <div id="ads-grid" class="grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-3 gap-6">
                             <!-- Placeholders loaded by JS -->
                        </div>
                    </div>
                </main>
            </div>
        </div>

        <!-- TAB 6: NEW BORN STUDIO -->
        <div id="content-new-born" class="main-content-panel hidden">
            <div class="container mx-auto p-4 md:p-8 max-w-6xl">
                <header class="text-center mb-8">
                    <h1 class="text-4xl md:text-5xl font-bold text-gray-800">Editor Foto Bayi Ajaib</h1>
                    <p class="text-lg text-gray-600 mt-2">Unggah foto bayi Anda dan biarkan keajaiban terjadi!</p>
                </header>

                <main class="bg-white p-6 md:p-8 rounded-2xl shadow-lg">
                    <!-- Input Section -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8 items-center">
                        <!-- Left Column: Upload and Preview -->
                        <div class="flex flex-col items-center">
                            <div id="new-born-image-preview-container" class="w-full max-w-sm h-80 bg-gray-200 rounded-lg flex items-center justify-center border-2 border-dashed border-gray-300 mb-4">
                                <img id="new-born-image-preview" src="" alt="Pratinjau Foto Bayi" class="hidden max-h-full max-w-full rounded-md object-contain">
                                <span id="new-born-preview-text" class="text-gray-500">Pratinjau Gambar</span>
                            </div>
                            <input type="file" id="new-born-image-upload" accept="image/*" class="hidden">
                            <button id="new-born-upload-button" class="w-full max-w-sm bg-indigo-600 text-white font-semibold py-3 px-4 rounded-lg hover:bg-indigo-700 transition-colors duration-300 shadow-md">
                                Pilih Foto Bayi
                            </button>
                        </div>

                        <!-- Right Column: Options and Generate -->
                        <div class="flex flex-col justify-center space-y-6">
                            <div>
                                <h3 class="text-xl font-semibold mb-3">1. Pilih Gender</h3>
                                <div class="flex space-x-4">
                                    <label class="flex items-center p-3 border border-gray-300 rounded-lg cursor-pointer has-[:checked]:bg-indigo-50 has-[:checked]:border-indigo-500">
                                        <input type="radio" name="gender" value="laki-laki" class="form-radio h-5 w-5 text-indigo-600" checked>
                                        <span class="ml-3 text-gray-700">Laki-laki</span>
                                    </label>
                                    <label class="flex items-center p-3 border border-gray-300 rounded-lg cursor-pointer has-[:checked]:bg-indigo-50 has-[:checked]:border-indigo-500">
                                        <input type="radio" name="gender" value="perempuan" class="form-radio h-5 w-5 text-indigo-600">
                                        <span class="ml-3 text-gray-700">Perempuan</span>
                                    </label>
                                </div>
                            </div>
                             <div>
                                <h3 class="text-xl font-semibold mb-3">2. Nama Bayi (Opsional)</h3>
                                <input type="text" id="new-born-name" placeholder="Contoh: Budi" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500">
                            </div>
                            <div>
                                <h3 class="text-xl font-semibold mb-3">3. Tanggal Lahir (Opsional)</h3>
                                <input type="date" id="new-born-dob" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500">
                            </div>
                            <div>
                                <h3 class="text-xl font-semibold mb-3">4. Pilih Rasio Gambar</h3>
                                <div id="newborn-ratio-options" class="grid grid-cols-2 sm:grid-cols-4 gap-3">
                                    <button type="button" data-value="1:1" class="option-btn-newborn">
                                        <i class="fas fa-square mr-2"></i>1:1
                                    </button>
                                    <button type="button" data-value="16:9" class="option-btn-newborn">
                                        <i class="fas fa-rectangle-landscape mr-2"></i>16:9
                                    </button>
                                    <button type="button" data-value="3:4" class="option-btn-newborn selected">
                                        <i class="fas fa-rectangle-portrait mr-2"></i>3:4
                                    </button>
                                    <button type="button" data-value="9:16" class="option-btn-newborn">
                                        <i class="fas fa-mobile-alt mr-2"></i>9:16
                                    </button>
                                </div>
                            </div>
                            <div>
                                <h3 class="text-xl font-semibold mb-3">5. Tema Custom (Opsional)</h3>
                                <textarea id="new-born-custom-theme" rows="3" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500" placeholder="Contoh: superhero cilik dengan kostum warna cerah..."></textarea>
                                <p class="text-sm text-gray-500 mt-1">üí° Kosongkan untuk menggunakan tema acak otomatis</p>
                            </div>
                            <div>
                               <h3 class="text-xl font-semibold mb-3">6. Mulai Keajaiban!</h3>
                                <p class="text-gray-600 mb-4">Aplikasi akan membuat 7 foto unik dengan tema berkualitas tinggi.</p>
                                <button id="new-born-generate-button" class="w-full bg-green-500 text-white font-bold py-4 px-4 rounded-lg hover:bg-green-600 transition-colors duration-300 text-lg shadow-lg disabled:bg-gray-400 disabled:cursor-not-allowed">
                                    Generate 7 Foto Ajaib
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Error Message Display -->
                    <div id="new-born-error-message" class="hidden mt-6 text-center text-red-600 bg-red-100 p-3 rounded-lg"></div>
                </main>

                <!-- Results Section -->
                <section id="new-born-results-section" class="mt-10">
                    <div id="new-born-loading-indicator" class="hidden flex flex-col items-center justify-center">
                        <div class="custom-loader"></div>
                        <p class="text-lg text-gray-600 mt-4">Sedang menciptakan keajaiban... Mohon tunggu sebentar.</p>
                    </div>
                    <div id="new-born-results-header" class="hidden mb-6 flex items-center justify-between">
                        <h3 class="text-xl font-bold text-indigo-600">
                            <i class="fas fa-check-circle mr-2"></i>
                            <span id="new-born-result-count">7</span> Foto Berhasil Dibuat
                        </h3>
                        <button id="new-born-download-all-btn" class="px-6 py-2 bg-gradient-to-r from-indigo-600 to-purple-600 text-white rounded-lg flex items-center gap-2 font-semibold shadow-lg hover:shadow-xl hover:-translate-y-0.5 transition-all">
                            <i class="fas fa-download"></i>
                            Download Semua
                        </button>
                    </div>
                    <div id="new-born-results-grid" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4">
                        <!-- Generated images will be appended here -->
                    </div>
                </section>
            </div>
        </div>

        <!-- TAB 7: FOTO PROFESI ANAK -->
        <div id="content-profesi-anak" class="main-content-panel hidden">
             <div class="container mx-auto">
                <header class="text-center mb-8">
                  <h1 class="text-4xl md:text-5xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-pink-500">
                    Generator Foto Profesi Anak
                  </h1>
                  <p class="mt-2 text-lg text-gray-300">
                    Unggah beberapa foto untuk hasil yang lebih konsisten.
                  </p>
                </header>

                <main>
                  <div class="profesi-card rounded-xl p-6 md:p-8 shadow-2xl max-w-2xl mx-auto">
                    
                    <div class="flex flex-col mb-6">
                        <label class="mb-2 font-semibold text-gray-300">Unggah Foto Anak (Opsional)</label>
                        <div class="relative border-2 border-dashed rounded-lg p-6 profesi-upload-area transition">
                            <input id="profesi-anak-image-upload" type="file" accept="image/png, image/jpeg" multiple class="absolute inset-0 w-full h-full opacity-0 cursor-pointer">
                            <div id="profesi-anak-preview-container" class="hidden">
                               <div id="profesi-anak-image-grid" class="grid grid-cols-3 sm:grid-cols-4 md:grid-cols-5 gap-3 mb-4">
                                   <!-- Previews will be injected here -->
                               </div>
                               <p class="text-sm text-center text-green-400">Gambar siap. Klik area ini untuk menambah foto.</p>
                            </div>
                            <div id="profesi-anak-upload-prompt" class="text-gray-400 text-center cursor-pointer">
                               <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mx-auto h-10 w-10 text-gray-500 mb-2">
                                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                    <polyline points="17 8 12 3 7 8"></polyline>
                                    <line x1="12" y1="3" x2="12" y2="15"></line>
                                </svg>
                                <p>Seret & lepas gambar atau klik untuk memilih file</p>
                                <p class="text-xs mt-1">Tips: Gunakan 3-5 foto close-up dengan wajah jelas, pencahayaan baik, dan dari sudut berbeda untuk hasil terbaik.</p>
                            </div>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                      <div class="flex flex-col">
                        <label for="profesi-anak-age" class="mb-2 font-semibold text-gray-300">Umur Anak</label>
                        <select id="profesi-anak-age" class="profesi-select rounded-lg p-3 transition">
                          <!-- Options 1-10 will be populated by JS -->
                        </select>
                      </div>
                      
                      <div class="flex flex-col">
                        <label for="profesi-anak-theme" class="mb-2 font-semibold text-gray-300">Tema (Opsional)</label>
                        <input type="text" id="profesi-anak-theme" placeholder="Contoh: sepak bola" class="profesi-input rounded-lg p-3 transition placeholder-gray-400">
                      </div>
                    </div>

                    <div class="mt-6">
                      <label class="mb-3 font-semibold text-gray-300 block">Pilih Rasio Gambar</label>
                      <div id="profesi-ratio-options" class="grid grid-cols-2 sm:grid-cols-4 gap-3">
                        <button type="button" data-value="1:1" class="option-btn-profesi">
                          <i class="fas fa-square mr-2"></i>1:1
                        </button>
                        <button type="button" data-value="16:9" class="option-btn-profesi">
                          <i class="fas fa-rectangle-landscape mr-2"></i>16:9
                        </button>
                        <button type="button" data-value="3:4" class="option-btn-profesi selected">
                          <i class="fas fa-rectangle-portrait mr-2"></i>3:4
                        </button>
                        <button type="button" data-value="9:16" class="option-btn-profesi">
                          <i class="fas fa-mobile-alt mr-2"></i>9:16
                        </button>
                      </div>
                    </div>

                    <div class="mt-8">
                      <button id="profesi-anak-generate-btn" class="w-full profesi-generate-btn text-white font-bold py-4 px-4 rounded-lg shadow-lg transform hover:scale-105 transition-transform duration-300 ease-in-out disabled:opacity-50 disabled:cursor-not-allowed disabled:scale-100">
                        ‚ú® Buat 7 Foto Ajaib! ‚ú®
                      </button>
                    </div>
                  </div>

                  <div id="profesi-anak-results-container" class="mt-12">
                      <div id="profesi-anak-loader" class="hidden flex-col items-center justify-center space-y-4 profesi-loader-spinner">
                          <svg class="animate-spin -ml-1 mr-3 h-10 w-10 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                              <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                              <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                          </svg>
                          <p class="text-lg text-gray-300">‚ú® Sedang membuat keajaiban... Ini mungkin perlu waktu sejenak. ‚ú®</p>
                      </div>
                      <div id="profesi-anak-error" class="hidden text-center text-red-400 text-lg bg-red-900/50 p-4 rounded-lg"></div>
                      <div id="profesi-anak-placeholder" class="text-center text-gray-400">
                          <p class="text-xl">üé® Hasil foto Anda akan muncul di sini. üé®</p>
                          <p>Pilih pengaturan di atas dan klik tombol untuk memulai.</p>
                      </div>

                      <!-- Results Header with Download All -->
                      <div id="profesi-anak-results-header" class="hidden flex items-center justify-between mb-6 bg-gradient-to-r from-purple-500/20 to-pink-500/20 p-4 rounded-xl border-2 border-purple-400">
                          <h3 class="text-xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-pink-500">
                              üåü Foto-Foto Keren Kamu! üåü
                          </h3>
                          <button id="profesi-anak-download-all-btn" class="bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600 text-white px-6 py-2 rounded-full font-semibold shadow-lg transition transform hover:scale-105 flex items-center gap-2">
                              <i class="fas fa-download"></i>
                              Download Semua
                          </button>
                      </div>

                      <div id="profesi-anak-results-grid" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-3 gap-6">
                         <!-- Generated images will be appended here -->
                      </div>
                  </div>
                </main>
            </div>
        </div>

        <!-- TAB 8: STORY UPDATE GENERATOR -->
        <div id="content-story-update" class="main-content-panel hidden">
            <div class="w-full max-w-4xl mx-auto bg-white rounded-2xl shadow-xl p-6 md:p-8">
                <div class="text-center mb-8">
                    <h1 class="text-3xl md:text-4xl font-bold text-gray-900">Story Update Generator</h1>
                    <p class="text-gray-500 mt-2">Buat foto story harian yang realistis sesuai gaya hidupmu.</p>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <!-- Kolom Kontrol -->
                    <div class="flex flex-col space-y-5">
                        <form id="story-update-form">
                            <div>
                                <label for="story-update-photo-upload" id="story-update-upload-label" class="font-semibold mb-2 block text-gray-700 cursor-pointer w-full p-3 text-center bg-indigo-100 text-indigo-700 rounded-lg border-2 border-dashed border-indigo-300 hover:bg-indigo-200 transition">
                                    Upload Fotomu
                                </label>
                                <input type="file" id="story-update-photo-upload" class="hidden" accept="image/png, image/jpeg">
                                <img id="story-update-photo-preview" src="#" alt="Pratinjau Foto" class="hidden w-full h-[150px] object-cover rounded-lg mt-4"/>
                                <p class="text-xs text-gray-500 mt-2">Upload foto selfie dengan wajah terlihat jelas untuk hasil terbaik.</p>
                            </div>
                            <div>
                                <label for="story-update-economic-status" class="font-semibold mb-2 block text-gray-700">Pilih Kelas Ekonomi:</label>
                                <select id="story-update-economic-status" class="w-full p-3 border border-gray-300 rounded-lg bg-gray-50 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition custom-select">
                                    <option value="gaji_bawah_umk">Gaji di Bawah UMK</option>
                                    <option value="gaji_sesuai_umk">Gaji Sesuai UMK</option>
                                    <option value="gaji_diatas_umk">Gaji di Atas UMK</option>
                                    <option value="orang_kaya_baru">Orang Kaya Baru</option>
                                    <option value="orang_kaya_lama">Orang Kaya Lama</option>
                                </select>
                            </div>
                            <div>
                                <label for="story-update-theme" class="font-semibold mb-2 block text-gray-700">Pilih Tema Story:</label>
                                <select id="story-update-theme" class="w-full p-3 border border-gray-300 rounded-lg bg-gray-50 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition custom-select">
                                    <option value="makan">Makan</option>
                                    <option value="jalan-jalan">Jalan-jalan</option>
                                    <option value="kerja">Kerja</option>
                                    <option value="kuliah">Kuliah</option>
                                    <option value="olahraga">Olahraga</option>
                                    <option value="nongkrong">Nongkrong</option>
                                </select>
                            </div>
                            <div>
                                <label for="story-update-specific-activity" class="font-semibold mb-2 block text-gray-700">Kegiatan Spesifik (Opsional):</label>
                                <input type="text" id="story-update-specific-activity" class="w-full p-3 border border-gray-300 rounded-lg bg-gray-50 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition" placeholder="Contoh: Makan sate di Gasibu, Bandung">
                                <p class="text-xs text-gray-500 mt-2">Jika diisi, ini akan digunakan sebagai tema utama story.</p>
                            </div>
                            <div>
                                <label class="font-semibold mb-2 block text-gray-700">Gaya Foto:</label>
                                <div class="flex gap-4">
                                    <label class="flex-1">
                                        <input type="radio" name="photo-style" value="sendiri" class="sr-only peer" checked>
                                        <div class="w-full p-3 text-center text-gray-600 bg-gray-50 rounded-lg border border-gray-300 cursor-pointer peer-checked:bg-indigo-600 peer-checked:text-white peer-checked:border-indigo-600 transition">Sendiri</div>
                                    </label>
                                    <label class="flex-1">
                                        <input type="radio" name="photo-style" value="bareng_temen" class="sr-only peer">
                                        <div class="w-full p-3 text-center text-gray-600 bg-gray-50 rounded-lg border border-gray-300 cursor-pointer peer-checked:bg-indigo-600 peer-checked:text-white peer-checked:border-indigo-600 transition">Bareng Temen</div>
                                    </label>
                                </div>
                            </div>
                            <div>
                                <label class="font-semibold mb-2 block text-gray-700">Pilih Rasio Gambar:</label>
                                <div id="story-ratio-options" class="grid grid-cols-2 gap-3">
                                    <button type="button" data-value="1:1" class="story-ratio-btn bg-gray-50 hover:bg-gray-100 text-gray-700 px-3 py-2.5 rounded-lg border-2 border-gray-300 transition-all text-sm font-medium">
                                        <i class="fas fa-square mr-1"></i>1:1
                                    </button>
                                    <button type="button" data-value="16:9" class="story-ratio-btn bg-gray-50 hover:bg-gray-100 text-gray-700 px-3 py-2.5 rounded-lg border-2 border-gray-300 transition-all text-sm font-medium">
                                        <i class="fas fa-rectangle-landscape mr-1"></i>16:9
                                    </button>
                                    <button type="button" data-value="3:4" class="story-ratio-btn bg-gray-50 hover:bg-gray-100 text-gray-700 px-3 py-2.5 rounded-lg border-2 border-gray-300 transition-all text-sm font-medium">
                                        <i class="fas fa-rectangle-portrait mr-1"></i>3:4
                                    </button>
                                    <button type="button" data-value="9:16" class="story-ratio-btn story-ratio-selected bg-indigo-600 text-white px-3 py-2.5 rounded-lg border-2 border-indigo-600 transition-all text-sm font-bold shadow-md">
                                        <i class="fas fa-mobile-alt mr-1"></i>9:16
                                    </button>
                                </div>
                            </div>
                            <button type="submit" id="story-update-generate-btn" class="w-full bg-indigo-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-indigo-700 focus:outline-none focus:ring-4 focus:ring-indigo-300 transition-all duration-300 ease-in-out shadow-md disabled:bg-gray-400 disabled:cursor-not-allowed">
                                Generate 10 Stories
                            </button>
                        </form>
                    </div>
                    <!-- Kolom Hasil Foto -->
                    <div id="story-update-result-container" class="bg-gray-50 rounded-xl p-4 min-h-[300px] md:min-h-full relative overflow-y-auto">
                        <!-- Placeholder -->
                        <div id="story-update-placeholder" class="flex flex-col items-center justify-center h-full text-center p-4">
                            <div class="w-20 h-20 rounded-full bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center mb-4 shadow-lg">
                                <i class="fas fa-images text-white text-3xl"></i>
                            </div>
                            <h3 class="text-xl font-bold text-gray-800 mb-2">Hasil Story Update Anda</h3>
                            <p class="text-gray-500 text-sm max-w-sm">10 foto story akan muncul di sini. Setiap foto bisa di-preview dan download!</p>
                            <div class="mt-4 flex items-center gap-3 text-xs text-gray-400">
                                <div class="flex items-center gap-1">
                                    <i class="fas fa-check text-indigo-500"></i>
                                    <span>10 Variasi</span>
                                </div>
                                <div class="flex items-center gap-1">
                                    <i class="fas fa-bolt text-purple-500"></i>
                                    <span>HD Quality</span>
                                </div>
                            </div>
                        </div>

                        <!-- Loader -->
                        <div id="story-update-loader" class="hidden flex flex-col items-center justify-center h-full">
                            <div class="loader ease-linear rounded-full border-8 border-t-8 border-gray-200 h-20 w-20 mb-4"></div>
                            <p class="text-indigo-600 font-semibold">Generating stories...</p>
                        </div>

                        <!-- Results Container -->
                        <div id="story-update-results-wrapper" class="hidden">
                            <div class="flex items-center justify-between mb-4 bg-gradient-to-r from-indigo-50 to-purple-50 p-3 rounded-xl border-2 border-indigo-200">
                                <h3 class="text-lg font-bold text-gray-800">
                                    <i class="fas fa-sparkles mr-2 text-indigo-600"></i>
                                    10 Story Updates
                                </h3>
                                <button id="story-download-all-btn" class="bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-700 hover:to-purple-700 text-white px-5 py-2 rounded-full font-semibold shadow-lg transition transform hover:scale-105 flex items-center gap-2 text-sm">
                                    <i class="fas fa-download"></i>
                                    Download Semua
                                </button>
                            </div>
                            <div id="story-update-result-grid" class="grid grid-cols-2 gap-3"></div>
                        </div>

                        <!-- Error Message -->
                        <div id="story-update-error-message" class="hidden text-center text-red-500 p-4"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- TAB: PHOTO ANGLE GENERATOR PRO -->
        <div id="content-photo-angle" class="main-content-panel hidden">
            <div class="w-full max-w-6xl mx-auto">
                <!-- Header -->
                <div class="text-center mb-10">
                    <div class="flex items-center justify-center mb-4">
                        <div class="bg-gradient-to-r from-cyan-500 to-blue-500 p-4 rounded-2xl shadow-2xl">
                            <i class="fas fa-cube text-4xl text-white"></i>
                        </div>
                    </div>
                    <h1 class="text-4xl md:text-5xl font-bold bg-gradient-to-r from-cyan-600 via-blue-600 to-indigo-600 bg-clip-text text-transparent mb-3">
                        Photo Angle Generator Pro
                    </h1>
                    <p class="text-gray-600 text-lg max-w-3xl mx-auto">
                        Transform foto Anda ke berbagai angle profesional dalam sekali klik - Front, Side, Top, 45¬∞, dan lebih!
                    </p>
                </div>

                <!-- Main Container -->
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                    <!-- Left Panel - Controls -->
                    <div class="lg:col-span-1 space-y-6">
                        <!-- Upload Section -->
                        <div class="bg-white rounded-2xl shadow-xl p-6 border-2 border-cyan-100">
                            <h3 class="text-lg font-bold text-gray-800 mb-4 flex items-center gap-2">
                                <i class="fas fa-upload text-cyan-600"></i>
                                Upload Foto
                            </h3>

                            <div id="pa-upload-area" class="relative border-3 border-dashed border-gray-300 rounded-xl p-6 text-center hover:border-cyan-500 hover:bg-cyan-50 transition-all cursor-pointer group">
                                <input type="file" id="pa-photo-upload" accept="image/*" class="hidden">
                                <div id="pa-upload-placeholder">
                                    <i class="fas fa-cloud-upload-alt text-5xl text-gray-400 group-hover:text-cyan-500 transition-all mb-3"></i>
                                    <p class="text-gray-600 font-semibold">Click to upload photo</p>
                                    <p class="text-xs text-gray-500 mt-2">PNG, JPG, HEIC up to 10MB</p>
                                </div>
                                <img id="pa-photo-preview" class="hidden w-full h-48 object-cover rounded-lg">
                            </div>
                        </div>

                        <!-- Angle Presets -->
                        <div class="bg-white rounded-2xl shadow-xl p-6 border-2 border-cyan-100">
                            <h3 class="text-lg font-bold text-gray-800 mb-4 flex items-center gap-2">
                                <i class="fas fa-angles-right text-cyan-600"></i>
                                Angle Presets
                            </h3>
                            <div class="space-y-2">
                                <label class="flex items-center p-3 bg-gradient-to-r from-cyan-50 to-blue-50 rounded-lg cursor-pointer hover:shadow-md transition-all">
                                    <input type="radio" name="pa-preset" value="all" checked class="mr-3 w-4 h-4 text-cyan-600">
                                    <div>
                                        <div class="font-semibold text-gray-800">All Angles (6 Photos)</div>
                                        <div class="text-xs text-gray-500">Front, Side, Top, Bottom, 45¬∞, Back</div>
                                    </div>
                                </label>
                                <label class="flex items-center p-3 bg-gray-50 rounded-lg cursor-pointer hover:shadow-md transition-all">
                                    <input type="radio" name="pa-preset" value="product" class="mr-3 w-4 h-4 text-cyan-600">
                                    <div>
                                        <div class="font-semibold text-gray-800">Product View (6 Photos)</div>
                                        <div class="text-xs text-gray-500">360¬∞ rotation views</div>
                                    </div>
                                </label>
                                <label class="flex items-center p-3 bg-gray-50 rounded-lg cursor-pointer hover:shadow-md transition-all">
                                    <input type="radio" name="pa-preset" value="portrait" class="mr-3 w-4 h-4 text-cyan-600">
                                    <div>
                                        <div class="font-semibold text-gray-800">Portrait Style (6 Photos)</div>
                                        <div class="text-xs text-gray-500">Face angles & perspectives</div>
                                    </div>
                                </label>
                            </div>
                        </div>

                        <!-- Aspect Ratio -->
                        <div class="bg-white rounded-2xl shadow-xl p-6 border-2 border-cyan-100">
                            <h3 class="text-lg font-bold text-gray-800 mb-4 flex items-center gap-2">
                                <i class="fas fa-crop text-cyan-600"></i>
                                Aspect Ratio
                            </h3>
                            <div class="grid grid-cols-2 gap-3">
                                <button data-ratio="1:1" class="pa-ratio-btn bg-cyan-600 text-white font-semibold py-3 px-4 rounded-lg hover:bg-cyan-700 transition-all transform hover:scale-105 ring-2 ring-cyan-400">1:1</button>
                                <button data-ratio="16:9" class="pa-ratio-btn bg-gray-200 text-gray-700 font-semibold py-3 px-4 rounded-lg hover:bg-gray-300 transition-all transform hover:scale-105">16:9</button>
                                <button data-ratio="3:4" class="pa-ratio-btn bg-gray-200 text-gray-700 font-semibold py-3 px-4 rounded-lg hover:bg-gray-300 transition-all transform hover:scale-105">3:4</button>
                                <button data-ratio="9:16" class="pa-ratio-btn bg-gray-200 text-gray-700 font-semibold py-3 px-4 rounded-lg hover:bg-gray-300 transition-all transform hover:scale-105">9:16</button>
                            </div>
                        </div>

                        <!-- Generate Button -->
                        <button id="pa-generate-btn" disabled class="w-full bg-gradient-to-r from-cyan-600 via-blue-600 to-indigo-600 hover:from-cyan-700 hover:via-blue-700 hover:to-indigo-700 text-white font-bold py-4 px-6 rounded-xl shadow-2xl disabled:opacity-50 disabled:cursor-not-allowed transform hover:scale-105 transition-all duration-300 flex items-center justify-center gap-3">
                            <i class="fas fa-wand-magic-sparkles text-xl"></i>
                            <span class="text-lg">Generate 6 Angles</span>
                        </button>
                    </div>

                    <!-- Right Panel - Results -->
                    <div class="lg:col-span-2 space-y-6">
                        <!-- Placeholder -->
                        <div id="pa-placeholder" class="bg-gradient-to-br from-cyan-50 via-blue-50 to-indigo-50 rounded-2xl p-12 text-center border-2 border-dashed border-cyan-300">
                            <i class="fas fa-cube text-6xl text-cyan-400 mb-4"></i>
                            <h3 class="text-xl font-bold text-gray-700 mb-2">Ready to Transform</h3>
                            <p class="text-gray-500">Upload foto dan pilih preset angle untuk memulai</p>
                        </div>

                        <!-- Loading -->
                        <div id="pa-loading" class="hidden bg-white rounded-2xl p-8 shadow-xl border-2 border-cyan-200">
                            <div class="flex items-center justify-center mb-4">
                                <svg class="animate-spin h-10 w-10 text-cyan-600 mr-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                                </svg>
                                <span class="text-gray-700 font-semibold text-lg" id="pa-loading-text">Generating angles...</span>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-3 overflow-hidden">
                                <div id="pa-progress-bar" class="bg-gradient-to-r from-cyan-500 to-blue-500 h-3 rounded-full transition-all duration-500" style="width: 0%"></div>
                            </div>
                            <p class="text-center text-gray-500 text-sm mt-2" id="pa-progress-text">0/6 completed</p>
                        </div>

                        <!-- Results Header -->
                        <div id="pa-results-header" class="hidden flex items-center justify-between bg-gradient-to-r from-cyan-100 to-blue-100 p-5 rounded-xl border-2 border-cyan-300">
                            <h3 class="text-xl font-bold text-gray-800 flex items-center gap-2">
                                <i class="fas fa-check-circle text-green-500"></i>
                                6 Angles Generated!
                            </h3>
                            <button id="pa-download-all-btn" class="bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white font-bold py-3 px-6 rounded-lg shadow-lg transform hover:scale-105 transition-all flex items-center gap-2">
                                <i class="fas fa-download"></i>
                                Download All
                            </button>
                        </div>

                        <!-- Results Grid -->
                        <div id="pa-results-grid" class="hidden grid grid-cols-2 md:grid-cols-3 gap-4">
                            <!-- Dynamic content here -->
                        </div>

                        <!-- Error Message -->
                        <div id="pa-error-message" class="hidden bg-red-100 border-2 border-red-300 text-red-700 p-5 rounded-xl shadow-lg">
                            <div class="flex items-center gap-3">
                                <i class="fas fa-exclamation-circle text-2xl"></i>
                                <div>
                                    <h4 class="font-bold mb-1">Generation Failed</h4>
                                    <p class="text-sm" id="pa-error-text"></p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- TAB: PHOTO STYLE MATCHER PRO -->
        <div id="content-style-matcher" class="main-content-panel hidden">
            <div class="w-full max-w-7xl mx-auto">
                <!-- Header -->
                <div class="text-center mb-10">
                    <div class="flex items-center justify-center mb-4">
                        <div class="bg-gradient-to-r from-pink-500 via-purple-500 to-indigo-500 p-4 rounded-2xl shadow-2xl animate-pulse">
                            <i class="fas fa-wand-sparkles text-4xl text-white"></i>
                        </div>
                    </div>
                    <h1 class="text-4xl md:text-5xl font-bold bg-gradient-to-r from-pink-600 via-purple-600 to-indigo-600 bg-clip-text text-transparent mb-3">
                        Photo Style Matcher Pro
                    </h1>
                    <p class="text-gray-600 text-lg max-w-3xl mx-auto">
                        Transform foto Anda dengan gaya visual dari foto referensi (artis, influencer, atau gaya apapun) - AI akan mencocokkan lighting, color grading, mood, dan aesthetics!
                    </p>
                </div>

                <!-- Main Grid -->
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                    <!-- Left Panel - Controls -->
                    <div class="lg:col-span-1 space-y-6">
                        <!-- Your Photo Upload -->
                        <div class="bg-white rounded-2xl shadow-xl p-6 border-2 border-pink-100">
                            <h3 class="text-lg font-bold text-gray-800 mb-4 flex items-center gap-2">
                                <i class="fas fa-user-circle text-pink-600"></i>
                                Foto Anda
                            </h3>
                            <div id="sm-your-upload-area" class="relative border-3 border-dashed border-gray-300 rounded-xl p-6 text-center hover:border-pink-500 hover:bg-pink-50 transition-all cursor-pointer group">
                                <input type="file" id="sm-your-photo" accept="image/*" class="hidden">
                                <div id="sm-your-placeholder">
                                    <i class="fas fa-user text-5xl text-gray-400 group-hover:text-pink-500 transition-all mb-3"></i>
                                    <p class="text-gray-600 font-semibold">Upload foto Anda</p>
                                    <p class="text-xs text-gray-500 mt-2">PNG, JPG, HEIC</p>
                                </div>
                                <img id="sm-your-preview" class="hidden w-full h-48 object-cover rounded-lg">
                            </div>
                        </div>

                        <!-- Reference Photo Upload -->
                        <div class="bg-white rounded-2xl shadow-xl p-6 border-2 border-purple-100">
                            <h3 class="text-lg font-bold text-gray-800 mb-4 flex items-center gap-2">
                                <i class="fas fa-star text-purple-600"></i>
                                Foto Referensi (Gaya)
                            </h3>
                            <div id="sm-ref-upload-area" class="relative border-3 border-dashed border-gray-300 rounded-xl p-6 text-center hover:border-purple-500 hover:bg-purple-50 transition-all cursor-pointer group">
                                <input type="file" id="sm-ref-photo" accept="image/*" class="hidden">
                                <div id="sm-ref-placeholder">
                                    <i class="fas fa-image text-5xl text-gray-400 group-hover:text-purple-500 transition-all mb-3"></i>
                                    <p class="text-gray-600 font-semibold">Upload foto gaya</p>
                                    <p class="text-xs text-gray-500 mt-2">Artis, influencer, dll</p>
                                </div>
                                <img id="sm-ref-preview" class="hidden w-full h-48 object-cover rounded-lg">
                            </div>
                        </div>

                        <!-- Style Strength -->
                        <div class="bg-white rounded-2xl shadow-xl p-6 border-2 border-indigo-100">
                            <h3 class="text-lg font-bold text-gray-800 mb-4 flex items-center gap-2">
                                <i class="fas fa-sliders-h text-indigo-600"></i>
                                Style Strength
                            </h3>
                            <div class="space-y-3">
                                <label class="flex items-center p-3 bg-gradient-to-r from-pink-50 to-purple-50 rounded-lg cursor-pointer hover:shadow-md transition-all">
                                    <input type="radio" name="sm-strength" value="subtle" class="mr-3 w-4 h-4 text-pink-600">
                                    <div class="flex-1">
                                        <div class="font-semibold text-gray-800">Subtle (30%)</div>
                                        <div class="text-xs text-gray-500">Gaya halus, natural</div>
                                    </div>
                                </label>
                                <label class="flex items-center p-3 bg-gradient-to-r from-purple-50 to-indigo-50 rounded-lg cursor-pointer hover:shadow-md transition-all">
                                    <input type="radio" name="sm-strength" value="moderate" checked class="mr-3 w-4 h-4 text-purple-600">
                                    <div class="flex-1">
                                        <div class="font-semibold text-gray-800">Moderate (60%)</div>
                                        <div class="text-xs text-gray-500">Balance, recommended</div>
                                    </div>
                                </label>
                                <label class="flex items-center p-3 bg-gray-50 rounded-lg cursor-pointer hover:shadow-md transition-all">
                                    <input type="radio" name="sm-strength" value="strong" class="mr-3 w-4 h-4 text-indigo-600">
                                    <div class="flex-1">
                                        <div class="font-semibold text-gray-800">Strong (90%)</div>
                                        <div class="text-xs text-gray-500">Gaya kuat, dramatic</div>
                                    </div>
                                </label>
                            </div>
                        </div>

                        <!-- Aspect Ratio -->
                        <div class="bg-white rounded-2xl shadow-xl p-6 border-2 border-pink-100">
                            <h3 class="text-lg font-bold text-gray-800 mb-4 flex items-center gap-2">
                                <i class="fas fa-crop text-pink-600"></i>
                                Output Ratio
                            </h3>
                            <div class="grid grid-cols-2 gap-3">
                                <button data-ratio="1:1" class="sm-ratio-btn bg-pink-600 text-white font-semibold py-3 px-4 rounded-lg hover:bg-pink-700 transition-all transform hover:scale-105 ring-2 ring-pink-400">1:1</button>
                                <button data-ratio="16:9" class="sm-ratio-btn bg-gray-200 text-gray-700 font-semibold py-3 px-4 rounded-lg hover:bg-gray-300 transition-all transform hover:scale-105">16:9</button>
                                <button data-ratio="3:4" class="sm-ratio-btn bg-gray-200 text-gray-700 font-semibold py-3 px-4 rounded-lg hover:bg-gray-300 transition-all transform hover:scale-105">3:4</button>
                                <button data-ratio="9:16" class="sm-ratio-btn bg-gray-200 text-gray-700 font-semibold py-3 px-4 rounded-lg hover:bg-gray-300 transition-all transform hover:scale-105">9:16</button>
                            </div>
                        </div>

                        <!-- Generate Button -->
                        <button id="sm-generate-btn" disabled class="w-full bg-gradient-to-r from-pink-600 via-purple-600 to-indigo-600 hover:from-pink-700 hover:via-purple-700 hover:to-indigo-700 text-white font-bold py-4 px-6 rounded-xl shadow-2xl disabled:opacity-50 disabled:cursor-not-allowed transform hover:scale-105 transition-all duration-300 flex items-center justify-center gap-3">
                            <i class="fas fa-wand-magic-sparkles text-xl"></i>
                            <span class="text-lg">Match Style (6 Variations)</span>
                        </button>
                    </div>

                    <!-- Right Panel - Results -->
                    <div class="lg:col-span-2 space-y-6">
                        <!-- Placeholder -->
                        <div id="sm-placeholder" class="bg-gradient-to-br from-pink-50 via-purple-50 to-indigo-50 rounded-2xl p-12 text-center border-2 border-dashed border-pink-300">
                            <i class="fas fa-wand-sparkles text-6xl text-pink-400 mb-4"></i>
                            <h3 class="text-xl font-bold text-gray-700 mb-2">Ready to Match Style</h3>
                            <p class="text-gray-500 mb-4">Upload foto Anda dan foto referensi untuk memulai</p>
                            <div class="flex items-center justify-center gap-8 mt-6">
                                <div class="text-center">
                                    <div class="w-20 h-20 bg-pink-200 rounded-full flex items-center justify-center mb-2 mx-auto">
                                        <i class="fas fa-user text-2xl text-pink-600"></i>
                                    </div>
                                    <p class="text-sm text-gray-600">Your Photo</p>
                                </div>
                                <i class="fas fa-arrow-right text-3xl text-purple-400"></i>
                                <div class="text-center">
                                    <div class="w-20 h-20 bg-purple-200 rounded-full flex items-center justify-center mb-2 mx-auto">
                                        <i class="fas fa-star text-2xl text-purple-600"></i>
                                    </div>
                                    <p class="text-sm text-gray-600">Reference Style</p>
                                </div>
                                <i class="fas fa-arrow-right text-3xl text-indigo-400"></i>
                                <div class="text-center">
                                    <div class="w-20 h-20 bg-indigo-200 rounded-full flex items-center justify-center mb-2 mx-auto">
                                        <i class="fas fa-magic text-2xl text-indigo-600"></i>
                                    </div>
                                    <p class="text-sm text-gray-600">Styled Photo</p>
                                </div>
                            </div>
                        </div>

                        <!-- Loading -->
                        <div id="sm-loading" class="hidden bg-white rounded-2xl p-8 shadow-xl border-2 border-purple-200">
                            <div class="flex items-center justify-center mb-4">
                                <svg class="animate-spin h-10 w-10 text-purple-600 mr-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                                </svg>
                                <span class="text-gray-700 font-semibold text-lg" id="sm-loading-text">Matching style...</span>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-3 overflow-hidden">
                                <div id="sm-progress-bar" class="bg-gradient-to-r from-pink-500 via-purple-500 to-indigo-500 h-3 rounded-full transition-all duration-500" style="width: 0%"></div>
                            </div>
                            <p class="text-center text-gray-500 text-sm mt-2" id="sm-progress-text">0/6 completed</p>
                        </div>

                        <!-- Results Header -->
                        <div id="sm-results-header" class="hidden flex flex-col md:flex-row items-center justify-between bg-gradient-to-r from-pink-100 via-purple-100 to-indigo-100 p-5 rounded-xl border-2 border-purple-300 gap-4">
                            <div>
                                <h3 class="text-xl font-bold text-gray-800 flex items-center gap-2">
                                    <i class="fas fa-check-circle text-green-500"></i>
                                    6 Styled Variations Generated!
                                </h3>
                                <p class="text-sm text-gray-600 mt-1">Pilih yang paling sesuai atau download semua</p>
                            </div>
                            <div class="flex gap-3">
                                <button id="sm-compare-btn" class="bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white font-bold py-3 px-6 rounded-lg shadow-lg transform hover:scale-105 transition-all flex items-center gap-2">
                                    <i class="fas fa-columns"></i>
                                    Compare
                                </button>
                                <button id="sm-download-all-btn" class="bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white font-bold py-3 px-6 rounded-lg shadow-lg transform hover:scale-105 transition-all flex items-center gap-2">
                                    <i class="fas fa-download"></i>
                                    Download All
                                </button>
                            </div>
                        </div>

                        <!-- Results Grid -->
                        <div id="sm-results-grid" class="hidden grid grid-cols-2 md:grid-cols-3 gap-4">
                            <!-- Dynamic content here -->
                        </div>

                        <!-- Comparison Modal -->
                        <div id="sm-comparison-modal" class="hidden fixed inset-0 bg-black/80 backdrop-blur-sm z-50 flex items-center justify-center p-4">
                            <div class="bg-white rounded-2xl max-w-6xl w-full max-h-[90vh] overflow-y-auto">
                                <div class="sticky top-0 bg-white border-b-2 border-gray-200 p-6 flex items-center justify-between">
                                    <h3 class="text-2xl font-bold text-gray-800">Before & After Comparison</h3>
                                    <button id="sm-close-comparison" class="text-gray-500 hover:text-gray-700 text-2xl">
                                        <i class="fas fa-times"></i>
                                    </button>
                                </div>
                                <div class="p-6">
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                        <div>
                                            <h4 class="text-lg font-bold text-gray-700 mb-3 flex items-center gap-2">
                                                <i class="fas fa-image text-gray-500"></i>
                                                Original
                                            </h4>
                                            <img id="sm-comparison-original" class="w-full rounded-xl shadow-lg border-2 border-gray-300">
                                        </div>
                                        <div>
                                            <h4 class="text-lg font-bold text-gray-700 mb-3 flex items-center gap-2">
                                                <i class="fas fa-wand-sparkles text-purple-500"></i>
                                                Styled
                                            </h4>
                                            <img id="sm-comparison-styled" class="w-full rounded-xl shadow-lg border-2 border-purple-300">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Error Message -->
                        <div id="sm-error-message" class="hidden bg-red-100 border-2 border-red-300 text-red-700 p-5 rounded-xl shadow-lg">
                            <div class="flex items-center gap-3">
                                <i class="fas fa-exclamation-circle text-2xl"></i>
                                <div>
                                    <h4 class="font-bold mb-1">Generation Failed</h4>
                                    <p class="text-sm" id="sm-error-text"></p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Feature Highlights -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mt-10">
                    <div class="bg-gradient-to-br from-pink-100 to-pink-50 rounded-xl p-6 border-2 border-pink-200">
                        <div class="flex items-center gap-3 mb-3">
                            <div class="bg-pink-500 p-3 rounded-lg">
                                <i class="fas fa-palette text-white text-xl"></i>
                            </div>
                            <h4 class="font-bold text-gray-800">Color Matching</h4>
                        </div>
                        <p class="text-sm text-gray-600">AI matches color grading, tones, and saturation dari foto referensi</p>
                    </div>
                    <div class="bg-gradient-to-br from-purple-100 to-purple-50 rounded-xl p-6 border-2 border-purple-200">
                        <div class="flex items-center gap-3 mb-3">
                            <div class="bg-purple-500 p-3 rounded-lg">
                                <i class="fas fa-lightbulb text-white text-xl"></i>
                            </div>
                            <h4 class="font-bold text-gray-800">Lighting Style</h4>
                        </div>
                        <p class="text-sm text-gray-600">Transfer lighting direction, softness, dan mood dari referensi</p>
                    </div>
                    <div class="bg-gradient-to-br from-indigo-100 to-indigo-50 rounded-xl p-6 border-2 border-indigo-200">
                        <div class="flex items-center gap-3 mb-3">
                            <div class="bg-indigo-500 p-3 rounded-lg">
                                <i class="fas fa-camera text-white text-xl"></i>
                            </div>
                            <h4 class="font-bold text-gray-800">Aesthetic Match</h4>
                        </div>
                        <p class="text-sm text-gray-600">Mencocokkan overall vibe, filters, dan post-processing style</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- TAB: THUMBNAIL GENERATOR PRO -->
        <div id="content-thumbnail-generator" class="main-content-panel hidden">
            <div class="w-full max-w-7xl mx-auto">
                <!-- Header -->
                <div class="text-center mb-10">
                    <div class="flex items-center justify-center mb-4">
                        <div class="bg-gradient-to-r from-red-500 via-orange-500 to-yellow-500 p-4 rounded-2xl shadow-2xl">
                            <i class="fas fa-rectangle-ad text-4xl text-white"></i>
                        </div>
                    </div>
                    <h1 class="text-4xl md:text-5xl font-bold bg-gradient-to-r from-red-600 via-orange-600 to-yellow-600 bg-clip-text text-transparent mb-3">
                        Thumbnail Generator Pro
                    </h1>
                    <p class="text-gray-600 text-lg max-w-3xl mx-auto">
                        Generate eye-catching thumbnails untuk YouTube, Instagram, atau platform apapun - Gunakan foto referensi atau buat dari teks custom!
                    </p>
                </div>

                <!-- Main Grid -->
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                    <!-- Left Panel - Controls -->
                    <div class="lg:col-span-1 space-y-6">
                        <!-- Mode Selector -->
                        <div class="bg-white rounded-2xl shadow-xl p-6 border-2 border-red-100">
                            <h3 class="text-lg font-bold text-gray-800 mb-4 flex items-center gap-2">
                                <i class="fas fa-toggle-on text-red-600"></i>
                                Generation Mode
                            </h3>
                            <div class="flex gap-2">
                                <button id="tg-mode-reference" class="flex-1 bg-gradient-to-r from-red-500 to-orange-500 text-white font-bold py-3 px-4 rounded-lg shadow-lg transition-all">
                                    <i class="fas fa-image mr-2"></i>Reference
                                </button>
                                <button id="tg-mode-text" class="flex-1 bg-gray-200 text-gray-700 font-semibold py-3 px-4 rounded-lg hover:bg-gray-300 transition-all">
                                    <i class="fas fa-text mr-2"></i>Text-Based
                                </button>
                            </div>
                        </div>

                        <!-- Reference Mode Panel -->
                        <div id="tg-reference-panel" class="space-y-6">
                            <div class="bg-white rounded-2xl shadow-xl p-6 border-2 border-orange-100">
                                <h3 class="text-lg font-bold text-gray-800 mb-4 flex items-center gap-2">
                                    <i class="fas fa-upload text-orange-600"></i>
                                    Upload Reference
                                </h3>
                                <div id="tg-ref-upload-area" class="relative border-3 border-dashed border-gray-300 rounded-xl p-6 text-center hover:border-orange-500 hover:bg-orange-50 transition-all cursor-pointer group">
                                    <input type="file" id="tg-ref-photo" accept="image/*" class="hidden">
                                    <div id="tg-ref-placeholder">
                                        <i class="fas fa-image text-5xl text-gray-400 group-hover:text-orange-500 transition-all mb-3"></i>
                                        <p class="text-gray-600 font-semibold">Upload thumbnail reference</p>
                                        <p class="text-xs text-gray-500 mt-2">PNG, JPG, HEIC</p>
                                    </div>
                                    <img id="tg-ref-preview" class="hidden w-full h-48 object-cover rounded-lg">
                                </div>
                            </div>

                            <div class="bg-white rounded-2xl shadow-xl p-6 border-2 border-orange-100">
                                <h3 class="text-lg font-bold text-gray-800 mb-4 flex items-center gap-2">
                                    <i class="fas fa-magic text-orange-600"></i>
                                    Custom Instructions <span class="text-sm font-normal text-gray-500">(Optional)</span>
                                </h3>
                                <textarea id="tg-ref-custom-instructions" rows="3" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-orange-500 focus:ring-2 focus:ring-orange-200 transition-all resize-none" placeholder="Contoh: Tambahkan efek glow, gunakan warna biru dan merah, fokus pada produk di tengah, background blur, dsb."></textarea>
                                <p class="text-xs text-gray-500 mt-2">üí° Deskripsikan perubahan atau penekanan yang Anda inginkan dari reference</p>
                            </div>
                        </div>

                        <!-- Text Mode Panel -->
                        <div id="tg-text-panel" class="hidden space-y-6">
                            <div class="bg-white rounded-2xl shadow-xl p-6 border-2 border-orange-100">
                                <h3 class="text-lg font-bold text-gray-800 mb-4 flex items-center gap-2">
                                    <i class="fas fa-heading text-orange-600"></i>
                                    Thumbnail Title
                                </h3>
                                <input type="text" id="tg-title-input" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-orange-500 focus:ring-2 focus:ring-orange-200 transition-all" placeholder="e.g., HOW TO MAKE $10,000 ONLINE">
                                <p class="text-xs text-gray-500 mt-2">üí° Gunakan ALL CAPS untuk impact maksimal</p>
                            </div>

                            <div class="bg-white rounded-2xl shadow-xl p-6 border-2 border-orange-100">
                                <h3 class="text-lg font-bold text-gray-800 mb-4 flex items-center gap-2">
                                    <i class="fas fa-text-height text-orange-600"></i>
                                    Subtitle (Optional)
                                </h3>
                                <input type="text" id="tg-subtitle-input" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-orange-500 focus:ring-2 focus:ring-orange-200 transition-all" placeholder="e.g., Step by Step Tutorial">
                            </div>

                            <div class="bg-white rounded-2xl shadow-xl p-6 border-2 border-orange-100">
                                <h3 class="text-lg font-bold text-gray-800 mb-4 flex items-center gap-2">
                                    <i class="fas fa-palette text-orange-600"></i>
                                    Thumbnail Style
                                </h3>
                                <select id="tg-style-select" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-orange-500 focus:ring-2 focus:ring-orange-200 transition-all">
                                    <option value="tech">Tech/Gaming (Neon, Futuristic)</option>
                                    <option value="business">Business/Finance (Professional)</option>
                                    <option value="vlog">Vlog/Lifestyle (Vibrant, Fun)</option>
                                    <option value="tutorial">Tutorial/Education (Clean, Clear)</option>
                                    <option value="dramatic">Dramatic/Clickbait (Bold, Eye-catching)</option>
                                    <option value="minimal">Minimal/Modern (Elegant, Simple)</option>
                                </select>
                            </div>
                        </div>

                        <!-- Expression/Emotion Selector (Both Modes) -->
                        <div class="bg-white rounded-2xl shadow-xl p-6 border-2 border-purple-100">
                            <h3 class="text-lg font-bold text-gray-800 mb-4 flex items-center gap-2">
                                <i class="fas fa-smile text-purple-600"></i>
                                Expression/Vibe <span class="text-sm font-normal text-gray-500">(Optional)</span>
                            </h3>
                            <select id="tg-expression-select" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-purple-500 focus:ring-2 focus:ring-purple-200 transition-all">
                                <option value="">No Specific Expression</option>
                                <option value="shocked">üò≤ Shocked/Surprised</option>
                                <option value="excited">ü§© Excited/Amazed</option>
                                <option value="serious">üòê Serious/Professional</option>
                                <option value="happy">üòÑ Happy/Cheerful</option>
                                <option value="dramatic">üò± Dramatic/Intense</option>
                                <option value="mysterious">ü§î Mysterious/Intriguing</option>
                                <option value="energetic">‚ö° Energetic/Dynamic</option>
                                <option value="calm">üòå Calm/Peaceful</option>
                            </select>
                            <p class="text-xs text-gray-500 mt-2">Atur mood/vibe keseluruhan thumbnail</p>
                        </div>

                        <!-- Number of Variations -->
                        <div class="bg-white rounded-2xl shadow-xl p-6 border-2 border-pink-100">
                            <h3 class="text-lg font-bold text-gray-800 mb-4 flex items-center gap-2">
                                <i class="fas fa-layer-group text-pink-600"></i>
                                Number of Variations
                            </h3>
                            <div id="tg-count-selection" class="grid grid-cols-3 gap-3">
                                <button type="button" data-count="4" class="tg-count-btn bg-gray-50 hover:bg-gray-100 text-gray-700 px-3 py-2.5 rounded-lg border-2 border-gray-300 transition-all text-sm font-medium">
                                    4 Images
                                </button>
                                <button type="button" data-count="6" class="tg-count-btn tg-count-selected bg-gradient-to-r from-pink-500 to-rose-500 text-white px-3 py-2.5 rounded-lg border-2 border-pink-500 transition-all text-sm font-bold shadow-md">
                                    6 Images
                                </button>
                                <button type="button" data-count="8" class="tg-count-btn bg-gray-50 hover:bg-gray-100 text-gray-700 px-3 py-2.5 rounded-lg border-2 border-gray-300 transition-all text-sm font-medium">
                                    8 Images
                                </button>
                            </div>
                        </div>

                        <!-- Category Selector (Both Modes) -->
                        <div class="bg-white rounded-2xl shadow-xl p-6 border-2 border-yellow-100">
                            <h3 class="text-lg font-bold text-gray-800 mb-4 flex items-center gap-2">
                                <i class="fas fa-tags text-yellow-600"></i>
                                Category
                            </h3>
                            <select id="tg-category-select" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-yellow-500 focus:ring-2 focus:ring-yellow-200 transition-all">
                                <option value="youtube">YouTube (16:9)</option>
                                <option value="instagram">Instagram Feed (1:1)</option>
                                <option value="story">Instagram Story (9:16)</option>
                                <option value="facebook">Facebook Post (16:9)</option>
                                <option value="twitter">Twitter Card (16:9)</option>
                            </select>
                        </div>

                        <!-- Generate Button -->
                        <button id="tg-generate-btn" disabled class="w-full bg-gradient-to-r from-red-600 via-orange-600 to-yellow-600 hover:from-red-700 hover:via-orange-700 hover:to-yellow-700 text-white font-bold py-4 px-6 rounded-xl shadow-2xl disabled:opacity-50 disabled:cursor-not-allowed transform hover:scale-105 transition-all duration-300 flex items-center justify-center gap-3">
                            <i class="fas fa-bolt text-xl"></i>
                            <span class="text-lg">Generate <span id="tg-count-text">6</span> Thumbnails</span>
                        </button>
                    </div>

                    <!-- Right Panel - Results -->
                    <div class="lg:col-span-2 space-y-6">
                        <!-- Placeholder -->
                        <div id="tg-placeholder" class="bg-gradient-to-br from-red-50 via-orange-50 to-yellow-50 rounded-2xl p-12 text-center border-2 border-dashed border-orange-300">
                            <i class="fas fa-rectangle-ad text-6xl text-orange-400 mb-4"></i>
                            <h3 class="text-xl font-bold text-gray-700 mb-2">Ready to Generate Thumbnails</h3>
                            <p class="text-gray-500 mb-6">Pilih mode dan isi informasi untuk memulai</p>
                            <div class="grid grid-cols-2 gap-4 max-w-md mx-auto">
                                <div class="bg-white rounded-lg p-4 shadow-md">
                                    <i class="fas fa-image text-3xl text-red-500 mb-2"></i>
                                    <p class="text-sm font-semibold text-gray-700">Reference Mode</p>
                                    <p class="text-xs text-gray-500">Upload existing thumbnail</p>
                                </div>
                                <div class="bg-white rounded-lg p-4 shadow-md">
                                    <i class="fas fa-text text-3xl text-orange-500 mb-2"></i>
                                    <p class="text-sm font-semibold text-gray-700">Text Mode</p>
                                    <p class="text-xs text-gray-500">Create from scratch</p>
                                </div>
                            </div>
                        </div>

                        <!-- Loading -->
                        <div id="tg-loading" class="hidden bg-white rounded-2xl p-8 shadow-xl border-2 border-orange-200">
                            <div class="flex items-center justify-center mb-4">
                                <svg class="animate-spin h-10 w-10 text-orange-600 mr-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                                </svg>
                                <span class="text-gray-700 font-semibold text-lg" id="tg-loading-text">Generating thumbnails...</span>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-3 overflow-hidden">
                                <div id="tg-progress-bar" class="bg-gradient-to-r from-red-500 via-orange-500 to-yellow-500 h-3 rounded-full transition-all duration-500" style="width: 0%"></div>
                            </div>
                            <p class="text-center text-gray-500 text-sm mt-2" id="tg-progress-text">0/6 completed</p>
                        </div>

                        <!-- Results Header -->
                        <div id="tg-results-header" class="hidden flex flex-col md:flex-row items-center justify-between bg-gradient-to-r from-red-100 via-orange-100 to-yellow-100 p-5 rounded-xl border-2 border-orange-300 gap-4">
                            <div>
                                <h3 class="text-xl font-bold text-gray-800 flex items-center gap-2">
                                    <i class="fas fa-check-circle text-green-500"></i>
                                    <span id="tg-results-count">6</span> Thumbnails Generated!
                                </h3>
                                <p class="text-sm text-gray-600 mt-1">Click-worthy thumbnails siap digunakan</p>
                            </div>
                            <button id="tg-download-all-btn" class="bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white font-bold py-3 px-6 rounded-lg shadow-lg transform hover:scale-105 transition-all flex items-center gap-2">
                                <i class="fas fa-download"></i>
                                Download All
                            </button>
                        </div>

                        <!-- Results Grid -->
                        <div id="tg-results-grid" class="hidden grid grid-cols-1 md:grid-cols-2 gap-4">
                            <!-- Dynamic content here -->
                        </div>

                        <!-- Error Message -->
                        <div id="tg-error-message" class="hidden bg-red-100 border-2 border-red-300 text-red-700 p-5 rounded-xl shadow-lg">
                            <div class="flex items-center gap-3">
                                <i class="fas fa-exclamation-circle text-2xl"></i>
                                <div>
                                    <h4 class="font-bold mb-1">Generation Failed</h4>
                                    <p class="text-sm" id="tg-error-text"></p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Tips Section -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mt-10">
                    <div class="bg-gradient-to-br from-red-100 to-red-50 rounded-xl p-6 border-2 border-red-200">
                        <div class="flex items-center gap-3 mb-3">
                            <div class="bg-red-500 p-3 rounded-lg">
                                <i class="fas fa-text-height text-white text-xl"></i>
                            </div>
                            <h4 class="font-bold text-gray-800">Bold Text</h4>
                        </div>
                        <p class="text-sm text-gray-600">Gunakan text besar, bold, dan kontras tinggi untuk readability maksimal</p>
                    </div>
                    <div class="bg-gradient-to-br from-orange-100 to-orange-50 rounded-xl p-6 border-2 border-orange-200">
                        <div class="flex items-center gap-3 mb-3">
                            <div class="bg-orange-500 p-3 rounded-lg">
                                <i class="fas fa-eye text-white text-xl"></i>
                            </div>
                            <h4 class="font-bold text-gray-800">Eye-Catching</h4>
                        </div>
                        <p class="text-sm text-gray-600">Warna kontras, ekspresif facial, dan composition yang menarik perhatian</p>
                    </div>
                    <div class="bg-gradient-to-br from-yellow-100 to-yellow-50 rounded-xl p-6 border-2 border-yellow-200">
                        <div class="flex items-center gap-3 mb-3">
                            <div class="bg-yellow-500 p-3 rounded-lg">
                                <i class="fas fa-mobile-alt text-white text-xl"></i>
                            </div>
                            <h4 class="font-bold text-gray-800">Mobile-Friendly</h4>
                        </div>
                        <p class="text-sm text-gray-600">Pastikan text terbaca jelas di layar kecil, hindari terlalu banyak detail</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- TAB: COVER PHOTO GENERATOR PRO -->
        <div id="content-cover-photo-generator" class="main-content-panel hidden">
            <div class="w-full max-w-7xl mx-auto">
                <!-- Header -->
                <div class="text-center mb-10">
                    <div class="flex items-center justify-center mb-4">
                        <div class="bg-gradient-to-r from-purple-600 via-indigo-600 to-blue-600 p-4 rounded-2xl shadow-2xl">
                            <i class="fas fa-image-portrait text-4xl text-white"></i>
                        </div>
                    </div>
                    <h1 class="text-4xl md:text-5xl font-bold bg-gradient-to-r from-purple-600 via-indigo-600 to-blue-600 bg-clip-text text-transparent mb-3">
                        Foto Sampul IG & TikTok Pro
                    </h1>
                    <p class="text-gray-600 text-lg max-w-3xl mx-auto">
                        Buat foto sampul profesional untuk Instagram & TikTok (9:16 vertical) - Support faceless & with face!
                    </p>
                </div>

                <!-- Main Grid -->
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                    <!-- Left Panel - Controls -->
                    <div class="lg:col-span-1 space-y-6">
                        <!-- Mode Selector -->
                        <div class="bg-white rounded-2xl shadow-xl p-6 border-2 border-purple-100">
                            <h3 class="text-lg font-bold text-gray-800 mb-4 flex items-center gap-2">
                                <i class="fas fa-toggle-on text-purple-600"></i>
                                Branding Mode
                            </h3>
                            <div class="flex gap-2">
                                <button id="cpg-mode-photo" class="flex-1 bg-gradient-to-r from-purple-600 to-indigo-600 text-white font-bold py-3 px-4 rounded-lg shadow-lg transition-all">
                                    <i class="fas fa-user-circle mr-2"></i>With Photo
                                </button>
                                <button id="cpg-mode-faceless" class="flex-1 bg-gray-200 text-gray-700 font-semibold py-3 px-4 rounded-lg hover:bg-gray-300 transition-all">
                                    <i class="fas fa-font mr-2"></i>Faceless
                                </button>
                            </div>
                        </div>

                        <!-- Photo Upload Panel (With Photo Mode) -->
                        <div id="cpg-photo-panel" class="space-y-6">
                            <div class="bg-white rounded-2xl shadow-xl p-6 border-2 border-indigo-100">
                                <h3 class="text-lg font-bold text-gray-800 mb-4 flex items-center gap-2">
                                    <i class="fas fa-upload text-indigo-600"></i>
                                    Upload Your Photo
                                </h3>
                                <div id="cpg-photo-upload-area" class="relative border-3 border-dashed border-gray-300 rounded-xl p-6 text-center hover:border-indigo-500 hover:bg-indigo-50 transition-all cursor-pointer group">
                                    <input type="file" id="cpg-photo-input" accept="image/*" class="hidden">
                                    <div id="cpg-photo-placeholder">
                                        <i class="fas fa-user-circle text-5xl text-gray-400 group-hover:text-indigo-500 transition-all mb-3"></i>
                                        <p class="text-gray-600 font-semibold">Upload model photo</p>
                                        <p class="text-xs text-gray-500 mt-2">PNG, JPG, HEIC</p>
                                    </div>
                                    <img id="cpg-photo-preview" class="hidden w-full h-48 object-cover rounded-lg">
                                </div>
                            </div>
                        </div>

                        <!-- Text Inputs -->
                        <div class="bg-white rounded-2xl shadow-xl p-6 border-2 border-indigo-100">
                            <h3 class="text-lg font-bold text-gray-800 mb-4 flex items-center gap-2">
                                <i class="fas fa-heading text-indigo-600"></i>
                                Brand Name
                            </h3>
                            <input type="text" id="cpg-brand-name" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 transition-all" placeholder="e.g., JOHN DOE">
                            <p class="text-xs text-gray-500 mt-2">üí° Nama atau brand Anda</p>
                        </div>

                        <div class="bg-white rounded-2xl shadow-xl p-6 border-2 border-indigo-100">
                            <h3 class="text-lg font-bold text-gray-800 mb-4 flex items-center gap-2">
                                <i class="fas fa-quote-left text-indigo-600"></i>
                                Tagline (Optional)
                            </h3>
                            <input type="text" id="cpg-tagline" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 transition-all" placeholder="e.g., Digital Marketing Expert">
                            <p class="text-xs text-gray-500 mt-2">üíº Profesi atau deskripsi singkat</p>
                        </div>

                        <!-- Text Style Selector -->
                        <div class="bg-white rounded-2xl shadow-xl p-6 border-2 border-blue-100">
                            <h3 class="text-lg font-bold text-gray-800 mb-4 flex items-center gap-2">
                                <i class="fas fa-font text-blue-600"></i>
                                Text Style
                            </h3>
                            <select id="cpg-text-style" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all">
                                <option value="bold">Bold & Impact (Tegas, Strong)</option>
                                <option value="elegant">Elegant & Luxury (Elegan, Mewah)</option>
                                <option value="modern">Modern & Clean (Modern, Minimalis)</option>
                                <option value="creative">Creative & Artistic (Kreatif, Unik)</option>
                                <option value="tech">Tech & Futuristic (Teknologi, Futuristik)</option>
                                <option value="casual">Casual & Friendly (Santai, Ramah)</option>
                            </select>
                        </div>

                        <!-- Theme Selector -->
                        <div class="bg-white rounded-2xl shadow-xl p-6 border-2 border-purple-100">
                            <h3 class="text-lg font-bold text-gray-800 mb-4 flex items-center gap-2">
                                <i class="fas fa-palette text-purple-600"></i>
                                Theme Style
                            </h3>
                            <select id="cpg-theme-preset" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-purple-500 focus:ring-2 focus:ring-purple-200 transition-all mb-3">
                                <option value="">Select Preset Theme...</option>
                                <option value="business">Business Professional (Formal, Corporate)</option>
                                <option value="creative">Creative & Colorful (Kreatif, Warna-warni)</option>
                                <option value="minimalist">Minimalist Clean (Simpel, Bersih)</option>
                                <option value="dark">Dark & Moody (Gelap, Dramatic)</option>
                                <option value="gradient">Gradient Modern (Gradien Trendy)</option>
                                <option value="nature">Nature & Fresh (Alam, Segar)</option>
                            </select>

                            <div class="mt-4">
                                <label class="text-sm font-semibold text-gray-700 mb-2 block">Or Custom Theme:</label>
                                <input type="text" id="cpg-custom-theme" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-purple-500 focus:ring-2 focus:ring-purple-200 transition-all" placeholder="e.g., Golden sunset with warm tones">
                                <p class="text-xs text-gray-500 mt-2">‚ú® Describe your custom theme style</p>
                            </div>
                        </div>

                        <!-- Platform Selector -->
                        <div class="bg-white rounded-2xl shadow-xl p-6 border-2 border-blue-100">
                            <h3 class="text-lg font-bold text-gray-800 mb-4 flex items-center gap-2">
                                <i class="fas fa-mobile-alt text-blue-600"></i>
                                Platform
                            </h3>
                            <select id="cpg-platform" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all">
                                <option value="tiktok">TikTok Cover (9:16)</option>
                                <option value="instagram">Instagram Story/Cover (9:16)</option>
                            </select>
                            <p class="text-xs text-gray-500 mt-2">üì± Vertical cover photo format (9:16 portrait)</p>
                        </div>

                        <!-- Generate Button -->
                        <button id="cpg-generate-btn" class="w-full bg-gradient-to-r from-purple-600 via-indigo-600 to-blue-600 text-white font-bold py-4 px-6 rounded-xl shadow-lg hover:shadow-2xl transform hover:scale-105 transition-all disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none">
                            <i class="fas fa-magic mr-2"></i>
                            Generate 6 Cover Photos
                        </button>
                    </div>

                    <!-- Right Panel - Results -->
                    <div class="lg:col-span-2 space-y-6">
                        <!-- Placeholder -->
                        <div id="cpg-placeholder" class="bg-white rounded-2xl shadow-xl p-12 text-center border-2 border-dashed border-purple-200">
                            <div class="mb-6">
                                <i class="fas fa-image-portrait text-6xl text-purple-300"></i>
                            </div>
                            <h3 class="text-2xl font-bold text-gray-800 mb-3">Ready to Create Your Cover Photo</h3>
                            <p class="text-gray-600 mb-6 max-w-md mx-auto">
                                Choose your branding mode, fill in your details, and generate professional cover photos for your personal brand!
                            </p>
                            <div class="grid grid-cols-2 gap-4 max-w-md mx-auto">
                                <div class="bg-gradient-to-br from-purple-50 to-indigo-50 p-4 rounded-xl border border-purple-200">
                                    <i class="fas fa-user-circle text-3xl text-purple-600 mb-2"></i>
                                    <p class="text-sm font-semibold text-gray-700">With Photo Mode</p>
                                    <p class="text-xs text-gray-500">Personal branding with your face</p>
                                </div>
                                <div class="bg-gradient-to-br from-indigo-50 to-blue-50 p-4 rounded-xl border border-indigo-200">
                                    <i class="fas fa-font text-3xl text-indigo-600 mb-2"></i>
                                    <p class="text-sm font-semibold text-gray-700">Faceless Mode</p>
                                    <p class="text-xs text-gray-500">Text & design focused</p>
                                </div>
                            </div>
                        </div>

                        <!-- Loading State -->
                        <div id="cpg-loading" class="hidden bg-white rounded-2xl shadow-xl p-12 text-center border-2 border-purple-200">
                            <div class="mb-6">
                                <i class="fas fa-spinner fa-spin text-6xl text-purple-600"></i>
                            </div>
                            <h3 class="text-2xl font-bold text-gray-800 mb-3" id="cpg-loading-text">Generating cover photos...</h3>
                            <div class="w-full bg-gray-200 rounded-full h-3 mb-4 overflow-hidden">
                                <div id="cpg-progress-bar" class="bg-gradient-to-r from-purple-600 via-indigo-600 to-blue-600 h-3 rounded-full transition-all duration-500" style="width: 0%"></div>
                            </div>
                            <p class="text-gray-600 font-semibold" id="cpg-progress-text">0/6 completed</p>
                        </div>

                        <!-- Error Message -->
                        <div id="cpg-error-message" class="hidden bg-red-50 border-2 border-red-200 rounded-xl p-4 flex items-start gap-3">
                            <i class="fas fa-exclamation-circle text-red-500 text-xl mt-1"></i>
                            <div class="flex-1">
                                <h4 class="font-bold text-red-800 mb-1">Generation Error</h4>
                                <p class="text-red-600 text-sm" id="cpg-error-text"></p>
                            </div>
                            <button onclick="this.closest('#cpg-error-message').classList.add('hidden')" class="text-red-400 hover:text-red-600">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>

                        <!-- Results Header -->
                        <div id="cpg-results-header" class="hidden flex items-center justify-between mb-6 bg-gradient-to-r from-purple-50 to-blue-50 p-4 rounded-xl border-2 border-purple-200">
                            <h3 class="text-xl font-bold text-gray-800">
                                üé® Your Cover Photos üé®
                            </h3>
                            <button id="cpg-download-all-btn" class="bg-gradient-to-r from-purple-600 to-indigo-600 hover:from-purple-700 hover:to-indigo-700 text-white px-6 py-2 rounded-full font-semibold shadow-lg transition transform hover:scale-105 flex items-center gap-2">
                                <i class="fas fa-download"></i>
                                Download All
                            </button>
                        </div>

                        <!-- Results Grid -->
                        <div id="cpg-results-grid" class="hidden grid grid-cols-2 md:grid-cols-3 gap-4"></div>
                    </div>
                </div>

                <!-- Tips Section -->
                <div class="mt-10 bg-gradient-to-r from-purple-50 via-indigo-50 to-blue-50 rounded-2xl p-8 border-2 border-purple-200">
                    <h3 class="text-2xl font-bold text-gray-800 mb-6 text-center">
                        <i class="fas fa-lightbulb text-yellow-500 mr-2"></i>
                        Cover Photo Tips for Personal Branding
                    </h3>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div class="bg-white p-4 rounded-xl shadow-md">
                            <div class="flex items-center gap-3 mb-3">
                                <div class="bg-purple-500 p-3 rounded-lg">
                                    <i class="fas fa-eye text-white text-xl"></i>
                                </div>
                                <h4 class="font-bold text-gray-800">Consistent Branding</h4>
                            </div>
                            <p class="text-sm text-gray-600">Gunakan colors dan style yang consistent di semua platform untuk brand recognition</p>
                        </div>
                        <div class="bg-white p-4 rounded-xl shadow-md">
                            <div class="flex items-center gap-3 mb-3">
                                <div class="bg-indigo-500 p-3 rounded-lg">
                                    <i class="fas fa-text-height text-white text-xl"></i>
                                </div>
                                <h4 class="font-bold text-gray-800">Clear & Readable</h4>
                            </div>
                            <p class="text-sm text-gray-600">Text harus clear dan mudah dibaca di thumbnail kecil mobile device</p>
                        </div>
                        <div class="bg-white p-4 rounded-xl shadow-md">
                            <div class="flex items-center gap-3 mb-3">
                                <div class="bg-blue-500 p-3 rounded-lg">
                                    <i class="fas fa-star text-white text-xl"></i>
                                </div>
                                <h4 class="font-bold text-gray-800">Professional Quality</h4>
                            </div>
                            <p class="text-sm text-gray-600">High-quality cover photo meningkatkan credibility dan first impression audience</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- TAB: PHOTO RESTORATION GENERATOR -->
        <div id="content-photo-restoration" class="main-content-panel hidden">
            <div class="w-full max-w-7xl mx-auto">
                <!-- Header -->
                <div class="text-center mb-10">
                    <div class="flex items-center justify-center mb-4">
                        <div class="bg-gradient-to-r from-amber-600 via-orange-600 to-amber-600 p-4 rounded-2xl shadow-2xl">
                            <i class="fas fa-clock-rotate-left text-4xl text-white"></i>
                        </div>
                    </div>
                    <h1 class="text-4xl md:text-5xl font-bold bg-gradient-to-r from-amber-600 via-orange-600 to-amber-600 bg-clip-text text-transparent mb-3">
                        Generator Restorasi Foto Pro
                    </h1>
                    <p class="text-gray-600 text-lg max-w-3xl mx-auto">
                        Perbaiki dan restore foto lama, rusak, atau blur menjadi jernih dan berkualitas tinggi dengan AI!
                    </p>
                </div>

                <!-- Main Grid -->
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                    <!-- Left Panel - Controls -->
                    <div class="lg:col-span-1 space-y-6">
                        <!-- Photo Upload -->
                        <div class="bg-white rounded-2xl shadow-xl p-6 border-2 border-amber-100">
                            <h3 class="text-lg font-bold text-gray-800 mb-4 flex items-center gap-2">
                                <i class="fas fa-upload text-amber-600"></i>
                                Upload Foto
                            </h3>
                            <div id="pr-upload-area" class="relative border-3 border-dashed border-gray-300 rounded-xl p-6 text-center hover:border-amber-500 hover:bg-amber-50 transition-all cursor-pointer group">
                                <input type="file" id="pr-photo-input" accept="image/*" class="hidden">
                                <div id="pr-photo-placeholder">
                                    <i class="fas fa-image text-5xl text-gray-400 group-hover:text-amber-500 transition-all mb-3"></i>
                                    <p class="text-gray-600 font-semibold">Upload foto yang ingin direstorasi</p>
                                    <p class="text-xs text-gray-500 mt-2">PNG, JPG, HEIC</p>
                                </div>
                                <img id="pr-photo-preview" class="hidden w-full h-48 object-cover rounded-lg">
                            </div>
                        </div>

                        <!-- Restoration Mode -->
                        <div class="bg-white rounded-2xl shadow-xl p-6 border-2 border-orange-100">
                            <h3 class="text-lg font-bold text-gray-800 mb-4 flex items-center gap-2">
                                <i class="fas fa-wand-magic-sparkles text-orange-600"></i>
                                Restoration Mode
                            </h3>
                            <select id="pr-mode-select" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-orange-500 focus:ring-2 focus:ring-orange-200 transition-all">
                                <option value="old-photo">Old Photo Restoration (Foto Lama)</option>
                                <option value="damaged">Damaged Photo Repair (Foto Rusak)</option>
                                <option value="colorize">Colorize B&W (Warnai Hitam-Putih)</option>
                                <option value="enhance">Quality Enhancement (Tingkatkan Kualitas)</option>
                                <option value="deblur">Deblur & Sharpen (Hilangkan Blur)</option>
                                <option value="denoise">Denoise (Hilangkan Noise)</option>
                            </select>
                            <p class="text-xs text-gray-500 mt-2">üí° Pilih jenis restorasi sesuai kondisi foto</p>
                        </div>

                        <!-- Restoration Intensity -->
                        <div class="bg-white rounded-2xl shadow-xl p-6 border-2 border-amber-100">
                            <h3 class="text-lg font-bold text-gray-800 mb-4 flex items-center gap-2">
                                <i class="fas fa-sliders text-amber-600"></i>
                                Intensity Level
                            </h3>
                            <div class="grid grid-cols-3 gap-2">
                                <button class="pr-intensity-btn active" data-intensity="light">
                                    <i class="fas fa-circle-half-stroke"></i>
                                    <span>Light</span>
                                </button>
                                <button class="pr-intensity-btn" data-intensity="medium">
                                    <i class="fas fa-circle"></i>
                                    <span>Medium</span>
                                </button>
                                <button class="pr-intensity-btn" data-intensity="strong">
                                    <i class="fas fa-circle-dot"></i>
                                    <span>Strong</span>
                                </button>
                            </div>
                            <p class="text-xs text-gray-500 mt-3">üéöÔ∏è Intensitas restorasi yang akan diterapkan</p>
                        </div>

                        <!-- Aspect Ratio -->
                        <div class="bg-white rounded-2xl shadow-xl p-6 border-2 border-orange-100">
                            <h3 class="text-lg font-bold text-gray-800 mb-4 flex items-center gap-2">
                                <i class="fas fa-crop text-orange-600"></i>
                                Aspect Ratio
                            </h3>
                            <div class="grid grid-cols-3 gap-2">
                                <button class="pr-ratio-btn active" data-ratio="original">Original</button>
                                <button class="pr-ratio-btn" data-ratio="1:1">1:1</button>
                                <button class="pr-ratio-btn" data-ratio="4:3">4:3</button>
                            </div>
                            <p class="text-xs text-gray-500 mt-2">üìê Tetap original atau crop ke ratio tertentu</p>
                        </div>

                        <!-- Generate Button -->
                        <button id="pr-generate-btn" class="w-full bg-gradient-to-r from-amber-600 via-orange-600 to-amber-600 text-white font-bold py-4 px-6 rounded-xl shadow-lg hover:shadow-2xl transform hover:scale-105 transition-all disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none">
                            <i class="fas fa-wand-magic-sparkles mr-2"></i>
                            Restore Photo (2 Results)
                        </button>
                    </div>

                    <!-- Right Panel - Results -->
                    <div class="lg:col-span-2 space-y-6">
                        <!-- Placeholder -->
                        <div id="pr-placeholder" class="bg-white rounded-2xl shadow-xl p-12 text-center border-2 border-dashed border-amber-200">
                            <div class="mb-6">
                                <i class="fas fa-clock-rotate-left text-6xl text-amber-300"></i>
                            </div>
                            <h3 class="text-2xl font-bold text-gray-800 mb-3">Ready to Restore Your Photos</h3>
                            <p class="text-gray-600 mb-6 max-w-md mx-auto">
                                Upload foto lama atau rusak, pilih mode restorasi, dan biarkan AI memperbaikinya menjadi seperti baru!
                            </p>
                            <div class="grid grid-cols-2 md:grid-cols-3 gap-4 max-w-2xl mx-auto">
                                <div class="bg-gradient-to-br from-amber-50 to-orange-50 p-4 rounded-xl border border-amber-200">
                                    <i class="fas fa-image text-3xl text-amber-600 mb-2"></i>
                                    <p class="text-sm font-semibold text-gray-700">Old Photos</p>
                                    <p class="text-xs text-gray-500">Restore vintage</p>
                                </div>
                                <div class="bg-gradient-to-br from-orange-50 to-amber-50 p-4 rounded-xl border border-orange-200">
                                    <i class="fas fa-band-aid text-3xl text-orange-600 mb-2"></i>
                                    <p class="text-sm font-semibold text-gray-700">Repair Damage</p>
                                    <p class="text-xs text-gray-500">Fix scratches</p>
                                </div>
                                <div class="bg-gradient-to-br from-amber-50 to-orange-50 p-4 rounded-xl border border-amber-200">
                                    <i class="fas fa-palette text-3xl text-amber-600 mb-2"></i>
                                    <p class="text-sm font-semibold text-gray-700">Colorize B&W</p>
                                    <p class="text-xs text-gray-500">Add colors</p>
                                </div>
                            </div>
                        </div>

                        <!-- Loading State -->
                        <div id="pr-loading" class="hidden bg-white rounded-2xl shadow-xl p-12 text-center border-2 border-amber-200">
                            <div class="mb-6">
                                <i class="fas fa-spinner fa-spin text-6xl text-amber-600"></i>
                            </div>
                            <h3 class="text-2xl font-bold text-gray-800 mb-3" id="pr-loading-text">Restoring photo...</h3>
                            <div class="w-full bg-gray-200 rounded-full h-3 mb-4 overflow-hidden">
                                <div id="pr-progress-bar" class="bg-gradient-to-r from-amber-600 via-orange-600 to-amber-600 h-3 rounded-full transition-all duration-500" style="width: 0%"></div>
                            </div>
                            <p class="text-gray-600 font-semibold" id="pr-progress-text">0/2 completed</p>
                        </div>

                        <!-- Error Message -->
                        <div id="pr-error-message" class="hidden bg-red-50 border-2 border-red-200 rounded-xl p-4 flex items-start gap-3">
                            <i class="fas fa-exclamation-circle text-red-500 text-xl mt-1"></i>
                            <div class="flex-1">
                                <h4 class="font-bold text-red-800 mb-1">Restoration Error</h4>
                                <p class="text-red-600 text-sm" id="pr-error-text"></p>
                            </div>
                            <button onclick="this.closest('#pr-error-message').classList.add('hidden')" class="text-red-400 hover:text-red-600">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>

                        <!-- Results Header -->
                        <div id="pr-results-header" class="hidden flex items-center justify-between mb-6 bg-gradient-to-r from-amber-50 to-orange-50 p-4 rounded-xl border-2 border-amber-200">
                            <h3 class="text-xl font-bold text-gray-800">
                                ‚ú® Restored Photos ‚ú®
                            </h3>
                            <button id="pr-download-all-btn" class="bg-gradient-to-r from-amber-600 to-orange-600 hover:from-amber-700 hover:to-orange-700 text-white px-6 py-2 rounded-full font-semibold shadow-lg transition transform hover:scale-105 flex items-center gap-2">
                                <i class="fas fa-download"></i>
                                Download All
                            </button>
                        </div>

                        <!-- Results Grid -->
                        <div id="pr-results-grid" class="hidden grid grid-cols-1 md:grid-cols-2 gap-4"></div>

                        <!-- Before/After Comparison -->
                        <div id="pr-comparison-section" class="hidden bg-white rounded-2xl shadow-xl p-6 border-2 border-amber-200">
                            <h3 class="text-xl font-bold text-gray-800 mb-4 text-center">
                                <i class="fas fa-repeat text-amber-600 mr-2"></i>
                                Before & After Comparison
                            </h3>
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <p class="text-sm font-semibold text-gray-600 mb-2 text-center">Before</p>
                                    <img id="pr-comparison-before" class="w-full rounded-lg border-2 border-gray-300">
                                </div>
                                <div>
                                    <p class="text-sm font-semibold text-gray-600 mb-2 text-center">After (Result 1)</p>
                                    <img id="pr-comparison-after" class="w-full rounded-lg border-2 border-amber-500">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Tips Section -->
                <div class="mt-10 bg-gradient-to-r from-amber-50 via-orange-50 to-amber-50 rounded-2xl p-8 border-2 border-amber-200">
                    <h3 class="text-2xl font-bold text-gray-800 mb-6 text-center">
                        <i class="fas fa-lightbulb text-yellow-500 mr-2"></i>
                        Photo Restoration Tips
                    </h3>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div class="bg-white p-4 rounded-xl shadow-md">
                            <div class="flex items-center gap-3 mb-3">
                                <div class="bg-amber-500 p-3 rounded-lg">
                                    <i class="fas fa-image text-white text-xl"></i>
                                </div>
                                <h4 class="font-bold text-gray-800">Photo Quality</h4>
                            </div>
                            <p class="text-sm text-gray-600">Upload foto dengan resolusi setinggi mungkin untuk hasil restorasi yang lebih baik</p>
                        </div>
                        <div class="bg-white p-4 rounded-xl shadow-md">
                            <div class="flex items-center gap-3 mb-3">
                                <div class="bg-orange-500 p-3 rounded-lg">
                                    <i class="fas fa-sliders text-white text-xl"></i>
                                </div>
                                <h4 class="font-bold text-gray-800">Right Mode</h4>
                            </div>
                            <p class="text-sm text-gray-600">Pilih restoration mode yang sesuai dengan kondisi foto untuk hasil optimal</p>
                        </div>
                        <div class="bg-white p-4 rounded-xl shadow-md">
                            <div class="flex items-center gap-3 mb-3">
                                <div class="bg-amber-600 p-3 rounded-lg">
                                    <i class="fas fa-repeat text-white text-xl"></i>
                                </div>
                                <h4 class="font-bold text-gray-800">Compare Results</h4>
                            </div>
                            <p class="text-sm text-gray-600">Bandingkan kedua hasil untuk memilih yang paling sesuai dengan kebutuhan Anda</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- TAB: LOGO GENERATOR -->
        <div id="content-logo-generator" class="main-content-panel hidden">
            <div class="container mx-auto max-w-7xl">
                <!-- Header -->
                <header class="text-center mb-10">
                    <div class="inline-flex items-center gap-3 mb-4">
                        <div class="w-16 h-16 rounded-2xl flex items-center justify-center shadow-lg" style="background: linear-gradient(135deg, #7C3AED 0%, #EC4899 100%);">
                            <i class="fas fa-palette text-white text-3xl"></i>
                        </div>
                        <div class="flex flex-col items-start">
                            <h1 class="text-4xl md:text-5xl font-bold text-transparent bg-clip-text" style="background: linear-gradient(135deg, #7C3AED 0%, #EC4899 100%);">
                                Professional Logo Generator
                            </h1>
                            <span class="text-xs font-semibold px-3 py-1 rounded-full mt-1 text-white" style="background: linear-gradient(135deg, #7C3AED 0%, #EC4899 100%);">‚ú® AI Powered Pro</span>
                        </div>
                    </div>
                    <p class="text-lg text-gray-600 max-w-3xl mx-auto">
                        Buat logo profesional untuk brand Anda dengan AI. Dapatkan 6 variasi desain unik dalam berbagai style dan mockup preview.
                    </p>
                </header>

                <div class="flex flex-col lg:flex-row gap-8">
                    <!-- Left Panel: Controls -->
                    <div class="w-full lg:w-5/12 flex-shrink-0">
                        <div class="card p-6 sticky top-6">
                            <div class="flex flex-col gap-6">

                                <!-- Step 1: Brand Information -->
                                <div>
                                    <div class="flex items-center gap-3 mb-4">
                                        <div class="flex items-center justify-center w-8 h-8 rounded-full text-white font-bold text-sm shadow-lg" style="background: linear-gradient(135deg, #7C3AED, #EC4899);">1</div>
                                        <h3 class="text-lg font-bold text-gray-800">Informasi Brand</h3>
                                    </div>

                                    <div class="space-y-4">
                                        <div>
                                            <label class="block text-sm font-semibold text-gray-700 mb-2">Nama Brand/Perusahaan *</label>
                                            <input type="text" id="logo-brand-name" class="w-full p-3 text-base rounded-xl border-2 border-gray-300 focus:border-purple-500 transition" placeholder="Contoh: TechNova, Cafe Delight">
                                            <p class="text-xs text-gray-500 mt-1">üí° Nama yang akan muncul di logo</p>
                                        </div>

                                        <div>
                                            <label class="block text-sm font-semibold text-gray-700 mb-2">Tagline (Opsional)</label>
                                            <input type="text" id="logo-tagline" class="w-full p-3 text-base rounded-xl border-2 border-gray-300 focus:border-purple-500 transition" placeholder="Contoh: Innovation for Tomorrow">
                                            <p class="text-xs text-gray-500 mt-1">‚ú® Slogan pendek untuk brand Anda</p>
                                        </div>

                                        <div>
                                            <label class="block text-sm font-semibold text-gray-700 mb-2">Deskripsi Bisnis *</label>
                                            <textarea id="logo-business-desc" rows="3" class="w-full p-3 text-sm rounded-xl border-2 border-gray-300 focus:border-purple-500 transition resize-none" placeholder="Jelaskan apa yang dilakukan bisnis Anda, nilai-nilai, dan target audience..."></textarea>
                                            <p class="text-xs text-gray-500 mt-1">üìù Bantu AI memahami brand Anda</p>
                                        </div>
                                    </div>
                                </div>

                                <!-- Step 2: Industry & Category -->
                                <div>
                                    <div class="flex items-center gap-3 mb-4">
                                        <div class="flex items-center justify-center w-8 h-8 rounded-full text-white font-bold text-sm shadow-lg" style="background: linear-gradient(135deg, #7C3AED, #EC4899);">2</div>
                                        <h3 class="text-lg font-bold text-gray-800">Industri</h3>
                                    </div>

                                    <div id="logo-industry-options" class="grid grid-cols-2 sm:grid-cols-3 gap-3">
                                        <button type="button" data-value="Technology" class="option-btn-logo">
                                            <i class="fas fa-laptop-code"></i> Tech
                                        </button>
                                        <button type="button" data-value="Food & Beverage" class="option-btn-logo">
                                            <i class="fas fa-utensils"></i> F&B
                                        </button>
                                        <button type="button" data-value="Fashion & Beauty" class="option-btn-logo">
                                            <i class="fas fa-tshirt"></i> Fashion
                                        </button>
                                        <button type="button" data-value="Health & Wellness" class="option-btn-logo">
                                            <i class="fas fa-heartbeat"></i> Health
                                        </button>
                                        <button type="button" data-value="Education" class="option-btn-logo">
                                            <i class="fas fa-graduation-cap"></i> Edu
                                        </button>
                                        <button type="button" data-value="Finance" class="option-btn-logo">
                                            <i class="fas fa-chart-line"></i> Finance
                                        </button>
                                        <button type="button" data-value="Real Estate" class="option-btn-logo">
                                            <i class="fas fa-building"></i> Property
                                        </button>
                                        <button type="button" data-value="Creative & Art" class="option-btn-logo">
                                            <i class="fas fa-paint-brush"></i> Creative
                                        </button>
                                        <button type="button" data-value="Sports & Fitness" class="option-btn-logo">
                                            <i class="fas fa-dumbbell"></i> Sports
                                        </button>
                                    </div>
                                </div>

                                <!-- Step 3: Logo Type -->
                                <div>
                                    <div class="flex items-center gap-3 mb-4">
                                        <div class="flex items-center justify-center w-8 h-8 rounded-full text-white font-bold text-sm shadow-lg" style="background: linear-gradient(135deg, #7C3AED, #EC4899);">3</div>
                                        <h3 class="text-lg font-bold text-gray-800">Tipe Logo</h3>
                                    </div>

                                    <div id="logo-type-options" class="grid grid-cols-2 gap-3">
                                        <button type="button" data-value="wordmark" class="option-btn-logo selected">
                                            <i class="fas fa-font"></i> Wordmark
                                        </button>
                                        <button type="button" data-value="symbol" class="option-btn-logo">
                                            <i class="fas fa-star"></i> Symbol
                                        </button>
                                        <button type="button" data-value="combination" class="option-btn-logo">
                                            <i class="fas fa-layer-group"></i> Kombinasi
                                        </button>
                                        <button type="button" data-value="emblem" class="option-btn-logo">
                                            <i class="fas fa-shield-alt"></i> Emblem
                                        </button>
                                    </div>
                                    <p class="text-xs text-gray-600 mt-2">
                                        üí° <strong>Wordmark:</strong> Hanya teks | <strong>Symbol:</strong> Hanya icon | <strong>Kombinasi:</strong> Teks + Icon
                                    </p>
                                </div>

                                <!-- Step 4: Style Preferences -->
                                <div>
                                    <div class="flex items-center gap-3 mb-4">
                                        <div class="flex items-center justify-center w-8 h-8 rounded-full text-white font-bold text-sm shadow-lg" style="background: linear-gradient(135deg, #7C3AED, #EC4899);">4</div>
                                        <h3 class="text-lg font-bold text-gray-800">Style & Mood</h3>
                                    </div>

                                    <div id="logo-style-options" class="grid grid-cols-2 sm:grid-cols-3 gap-2 text-sm">
                                        <button type="button" data-value="Minimalist Modern" class="checkbox-btn-logo">
                                            <i class="fas fa-check hidden mr-1"></i> Minimalis
                                        </button>
                                        <button type="button" data-value="Bold & Powerful" class="checkbox-btn-logo">
                                            <i class="fas fa-check hidden mr-1"></i> Bold
                                        </button>
                                        <button type="button" data-value="Elegant Luxury" class="checkbox-btn-logo">
                                            <i class="fas fa-check hidden mr-1"></i> Elegant
                                        </button>
                                        <button type="button" data-value="Playful & Fun" class="checkbox-btn-logo">
                                            <i class="fas fa-check hidden mr-1"></i> Playful
                                        </button>
                                        <button type="button" data-value="Professional Corporate" class="checkbox-btn-logo">
                                            <i class="fas fa-check hidden mr-1"></i> Corporate
                                        </button>
                                        <button type="button" data-value="Vintage Retro" class="checkbox-btn-logo">
                                            <i class="fas fa-check hidden mr-1"></i> Vintage
                                        </button>
                                    </div>
                                    <p class="text-xs text-gray-600 mt-2">‚ú® Pilih 1-3 style yang menggambarkan brand Anda</p>
                                </div>

                                <!-- Step 5: Color Scheme -->
                                <div>
                                    <div class="flex items-center gap-3 mb-4">
                                        <div class="flex items-center justify-center w-8 h-8 rounded-full text-white font-bold text-sm shadow-lg" style="background: linear-gradient(135deg, #7C3AED, #EC4899);">5</div>
                                        <h3 class="text-lg font-bold text-gray-800">Skema Warna</h3>
                                    </div>

                                    <div id="logo-color-scheme-options" class="grid grid-cols-3 gap-3 mb-4">
                                        <button type="button" data-value="colorful" class="option-btn-logo selected">
                                            <i class="fas fa-palette"></i> Colorful
                                        </button>
                                        <button type="button" data-value="monochrome" class="option-btn-logo">
                                            <i class="fas fa-circle"></i> Mono
                                        </button>
                                        <button type="button" data-value="gradient" class="option-btn-logo">
                                            <i class="fas fa-fill-drip"></i> Gradient
                                        </button>
                                    </div>

                                    <!-- Color Palette Selection -->
                                    <div>
                                        <label class="block text-sm font-semibold text-gray-700 mb-3">Pilih Palet Warna (Opsional)</label>
                                        <div id="logo-color-palette-options" class="flex flex-wrap gap-3">
                                            <div class="logo-color-chip" data-colors="#3B82F6,#1E40AF" style="background: linear-gradient(135deg, #3B82F6, #1E40AF);" title="Blue Professional"></div>
                                            <div class="logo-color-chip" data-colors="#EF4444,#DC2626" style="background: linear-gradient(135deg, #EF4444, #DC2626);" title="Red Energy"></div>
                                            <div class="logo-color-chip" data-colors="#10B981,#059669" style="background: linear-gradient(135deg, #10B981, #059669);" title="Green Fresh"></div>
                                            <div class="logo-color-chip" data-colors="#F59E0B,#D97706" style="background: linear-gradient(135deg, #F59E0B, #D97706);" title="Orange Warm"></div>
                                            <div class="logo-color-chip selected" data-colors="#7C3AED,#EC4899" style="background: linear-gradient(135deg, #7C3AED, #EC4899);" title="Purple Pink"></div>
                                            <div class="logo-color-chip" data-colors="#06B6D4,#0891B2" style="background: linear-gradient(135deg, #06B6D4, #0891B2);" title="Cyan Cool"></div>
                                            <div class="logo-color-chip" data-colors="#1F2937,#374151" style="background: linear-gradient(135deg, #1F2937, #374151);" title="Dark Elegant"></div>
                                            <div class="logo-color-chip" data-colors="#000000,#FFFFFF" style="background: linear-gradient(135deg, #000000, #FFFFFF);" title="Black & White"></div>
                                        </div>
                                        <p class="text-xs text-gray-500 mt-2">üé® Kosongkan untuk AI pilih otomatis berdasarkan brand</p>
                                    </div>
                                </div>

                                <!-- Step 6: Reference Image (Optional) -->
                                <div>
                                    <div class="flex items-center gap-3 mb-4">
                                        <div class="flex items-center justify-center w-8 h-8 rounded-full text-white font-bold text-sm shadow-lg" style="background: linear-gradient(135deg, #7C3AED, #EC4899);">6</div>
                                        <h3 class="text-lg font-bold text-gray-800">Referensi (Opsional)</h3>
                                    </div>

                                    <label for="logo-ref-input" id="logo-ref-upload-box" class="upload-box-logo-ref w-full h-40 rounded-xl flex items-center justify-center cursor-pointer relative overflow-hidden border-2 border-dashed border-gray-300">
                                        <div id="logo-ref-placeholder" class="text-center p-4">
                                            <i class="fas fa-image text-4xl text-gray-400 mb-2"></i>
                                            <p class="text-sm text-gray-600 font-semibold">Upload referensi logo/inspirasi</p>
                                            <p class="text-xs text-gray-500 mt-1">Logo yang Anda suka untuk referensi style</p>
                                        </div>
                                        <img id="logo-ref-preview" class="hidden absolute top-0 left-0 w-full h-full object-contain" alt="Referensi Logo">
                                        <button type="button" id="logo-ref-remove-btn" class="hidden absolute top-2 right-2 bg-red-600 text-white rounded-full p-1 hover:bg-red-700 z-10">
                                            <i class="fas fa-times"></i>
                                        </button>
                                    </label>
                                    <input type="file" id="logo-ref-input" class="hidden" accept="image/png, image/jpeg, image/webp">
                                </div>

                                <!-- Generate Button -->
                                <button id="logo-generate-btn" class="w-full text-white font-bold py-4 px-6 rounded-xl flex items-center justify-center text-lg shadow-lg hover:shadow-xl transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed" style="background: linear-gradient(135deg, #7C3AED 0%, #EC4899 100%);" disabled>
                                    <i class="fas fa-wand-magic-sparkles mr-2"></i>
                                    <span>Generate 6 Logo Variations</span>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Right Panel: Results -->
                    <div class="w-full lg:w-7/12">
                        <div class="card p-6 min-h-[600px]">
                            <!-- Placeholder -->
                            <div id="logo-results-placeholder" class="flex flex-col items-center justify-center h-full text-center">
                                <div class="w-24 h-24 rounded-full flex items-center justify-center mb-6 shadow-lg" style="background: linear-gradient(135deg, #F3E8FF 0%, #FCE7F3 100%);">
                                    <i class="fas fa-palette text-5xl" style="color: #7C3AED;"></i>
                                </div>
                                <h3 class="text-2xl font-bold text-gray-800 mb-2">Logo Profesional Anda</h3>
                                <p class="text-gray-600 max-w-md">
                                    AI akan generate 6 variasi logo unik berdasarkan preferensi Anda. Setiap logo dapat di-preview dalam berbagai mockup!
                                </p>
                                <div class="mt-6 grid grid-cols-3 gap-4 text-sm">
                                    <div class="p-3 bg-purple-50 rounded-lg">
                                        <i class="fas fa-check-circle text-purple-600 mb-1"></i>
                                        <p class="font-semibold text-gray-700">6 Variations</p>
                                    </div>
                                    <div class="p-3 bg-pink-50 rounded-lg">
                                        <i class="fas fa-swatchbook text-pink-600 mb-1"></i>
                                        <p class="font-semibold text-gray-700">Pro Mockups</p>
                                    </div>
                                    <div class="p-3 bg-purple-50 rounded-lg">
                                        <i class="fas fa-download text-purple-600 mb-1"></i>
                                        <p class="font-semibold text-gray-700">HD Download</p>
                                    </div>
                                </div>
                            </div>

                            <!-- Results Grid -->
                            <div id="logo-results-container" class="hidden">
                                <div class="flex items-center justify-between mb-6">
                                    <h3 class="text-2xl font-bold text-gray-800">
                                        <i class="fas fa-sparkles mr-2" style="color: #7C3AED;"></i>
                                        Your Logo Variations
                                    </h3>
                                    <button id="logo-download-all-btn" class="hidden logo-action-btn text-sm">
                                        <i class="fas fa-download mr-2"></i>
                                        <span>Download Semua</span>
                                    </button>
                                </div>
                                <div id="logo-results-grid" class="grid grid-cols-1 md:grid-cols-2 gap-6"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- TAB: MASCOT GENERATOR -->
        <div id="content-mascot-generator" class="main-content-panel hidden">
            <div class="container mx-auto max-w-7xl">
                <!-- Header -->
                <header class="text-center mb-10">
                    <div class="inline-flex items-center gap-3 mb-4">
                        <div class="w-16 h-16 rounded-2xl flex items-center justify-center shadow-lg" style="background: linear-gradient(135deg, #F59E0B 0%, #EF4444 100%);">
                            <i class="fas fa-dragon text-white text-3xl"></i>
                        </div>
                        <div class="flex flex-col items-start">
                            <h1 class="text-4xl md:text-5xl font-bold text-transparent bg-clip-text" style="background: linear-gradient(135deg, #F59E0B 0%, #EF4444 100%);">
                                Professional Mascot Generator
                            </h1>
                            <span class="text-xs font-semibold px-3 py-1 rounded-full mt-1 text-white" style="background: linear-gradient(135deg, #F59E0B 0%, #EF4444 100%);">üé≠ Character AI Creator</span>
                        </div>
                    </div>
                    <p class="text-lg text-gray-600 max-w-3xl mx-auto">
                        Buat karakter mascot unik untuk brand Anda! Upload referensi dan AI akan generate mascot yang mirip dengan style yang Anda inginkan.
                    </p>
                </header>

                <div class="flex flex-col lg:flex-row gap-8">
                    <!-- Left Panel: Controls -->
                    <div class="w-full lg:w-5/12 flex-shrink-0">
                        <div class="card p-6 sticky top-6">
                            <div class="flex flex-col gap-6">

                                <!-- Step 1: Reference Image (REQUIRED) -->
                                <div>
                                    <div class="flex items-center gap-3 mb-4">
                                        <div class="flex items-center justify-center w-8 h-8 rounded-full text-white font-bold text-sm shadow-lg" style="background: linear-gradient(135deg, #F59E0B, #EF4444);">1</div>
                                        <h3 class="text-lg font-bold text-gray-800">Upload Referensi Mascot *</h3>
                                    </div>

                                    <label for="mascot-ref-input" id="mascot-ref-upload-box" class="upload-box-mascot-ref w-full h-56 rounded-xl flex items-center justify-center cursor-pointer relative overflow-hidden border-2 border-dashed border-gray-300">
                                        <div id="mascot-ref-placeholder" class="text-center p-4">
                                            <i class="fas fa-dragon text-5xl mb-3" style="color: #F59E0B;"></i>
                                            <p class="text-base font-bold text-gray-800 mb-1">Upload Gambar Referensi Mascot</p>
                                            <p class="text-sm text-gray-600">AI akan membuat mascot mirip dengan referensi ini</p>
                                            <p class="text-xs text-gray-500 mt-2">üì∏ Klik atau drag & drop</p>
                                        </div>
                                        <img id="mascot-ref-preview" class="hidden absolute top-0 left-0 w-full h-full object-contain" alt="Referensi Mascot">
                                        <button type="button" id="mascot-ref-remove-btn" class="hidden absolute top-2 right-2 bg-red-600 text-white rounded-full p-2 hover:bg-red-700 z-10 shadow-lg">
                                            <i class="fas fa-times"></i>
                                        </button>
                                    </label>
                                    <input type="file" id="mascot-ref-input" class="hidden" accept="image/png, image/jpeg, image/webp, .heic, .HEIC">
                                    <p class="text-xs text-amber-600 mt-2 font-semibold">
                                        <i class="fas fa-star mr-1"></i> Wajib! AI akan meniru style, bentuk, dan karakter dari referensi
                                    </p>
                                </div>

                                <!-- Step 2: Mascot Information -->
                                <div>
                                    <div class="flex items-center gap-3 mb-4">
                                        <div class="flex items-center justify-center w-8 h-8 rounded-full text-white font-bold text-sm shadow-lg" style="background: linear-gradient(135deg, #F59E0B, #EF4444);">2</div>
                                        <h3 class="text-lg font-bold text-gray-800">Info Mascot</h3>
                                    </div>

                                    <div class="space-y-4">
                                        <div>
                                            <label class="block text-sm font-semibold text-gray-700 mb-2">Nama Mascot *</label>
                                            <input type="text" id="mascot-name" class="w-full p-3 text-base rounded-xl border-2 border-gray-300 transition" placeholder="Contoh: Bobby Dragon, Kuma Bear, Luna Cat">
                                            <p class="text-xs text-gray-500 mt-1">üé≠ Nama karakter mascot Anda</p>
                                        </div>

                                        <div>
                                            <label class="block text-sm font-semibold text-gray-700 mb-2">Deskripsi Karakter *</label>
                                            <textarea id="mascot-description" rows="3" class="w-full p-3 text-sm rounded-xl border-2 border-gray-300 transition resize-none" placeholder="Jelaskan karakteristik mascot: bentuk tubuh, warna, fitur unik, kepribadian..."></textarea>
                                            <p class="text-xs text-gray-500 mt-1">üí¨ Deskripsikan detail mascot Anda</p>
                                        </div>
                                    </div>
                                </div>

                                <!-- Step 3: Mascot Type -->
                                <div>
                                    <div class="flex items-center gap-3 mb-4">
                                        <div class="flex items-center justify-center w-8 h-8 rounded-full text-white font-bold text-sm shadow-lg" style="background: linear-gradient(135deg, #F59E0B, #EF4444);">3</div>
                                        <h3 class="text-lg font-bold text-gray-800">Tipe Karakter</h3>
                                    </div>

                                    <div id="mascot-type-options" class="grid grid-cols-2 sm:grid-cols-3 gap-3">
                                        <button type="button" data-value="Animal" class="option-btn-mascot selected">
                                            <i class="fas fa-paw"></i> Hewan
                                        </button>
                                        <button type="button" data-value="Robot/Mecha" class="option-btn-mascot">
                                            <i class="fas fa-robot"></i> Robot
                                        </button>
                                        <button type="button" data-value="Fantasy Creature" class="option-btn-mascot">
                                            <i class="fas fa-dragon"></i> Fantasy
                                        </button>
                                        <button type="button" data-value="Human-like Character" class="option-btn-mascot">
                                            <i class="fas fa-user"></i> Human
                                        </button>
                                        <button type="button" data-value="Food Character" class="option-btn-mascot">
                                            <i class="fas fa-cookie-bite"></i> Food
                                        </button>
                                        <button type="button" data-value="Abstract/Geometric" class="option-btn-mascot">
                                            <i class="fas fa-shapes"></i> Abstract
                                        </button>
                                    </div>
                                </div>

                                <!-- Step 4: Visual Style -->
                                <div>
                                    <div class="flex items-center gap-3 mb-4">
                                        <div class="flex items-center justify-center w-8 h-8 rounded-full text-white font-bold text-sm shadow-lg" style="background: linear-gradient(135deg, #F59E0B, #EF4444);">4</div>
                                        <h3 class="text-lg font-bold text-gray-800">Style Visual</h3>
                                    </div>

                                    <div id="mascot-style-options" class="grid grid-cols-2 sm:grid-cols-3 gap-2 text-sm">
                                        <button type="button" data-value="Cute Kawaii" class="option-btn-mascot selected">
                                            <i class="fas fa-heart"></i> Kawaii
                                        </button>
                                        <button type="button" data-value="3D Render" class="option-btn-mascot">
                                            <i class="fas fa-cube"></i> 3D
                                        </button>
                                        <button type="button" data-value="Flat Design" class="option-btn-mascot">
                                            <i class="fas fa-layer-group"></i> Flat
                                        </button>
                                        <button type="button" data-value="Cartoon Style" class="option-btn-mascot">
                                            <i class="fas fa-tv"></i> Cartoon
                                        </button>
                                        <button type="button" data-value="Chibi Style" class="option-btn-mascot">
                                            <i class="fas fa-baby"></i> Chibi
                                        </button>
                                        <button type="button" data-value="Realistic" class="option-btn-mascot">
                                            <i class="fas fa-camera"></i> Realis
                                        </button>
                                    </div>
                                </div>

                                <!-- Step 5: Personality Traits -->
                                <div>
                                    <div class="flex items-center gap-3 mb-4">
                                        <div class="flex items-center justify-center w-8 h-8 rounded-full text-white font-bold text-sm shadow-lg" style="background: linear-gradient(135deg, #F59E0B, #EF4444);">5</div>
                                        <h3 class="text-lg font-bold text-gray-800">Personality</h3>
                                    </div>

                                    <div id="mascot-personality-options" class="grid grid-cols-2 sm:grid-cols-3 gap-2 text-xs">
                                        <button type="button" data-value="Friendly" class="checkbox-btn-mascot">
                                            <i class="fas fa-check hidden mr-1"></i> Ramah
                                        </button>
                                        <button type="button" data-value="Energetic" class="checkbox-btn-mascot">
                                            <i class="fas fa-check hidden mr-1"></i> Energik
                                        </button>
                                        <button type="button" data-value="Brave" class="checkbox-btn-mascot">
                                            <i class="fas fa-check hidden mr-1"></i> Berani
                                        </button>
                                        <button type="button" data-value="Smart" class="checkbox-btn-mascot">
                                            <i class="fas fa-check hidden mr-1"></i> Pintar
                                        </button>
                                        <button type="button" data-value="Playful" class="checkbox-btn-mascot">
                                            <i class="fas fa-check hidden mr-1"></i> Ceria
                                        </button>
                                        <button type="button" data-value="Cool" class="checkbox-btn-mascot">
                                            <i class="fas fa-check hidden mr-1"></i> Keren
                                        </button>
                                    </div>
                                    <p class="text-xs text-gray-600 mt-2">‚ú® Pilih sifat karakter mascot (opsional)</p>
                                </div>

                                <!-- Step 6: Pose & Action -->
                                <div>
                                    <div class="flex items-center gap-3 mb-4">
                                        <div class="flex items-center justify-center w-8 h-8 rounded-full text-white font-bold text-sm shadow-lg" style="background: linear-gradient(135deg, #F59E0B, #EF4444);">6</div>
                                        <h3 class="text-lg font-bold text-gray-800">Pose & Action</h3>
                                    </div>

                                    <div id="mascot-pose-options" class="grid grid-cols-2 gap-3">
                                        <button type="button" data-value="Standing" class="option-btn-mascot selected">
                                            <i class="fas fa-user"></i> Berdiri
                                        </button>
                                        <button type="button" data-value="Waving" class="option-btn-mascot">
                                            <i class="fas fa-hand-paper"></i> Melambaikan
                                        </button>
                                        <button type="button" data-value="Jumping" class="option-btn-mascot">
                                            <i class="fas fa-running"></i> Melompat
                                        </button>
                                        <button type="button" data-value="Sitting" class="option-btn-mascot">
                                            <i class="fas fa-chair"></i> Duduk
                                        </button>
                                    </div>
                                </div>

                                <!-- Step 7: Background -->
                                <div>
                                    <div class="flex items-center gap-3 mb-4">
                                        <div class="flex items-center justify-center w-8 h-8 rounded-full text-white font-bold text-sm shadow-lg" style="background: linear-gradient(135deg, #F59E0B, #EF4444);">7</div>
                                        <h3 class="text-lg font-bold text-gray-800">Background</h3>
                                    </div>

                                    <div id="mascot-bg-options" class="grid grid-cols-2 sm:grid-cols-3 gap-3">
                                        <button type="button" data-value="transparent" class="option-btn-mascot selected">
                                            <i class="fas fa-adjust"></i> Transparan
                                        </button>
                                        <button type="button" data-value="solid color" class="option-btn-mascot">
                                            <i class="fas fa-fill"></i> Solid
                                        </button>
                                        <button type="button" data-value="gradient" class="option-btn-mascot">
                                            <i class="fas fa-palette"></i> Gradient
                                        </button>
                                    </div>
                                </div>

                                <!-- Generate Button -->
                                <button id="mascot-generate-btn" class="w-full text-white font-bold py-4 px-6 rounded-xl flex items-center justify-center text-lg shadow-lg hover:shadow-xl transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed" style="background: linear-gradient(135deg, #F59E0B 0%, #EF4444 100%);" disabled>
                                    <i class="fas fa-wand-magic-sparkles mr-2"></i>
                                    <span>Generate 4 Mascot Variations</span>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Right Panel: Results -->
                    <div class="w-full lg:w-7/12">
                        <div class="card p-6 min-h-[600px]">
                            <!-- Placeholder -->
                            <div id="mascot-results-placeholder" class="flex flex-col items-center justify-center h-full text-center">
                                <div class="w-24 h-24 rounded-full flex items-center justify-center mb-6 shadow-lg" style="background: linear-gradient(135deg, #FEF3C7 0%, #FEE2E2 100%);">
                                    <i class="fas fa-dragon text-5xl" style="color: #F59E0B;"></i>
                                </div>
                                <h3 class="text-2xl font-bold text-gray-800 mb-2">Mascot Karakter Anda</h3>
                                <p class="text-gray-600 max-w-md mb-4">
                                    Upload referensi mascot yang Anda inginkan, dan AI akan membuat 4 variasi mascot yang mirip dengan style referensi!
                                </p>
                                <div class="p-4 bg-amber-50 rounded-xl border-2 border-amber-200 max-w-md">
                                    <p class="text-sm text-amber-800">
                                        <i class="fas fa-lightbulb mr-2"></i>
                                        <strong>Tips:</strong> Upload gambar mascot/karakter yang jelas. AI akan meniru bentuk, style, warna, dan karakteristiknya!
                                    </p>
                                </div>
                            </div>

                            <!-- Results Grid -->
                            <div id="mascot-results-container" class="hidden">
                                <div class="flex items-center justify-between mb-6">
                                    <h3 class="text-2xl font-bold text-gray-800">
                                        <i class="fas fa-sparkles mr-2" style="color: #F59E0B;"></i>
                                        Your Mascot Variations
                                    </h3>
                                    <span class="mascot-info-badge">
                                        <i class="fas fa-check-circle"></i>
                                        4 Variasi
                                    </span>
                                </div>

                                <!-- Reference Comparison -->
                                <div id="mascot-reference-display" class="mb-6 p-4 bg-gradient-to-r from-amber-50 to-red-50 rounded-xl border-2 border-amber-300">
                                    <div class="flex items-center gap-3 mb-3">
                                        <i class="fas fa-image text-amber-600 text-xl"></i>
                                        <h4 class="font-bold text-gray-800">Referensi Anda:</h4>
                                    </div>
                                    <div class="flex justify-center">
                                        <img id="mascot-ref-display-img" src="" alt="Referensi" class="max-h-32 rounded-lg border-2 border-amber-400 shadow-md">
                                    </div>
                                </div>

                                <div id="mascot-results-grid" class="grid grid-cols-1 md:grid-cols-2 gap-6"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- TAB 9: WEDDING & PRE-WEDDING -->
        <div id="content-wedding" class="main-content-panel hidden">
            <div class="hearts-container" id="wedding-hearts-container"></div>
            <div class="container mx-auto p-4 md:p-8">
                <div class="bg-white/80 backdrop-blur-sm max-w-5xl mx-auto p-6 md:p-10 rounded-2xl shadow-xl border border-rose-100">
                    <header class="text-center mb-8">
                        <h1 class="font-title text-5xl md:text-6xl text-rose-500">Wedding & Pre-wedding Photo Generator</h1>
                        <p class="text-gray-600 mt-2 text-lg">Ciptakan momen impian Anda dengan AI</p>
                    </header>
                    <main>
                        <!-- Input Section -->
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-8 items-start">
                            <!-- Male Partner Input -->
                            <div class="flex flex-col items-center">
                                <h2 class="text-2xl font-semibold text-gray-700 mb-4">Foto Pria</h2>
                                <div id="wedding-male-preview" class="image-preview mb-4">
                                    <span class="image-preview-placeholder">ü§µ</span>
                                </div>
                                <label for="wedding-male-upload" class="cursor-pointer bg-blue-500 text-white px-6 py-2 rounded-lg shadow-md hover:bg-blue-600 transition-all">
                                    Unggah Foto
                                    <input type="file" id="wedding-male-upload" class="hidden" accept="image/*">
                                </label>
                            </div>
                            <!-- Female Partner Input -->
                            <div class="flex flex-col items-center">
                                <h2 class="text-2xl font-semibold text-gray-700 mb-4">Foto Wanita</h2>
                                <div id="wedding-female-preview" class="image-preview mb-4">
                                    <span class="image-preview-placeholder">üë∞</span>
                                </div>
                                <label for="wedding-female-upload" class="cursor-pointer bg-pink-500 text-white px-6 py-2 rounded-lg shadow-md hover:bg-pink-600 transition-all">
                                    Unggah Foto
                                    <input type="file" id="wedding-female-upload" class="hidden" accept="image/*">
                                </label>
                            </div>
                        </div>
                        <!-- Theme & Options Section -->
                        <div class="space-y-6 mb-8">
                            <div>
                                <label for="wedding-theme-input" class="block text-xl font-semibold text-gray-700 mb-2">Tema Foto (Opsional)</label>
                                <input type="text" id="wedding-theme-input" placeholder="Contoh: di pantai saat matahari terbenam, fairytale castle, vintage retro..." class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-rose-400 focus:border-rose-400 transition">
                            </div>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div>
                                    <label class="block text-xl font-semibold text-gray-700 mb-2">Jenis Foto</label>
                                    <div class="flex items-center gap-6">
                                        <label class="flex items-center cursor-pointer">
                                            <input type="radio" name="wedding-photo-type" value="wedding" class="form-radio h-5 w-5 text-rose-500" checked>
                                            <span class="ml-2 text-gray-700">Wedding</span>
                                        </label>
                                        <label class="flex items-center cursor-pointer">
                                            <input type="radio" name="wedding-photo-type" value="prewedding" class="form-radio h-5 w-5 text-rose-500">
                                            <span class="ml-2 text-gray-700">Pre-wedding</span>
                                        </label>
                                    </div>
                                </div>
                                <div>
                                    <label class="block text-xl font-semibold text-gray-700 mb-2">Ukuran Foto</label>
                                    <div class="flex items-center gap-6">
                                        <label class="flex items-center cursor-pointer">
                                            <input type="radio" name="wedding-aspect-ratio" value="vertical" class="form-radio h-5 w-5 text-rose-500" checked>
                                            <span class="ml-2 text-gray-700">Vertikal (9:16)</span>
                                        </label>
                                        <label class="flex items-center cursor-pointer">
                                            <input type="radio" name="wedding-aspect-ratio" value="horizontal" class="form-radio h-5 w-5 text-rose-500">
                                            <span class="ml-2 text-gray-700">Horizontal (16:9)</span>
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- Generate Button -->
                        <div class="text-center">
                            <button id="wedding-generate-btn" class="bg-gradient-to-r from-rose-500 to-pink-500 text-white font-bold text-xl px-12 py-4 rounded-full shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300">
                                üíñ Generate 7 Foto üíñ
                            </button>
                        </div>
                        <!-- Loading & Result Section -->
                        <div id="wedding-loading" class="hidden flex-col items-center justify-center mt-8">
                            <div class="loader"></div>
                            <p class="text-gray-600 mt-4 text-lg">AI sedang melukis momen indah Anda... Mohon tunggu sebentar.</p>
                        </div>
                        <div id="wedding-error-message" class="hidden text-center mt-8 bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-lg"></div>

                        <!-- Results Header with Download All -->
                        <div id="wedding-results-header" class="hidden flex items-center justify-between mt-12 mb-4 bg-gradient-to-r from-rose-50 to-pink-50 p-4 rounded-xl border-2 border-rose-200">
                            <h3 class="text-2xl font-bold text-rose-600">
                                üíï Foto Pernikahan Cantik üíï
                            </h3>
                            <button id="wedding-download-all-btn" class="bg-gradient-to-r from-rose-500 to-pink-500 hover:from-rose-600 hover:to-pink-600 text-white px-6 py-2 rounded-full font-semibold shadow-lg transition transform hover:scale-105 flex items-center gap-2">
                                <i class="fas fa-download"></i>
                                Download Semua
                            </button>
                        </div>

                        <div id="wedding-image-grid" class="grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-3 gap-4">
                            <!-- Generated images will appear here -->
                        </div>
                    </main>
                </div>
            </div>
        </div>

        <!-- TAB: FOTO UMRAH/HAJI -->
        <div id="content-umrah-haji" class="main-content-panel hidden">
            <div class="container mx-auto max-w-7xl">
                <header class="text-center mb-10">
                    <div class="inline-flex items-center gap-3 mb-4">
                        <div class="w-14 h-14 rounded-2xl flex items-center justify-center shadow-lg" style="background: linear-gradient(135deg, #F59E0B 0%, #FB923C 100%);">
                            <i class="fas fa-kaaba text-white text-2xl"></i>
                        </div>
                        <div class="flex flex-col items-start">
                            <h1 class="text-4xl md:text-5xl font-bold text-transparent bg-clip-text" style="background: linear-gradient(135deg, #F59E0B 0%, #FB923C 100%); -webkit-background-clip: text; background-clip: text;">
                                Foto Umrah/Haji
                            </h1>
                            <span class="text-xs font-semibold px-3 py-1 rounded-full mt-1" style="background: linear-gradient(135deg, #F59E0B 0%, #FB923C 100%); color: white;">‚ú® AI Powered</span>
                        </div>
                    </div>
                    <p class="text-base md:text-lg text-gray-600 max-w-2xl mx-auto leading-relaxed">
                        Abadikan momen spiritual Anda dengan teknologi AI. Unggah foto diri dan dapatkan foto profesional dengan latar lokasi suci.
                    </p>
                    <div class="mt-6 inline-flex items-center gap-2 px-5 py-3 rounded-xl border-2 shadow-sm" style="border-color: #F59E0B; background: linear-gradient(135deg, #FEF3C7 0%, #FFFBEB 100%);">
                        <i class="fas fa-bolt" style="color: #F59E0B;"></i>
                        <span class="text-sm font-medium" style="color: #D97706;">Hasil instant dalam hitungan detik</span>
                    </div>
                </header>

                <div class="flex flex-col lg:flex-row gap-8 w-full">
                    <div class="w-full lg:w-5/12 flex-shrink-0">
                        <div class="card p-8 sticky top-6 shadow-xl rounded-2xl border" style="border-color: #FEF3C7; background: linear-gradient(to bottom, #ffffff 0%, #fafcfc 100%);">
                            <div class="flex flex-col gap-6">
                                <div>
                                    <div class="flex items-center gap-3 mb-4">
                                        <div class="w-10 h-10 rounded-xl flex items-center justify-center font-bold text-white shadow-md" style="background: linear-gradient(135deg, #F59E0B 0%, #FB923C 100%);">
                                            1
                                        </div>
                                        <h3 class="text-lg font-bold text-gray-800">Unggah Foto Diri</h3>
                                    </div>
                                    <label for="umrah-input" id="umrah-upload-box" class="upload-box-umrah w-full h-64 sm:h-72 rounded-2xl flex items-center justify-center cursor-pointer relative overflow-hidden border-2 border-dashed shadow-lg transition-all duration-300 hover:scale-[1.02]" style="border-color: #F59E0B; background: linear-gradient(135deg, #FFFBEB 0%, #FEF3C7 50%, #FFFBEB 100%);">
                                        <div id="umrah-placeholder" class="text-center p-4">
                                            <div class="w-20 h-20 mx-auto rounded-full flex items-center justify-center mb-4 shadow-lg" style="background: linear-gradient(135deg, #F59E0B 0%, #FB923C 100%);">
                                                <i class="fas fa-user text-white text-3xl"></i>
                                            </div>
                                            <p class="text-base font-semibold mb-2" style="color: #D97706;">Klik atau seret foto diri Anda</p>
                                            <p class="text-xs text-gray-500">PNG, JPG, WEBP, HEIC (Max 10MB)</p>
                                        </div>
                                        <img id="umrah-preview" class="hidden absolute top-0 left-0 w-full h-full object-contain" alt="Pratinjau Diri">
                                        <button type="button" id="umrah-remove-btn" class="hidden absolute top-3 right-3 bg-red-500 text-white rounded-full p-2 hover:bg-red-600 z-10 shadow-lg transition-all hover:scale-110">
                                            <i class="fas fa-times w-4 h-4"></i>
                                        </button>
                                    </label>
                                    <input type="file" id="umrah-input" class="hidden" accept="image/png, image/jpeg, image/webp, .heic, .HEIC">
                                    <div id="umrah-validation" class="text-center text-sm mt-3 font-medium"></div>
                                </div>
                                <div>
                                    <div class="flex items-center gap-3 mb-4">
                                        <div class="w-10 h-10 rounded-xl flex items-center justify-center font-bold text-white shadow-md" style="background: linear-gradient(135deg, #F59E0B 0%, #FB923C 100%);">
                                            2
                                        </div>
                                        <h3 class="text-lg font-bold text-gray-800">Pilih Jenis Kelamin</h3>
                                    </div>
                                    <div id="umrah-gender-options" class="grid grid-cols-2 gap-4">
                                        <button type="button" data-value="Laki-laki" class="option-btn-umrah selected">
                                            <i class="fas fa-male mr-2"></i>Laki-laki
                                        </button>
                                        <button type="button" data-value="Perempuan" class="option-btn-umrah">
                                            <i class="fas fa-female mr-2"></i>Perempuan
                                        </button>
                                    </div>
                                </div>
                                <div>
                                    <div class="flex items-center gap-3 mb-4">
                                        <div class="w-10 h-10 rounded-xl flex items-center justify-center font-bold text-white shadow-md" style="background: linear-gradient(135deg, #F59E0B 0%, #FB923C 100%);">
                                            3
                                        </div>
                                        <h3 class="text-lg font-bold text-gray-800">Pilih Pakaian</h3>
                                    </div>
                                    <div id="umrah-attire-options" class="grid grid-cols-2 gap-4">
                                        <button type="button" data-value="pakaian Ihram putih yang sesuai" class="option-btn-umrah selected">
                                            <i class="fas fa-praying-hands mr-2"></i>Pakaian Ihram
                                        </button>
                                        <button type="button" data-value="pakaian bebas yang sopan (misal: kemeja koko atau batik untuk pria, gamis atau abaya untuk wanita)" class="option-btn-umrah">
                                            <i class="fas fa-shirt mr-2"></i>Bebas Sopan
                                        </button>
                                    </div>
                                </div>
                                <div>
                                    <div class="flex items-center gap-3 mb-4">
                                        <div class="w-10 h-10 rounded-xl flex items-center justify-center font-bold text-white shadow-md" style="background: linear-gradient(135deg, #F59E0B 0%, #FB923C 100%);">
                                            4
                                        </div>
                                        <h3 class="text-lg font-bold text-gray-800">Pilih Lokasi</h3>
                                    </div>
                                    <div id="umrah-theme-options" class="grid grid-cols-2 md:grid-cols-3 gap-3 text-sm">
                                        <button type="button" data-value="Gaya pemotretan modern & profesional..." class="option-btn-umrah selected">
                                            <i class="fas fa-star mr-1"></i>Gaya Modern
                                        </button>
                                        <button type="button" data-value="Di Depan Ka'bah (Masjidil Haram)..." class="option-btn-umrah">
                                            <i class="fas fa-kaaba mr-1"></i>Depan Ka'bah
                                        </button>
                                        <button type="button" data-value="Masjid Nabawi (Madinah) dengan latar depan polos tanpa karpet merah..." class="option-btn-umrah">
                                            <i class="fas fa-mosque mr-1"></i>Masjid Nabawi
                                        </button>
                                        <button type="button" data-value="Di atas bukit Jabal Khandamah dengan latar belakang Ka'bah dan Zamzam Tower..." class="option-btn-umrah">
                                            <i class="fas fa-mountain mr-1"></i>Jabal Khandamah
                                        </button>
                                        <button type="button" data-value="Tawaf di Ka'bah..." class="option-btn-umrah">
                                            <i class="fas fa-circle-notch mr-1"></i>Tawaf
                                        </button>
                                        <button type="button" data-value="Berdoa di Raudhah..." class="option-btn-umrah">
                                            <i class="fas fa-hands-praying mr-1"></i>Di Raudhah
                                        </button>
                                        <button type="button" data-value="Padang Arafah / Mina..." class="option-btn-umrah">
                                            <i class="fas fa-campground mr-1"></i>Arafah/Mina
                                        </button>
                                        <button type="button" data-value="Sunset di Makkah..." class="option-btn-umrah">
                                            <i class="fas fa-sun mr-1"></i>Sunset Makkah
                                        </button>
                                    </div>
                                </div>
                                <div>
                                    <div class="flex items-center gap-3 mb-4">
                                        <div class="w-10 h-10 rounded-xl flex items-center justify-center font-bold text-white shadow-md" style="background: linear-gradient(135deg, #F59E0B 0%, #FB923C 100%);">
                                            5
                                        </div>
                                        <h3 class="text-lg font-bold text-gray-800">Pilih Rasio Gambar</h3>
                                    </div>
                                    <div id="umrah-ratio-options" class="grid grid-cols-2 sm:grid-cols-4 gap-3">
                                        <button type="button" data-value="1:1" class="option-btn-umrah">
                                            <i class="fas fa-square mr-2"></i>1:1
                                        </button>
                                        <button type="button" data-value="16:9" class="option-btn-umrah">
                                            <i class="fas fa-rectangle-landscape mr-2"></i>16:9
                                        </button>
                                        <button type="button" data-value="3:4" class="option-btn-umrah selected">
                                            <i class="fas fa-rectangle-portrait mr-2"></i>3:4
                                        </button>
                                        <button type="button" data-value="9:16" class="option-btn-umrah">
                                            <i class="fas fa-mobile-alt mr-2"></i>9:16
                                        </button>
                                    </div>
                                </div>
                                <button id="umrah-generate-btn" class="w-full text-white font-bold py-4 px-8 rounded-2xl flex items-center justify-center text-lg shadow-xl hover:shadow-2xl hover:-translate-y-1 hover:scale-[1.02] transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none relative overflow-hidden group" style="background: linear-gradient(135deg, #F59E0B 0%, #FB923C 100%);" disabled>
                                    <div class="absolute inset-0 bg-white opacity-0 group-hover:opacity-20 transition-opacity duration-300"></div>
                                    <i class="fas fa-sparkles mr-3 text-xl relative z-10"></i>
                                    <span class="relative z-10">Buat Foto Umrah/Haji</span>
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="w-full lg:w-7/12 flex flex-col">
                        <div class="card p-8 h-full flex flex-col shadow-xl rounded-2xl border" style="border-color: #FEF3C7; background: linear-gradient(to bottom, #ffffff 0%, #fafcfc 100%);">
                            <div id="umrah-results-placeholder" class="flex flex-grow flex-col items-center justify-center text-center">
                                <div class="w-28 h-28 rounded-3xl flex items-center justify-center mb-6 shadow-lg" style="background: linear-gradient(135deg, #FEF3C7 0%, #FCD34D 100%);">
                                    <i class="fas fa-images text-6xl" style="color: #F59E0B;"></i>
                                </div>
                                <h3 class="font-bold text-2xl mb-3" style="color: #D97706;">Hasil Foto Umrah/Haji Anda</h3>
                                <p class="text-gray-500 text-base max-w-md">Unggah foto Anda dan pilih preferensi untuk memulai. Hasil foto akan muncul di sini dengan kualitas profesional.</p>
                                <div class="mt-8 flex items-center gap-6">
                                    <div class="flex items-center gap-2">
                                        <div class="w-8 h-8 rounded-lg flex items-center justify-center" style="background: linear-gradient(135deg, #F59E0B 0%, #FB923C 100%);">
                                            <i class="fas fa-check text-white text-sm"></i>
                                        </div>
                                        <span class="text-sm text-gray-600">4 Variasi</span>
                                    </div>
                                    <div class="flex items-center gap-2">
                                        <div class="w-8 h-8 rounded-lg flex items-center justify-center" style="background: linear-gradient(135deg, #F59E0B 0%, #FB923C 100%);">
                                            <i class="fas fa-bolt text-white text-sm"></i>
                                        </div>
                                        <span class="text-sm text-gray-600">Instant</span>
                                    </div>
                                    <div class="flex items-center gap-2">
                                        <div class="w-8 h-8 rounded-lg flex items-center justify-center" style="background: linear-gradient(135deg, #F59E0B 0%, #FB923C 100%);">
                                            <i class="fas fa-star text-white text-sm"></i>
                                        </div>
                                        <span class="text-sm text-gray-600">HD Quality</span>
                                    </div>
                                </div>
                            </div>
                            <div id="umrah-results-container" class="hidden">
                                <div class="flex flex-col md:flex-row items-center justify-between mb-8 bg-gradient-to-r from-orange-50 to-amber-50 p-4 rounded-xl border-2 border-orange-200">
                                    <div class="text-center md:text-left">
                                        <div class="inline-flex items-center gap-2 px-4 py-2 rounded-xl shadow-md mb-2" style="background: linear-gradient(135deg, #F59E0B 0%, #FB923C 100%);">
                                            <i class="fas fa-check-circle text-white"></i>
                                            <span class="text-white font-semibold">Foto Berhasil Dibuat!</span>
                                        </div>
                                        <h3 class="text-xl md:text-2xl font-bold text-gray-800">Hasil Foto Umrah/Haji Anda</h3>
                                        <p class="text-gray-500 text-sm mt-1">Klik gambar untuk preview atau unduh</p>
                                    </div>
                                    <button id="umrah-download-all-btn" class="mt-4 md:mt-0 bg-gradient-to-r from-orange-500 to-amber-500 hover:from-orange-600 hover:to-amber-600 text-white px-6 py-2 rounded-full font-semibold shadow-lg transition transform hover:scale-105 flex items-center gap-2">
                                        <i class="fas fa-download"></i>
                                        Download Semua
                                    </button>
                                </div>
                                <div id="umrah-results-grid" class="grid grid-cols-1 md:grid-cols-2 gap-6"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- TAB: PAS FOTO WARNA -->
        <div id="content-passport-photo" class="main-content-panel hidden">
            <div class="container mx-auto max-w-7xl">
                <header class="text-center mb-8">
                    <h1 class="text-4xl md:text-5xl font-bold mb-3">
                        <i class="fas fa-id-card mr-3"></i>Pas Foto Warna
                    </h1>
                    <p class="text-lg text-gray-600">
                        Buat pas foto formal dengan berbagai warna latar dan pilihan pakaian instan. Cepat dan praktis untuk semua kebutuhan.
                    </p>
                </header>

                <div class="flex flex-col lg:flex-row gap-8 w-full">
                    <div class="w-full lg:w-5/12 flex-shrink-0">
                        <div class="card p-6 sticky top-6">
                            <div class="flex flex-col gap-5">
                                <div>
                                    <h3 class="text-base font-semibold mb-3 text-gray-800">1. Unggah Foto Wajah</h3>
                                    <label for="passport-input" id="passport-upload-box" class="upload-box-passport w-full h-56 sm:h-64 rounded-lg flex items-center justify-center cursor-pointer relative overflow-hidden border-2 border-dashed border-gray-300">
                                        <div id="passport-placeholder" class="text-center text-gray-500 p-2">
                                            <i class="fas fa-user-circle" style="font-size: 3rem;"></i>
                                            <p class="mt-2 text-sm md:text-base">Klik atau seret foto close-up</p>
                                        </div>
                                        <img id="passport-preview" class="hidden absolute top-0 left-0 w-full h-full object-contain" alt="Pratinjau Pas Foto">
                                        <button type="button" id="passport-remove-btn" class="hidden absolute top-2 right-2 bg-red-600 text-white rounded-full p-1 hover:bg-red-700 z-10">
                                            <i class="fas fa-times"></i>
                                        </button>
                                    </label>
                                    <input type="file" id="passport-input" class="hidden" accept="image/png, image/jpeg, image/webp, .heic, .HEIC">
                                    <div id="passport-validation" class="text-center text-sm mt-2"></div>
                                </div>
                                <div>
                                    <h3 class="text-base font-semibold mb-3 text-gray-800">2. Pilih Warna Background</h3>
                                    <div id="passport-bg-options" class="grid grid-cols-2 md:grid-cols-4 gap-3">
                                        <button type="button" data-value="Merah" class="option-btn-passport selected">Merah</button>
                                        <button type="button" data-value="Biru" class="option-btn-passport">Biru</button>
                                        <button type="button" data-value="Putih" class="option-btn-passport">Putih</button>
                                        <button type="button" data-value="Abu-abu" class="option-btn-passport">Abu-abu</button>
                                    </div>
                                </div>
                                <div>
                                    <h3 class="text-base font-semibold mb-3 text-gray-800">3. Mode Pakaian Otomatis</h3>
                                    <div id="passport-attire-options" class="grid grid-cols-2 sm:grid-cols-3 gap-3">
                                        <button type="button" data-value="Ganti dengan Jas Hitam dan Dasi" class="option-btn-passport selected">Jas + Dasi</button>
                                        <button type="button" data-value="Ganti dengan Blazer Formal Wanita" class="option-btn-passport">Blazer</button>
                                        <button type="button" data-value="Ganti dengan Kemeja Putih Polos" class="option-btn-passport">Kemeja</button>
                                        <button type="button" data-value="Sekolah" class="option-btn-passport">Sekolah</button>
                                        <button type="button" data-value="Kustom" class="option-btn-passport">Kustom</button>
                                    </div>
                                    <div id="passport-school-options-container" class="hidden mt-4">
                                        <h4 class="text-sm font-semibold mb-2 text-gray-700">Pilih Jenjang:</h4>
                                        <div id="passport-school-options" class="grid grid-cols-3 gap-3">
                                            <button type="button" data-value="SD (putih merah)" class="option-btn-passport selected text-sm !p-2">SD</button>
                                            <button type="button" data-value="SMP (putih biru)" class="option-btn-passport text-sm !p-2">SMP</button>
                                            <button type="button" data-value="SMA (putih abu-abu)" class="option-btn-passport text-sm !p-2">SMA</button>
                                        </div>
                                    </div>
                                    <div id="passport-custom-attire-container" class="hidden mt-4 space-y-4">
                                        <h4 class="text-sm font-semibold text-gray-700">Pakaian Kustom:</h4>
                                        <input type="text" id="passport-custom-attire-input" class="w-full p-3 rounded-lg border border-gray-300" placeholder="Contoh: kemeja batik...">
                                        <div class="text-center text-sm font-semibold text-gray-500">ATAU</div>
                                        <label for="passport-custom-attire-ref-input" id="passport-custom-attire-ref-upload-box" class="upload-box-passport w-full h-40 rounded-lg flex items-center justify-center cursor-pointer relative overflow-hidden border-2 border-dashed border-gray-300">
                                            <div id="passport-custom-attire-ref-placeholder" class="text-center text-gray-500 p-2">
                                                <i class="fas fa-image" style="font-size: 2rem;"></i>
                                                <p class="mt-2 text-sm">Unggah referensi</p>
                                            </div>
                                            <img id="passport-custom-attire-ref-preview" class="hidden absolute top-0 left-0 w-full h-full object-contain" alt="Pratinjau Referensi Pakaian">
                                            <button type="button" id="passport-custom-attire-ref-remove-btn" class="hidden absolute top-2 right-2 bg-red-600 text-white rounded-full p-1 hover:bg-red-700 z-10">
                                                <i class="fas fa-times"></i>
                                            </button>
                                        </label>
                                        <input type="file" id="passport-custom-attire-ref-input" class="hidden" accept="image/png, image/jpeg, image/webp, .heic, .HEIC">
                                    </div>
                                </div>
                                <div>
                                    <h3 class="text-base font-semibold mb-3 text-gray-800">4. Ukuran Output</h3>
                                    <div id="passport-size-options" class="grid grid-cols-3 gap-3">
                                        <button type="button" data-value="2:3" class="option-btn-passport">2x3</button>
                                        <button type="button" data-value="3:4" class="option-btn-passport selected">3x4</button>
                                        <button type="button" data-value="4:6" class="option-btn-passport">4x6</button>
                                    </div>
                                </div>
                                <button id="passport-generate-btn" class="w-full text-white font-bold py-3 px-6 rounded-lg flex items-center justify-center text-lg shadow-md hover:shadow-lg hover:-translate-y-px transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed" style="background: linear-gradient(to right, #7DDCDD, #79D7DE);" disabled>
                                    <i class="fas fa-magic mr-2"></i>
                                    <span>Buat Pas Foto</span>
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="w-full lg:w-7/12 flex flex-col">
                        <div class="card p-6 h-full flex flex-col">
                            <div id="passport-results-placeholder" class="flex flex-grow flex-col items-center justify-center text-center text-slate-500">
                                <i class="fas fa-image" style="font-size: 4rem; color: #cbd5e1; margin-bottom: 1rem;"></i>
                                <h3 class="font-semibold text-lg text-slate-600">Hasil Pas Foto Anda</h3>
                                <p class="mt-1 text-sm">Hasil foto akan muncul di sini.</p>
                            </div>
                            <div id="passport-results-container" class="hidden">
                                <div class="flex flex-col md:flex-row items-center justify-between mb-6 bg-gradient-to-r from-cyan-50 to-teal-50 p-4 rounded-xl border-2 border-cyan-200">
                                    <h3 class="text-xl md:text-2xl font-bold text-gray-800">
                                        üì∏ Hasil Pas Foto üì∏
                                    </h3>
                                    <button id="passport-download-all-btn" class="mt-4 md:mt-0 bg-gradient-to-r from-cyan-500 to-teal-500 hover:from-cyan-600 hover:to-teal-600 text-white px-6 py-2 rounded-full font-semibold shadow-lg transition transform hover:scale-105 flex items-center gap-2">
                                        <i class="fas fa-download"></i>
                                        Download Semua
                                    </button>
                                </div>
                                <div id="passport-results-grid" class="grid grid-cols-2 md:grid-cols-4 gap-4 md:gap-6"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- TAB: PHOTO BOOTH -->
        <div id="content-photo-booth" class="main-content-panel hidden">
            <div class="container mx-auto max-w-7xl">
                <header class="text-center mb-8">
                    <h1 class="text-4xl md:text-5xl font-bold mb-3">
                        <i class="fas fa-camera-retro mr-3"></i>Photo Booth Studio
                    </h1>
                    <p class="text-lg text-gray-600">
                        Buat foto booth profesional dengan berbagai tema dan frame menarik. Perfect untuk kenangan spesial Anda!
                    </p>
                </header>

                <div class="flex flex-col lg:flex-row gap-8 w-full">
                    <!-- Left Panel: Controls -->
                    <div class="w-full lg:w-5/12 flex-shrink-0">
                        <div class="card p-6 sticky top-6">
                            <div class="flex flex-col gap-5">
                                <!-- Step 1: Upload Photo -->
                                <div>
                                    <div class="flex items-center gap-2 mb-3">
                                        <div class="flex items-center justify-center w-8 h-8 rounded-full bg-gradient-to-br from-purple-500 to-pink-600 text-white font-bold text-sm shadow-lg">1</div>
                                        <h3 class="text-base font-semibold text-gray-800">Unggah Foto</h3>
                                    </div>
                                    <label for="photo-booth-input" id="photo-booth-upload-box" class="upload-box-booth w-full h-56 sm:h-64 rounded-xl flex items-center justify-center cursor-pointer relative overflow-hidden border-2 border-dashed border-gray-300 transition-all duration-300 hover:border-purple-500 hover:bg-gradient-to-br hover:from-purple-50 hover:to-pink-50 hover:shadow-xl hover:-translate-y-1">
                                        <div id="photo-booth-placeholder" class="text-center text-gray-500 p-4">
                                            <i class="fas fa-camera-retro transition-transform duration-300" style="font-size: 3.5rem; color: #9333ea;"></i>
                                            <p class="mt-3 text-sm md:text-base font-semibold">üì∏ Klik atau seret foto Anda</p>
                                            <p class="mt-1 text-xs text-gray-400">PNG, JPG, HEIC (Max 10MB)</p>
                                        </div>
                                        <img id="photo-booth-preview" class="hidden absolute top-0 left-0 w-full h-full object-cover" alt="Preview">
                                        <button type="button" id="photo-booth-remove-btn" class="hidden absolute top-2 right-2 bg-red-600 text-white rounded-full w-8 h-8 flex items-center justify-center hover:bg-red-700 z-10 shadow-lg transition-transform hover:scale-110">
                                            <i class="fas fa-times"></i>
                                        </button>
                                    </label>
                                    <input type="file" id="photo-booth-input" class="hidden" accept="image/png, image/jpeg, image/webp, .heic, .HEIC">
                                </div>

                                <!-- Step 2: Choose Frame Style -->
                                <div>
                                    <div class="flex items-center gap-2 mb-3">
                                        <div class="flex items-center justify-center w-8 h-8 rounded-full bg-gradient-to-br from-purple-500 to-pink-600 text-white font-bold text-sm shadow-lg">2</div>
                                        <h3 class="text-base font-semibold text-gray-800">Pilih Tema Frame</h3>
                                    </div>
                                    <div id="photo-booth-frame-options" class="grid grid-cols-2 sm:grid-cols-3 gap-3">
                                        <button type="button" data-value="Classic Strip" class="option-btn-booth selected">
                                            <i class="fas fa-film mr-1"></i>Classic Strip
                                        </button>
                                        <button type="button" data-value="Vintage Polaroid" class="option-btn-booth">
                                            <i class="fas fa-image mr-1"></i>Polaroid
                                        </button>
                                        <button type="button" data-value="Colorful Party" class="option-btn-booth">
                                            <i class="fas fa-birthday-cake mr-1"></i>Party
                                        </button>
                                        <button type="button" data-value="Wedding Elegant" class="option-btn-booth">
                                            <i class="fas fa-ring mr-1"></i>Wedding
                                        </button>
                                        <button type="button" data-value="Birthday Fun" class="option-btn-booth">
                                            <i class="fas fa-gift mr-1"></i>Birthday
                                        </button>
                                        <button type="button" data-value="Retro 80s" class="option-btn-booth">
                                            <i class="fas fa-compact-disc mr-1"></i>Retro 80s
                                        </button>
                                        <button type="button" data-value="Modern Minimal" class="option-btn-booth">
                                            <i class="fas fa-square mr-1"></i>Minimal
                                        </button>
                                        <button type="button" data-value="Custom" class="option-btn-booth">
                                            <i class="fas fa-edit mr-1"></i>Custom
                                        </button>
                                    </div>

                                    <!-- Custom Theme Input -->
                                    <div id="photo-booth-custom-theme-container" class="hidden mt-4">
                                        <label class="block text-sm font-semibold text-gray-700 mb-2">‚ú® Tema Kustom Anda:</label>
                                        <input type="text" id="photo-booth-custom-theme-input" class="w-full p-3 rounded-lg border-2 border-gray-300 focus:border-purple-500 focus:ring-2 focus:ring-purple-200 transition-all" placeholder="Contoh: Tropical Beach, Neon Cyberpunk, Flower Garden...">
                                        <p class="text-xs text-gray-500 mt-2">üí° Deskripsikan tema frame yang Anda inginkan</p>
                                    </div>
                                </div>

                                <!-- Step 3: Aspect Ratio -->
                                <div>
                                    <div class="flex items-center gap-2 mb-3">
                                        <div class="flex items-center justify-center w-8 h-8 rounded-full bg-gradient-to-br from-purple-500 to-pink-600 text-white font-bold text-sm shadow-lg">3</div>
                                        <h3 class="text-base font-semibold text-gray-800">Rasio Gambar</h3>
                                    </div>
                                    <div id="photo-booth-ratio-options" class="grid grid-cols-4 gap-3">
                                        <button type="button" data-value="1:1" class="option-btn-booth">1:1</button>
                                        <button type="button" data-value="3:4" class="option-btn-booth selected">3:4</button>
                                        <button type="button" data-value="9:16" class="option-btn-booth">9:16</button>
                                        <button type="button" data-value="16:9" class="option-btn-booth">16:9</button>
                                    </div>
                                </div>

                                <!-- Step 4: Number of Photos -->
                                <div>
                                    <div class="flex items-center gap-2 mb-3">
                                        <div class="flex items-center justify-center w-8 h-8 rounded-full bg-gradient-to-br from-purple-500 to-pink-600 text-white font-bold text-sm shadow-lg">4</div>
                                        <h3 class="text-base font-semibold text-gray-800">Jumlah Foto</h3>
                                    </div>
                                    <div id="photo-booth-count-options" class="grid grid-cols-3 gap-3">
                                        <button type="button" data-value="4" class="option-btn-booth">4 Foto</button>
                                        <button type="button" data-value="6" class="option-btn-booth">6 Foto</button>
                                        <button type="button" data-value="8" class="option-btn-booth selected">8 Foto</button>
                                    </div>
                                </div>

                                <!-- Generate Button -->
                                <button id="photo-booth-generate-btn" class="w-full text-white font-bold py-4 px-6 rounded-xl flex items-center justify-center text-lg shadow-lg hover:shadow-xl hover:-translate-y-1 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:translate-y-0" style="background: linear-gradient(135deg, #9333ea 0%, #ec4899 100%);" disabled>
                                    <i class="fas fa-camera-retro mr-2"></i>
                                    <span>Buat Photo Booth</span>
                                </button>

                                <div class="text-center text-xs text-gray-500 mt-2">
                                    ‚ö° Proses generasi memerlukan waktu 20-40 detik per foto
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Right Panel: Results -->
                    <div class="w-full lg:w-7/12 flex flex-col">
                        <div class="card p-6 h-full flex flex-col">
                            <!-- Placeholder -->
                            <div id="photo-booth-results-placeholder" class="flex flex-grow flex-col items-center justify-center text-center text-slate-500">
                                <i class="fas fa-images" style="font-size: 4rem; color: #cbd5e1; margin-bottom: 1rem;"></i>
                                <h3 class="font-semibold text-lg text-slate-600">Hasil Photo Booth Anda</h3>
                                <p class="mt-1 text-sm">Foto booth akan muncul di sini setelah diproses</p>
                            </div>

                            <!-- Results Container -->
                            <div id="photo-booth-results-container" class="hidden">
                                <!-- Results Header -->
                                <div class="flex flex-col md:flex-row items-center justify-between mb-6 bg-gradient-to-r from-purple-50 to-pink-50 p-4 rounded-xl border-2 border-purple-200">
                                    <h3 class="text-xl md:text-2xl font-bold text-gray-800">
                                        üì∏ Hasil Photo Booth üì∏
                                    </h3>
                                    <button id="photo-booth-download-all-btn" class="mt-4 md:mt-0 bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600 text-white px-6 py-2 rounded-full font-semibold shadow-lg transition transform hover:scale-105 flex items-center gap-2">
                                        <i class="fas fa-download"></i>
                                        Download Semua
                                    </button>
                                </div>

                                <!-- Results Grid -->
                                <div id="photo-booth-results-grid" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 md:gap-6"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- TAB: EXPRESSION CHANGER -->
        <div id="content-expression-changer" class="main-content-panel hidden">
            <div class="container mx-auto max-w-7xl">
                <header class="text-center mb-8">
                    <h1 class="text-4xl md:text-5xl font-bold mb-3">
                        <i class="fas fa-face-laugh-beam mr-3"></i>Expression Changer
                    </h1>
                    <p class="text-lg text-gray-600">
                        Ubah ekspresi wajah dalam foto dengan AI canggih. Dari senyum hingga serius, semua ekspresi bisa diciptakan dengan natural!
                    </p>
                </header>

                <div class="flex flex-col lg:flex-row gap-8 w-full">
                    <!-- Left Panel: Controls -->
                    <div class="w-full lg:w-5/12 flex-shrink-0">
                        <div class="card p-6 sticky top-6">
                            <div class="flex flex-col gap-5">
                                <!-- Step 1: Upload Photo -->
                                <div>
                                    <div class="flex items-center gap-2 mb-3">
                                        <div class="flex items-center justify-center w-8 h-8 rounded-full bg-gradient-to-br from-blue-500 to-cyan-600 text-white font-bold text-sm shadow-lg">1</div>
                                        <h3 class="text-base font-semibold text-gray-800">Unggah Foto Wajah</h3>
                                    </div>
                                    <label for="expression-input" id="expression-upload-box" class="upload-box-expression w-full h-56 sm:h-64 rounded-xl flex items-center justify-center cursor-pointer relative overflow-hidden border-2 border-dashed border-gray-300 transition-all duration-300 hover:border-blue-500 hover:bg-gradient-to-br hover:from-blue-50 hover:to-cyan-50 hover:shadow-xl hover:-translate-y-1">
                                        <div id="expression-placeholder" class="text-center text-gray-500 p-4">
                                            <i class="fas fa-face-smile transition-transform duration-300" style="font-size: 3.5rem; color: #3b82f6;"></i>
                                            <p class="mt-3 text-sm md:text-base font-semibold">üòä Klik atau seret foto close-up wajah</p>
                                            <p class="mt-1 text-xs text-gray-400">PNG, JPG, HEIC (Max 10MB)</p>
                                        </div>
                                        <img id="expression-preview" class="hidden absolute top-0 left-0 w-full h-full object-cover" alt="Preview">
                                        <button type="button" id="expression-remove-btn" class="hidden absolute top-2 right-2 bg-red-600 text-white rounded-full w-8 h-8 flex items-center justify-center hover:bg-red-700 z-10 shadow-lg transition-transform hover:scale-110">
                                            <i class="fas fa-times"></i>
                                        </button>
                                    </label>
                                    <input type="file" id="expression-input" class="hidden" accept="image/png, image/jpeg, image/webp, .heic, .HEIC">
                                </div>

                                <!-- Step 2: Choose Expression -->
                                <div>
                                    <div class="flex items-center gap-2 mb-3">
                                        <div class="flex items-center justify-center w-8 h-8 rounded-full bg-gradient-to-br from-blue-500 to-cyan-600 text-white font-bold text-sm shadow-lg">2</div>
                                        <h3 class="text-base font-semibold text-gray-800">Pilih Ekspresi Target</h3>
                                    </div>
                                    <div id="expression-type-options" class="grid grid-cols-2 sm:grid-cols-3 gap-3">
                                        <button type="button" data-value="Happy Smiling" class="option-btn-expression selected">
                                            <i class="fas fa-face-laugh-beam mr-1"></i>Senyum Lebar
                                        </button>
                                        <button type="button" data-value="Gentle Smile" class="option-btn-expression">
                                            <i class="fas fa-face-smile mr-1"></i>Senyum Lembut
                                        </button>
                                        <button type="button" data-value="Serious" class="option-btn-expression">
                                            <i class="fas fa-face-meh mr-1"></i>Serius
                                        </button>
                                        <button type="button" data-value="Surprised" class="option-btn-expression">
                                            <i class="fas fa-face-surprise mr-1"></i>Terkejut
                                        </button>
                                        <button type="button" data-value="Sad" class="option-btn-expression">
                                            <i class="fas fa-face-sad-tear mr-1"></i>Sedih
                                        </button>
                                        <button type="button" data-value="Angry" class="option-btn-expression">
                                            <i class="fas fa-face-angry mr-1"></i>Marah
                                        </button>
                                        <button type="button" data-value="Laughing" class="option-btn-expression">
                                            <i class="fas fa-face-grin-squint-tears mr-1"></i>Tertawa
                                        </button>
                                        <button type="button" data-value="Confident" class="option-btn-expression">
                                            <i class="fas fa-face-grin-stars mr-1"></i>Percaya Diri
                                        </button>
                                        <button type="button" data-value="Thinking" class="option-btn-expression">
                                            <i class="fas fa-face-rolling-eyes mr-1"></i>Berpikir
                                        </button>
                                        <button type="button" data-value="Excited" class="option-btn-expression">
                                            <i class="fas fa-face-grin-hearts mr-1"></i>Bersemangat
                                        </button>
                                        <button type="button" data-value="Neutral Calm" class="option-btn-expression">
                                            <i class="fas fa-face-meh-blank mr-1"></i>Netral Tenang
                                        </button>
                                        <button type="button" data-value="Custom" class="option-btn-expression">
                                            <i class="fas fa-edit mr-1"></i>Kustom
                                        </button>
                                    </div>

                                    <!-- Custom Expression Input -->
                                    <div id="expression-custom-container" class="hidden mt-4">
                                        <label class="block text-sm font-semibold text-gray-700 mb-2">‚ú® Ekspresi Kustom Anda:</label>
                                        <input type="text" id="expression-custom-input" class="w-full p-3 rounded-lg border-2 border-gray-300 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all" placeholder="Contoh: senyum malu-malu, wajah misterius, ekspresi memikat...">
                                        <p class="text-xs text-gray-500 mt-2">üí° Deskripsikan ekspresi yang Anda inginkan dengan detail</p>
                                    </div>
                                </div>

                                <!-- Step 3: Intensity Level -->
                                <div>
                                    <div class="flex items-center gap-2 mb-3">
                                        <div class="flex items-center justify-center w-8 h-8 rounded-full bg-gradient-to-br from-blue-500 to-cyan-600 text-white font-bold text-sm shadow-lg">3</div>
                                        <h3 class="text-base font-semibold text-gray-800">Intensitas Ekspresi</h3>
                                    </div>
                                    <div id="expression-intensity-options" class="grid grid-cols-3 gap-3">
                                        <button type="button" data-value="Subtle" class="option-btn-expression">
                                            <span>Halus</span>
                                        </button>
                                        <button type="button" data-value="Moderate" class="option-btn-expression selected">
                                            <span>Sedang</span>
                                        </button>
                                        <button type="button" data-value="Strong" class="option-btn-expression">
                                            <span>Kuat</span>
                                        </button>
                                    </div>
                                </div>

                                <!-- Step 4: Number of Variations -->
                                <div>
                                    <div class="flex items-center gap-2 mb-3">
                                        <div class="flex items-center justify-center w-8 h-8 rounded-full bg-gradient-to-br from-blue-500 to-cyan-600 text-white font-bold text-sm shadow-lg">4</div>
                                        <h3 class="text-base font-semibold text-gray-800">Jumlah Variasi</h3>
                                    </div>
                                    <div id="expression-count-options" class="grid grid-cols-3 gap-3">
                                        <button type="button" data-value="3" class="option-btn-expression">3 Variasi</button>
                                        <button type="button" data-value="4" class="option-btn-expression selected">4 Variasi</button>
                                        <button type="button" data-value="6" class="option-btn-expression">6 Variasi</button>
                                    </div>
                                </div>

                                <!-- Generate Button -->
                                <button id="expression-generate-btn" class="w-full text-white font-bold py-4 px-6 rounded-xl flex items-center justify-center text-lg shadow-lg hover:shadow-xl hover:-translate-y-1 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:translate-y-0" style="background: linear-gradient(135deg, #3b82f6 0%, #06b6d4 100%);" disabled>
                                    <i class="fas fa-wand-magic-sparkles mr-2"></i>
                                    <span>Ubah Ekspresi</span>
                                </button>

                                <div class="text-center text-xs text-gray-500 mt-2">
                                    ‚ö° Proses generasi memerlukan waktu 15-30 detik per variasi
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Right Panel: Results -->
                    <div class="w-full lg:w-7/12 flex flex-col">
                        <div class="card p-6 h-full flex flex-col">
                            <!-- Placeholder -->
                            <div id="expression-results-placeholder" class="flex flex-grow flex-col items-center justify-center text-center text-slate-500">
                                <i class="fas fa-face-smile-wink" style="font-size: 4rem; color: #cbd5e1; margin-bottom: 1rem;"></i>
                                <h3 class="font-semibold text-lg text-slate-600">Hasil Expression Changer</h3>
                                <p class="mt-1 text-sm">Foto dengan ekspresi baru akan muncul di sini</p>
                                <div class="mt-4 p-4 bg-blue-50 rounded-lg max-w-md">
                                    <p class="text-xs text-blue-700">
                                        <i class="fas fa-info-circle mr-1"></i>
                                        <strong>Tips:</strong> Gunakan foto close-up wajah yang jelas untuk hasil terbaik. AI akan mengubah ekspresi sambil mempertahankan identitas wajah asli.
                                    </p>
                                </div>
                            </div>

                            <!-- Results Container -->
                            <div id="expression-results-container" class="hidden">
                                <!-- Results Header -->
                                <div class="flex flex-col md:flex-row items-center justify-between mb-6 bg-gradient-to-r from-blue-50 to-cyan-50 p-4 rounded-xl border-2 border-blue-200">
                                    <h3 class="text-xl md:text-2xl font-bold text-gray-800">
                                        üòä Hasil Expression Changer üé≠
                                    </h3>
                                    <button id="expression-download-all-btn" class="mt-4 md:mt-0 bg-gradient-to-r from-blue-500 to-cyan-500 hover:from-blue-600 hover:to-cyan-600 text-white px-6 py-2 rounded-full font-semibold shadow-lg transition transform hover:scale-105 flex items-center gap-2">
                                        <i class="fas fa-download"></i>
                                        Download Semua
                                    </button>
                                </div>

                                <!-- Results Grid -->
                                <div id="expression-results-grid" class="grid grid-cols-2 md:grid-cols-3 gap-4 md:gap-6"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- TAB: FACE SWAP -->
        <div id="content-face-swap" class="main-content-panel hidden">
            <div class="container mx-auto max-w-7xl">
                <header class="text-center mb-8">
                    <h1 class="text-4xl md:text-5xl font-bold mb-3" style="background: linear-gradient(135deg, #f97316 0%, #ea580c 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">
                        <i class="fas fa-face-grin-stars mr-3"></i>Face Swap
                    </h1>
                    <p class="text-lg text-gray-600">
                        Tukar wajah dengan AI profesional! Ambil wajah dari satu foto dan terapkan ke foto lain dengan hasil yang natural dan realistis.
                    </p>
                </header>

                <div class="flex flex-col lg:flex-row gap-8 w-full">
                    <!-- Left Panel: Controls -->
                    <div class="w-full lg:w-5/12 flex-shrink-0">
                        <div class="card p-6 sticky top-6">
                            <div class="flex flex-col gap-5">
                                <!-- Step 1: Upload Source Face (wajah yang akan diambil) -->
                                <div>
                                    <div class="flex items-center gap-2 mb-3">
                                        <div class="flex items-center justify-center w-8 h-8 rounded-full bg-gradient-to-br from-orange-500 to-orange-600 text-white font-bold text-sm shadow-lg">1</div>
                                        <h3 class="text-base font-semibold text-gray-800">Foto Wajah Sumber</h3>
                                    </div>
                                    <label for="faceswap-source-input" id="faceswap-source-upload-box" class="upload-box-faceswap w-full h-56 sm:h-64 rounded-xl flex items-center justify-center cursor-pointer relative overflow-hidden border-2 border-dashed border-gray-300">
                                        <div id="faceswap-source-placeholder" class="text-center text-gray-500 p-4">
                                            <i class="fas fa-user-circle transition-transform duration-300" style="font-size: 3.5rem; color: #f97316;"></i>
                                            <p class="mt-3 text-sm md:text-base font-semibold">üì∑ Wajah yang akan digunakan</p>
                                            <p class="mt-1 text-xs text-gray-400">Close-up wajah yang jelas</p>
                                        </div>
                                        <img id="faceswap-source-preview" class="hidden absolute top-0 left-0 w-full h-full object-cover" alt="Source Preview">
                                        <button type="button" id="faceswap-source-remove-btn" class="hidden absolute top-2 right-2 bg-red-600 text-white rounded-full w-8 h-8 flex items-center justify-center hover:bg-red-700 z-10 shadow-lg transition-transform hover:scale-110">
                                            <i class="fas fa-times"></i>
                                        </button>
                                    </label>
                                    <input type="file" id="faceswap-source-input" class="hidden" accept="image/png, image/jpeg, image/webp, .heic, .HEIC">
                                    <p class="text-xs text-orange-600 mt-2 font-medium">
                                        <i class="fas fa-info-circle mr-1"></i>Wajah dari foto ini yang akan digunakan
                                    </p>
                                </div>

                                <!-- Step 2: Upload Target Photo (foto yang wajahnya akan diganti) -->
                                <div>
                                    <div class="flex items-center gap-2 mb-3">
                                        <div class="flex items-center justify-center w-8 h-8 rounded-full bg-gradient-to-br from-orange-500 to-orange-600 text-white font-bold text-sm shadow-lg">2</div>
                                        <h3 class="text-base font-semibold text-gray-800">Foto Target</h3>
                                    </div>
                                    <label for="faceswap-target-input" id="faceswap-target-upload-box" class="upload-box-faceswap w-full h-56 sm:h-64 rounded-xl flex items-center justify-center cursor-pointer relative overflow-hidden border-2 border-dashed border-gray-300">
                                        <div id="faceswap-target-placeholder" class="text-center text-gray-500 p-4">
                                            <i class="fas fa-image transition-transform duration-300" style="font-size: 3.5rem; color: #f97316;"></i>
                                            <p class="mt-3 text-sm md:text-base font-semibold">üñºÔ∏è Foto yang akan diedit</p>
                                            <p class="mt-1 text-xs text-gray-400">Foto dengan wajah yang akan diganti</p>
                                        </div>
                                        <img id="faceswap-target-preview" class="hidden absolute top-0 left-0 w-full h-full object-cover" alt="Target Preview">
                                        <button type="button" id="faceswap-target-remove-btn" class="hidden absolute top-2 right-2 bg-red-600 text-white rounded-full w-8 h-8 flex items-center justify-center hover:bg-red-700 z-10 shadow-lg transition-transform hover:scale-110">
                                            <i class="fas fa-times"></i>
                                        </button>
                                    </label>
                                    <input type="file" id="faceswap-target-input" class="hidden" accept="image/png, image/jpeg, image/webp, .heic, .HEIC">
                                    <p class="text-xs text-orange-600 mt-2 font-medium">
                                        <i class="fas fa-info-circle mr-1"></i>Wajah di foto ini akan diganti
                                    </p>
                                </div>

                                <!-- Step 3: Aspect Ratio -->
                                <div>
                                    <div class="flex items-center gap-2 mb-3">
                                        <div class="flex items-center justify-center w-8 h-8 rounded-full bg-gradient-to-br from-orange-500 to-orange-600 text-white font-bold text-sm shadow-lg">3</div>
                                        <h3 class="text-base font-semibold text-gray-800">Aspek Rasio</h3>
                                    </div>
                                    <div id="faceswap-ratio-options" class="grid grid-cols-2 sm:grid-cols-4 gap-3">
                                        <button type="button" data-value="1:1" class="option-btn-faceswap">
                                            <i class="fas fa-square mr-1"></i>1:1
                                        </button>
                                        <button type="button" data-value="3:4" class="option-btn-faceswap selected">
                                            <i class="fas fa-rectangle-portrait mr-1"></i>3:4
                                        </button>
                                        <button type="button" data-value="4:5" class="option-btn-faceswap">
                                            <i class="fas fa-mobile-alt mr-1"></i>4:5
                                        </button>
                                        <button type="button" data-value="9:16" class="option-btn-faceswap">
                                            <i class="fas fa-mobile mr-1"></i>9:16
                                        </button>
                                    </div>
                                </div>

                                <!-- Step 4: Number of Variations -->
                                <div>
                                    <div class="flex items-center gap-2 mb-3">
                                        <div class="flex items-center justify-center w-8 h-8 rounded-full bg-gradient-to-br from-orange-500 to-orange-600 text-white font-bold text-sm shadow-lg">4</div>
                                        <h3 class="text-base font-semibold text-gray-800">Jumlah Variasi</h3>
                                    </div>
                                    <div id="faceswap-count-options" class="grid grid-cols-3 gap-3">
                                        <button type="button" data-value="3" class="option-btn-faceswap">3 Variasi</button>
                                        <button type="button" data-value="4" class="option-btn-faceswap selected">4 Variasi</button>
                                        <button type="button" data-value="6" class="option-btn-faceswap">6 Variasi</button>
                                    </div>
                                </div>

                                <!-- Generate Button -->
                                <button id="faceswap-generate-btn" class="w-full text-white font-bold py-4 px-6 rounded-xl flex items-center justify-center text-lg shadow-lg hover:shadow-xl hover:-translate-y-1 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:translate-y-0" style="background: linear-gradient(135deg, #f97316 0%, #ea580c 100%);" disabled>
                                    <i class="fas fa-wand-magic-sparkles mr-2"></i>
                                    <span>Tukar Wajah</span>
                                </button>

                                <div class="text-center text-xs text-gray-500 mt-2">
                                    ‚ö° Proses memerlukan waktu 20-40 detik per variasi
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Right Panel: Results -->
                    <div class="w-full lg:w-7/12 flex flex-col">
                        <div class="card p-6 h-full flex flex-col">
                            <!-- Placeholder -->
                            <div id="faceswap-results-placeholder" class="flex flex-grow flex-col items-center justify-center text-center text-slate-500">
                                <i class="fas fa-face-grin-stars" style="font-size: 4rem; color: #fed7aa; margin-bottom: 1rem;"></i>
                                <h3 class="font-semibold text-lg text-slate-600">Hasil Face Swap Anda</h3>
                                <p class="mt-1 text-sm">Foto dengan wajah yang sudah ditukar akan muncul di sini</p>
                                <div class="mt-4 p-4 bg-orange-50 rounded-lg max-w-md">
                                    <p class="text-xs text-orange-700">
                                        <i class="fas fa-lightbulb mr-1"></i>
                                        <strong>Tips:</strong> Gunakan foto dengan pencahayaan yang baik dan sudut wajah yang mirip untuk hasil terbaik. AI akan menjaga kualitas dan kealamian hasil swap.
                                    </p>
                                </div>
                            </div>

                            <!-- Results Container -->
                            <div id="faceswap-results-container" class="hidden flex flex-col gap-4">
                                <div class="flex items-center justify-between">
                                    <h3 class="font-semibold text-lg text-slate-600">
                                        <i class="fas fa-sparkles mr-2" style="color: #f97316;"></i>
                                        üòä Hasil Face Swap ‚ú®
                                    </h3>
                                    <button id="faceswap-download-all-btn" class="hidden bg-gradient-to-r from-orange-500 to-orange-600 text-white text-sm font-semibold px-4 py-2 rounded-lg hover:from-orange-600 hover:to-orange-700 transition-all shadow-md hover:shadow-lg flex items-center gap-2">
                                        <i class="fas fa-download"></i>
                                        <span>Download Semua</span>
                                    </button>
                                </div>
                                <div id="faceswap-results-grid" class="grid grid-cols-1 sm:grid-cols-2 gap-4 max-h-[70vh] md:max-h-96 overflow-y-auto" style="-webkit-overflow-scrolling: touch;"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- TAB: BACKGROUND REMOVER -->
        <div id="content-bg-remover" class="main-content-panel hidden">
            <div class="container mx-auto max-w-7xl">
                <header class="text-center mb-8">
                    <h1 class="text-4xl md:text-5xl font-bold mb-3" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">
                        <i class="fas fa-scissors mr-3"></i>Hapus Background
                    </h1>
                    <p class="text-lg text-gray-600">
                        Hapus background dari foto secara otomatis dengan AI! Pilih background baru atau biarkan transparan untuk hasil profesional.
                    </p>
                </header>

                <div class="flex flex-col lg:flex-row gap-8 w-full">
                    <!-- Left Panel: Controls -->
                    <div class="w-full lg:w-5/12 flex-shrink-0">
                        <div class="card p-6 sticky top-6">
                            <div class="flex flex-col gap-5">
                                <!-- Step 1: Upload Photo -->
                                <div>
                                    <div class="flex items-center gap-2 mb-3">
                                        <div class="flex items-center justify-center w-8 h-8 rounded-full bg-gradient-to-br from-emerald-500 to-emerald-600 text-white font-bold text-sm shadow-lg">1</div>
                                        <h3 class="text-base font-semibold text-gray-800">Unggah Foto</h3>
                                    </div>
                                    <label for="bgremover-input" id="bgremover-upload-box" class="upload-box-bgremover w-full h-56 sm:h-64 rounded-xl flex items-center justify-center cursor-pointer relative overflow-hidden border-2 border-dashed border-gray-300">
                                        <div id="bgremover-placeholder" class="text-center text-gray-500 p-4">
                                            <i class="fas fa-image transition-transform duration-300" style="font-size: 3.5rem; color: #10b981;"></i>
                                            <p class="mt-3 text-sm md:text-base font-semibold">üì∏ Klik atau seret foto</p>
                                            <p class="mt-1 text-xs text-gray-400">PNG, JPG, HEIC (Max 10MB)</p>
                                        </div>
                                        <img id="bgremover-preview" class="hidden absolute top-0 left-0 w-full h-full object-cover" alt="Preview">
                                        <button type="button" id="bgremover-remove-btn" class="hidden absolute top-2 right-2 bg-red-600 text-white rounded-full w-8 h-8 flex items-center justify-center hover:bg-red-700 z-10 shadow-lg transition-transform hover:scale-110">
                                            <i class="fas fa-times"></i>
                                        </button>
                                    </label>
                                    <input type="file" id="bgremover-input" class="hidden" accept="image/png, image/jpeg, image/webp, .heic, .HEIC">
                                </div>

                                <!-- Step 2: Background Type -->
                                <div>
                                    <div class="flex items-center gap-2 mb-3">
                                        <div class="flex items-center justify-center w-8 h-8 rounded-full bg-gradient-to-br from-emerald-500 to-emerald-600 text-white font-bold text-sm shadow-lg">2</div>
                                        <h3 class="text-base font-semibold text-gray-800">Pilih Background Baru</h3>
                                    </div>
                                    <div id="bgremover-bg-options" class="grid grid-cols-2 sm:grid-cols-3 gap-3">
                                        <button type="button" data-value="transparent" class="option-btn-bgremover selected">
                                            <i class="fas fa-layer-group mr-1"></i>Transparan
                                        </button>
                                        <button type="button" data-value="blur" class="option-btn-bgremover">
                                            <i class="fas fa-circle-notch mr-1"></i>Blur
                                        </button>
                                        <button type="button" data-value="white" class="option-btn-bgremover">
                                            <i class="fas fa-square mr-1"></i>Putih
                                        </button>
                                        <button type="button" data-value="black" class="option-btn-bgremover">
                                            <i class="fas fa-square mr-1" style="color: #000;"></i>Hitam
                                        </button>
                                        <button type="button" data-value="gradient-blue" class="option-btn-bgremover">
                                            <i class="fas fa-fill-drip mr-1"></i>Biru
                                        </button>
                                        <button type="button" data-value="gradient-purple" class="option-btn-bgremover">
                                            <i class="fas fa-fill-drip mr-1"></i>Ungu
                                        </button>
                                        <button type="button" data-value="custom" class="option-btn-bgremover">
                                            <i class="fas fa-edit mr-1"></i>Kustom
                                        </button>
                                    </div>

                                    <!-- Custom Background Input -->
                                    <div id="bgremover-custom-container" class="hidden mt-4">
                                        <label class="block text-sm font-semibold text-gray-700 mb-2">‚ú® Deskripsikan Background:</label>
                                        <input type="text" id="bgremover-custom-input" class="w-full p-3 rounded-lg border-2 border-gray-300 focus:border-emerald-500 focus:ring-2 focus:ring-emerald-200 transition-all" placeholder="Contoh: studio putih profesional, gradient pink soft, ruangan modern...">
                                        <p class="text-xs text-gray-500 mt-2">üí° Deskripsikan background yang Anda inginkan</p>
                                    </div>
                                </div>

                                <!-- Step 3: Aspect Ratio -->
                                <div>
                                    <div class="flex items-center gap-2 mb-3">
                                        <div class="flex items-center justify-center w-8 h-8 rounded-full bg-gradient-to-br from-emerald-500 to-emerald-600 text-white font-bold text-sm shadow-lg">3</div>
                                        <h3 class="text-base font-semibold text-gray-800">Aspek Rasio</h3>
                                    </div>
                                    <div id="bgremover-ratio-options" class="grid grid-cols-2 sm:grid-cols-4 gap-3">
                                        <button type="button" data-value="1:1" class="option-btn-bgremover selected">
                                            <i class="fas fa-square mr-1"></i>1:1
                                        </button>
                                        <button type="button" data-value="3:4" class="option-btn-bgremover">
                                            <i class="fas fa-rectangle-portrait mr-1"></i>3:4
                                        </button>
                                        <button type="button" data-value="4:5" class="option-btn-bgremover">
                                            <i class="fas fa-mobile-alt mr-1"></i>4:5
                                        </button>
                                        <button type="button" data-value="9:16" class="option-btn-bgremover">
                                            <i class="fas fa-mobile mr-1"></i>9:16
                                        </button>
                                    </div>
                                </div>

                                <!-- Step 4: Number of Variations -->
                                <div>
                                    <div class="flex items-center gap-2 mb-3">
                                        <div class="flex items-center justify-center w-8 h-8 rounded-full bg-gradient-to-br from-emerald-500 to-emerald-600 text-white font-bold text-sm shadow-lg">4</div>
                                        <h3 class="text-base font-semibold text-gray-800">Jumlah Variasi</h3>
                                    </div>
                                    <div id="bgremover-count-options" class="grid grid-cols-3 gap-3">
                                        <button type="button" data-value="3" class="option-btn-bgremover">3 Variasi</button>
                                        <button type="button" data-value="4" class="option-btn-bgremover selected">4 Variasi</button>
                                        <button type="button" data-value="6" class="option-btn-bgremover">6 Variasi</button>
                                    </div>
                                </div>

                                <!-- Generate Button -->
                                <button id="bgremover-generate-btn" class="w-full text-white font-bold py-4 px-6 rounded-xl flex items-center justify-center text-lg shadow-lg hover:shadow-xl hover:-translate-y-1 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:translate-y-0" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%);" disabled>
                                    <i class="fas fa-wand-magic-sparkles mr-2"></i>
                                    <span>Hapus Background</span>
                                </button>

                                <div class="text-center text-xs text-gray-500 mt-2">
                                    ‚ö° Proses memerlukan waktu 15-30 detik per variasi
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Right Panel: Results -->
                    <div class="w-full lg:w-7/12 flex flex-col">
                        <div class="card p-6 h-full flex flex-col">
                            <!-- Placeholder -->
                            <div id="bgremover-results-placeholder" class="flex flex-grow flex-col items-center justify-center text-center text-slate-500">
                                <i class="fas fa-scissors" style="font-size: 4rem; color: #a7f3d0; margin-bottom: 1rem;"></i>
                                <h3 class="font-semibold text-lg text-slate-600">Hasil Hapus Background</h3>
                                <p class="mt-1 text-sm">Foto dengan background baru akan muncul di sini</p>
                                <div class="mt-4 p-4 bg-emerald-50 rounded-lg max-w-md">
                                    <p class="text-xs text-emerald-700">
                                        <i class="fas fa-lightbulb mr-1"></i>
                                        <strong>Tips:</strong> Gunakan foto dengan subjek yang jelas dan kontras dengan background untuk hasil terbaik. AI akan otomatis mendeteksi dan menghapus background.
                                    </p>
                                </div>
                            </div>

                            <!-- Results Container -->
                            <div id="bgremover-results-container" class="hidden flex flex-col gap-4">
                                <div class="flex items-center justify-between">
                                    <h3 class="font-semibold text-lg text-slate-600">
                                        <i class="fas fa-sparkles mr-2" style="color: #10b981;"></i>
                                        ‚ú® Hasil Background Removal ‚ú®
                                    </h3>
                                    <button id="bgremover-download-all-btn" class="hidden bg-gradient-to-r from-emerald-500 to-emerald-600 text-white text-sm font-semibold px-4 py-2 rounded-lg hover:from-emerald-600 hover:to-emerald-700 transition-all shadow-md hover:shadow-lg flex items-center gap-2">
                                        <i class="fas fa-download"></i>
                                        <span>Download Semua</span>
                                    </button>
                                </div>
                                <div id="bgremover-results-grid" class="grid grid-cols-1 sm:grid-cols-2 gap-4 max-h-[70vh] md:max-h-96 overflow-y-auto" style="-webkit-overflow-scrolling: touch;"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- TAB: PHOTO EXTENDER -->
        <div id="content-photo-extender" class="main-content-panel hidden">
            <div class="container mx-auto max-w-7xl">
                <header class="text-center mb-8">
                    <h1 class="text-4xl md:text-5xl font-bold mb-3" style="background: linear-gradient(135deg, #0ea5e9 0%, #0284c7 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">
                        <i class="fas fa-expand-arrows-alt mr-3"></i>Perluas Foto
                    </h1>
                    <p class="text-lg text-gray-600">
                        Perluas foto keluar dari frame aslinya! Extend background, ubah aspect ratio, atau lengkapi foto yang terpotong dengan AI.
                    </p>
                </header>

                <div class="flex flex-col lg:flex-row gap-8 w-full">
                    <!-- Left Panel: Controls -->
                    <div class="w-full lg:w-5/12 flex-shrink-0">
                        <div class="card p-6 sticky top-6">
                            <div class="flex flex-col gap-5">
                                <!-- Step 1: Upload Photo -->
                                <div>
                                    <div class="flex items-center gap-2 mb-3">
                                        <div class="flex items-center justify-center w-8 h-8 rounded-full bg-gradient-to-br from-sky-500 to-sky-600 text-white font-bold text-sm shadow-lg">1</div>
                                        <h3 class="text-base font-semibold text-gray-800">Unggah Foto</h3>
                                    </div>
                                    <label for="extender-input" id="extender-upload-box" class="upload-box-extender w-full h-56 sm:h-64 rounded-xl flex items-center justify-center cursor-pointer relative overflow-hidden border-2 border-dashed border-gray-300">
                                        <div id="extender-placeholder" class="text-center text-gray-500 p-4">
                                            <i class="fas fa-image transition-transform duration-300" style="font-size: 3.5rem; color: #0ea5e9;"></i>
                                            <p class="mt-3 text-sm md:text-base font-semibold">üì∏ Klik atau seret foto</p>
                                            <p class="mt-1 text-xs text-gray-400">PNG, JPG, HEIC (Max 10MB)</p>
                                        </div>
                                        <img id="extender-preview" class="hidden absolute top-0 left-0 w-full h-full object-cover" alt="Preview">
                                        <button type="button" id="extender-remove-btn" class="hidden absolute top-2 right-2 bg-red-600 text-white rounded-full w-8 h-8 flex items-center justify-center hover:bg-red-700 z-10 shadow-lg transition-transform hover:scale-110">
                                            <i class="fas fa-times"></i>
                                        </button>
                                    </label>
                                    <input type="file" id="extender-input" class="hidden" accept="image/png, image/jpeg, image/webp, .heic, .HEIC">

                                    <!-- Mobile-only preview (hidden on desktop) -->
                                    <div id="extender-preview-container" class="mt-3 hidden lg:hidden">
                                        <img id="extender-image-preview" src="" alt="Preview" class="w-full rounded-lg shadow-lg max-h-48 object-cover">
                                        <button id="extender-remove-preview" class="mt-2 w-full bg-red-600 hover:bg-red-700 text-white text-sm py-2 px-3 rounded-lg transition-colors">
                                            <i class="fas fa-times mr-1"></i> Hapus Foto
                                        </button>
                                    </div>
                                </div>

                                <!-- Step 2: Extension Direction -->
                                <div>
                                    <div class="flex items-center gap-2 mb-3">
                                        <div class="flex items-center justify-center w-8 h-8 rounded-full bg-gradient-to-br from-sky-500 to-sky-600 text-white font-bold text-sm shadow-lg">2</div>
                                        <h3 class="text-base font-semibold text-gray-800">Arah Perluasan</h3>
                                    </div>
                                    <div id="extender-direction-options" class="grid grid-cols-2 sm:grid-cols-4 gap-3">
                                        <button type="button" data-value="all" class="option-btn-extender selected">
                                            <i class="fas fa-expand mr-1"></i>Semua
                                        </button>
                                        <button type="button" data-value="horizontal" class="option-btn-extender">
                                            <i class="fas fa-arrows-left-right mr-1"></i>Horizontal
                                        </button>
                                        <button type="button" data-value="vertical" class="option-btn-extender">
                                            <i class="fas fa-arrows-up-down mr-1"></i>Vertikal
                                        </button>
                                        <button type="button" data-value="left" class="option-btn-extender">
                                            <i class="fas fa-arrow-left mr-1"></i>Kiri
                                        </button>
                                        <button type="button" data-value="right" class="option-btn-extender">
                                            <i class="fas fa-arrow-right mr-1"></i>Kanan
                                        </button>
                                        <button type="button" data-value="top" class="option-btn-extender">
                                            <i class="fas fa-arrow-up mr-1"></i>Atas
                                        </button>
                                        <button type="button" data-value="bottom" class="option-btn-extender">
                                            <i class="fas fa-arrow-down mr-1"></i>Bawah
                                        </button>
                                    </div>
                                </div>

                                <!-- Step 3: Target Aspect Ratio -->
                                <div>
                                    <div class="flex items-center gap-2 mb-3">
                                        <div class="flex items-center justify-center w-8 h-8 rounded-full bg-gradient-to-br from-sky-500 to-sky-600 text-white font-bold text-sm shadow-lg">3</div>
                                        <h3 class="text-base font-semibold text-gray-800">Aspek Rasio Target</h3>
                                    </div>
                                    <div id="extender-ratio-options" class="grid grid-cols-2 sm:grid-cols-4 gap-3">
                                        <button type="button" data-value="1:1" class="option-btn-extender">
                                            <i class="fas fa-square mr-1"></i>1:1
                                        </button>
                                        <button type="button" data-value="16:9" class="option-btn-extender selected">
                                            <i class="fas fa-rectangle-landscape mr-1"></i>16:9
                                        </button>
                                        <button type="button" data-value="9:16" class="option-btn-extender">
                                            <i class="fas fa-mobile mr-1"></i>9:16
                                        </button>
                                        <button type="button" data-value="4:3" class="option-btn-extender">
                                            <i class="fas fa-tv mr-1"></i>4:3
                                        </button>
                                    </div>
                                </div>

                                <!-- Step 4: Number of Variations -->
                                <div>
                                    <div class="flex items-center gap-2 mb-3">
                                        <div class="flex items-center justify-center w-8 h-8 rounded-full bg-gradient-to-br from-sky-500 to-sky-600 text-white font-bold text-sm shadow-lg">4</div>
                                        <h3 class="text-base font-semibold text-gray-800">Jumlah Variasi</h3>
                                    </div>
                                    <div id="extender-count-options" class="grid grid-cols-3 gap-3">
                                        <button type="button" data-value="3" class="option-btn-extender">3 Variasi</button>
                                        <button type="button" data-value="4" class="option-btn-extender selected">4 Variasi</button>
                                        <button type="button" data-value="6" class="option-btn-extender">6 Variasi</button>
                                    </div>
                                </div>

                                <!-- Generate Button -->
                                <button id="extender-generate-btn" class="w-full text-white font-bold py-4 px-6 rounded-xl flex items-center justify-center text-lg shadow-lg hover:shadow-xl hover:-translate-y-1 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:translate-y-0" style="background: linear-gradient(135deg, #0ea5e9 0%, #0284c7 100%);" disabled>
                                    <i class="fas fa-wand-magic-sparkles mr-2"></i>
                                    <span>Perluas Foto</span>
                                </button>

                                <div class="text-center text-xs text-gray-500 mt-2">
                                    ‚ö° Proses memerlukan waktu 20-40 detik per variasi
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Right Panel: Results -->
                    <div class="w-full lg:w-7/12 flex flex-col">
                        <div class="card p-6 h-full flex flex-col">
                            <!-- Placeholder -->
                            <div id="extender-results-placeholder" class="flex flex-grow flex-col items-center justify-center text-center text-slate-500">
                                <i class="fas fa-expand-arrows-alt" style="font-size: 4rem; color: #bae6fd; margin-bottom: 1rem;"></i>
                                <h3 class="font-semibold text-lg text-slate-600">Hasil Perluas Foto</h3>
                                <p class="mt-1 text-sm">Foto yang sudah diperluas akan muncul di sini</p>
                                <div class="mt-4 p-4 bg-sky-50 rounded-lg max-w-md">
                                    <p class="text-xs text-sky-700">
                                        <i class="fas fa-lightbulb mr-1"></i>
                                        <strong>Tips:</strong> AI akan memperluas foto secara natural dengan melanjutkan background, objek, dan atmosfer dari foto asli. Hasilnya seamless dan photorealistic!
                                    </p>
                                </div>
                            </div>

                            <!-- Results Container -->
                            <div id="extender-results-container" class="hidden flex flex-col gap-4">
                                <div class="flex items-center justify-between">
                                    <h3 class="font-semibold text-lg text-slate-600">
                                        <i class="fas fa-sparkles mr-2" style="color: #0ea5e9;"></i>
                                        ‚ú® Hasil Perluasan Foto ‚ú®
                                    </h3>
                                    <button id="extender-download-all-btn" class="hidden bg-gradient-to-r from-sky-500 to-sky-600 text-white text-sm font-semibold px-4 py-2 rounded-lg hover:from-sky-600 hover:to-sky-700 transition-all shadow-md hover:shadow-lg flex items-center gap-2">
                                        <i class="fas fa-download"></i>
                                        <span>Download Semua</span>
                                    </button>
                                </div>
                                <div id="extender-results-grid" class="grid grid-cols-1 sm:grid-cols-2 gap-4 max-h-[70vh] md:max-h-96 overflow-y-auto" style="-webkit-overflow-scrolling: touch;"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- TAB: STORY BOARD -->
        <div id="content-story-board" class="main-content-panel hidden">
            <div class="container mx-auto max-w-7xl">
                <header class="text-center mb-8">
                    <h1 class="text-4xl md:text-5xl font-bold mb-3 bg-gradient-to-r from-purple-600 to-violet-600 bg-clip-text text-transparent">
                        <i class="fas fa-film mr-3 text-purple-600"></i>Story Board Generator
                    </h1>
                    <p class="text-lg text-gray-600">
                        Buat storyboard visual profesional untuk video, film, presentasi, campaign, dan berbagai konten kreatif!
                    </p>
                </header>

                <div class="flex flex-col lg:flex-row gap-8 w-full">
                    <!-- Left Panel: Controls -->
                    <div class="w-full lg:w-5/12 flex-shrink-0">
                        <div class="card p-6 sticky top-6 max-h-[calc(100vh-3rem)] overflow-y-auto">
                            <div class="flex flex-col gap-5">
                                <!-- Step 1: Story Topic -->
                                <div>
                                    <div class="flex items-center gap-3 mb-3">
                                        <div class="flex items-center justify-center w-8 h-8 rounded-full bg-gradient-to-br from-purple-500 to-violet-600 text-white font-bold text-sm shadow-lg">1</div>
                                        <h3 class="text-lg font-bold text-gray-800">Topik Story</h3>
                                    </div>
                                    <textarea
                                        id="storyboard-topic"
                                        placeholder="Contoh: Tutorial membuat kopi latte, Campaign launching produk baru, Behind the scenes proses produksi, dll."
                                        class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-purple-500 focus:outline-none text-sm resize-none"
                                        rows="3"
                                    ></textarea>
                                </div>

                                <!-- Step 2: Story Type -->
                                <div>
                                    <div class="flex items-center gap-3 mb-3">
                                        <div class="flex items-center justify-center w-8 h-8 rounded-full bg-gradient-to-br from-purple-500 to-violet-600 text-white font-bold text-sm shadow-lg">2</div>
                                        <h3 class="text-lg font-bold text-gray-800">Tipe Story</h3>
                                    </div>
                                    <div class="grid grid-cols-2 gap-2">
                                        <button data-value="social-media" class="option-btn-storyboard selected text-sm">
                                            <i class="fas fa-share-alt mr-2"></i>Social Media
                                        </button>
                                        <button data-value="video-content" class="option-btn-storyboard text-sm">
                                            <i class="fas fa-video mr-2"></i>Video Content
                                        </button>
                                        <button data-value="film-scene" class="option-btn-storyboard text-sm">
                                            <i class="fas fa-clapperboard mr-2"></i>Film Scene
                                        </button>
                                        <button data-value="tutorial" class="option-btn-storyboard text-sm">
                                            <i class="fas fa-graduation-cap mr-2"></i>Tutorial
                                        </button>
                                        <button data-value="marketing" class="option-btn-storyboard text-sm">
                                            <i class="fas fa-bullhorn mr-2"></i>Marketing
                                        </button>
                                        <button data-value="product-demo" class="option-btn-storyboard text-sm">
                                            <i class="fas fa-box-open mr-2"></i>Product Demo
                                        </button>
                                        <button data-value="event" class="option-btn-storyboard text-sm">
                                            <i class="fas fa-calendar-alt mr-2"></i>Event Coverage
                                        </button>
                                        <button data-value="animation" class="option-btn-storyboard text-sm">
                                            <i class="fas fa-magic mr-2"></i>Animation
                                        </button>
                                    </div>
                                </div>

                                <!-- Step 3: Number of Frames -->
                                <div>
                                    <div class="flex items-center gap-3 mb-3">
                                        <div class="flex items-center justify-center w-8 h-8 rounded-full bg-gradient-to-br from-purple-500 to-violet-600 text-white font-bold text-sm shadow-lg">3</div>
                                        <h3 class="text-lg font-bold text-gray-800">Jumlah Frame</h3>
                                    </div>
                                    <div class="grid grid-cols-3 gap-2">
                                        <button data-value="5" class="option-btn-storyboard selected">
                                            <i class="fas fa-th-large mr-2"></i>5 Frame
                                        </button>
                                        <button data-value="10" class="option-btn-storyboard">
                                            <i class="fas fa-th mr-2"></i>10 Frame
                                        </button>
                                        <button data-value="20" class="option-btn-storyboard">
                                            <i class="fas fa-grip-horizontal mr-2"></i>20 Frame
                                        </button>
                                    </div>
                                </div>

                                <!-- Step 4: Visual Style -->
                                <div>
                                    <div class="flex items-center gap-3 mb-3">
                                        <div class="flex items-center justify-center w-8 h-8 rounded-full bg-gradient-to-br from-purple-500 to-violet-600 text-white font-bold text-sm shadow-lg">4</div>
                                        <h3 class="text-lg font-bold text-gray-800">Style Visual</h3>
                                    </div>
                                    <div class="grid grid-cols-2 gap-2">
                                        <button data-value="sketch" class="option-btn-storyboard selected text-sm">
                                            <i class="fas fa-pencil mr-2"></i>Sketch
                                        </button>
                                        <button data-value="realistic" class="option-btn-storyboard text-sm">
                                            <i class="fas fa-camera mr-2"></i>Realistic
                                        </button>
                                        <button data-value="cartoon" class="option-btn-storyboard text-sm">
                                            <i class="fas fa-palette mr-2"></i>Cartoon
                                        </button>
                                        <button data-value="minimalist" class="option-btn-storyboard text-sm">
                                            <i class="fas fa-circle mr-2"></i>Minimalist
                                        </button>
                                        <button data-value="cinematic" class="option-btn-storyboard text-sm">
                                            <i class="fas fa-film mr-2"></i>Cinematic
                                        </button>
                                        <button data-value="comic" class="option-btn-storyboard text-sm">
                                            <i class="fas fa-book mr-2"></i>Comic Style
                                        </button>
                                    </div>
                                </div>

                                <!-- Step 5: Language -->
                                <div>
                                    <div class="flex items-center gap-3 mb-3">
                                        <div class="flex items-center justify-center w-8 h-8 rounded-full bg-gradient-to-br from-purple-500 to-violet-600 text-white font-bold text-sm shadow-lg">5</div>
                                        <h3 class="text-lg font-bold text-gray-800">Bahasa Deskripsi</h3>
                                    </div>
                                    <div class="grid grid-cols-2 gap-2">
                                        <button data-value="indonesian" class="option-btn-storyboard selected text-sm">
                                            <i class="fas fa-flag mr-2"></i>Bahasa Indonesia
                                        </button>
                                        <button data-value="english" class="option-btn-storyboard text-sm">
                                            <i class="fas fa-language mr-2"></i>English
                                        </button>
                                    </div>
                                </div>

                                <!-- Generate Button -->
                                <button
                                    id="storyboard-generate-btn"
                                    class="w-full bg-gradient-to-r from-purple-600 to-violet-600 hover:from-purple-700 hover:to-violet-700 text-white text-lg font-bold py-4 rounded-xl shadow-lg hover:shadow-xl transition-all duration-300 hover:scale-[1.02] active:scale-[0.98] flex items-center justify-center gap-2"
                                >
                                    <i class="fas fa-film"></i>
                                    <span>Generate Story Board</span>
                                </button>

                                <p class="text-xs text-gray-500 text-center">
                                    <i class="fas fa-info-circle mr-1"></i>
                                    Storyboard akan dibuat dengan AI untuk memvisualisasikan setiap scene
                                </p>
                            </div>
                        </div>
                    </div>

                    <!-- Right Panel: Results -->
                    <div class="w-full lg:w-7/12">
                        <div class="card p-6">
                            <div class="flex flex-col gap-4">
                                <div class="flex items-center justify-between">
                                    <h3 class="text-xl font-bold text-gray-800 flex items-center gap-2">
                                        <i class="fas fa-images text-purple-600"></i>
                                        Storyboard Frames
                                    </h3>
                                    <button id="storyboard-download-all-btn" class="hidden bg-gradient-to-r from-purple-500 to-violet-600 text-white text-sm font-semibold px-4 py-2 rounded-lg hover:from-purple-600 hover:to-violet-700 transition-all shadow-md hover:shadow-lg flex items-center gap-2">
                                        <i class="fas fa-download"></i>
                                        <span>Download Semua</span>
                                    </button>
                                </div>
                                <div id="storyboard-results-grid" class="grid grid-cols-1 sm:grid-cols-2 gap-4 max-h-[70vh] md:max-h-96 overflow-y-auto" style="-webkit-overflow-scrolling: touch;"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Regenerate Modal -->
                <div id="storyboard-regenerate-modal" class="hidden fixed inset-0 bg-black/50 z-[9999] flex items-center justify-center p-4" style="backdrop-filter: blur(4px);">
                    <div class="bg-white rounded-2xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
                        <div class="sticky top-0 bg-gradient-to-r from-purple-600 to-violet-600 text-white p-6 rounded-t-2xl">
                            <div class="flex items-center justify-between">
                                <div>
                                    <h3 class="text-xl font-bold flex items-center gap-2">
                                        <i class="fas fa-edit"></i>
                                        Edit & Regenerate Frame
                                    </h3>
                                    <p class="text-sm text-purple-100 mt-1">Ubah deskripsi scene untuk hasil yang lebih sesuai</p>
                                </div>
                                <button id="storyboard-modal-close" class="text-white hover:bg-white/20 w-8 h-8 rounded-full transition-colors flex items-center justify-center">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                        </div>

                        <div class="p-6 space-y-4">
                            <!-- Frame Info -->
                            <div class="bg-purple-50 border-2 border-purple-200 rounded-xl p-4">
                                <div class="flex items-center gap-3 mb-2">
                                    <div id="storyboard-modal-frame-number" class="w-10 h-10 rounded-full bg-gradient-to-br from-purple-500 to-violet-600 text-white font-bold text-lg flex items-center justify-center shadow-lg">1</div>
                                    <div>
                                        <h4 class="font-bold text-gray-800">Frame <span id="storyboard-modal-frame-text">1</span></h4>
                                        <p class="text-xs text-gray-600">Deskripsi scene akan digunakan untuk generate gambar</p>
                                    </div>
                                </div>
                            </div>

                            <!-- Current Image Preview (if exists) -->
                            <div id="storyboard-modal-preview-container" class="hidden">
                                <label class="text-sm font-semibold text-gray-700 mb-2 block">Gambar Saat Ini:</label>
                                <div class="relative rounded-xl overflow-hidden border-2 border-gray-200">
                                    <img id="storyboard-modal-preview-img" src="" alt="Current frame" class="w-full h-auto">
                                </div>
                            </div>

                            <!-- Prompt Editor -->
                            <div>
                                <label class="text-sm font-semibold text-gray-700 mb-2 flex items-center gap-2">
                                    <i class="fas fa-pen text-purple-600"></i>
                                    Deskripsi Scene:
                                </label>
                                <textarea
                                    id="storyboard-modal-prompt"
                                    rows="6"
                                    class="w-full border-2 border-gray-300 rounded-xl px-4 py-3 focus:border-purple-500 focus:ring-2 focus:ring-purple-200 transition-all resize-none"
                                    placeholder="Tulis deskripsi visual scene (camera angle, subject, action, background, mood)..."
                                ></textarea>
                                <p class="text-xs text-gray-500 mt-2">
                                    <i class="fas fa-info-circle mr-1"></i>
                                    Tips: Sertakan detail visual seperti camera angle, ekspresi, pencahayaan, dan suasana
                                </p>
                            </div>

                            <!-- Action Buttons -->
                            <div class="flex gap-3 pt-4">
                                <button id="storyboard-modal-cancel" class="flex-1 bg-gray-100 hover:bg-gray-200 text-gray-700 font-semibold py-3 px-6 rounded-xl transition-all">
                                    <i class="fas fa-times mr-2"></i>Batal
                                </button>
                                <button id="storyboard-modal-regenerate" class="flex-1 bg-gradient-to-r from-purple-600 to-violet-600 hover:from-purple-700 hover:to-violet-700 text-white font-bold py-3 px-6 rounded-xl shadow-lg hover:shadow-xl transition-all hover:scale-[1.02] active:scale-[0.98]">
                                    <i class="fas fa-sync-alt mr-2"></i>Regenerate Frame
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- TAB: TWIBON -->
        <div id="content-twibon" class="main-content-panel hidden">
            <div class="container mx-auto max-w-7xl">
                <header class="text-center mb-8">
                    <h1 class="text-4xl md:text-5xl font-bold mb-3 bg-gradient-to-r from-rose-600 to-pink-600 bg-clip-text text-transparent">
                        <i class="fas fa-image mr-3 text-rose-600"></i>Twibon Frame Generator
                    </h1>
                    <p class="text-lg text-gray-600">
                        Tambahkan frame/border profesional pada foto untuk kampanye, event, hari spesial, dan berbagai keperluan!
                    </p>
                </header>

                <div class="flex flex-col lg:flex-row gap-8 w-full">
                    <!-- Left Panel: Controls -->
                    <div class="w-full lg:w-5/12 flex-shrink-0">
                        <div class="card p-6 sticky top-6 max-h-[calc(100vh-3rem)] overflow-y-auto">
                            <div class="flex flex-col gap-5">
                                <!-- Step 1: Upload Photo -->
                                <div>
                                    <div class="flex items-center gap-3 mb-3">
                                        <div class="flex items-center justify-center w-8 h-8 rounded-full bg-gradient-to-br from-rose-500 to-pink-600 text-white font-bold text-sm shadow-lg">1</div>
                                        <h3 class="text-lg font-bold text-gray-800">Upload Foto</h3>
                                    </div>
                                    <div id="twibon-upload-box" class="upload-box-twibon cursor-pointer border-2 border-dashed border-rose-300 bg-gradient-to-br from-rose-50 to-pink-50 rounded-xl p-8 text-center hover:border-rose-400 transition-all">
                                        <input type="file" id="twibon-input" accept="image/png, image/jpeg, image/webp, image/heic, .heic" class="hidden">
                                        <div id="twibon-placeholder">
                                            <i class="fas fa-cloud-upload-alt text-5xl text-rose-400 mb-3"></i>
                                            <p class="text-gray-700 font-semibold mb-1">Klik untuk upload foto</p>
                                            <p class="text-sm text-gray-500">PNG, JPG, WEBP, HEIC (Max 10MB)</p>
                                        </div>
                                        <img id="twibon-preview" src="" alt="Preview" class="hidden max-w-full h-48 object-contain mx-auto rounded-lg">
                                    </div>
                                    <button id="twibon-remove-btn" class="hidden mt-3 w-full bg-red-500 hover:bg-red-600 text-white text-sm py-2 px-3 rounded-lg transition-colors flex items-center justify-center gap-2">
                                        <i class="fas fa-times"></i>
                                        <span>Hapus Foto</span>
                                    </button>
                                </div>

                                <!-- Step 2: Frame Category -->
                                <div>
                                    <div class="flex items-center gap-3 mb-3">
                                        <div class="flex items-center justify-center w-8 h-8 rounded-full bg-gradient-to-br from-rose-500 to-pink-600 text-white font-bold text-sm shadow-lg">2</div>
                                        <h3 class="text-lg font-bold text-gray-800">Kategori Frame</h3>
                                    </div>
                                    <div class="grid grid-cols-2 gap-2">
                                        <button data-value="independence" class="option-btn-twibon selected text-sm">
                                            <i class="fas fa-flag mr-2"></i>Kemerdekaan
                                        </button>
                                        <button data-value="holiday" class="option-btn-twibon text-sm">
                                            <i class="fas fa-calendar-day mr-2"></i>Hari Raya
                                        </button>
                                        <button data-value="birthday" class="option-btn-twibon text-sm">
                                            <i class="fas fa-birthday-cake mr-2"></i>Ulang Tahun
                                        </button>
                                        <button data-value="wedding" class="option-btn-twibon text-sm">
                                            <i class="fas fa-heart mr-2"></i>Pernikahan
                                        </button>
                                        <button data-value="graduation" class="option-btn-twibon text-sm">
                                            <i class="fas fa-graduation-cap mr-2"></i>Wisuda
                                        </button>
                                        <button data-value="campaign" class="option-btn-twibon text-sm">
                                            <i class="fas fa-bullhorn mr-2"></i>Kampanye
                                        </button>
                                        <button data-value="corporate" class="option-btn-twibon text-sm">
                                            <i class="fas fa-building mr-2"></i>Perusahaan
                                        </button>
                                        <button data-value="custom" class="option-btn-twibon text-sm">
                                            <i class="fas fa-pencil mr-2"></i>Custom
                                        </button>
                                    </div>
                                </div>

                                <!-- Step 3: Frame Description (for AI generation) -->
                                <div id="twibon-ai-section">
                                    <div class="flex items-center gap-3 mb-3">
                                        <div class="flex items-center justify-center w-8 h-8 rounded-full bg-gradient-to-br from-rose-500 to-pink-600 text-white font-bold text-sm shadow-lg">3</div>
                                        <h3 class="text-lg font-bold text-gray-800">Deskripsi Frame</h3>
                                    </div>
                                    <textarea
                                        id="twibon-description"
                                        placeholder="Contoh: Frame untuk HUT RI ke-79 dengan bendera merah putih, warna patriotik, dan teks 'Dirgahayu Indonesia'"
                                        class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-rose-500 focus:outline-none text-sm resize-none"
                                        rows="3"
                                    ></textarea>
                                    <p class="text-xs text-gray-500 mt-2">
                                        <i class="fas fa-info-circle mr-1"></i>
                                        AI akan generate frame sesuai deskripsi Anda
                                    </p>
                                </div>

                                <!-- Step 3: Upload Custom Frame -->
                                <div id="twibon-custom-section" class="hidden">
                                    <div class="flex items-center gap-3 mb-3">
                                        <div class="flex items-center justify-center w-8 h-8 rounded-full bg-gradient-to-br from-rose-500 to-pink-600 text-white font-bold text-sm shadow-lg">3</div>
                                        <h3 class="text-lg font-bold text-gray-800">Upload Frame Custom</h3>
                                    </div>
                                    <div id="twibon-frame-upload-box" class="upload-box-twibon cursor-pointer border-2 border-dashed border-rose-300 bg-gradient-to-br from-rose-50 to-pink-50 rounded-xl p-6 text-center hover:border-rose-400 transition-all">
                                        <input type="file" id="twibon-frame-input" accept="image/png" class="hidden">
                                        <div id="twibon-frame-placeholder">
                                            <i class="fas fa-image text-4xl text-rose-400 mb-2"></i>
                                            <p class="text-gray-700 font-semibold mb-1 text-sm">Upload Frame PNG (Transparan)</p>
                                            <p class="text-xs text-gray-500">PNG dengan background transparan</p>
                                        </div>
                                        <img id="twibon-frame-preview" src="" alt="Frame Preview" class="hidden max-w-full h-32 object-contain mx-auto rounded-lg">
                                    </div>
                                </div>

                                <!-- Step 4: Frame Style -->
                                <div>
                                    <div class="flex items-center gap-3 mb-3">
                                        <div class="flex items-center justify-center w-8 h-8 rounded-full bg-gradient-to-br from-rose-500 to-pink-600 text-white font-bold text-sm shadow-lg">4</div>
                                        <h3 class="text-lg font-bold text-gray-800">Style Frame</h3>
                                    </div>
                                    <div class="grid grid-cols-2 gap-2">
                                        <button data-value="elegant" class="option-btn-twibon selected text-sm">
                                            <i class="fas fa-crown mr-2"></i>Elegant
                                        </button>
                                        <button data-value="modern" class="option-btn-twibon text-sm">
                                            <i class="fas fa-bolt mr-2"></i>Modern
                                        </button>
                                        <button data-value="minimalist" class="option-btn-twibon text-sm">
                                            <i class="fas fa-circle mr-2"></i>Minimalist
                                        </button>
                                        <button data-value="colorful" class="option-btn-twibon text-sm">
                                            <i class="fas fa-palette mr-2"></i>Colorful
                                        </button>
                                    </div>
                                </div>

                                <!-- Step 5: Aspect Ratio -->
                                <div>
                                    <div class="flex items-center gap-3 mb-3">
                                        <div class="flex items-center justify-center w-8 h-8 rounded-full bg-gradient-to-br from-rose-500 to-pink-600 text-white font-bold text-sm shadow-lg">5</div>
                                        <h3 class="text-lg font-bold text-gray-800">Ukuran Frame</h3>
                                    </div>
                                    <div class="grid grid-cols-2 gap-2">
                                        <button data-value="1:1" class="option-btn-twibon selected text-sm">
                                            <i class="fas fa-square mr-2"></i>1:1
                                        </button>
                                        <button data-value="4:5" class="option-btn-twibon text-sm">
                                            <i class="fas fa-mobile-alt mr-2"></i>4:5
                                        </button>
                                        <button data-value="9:16" class="option-btn-twibon text-sm">
                                            <i class="fas fa-mobile mr-2"></i>9:16
                                        </button>
                                        <button data-value="16:9" class="option-btn-twibon text-sm">
                                            <i class="fas fa-desktop mr-2"></i>16:9
                                        </button>
                                    </div>
                                </div>

                                <!-- Step 6: Photo Position Controls -->
                                <div id="twibon-position-controls" class="hidden">
                                    <div class="flex items-center gap-3 mb-3">
                                        <div class="flex items-center justify-center w-8 h-8 rounded-full bg-gradient-to-br from-rose-500 to-pink-600 text-white font-bold text-sm shadow-lg">6</div>
                                        <h3 class="text-lg font-bold text-gray-800">Atur Posisi Foto</h3>
                                    </div>

                                    <!-- Zoom Slider -->
                                    <div class="mb-3">
                                        <label class="text-sm font-semibold text-gray-700 mb-2 flex items-center justify-between">
                                            <span><i class="fas fa-search-plus mr-1 text-rose-500"></i>Zoom Foto</span>
                                            <span id="twibon-zoom-value" class="text-rose-600">100%</span>
                                        </label>
                                        <input type="range" id="twibon-zoom-slider" min="50" max="200" value="100" step="5" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-rose-500">
                                    </div>

                                    <!-- Position Controls -->
                                    <div class="grid grid-cols-3 gap-2 mb-3">
                                        <button id="twibon-move-up" class="bg-gray-100 hover:bg-rose-100 text-gray-700 hover:text-rose-600 px-3 py-2 rounded-lg transition-colors text-sm font-semibold">
                                            <i class="fas fa-arrow-up"></i>
                                        </button>
                                        <div></div>
                                        <div></div>

                                        <button id="twibon-move-left" class="bg-gray-100 hover:bg-rose-100 text-gray-700 hover:text-rose-600 px-3 py-2 rounded-lg transition-colors text-sm font-semibold">
                                            <i class="fas fa-arrow-left"></i>
                                        </button>
                                        <button id="twibon-reset-position" class="bg-rose-500 hover:bg-rose-600 text-white px-3 py-2 rounded-lg transition-colors text-sm font-semibold">
                                            <i class="fas fa-redo mr-1"></i>Reset
                                        </button>
                                        <button id="twibon-move-right" class="bg-gray-100 hover:bg-rose-100 text-gray-700 hover:text-rose-600 px-3 py-2 rounded-lg transition-colors text-sm font-semibold">
                                            <i class="fas fa-arrow-right"></i>
                                        </button>

                                        <div></div>
                                        <button id="twibon-move-down" class="bg-gray-100 hover:bg-rose-100 text-gray-700 hover:text-rose-600 px-3 py-2 rounded-lg transition-colors text-sm font-semibold">
                                            <i class="fas fa-arrow-down"></i>
                                        </button>
                                        <div></div>
                                    </div>

                                    <p class="text-xs text-gray-500 text-center">
                                        <i class="fas fa-info-circle mr-1"></i>
                                        Atur posisi foto sebelum generate
                                    </p>
                                </div>

                                <!-- Generate Button -->
                                <button
                                    id="twibon-generate-btn"
                                    disabled
                                    class="w-full bg-gradient-to-r from-rose-600 to-pink-600 hover:from-rose-700 hover:to-pink-700 text-white text-lg font-bold py-4 rounded-xl shadow-lg hover:shadow-xl transition-all duration-300 hover:scale-[1.02] active:scale-[0.98] disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2"
                                >
                                    <i class="fas fa-magic"></i>
                                    <span>Generate Twibon</span>
                                </button>

                                <p class="text-xs text-gray-500 text-center">
                                    <i class="fas fa-info-circle mr-1"></i>
                                    Upload foto dan pilih kategori untuk mulai
                                </p>
                            </div>
                        </div>
                    </div>

                    <!-- Right Panel: Results -->
                    <div class="w-full lg:w-7/12">
                        <div class="card p-6">
                            <div class="flex flex-col gap-4">
                                <div class="flex items-center justify-between">
                                    <h3 class="text-xl font-bold text-gray-800 flex items-center gap-2">
                                        <i class="fas fa-image text-rose-600"></i>
                                        Preview & Download
                                    </h3>
                                </div>

                                <!-- Preview with Photo + Frame Overlay -->
                                <div id="twibon-preview-container" class="hidden">
                                    <div class="relative bg-gradient-to-br from-gray-50 to-gray-100 rounded-xl p-6 flex items-center justify-center min-h-[400px]">
                                        <div id="twibon-result-container" class="relative w-full max-w-[500px]" style="aspect-ratio: 1/1;">
                                            <!-- Background Photo -->
                                            <img id="twibon-photo-display" src="" alt="Your Photo" class="absolute inset-0 w-full h-full object-cover rounded-lg" crossorigin="anonymous">
                                            <!-- Frame Overlay -->
                                            <div id="twibon-frame-wrapper" class="absolute inset-0">
                                                <img id="twibon-frame-display" src="" alt="Frame" class="w-full h-full object-cover rounded-lg" crossorigin="anonymous">
                                            </div>
                                        </div>
                                        <!-- Hidden canvas for download -->
                                        <canvas id="twibon-canvas" class="hidden"></canvas>
                                    </div>

                                    <!-- Download Button -->
                                    <div class="mt-4 flex gap-3">
                                        <button id="twibon-download-btn" class="flex-1 bg-gradient-to-r from-rose-500 to-pink-600 text-white text-sm font-semibold px-6 py-3 rounded-lg hover:from-rose-600 hover:to-pink-700 transition-all shadow-md hover:shadow-lg flex items-center justify-center gap-2">
                                            <i class="fas fa-download"></i>
                                            <span>Download Twibon</span>
                                        </button>
                                        <button id="twibon-reset-btn" class="bg-gray-500 hover:bg-gray-600 text-white text-sm font-semibold px-6 py-3 rounded-lg transition-all shadow-md hover:shadow-lg flex items-center justify-center gap-2">
                                            <i class="fas fa-redo"></i>
                                            <span>Reset</span>
                                        </button>
                                    </div>
                                </div>

                                <!-- Empty State -->
                                <div id="twibon-empty-state" class="flex flex-col items-center justify-center py-16 text-center">
                                    <div class="w-32 h-32 bg-gradient-to-br from-rose-100 to-pink-100 rounded-full flex items-center justify-center mb-6">
                                        <i class="fas fa-image text-5xl text-rose-400"></i>
                                    </div>
                                    <h4 class="text-xl font-bold text-gray-800 mb-2">Belum Ada Preview</h4>
                                    <p class="text-gray-600 mb-4">Upload foto dan generate twibon untuk melihat preview</p>
                                    <div class="flex items-center gap-2 text-sm text-gray-500">
                                        <i class="fas fa-lightbulb text-rose-500"></i>
                                        <span>Pilih kategori dan buat frame yang sesuai kebutuhan Anda</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- TAB: PROFESSIONAL HEADSHOT -->
        <div id="content-professional-headshot" class="main-content-panel hidden">
            <div class="container mx-auto max-w-7xl">
                <header class="text-center mb-8">
                    <h1 class="text-4xl md:text-5xl font-bold mb-3">
                        <i class="fas fa-user-tie mr-3"></i>Professional Headshot Studio
                    </h1>
                    <p class="text-lg text-gray-600">
                        Buat foto headshot profesional untuk LinkedIn, CV, profil bisnis, dan berbagai kebutuhan profesional dengan AI canggih!
                    </p>
                </header>

                <div class="flex flex-col lg:flex-row gap-8 w-full">
                    <!-- Left Panel: Controls -->
                    <div class="w-full lg:w-5/12 flex-shrink-0">
                        <div class="card p-6 sticky top-6 max-h-[calc(100vh-3rem)] overflow-y-auto">
                            <div class="flex flex-col gap-5">
                                <!-- Step 1: Upload Photo -->
                                <div>
                                    <div class="flex items-center gap-2 mb-3">
                                        <div class="flex items-center justify-center w-8 h-8 rounded-full bg-gradient-to-br from-indigo-600 to-blue-700 text-white font-bold text-sm shadow-lg">1</div>
                                        <h3 class="text-base font-semibold text-gray-800">Unggah Foto Anda</h3>
                                    </div>
                                    <label for="headshot-input" id="headshot-upload-box" class="upload-box-headshot w-full h-56 sm:h-64 rounded-xl flex items-center justify-center cursor-pointer relative overflow-hidden border-2 border-dashed border-gray-300 transition-all duration-300 hover:border-indigo-600 hover:bg-gradient-to-br hover:from-indigo-50 hover:to-blue-50 hover:shadow-xl hover:-translate-y-1">
                                        <div id="headshot-placeholder" class="text-center text-gray-500 p-4">
                                            <i class="fas fa-user-tie transition-transform duration-300" style="font-size: 3.5rem; color: #4f46e5;"></i>
                                            <p class="mt-3 text-sm md:text-base font-semibold">üëî Klik atau seret foto Anda</p>
                                            <p class="mt-1 text-xs text-gray-400">PNG, JPG, HEIC (Max 10MB)</p>
                                        </div>
                                        <img id="headshot-preview" class="hidden absolute top-0 left-0 w-full h-full object-cover" alt="Preview">
                                        <button type="button" id="headshot-remove-btn" class="hidden absolute top-2 right-2 bg-red-600 text-white rounded-full w-8 h-8 flex items-center justify-center hover:bg-red-700 z-10 shadow-lg transition-transform hover:scale-110">
                                            <i class="fas fa-times"></i>
                                        </button>
                                    </label>
                                    <input type="file" id="headshot-input" class="hidden" accept="image/png, image/jpeg, image/webp, .heic, .HEIC">
                                </div>

                                <!-- Step 2: Choose Professional Theme -->
                                <div>
                                    <div class="flex items-center gap-2 mb-3">
                                        <div class="flex items-center justify-center w-8 h-8 rounded-full bg-gradient-to-br from-indigo-600 to-blue-700 text-white font-bold text-sm shadow-lg">2</div>
                                        <h3 class="text-base font-semibold text-gray-800">Pilih Tema Profesional</h3>
                                    </div>
                                    <div id="headshot-theme-options" class="grid grid-cols-2 sm:grid-cols-2 gap-3">
                                        <button type="button" data-value="LinkedIn Professional" class="option-btn-headshot selected">
                                            <i class="fab fa-linkedin mr-1"></i>LinkedIn Pro
                                        </button>
                                        <button type="button" data-value="Business Executive" class="option-btn-headshot">
                                            <i class="fas fa-briefcase mr-1"></i>Executive
                                        </button>
                                        <button type="button" data-value="Corporate Formal" class="option-btn-headshot">
                                            <i class="fas fa-building mr-1"></i>Corporate
                                        </button>
                                        <button type="button" data-value="Creative Professional" class="option-btn-headshot">
                                            <i class="fas fa-palette mr-1"></i>Creative
                                        </button>
                                        <button type="button" data-value="Tech Professional" class="option-btn-headshot">
                                            <i class="fas fa-laptop-code mr-1"></i>Tech
                                        </button>
                                        <button type="button" data-value="Medical Professional" class="option-btn-headshot">
                                            <i class="fas fa-user-doctor mr-1"></i>Medical
                                        </button>
                                        <button type="button" data-value="Legal Professional" class="option-btn-headshot">
                                            <i class="fas fa-scale-balanced mr-1"></i>Legal
                                        </button>
                                        <button type="button" data-value="Entrepreneur" class="option-btn-headshot">
                                            <i class="fas fa-rocket mr-1"></i>Entrepreneur
                                        </button>
                                        <button type="button" data-value="Academic" class="option-btn-headshot">
                                            <i class="fas fa-graduation-cap mr-1"></i>Academic
                                        </button>
                                        <button type="button" data-value="Smart Casual" class="option-btn-headshot">
                                            <i class="fas fa-shirt mr-1"></i>Smart Casual
                                        </button>
                                        <button type="button" data-value="Consultant" class="option-btn-headshot">
                                            <i class="fas fa-chart-line mr-1"></i>Consultant
                                        </button>
                                        <button type="button" data-value="Custom" class="option-btn-headshot">
                                            <i class="fas fa-edit mr-1"></i>Custom
                                        </button>
                                    </div>

                                    <!-- Custom Theme Input -->
                                    <div id="headshot-custom-theme-container" class="hidden mt-4">
                                        <label class="block text-sm font-semibold text-gray-700 mb-2">‚ú® Tema/Profesi Kustom:</label>
                                        <input type="text" id="headshot-custom-theme-input" class="w-full p-3 rounded-lg border-2 border-gray-300 focus:border-indigo-600 focus:ring-2 focus:ring-indigo-200 transition-all" placeholder="Contoh: Financial Advisor, Real Estate Agent, Designer...">
                                        <p class="text-xs text-gray-500 mt-2">üí° Sebutkan profesi atau gaya foto yang Anda inginkan</p>
                                    </div>
                                </div>

                                <!-- Step 3: Background Style -->
                                <div>
                                    <div class="flex items-center gap-2 mb-3">
                                        <div class="flex items-center justify-center w-8 h-8 rounded-full bg-gradient-to-br from-indigo-600 to-blue-700 text-white font-bold text-sm shadow-lg">3</div>
                                        <h3 class="text-base font-semibold text-gray-800">Background</h3>
                                    </div>
                                    <div id="headshot-bg-options" class="grid grid-cols-2 sm:grid-cols-3 gap-3">
                                        <button type="button" data-value="Studio White" class="option-btn-headshot selected">
                                            <span>‚ö™ White</span>
                                        </button>
                                        <button type="button" data-value="Professional Gray" class="option-btn-headshot">
                                            <span>‚ö´ Gray</span>
                                        </button>
                                        <button type="button" data-value="Navy Blue" class="option-btn-headshot">
                                            <span>üîµ Navy</span>
                                        </button>
                                        <button type="button" data-value="Gradient Blue" class="option-btn-headshot">
                                            <span>üíô Gradient</span>
                                        </button>
                                        <button type="button" data-value="Office Interior" class="option-btn-headshot">
                                            <span>üè¢ Office</span>
                                        </button>
                                        <button type="button" data-value="Outdoor Professional" class="option-btn-headshot">
                                            <span>üå≥ Outdoor</span>
                                        </button>
                                    </div>
                                </div>

                                <!-- Step 4: Attire Style -->
                                <div>
                                    <div class="flex items-center gap-2 mb-3">
                                        <div class="flex items-center justify-center w-8 h-8 rounded-full bg-gradient-to-br from-indigo-600 to-blue-700 text-white font-bold text-sm shadow-lg">4</div>
                                        <h3 class="text-base font-semibold text-gray-800">Pakaian</h3>
                                    </div>
                                    <div id="headshot-attire-options" class="grid grid-cols-2 sm:grid-cols-2 gap-3">
                                        <button type="button" data-value="Business Suit" class="option-btn-headshot selected">
                                            <span>üëî Suit</span>
                                        </button>
                                        <button type="button" data-value="Smart Casual Blazer" class="option-btn-headshot">
                                            <span>üß• Blazer</span>
                                        </button>
                                        <button type="button" data-value="Professional Shirt" class="option-btn-headshot">
                                            <span>üëï Shirt</span>
                                        </button>
                                        <button type="button" data-value="Industry Specific" class="option-btn-headshot">
                                            <span>üè• Industry</span>
                                        </button>
                                    </div>
                                </div>

                                <!-- Step 5: Photo Style -->
                                <div>
                                    <div class="flex items-center gap-2 mb-3">
                                        <div class="flex items-center justify-center w-8 h-8 rounded-full bg-gradient-to-br from-indigo-600 to-blue-700 text-white font-bold text-sm shadow-lg">5</div>
                                        <h3 class="text-base font-semibold text-gray-800">Gaya Foto</h3>
                                    </div>
                                    <div id="headshot-style-options" class="grid grid-cols-3 gap-3">
                                        <button type="button" data-value="Classic" class="option-btn-headshot selected">
                                            <span>Klasik</span>
                                        </button>
                                        <button type="button" data-value="Modern" class="option-btn-headshot">
                                            <span>Modern</span>
                                        </button>
                                        <button type="button" data-value="Cinematic" class="option-btn-headshot">
                                            <span>Sinematik</span>
                                        </button>
                                    </div>
                                </div>

                                <!-- Step 6: Aspect Ratio -->
                                <div>
                                    <div class="flex items-center gap-2 mb-3">
                                        <div class="flex items-center justify-center w-8 h-8 rounded-full bg-gradient-to-br from-indigo-600 to-blue-700 text-white font-bold text-sm shadow-lg">6</div>
                                        <h3 class="text-base font-semibold text-gray-800">Format</h3>
                                    </div>
                                    <div id="headshot-ratio-options" class="grid grid-cols-4 gap-3">
                                        <button type="button" data-value="1:1" class="option-btn-headshot">1:1</button>
                                        <button type="button" data-value="3:4" class="option-btn-headshot selected">3:4</button>
                                        <button type="button" data-value="4:5" class="option-btn-headshot">4:5</button>
                                        <button type="button" data-value="9:16" class="option-btn-headshot">9:16</button>
                                    </div>
                                </div>

                                <!-- Step 7: Number of Variations -->
                                <div>
                                    <div class="flex items-center gap-2 mb-3">
                                        <div class="flex items-center justify-center w-8 h-8 rounded-full bg-gradient-to-br from-indigo-600 to-blue-700 text-white font-bold text-sm shadow-lg">7</div>
                                        <h3 class="text-base font-semibold text-gray-800">Jumlah Variasi</h3>
                                    </div>
                                    <div id="headshot-count-options" class="grid grid-cols-3 gap-3">
                                        <button type="button" data-value="4" class="option-btn-headshot">4 Foto</button>
                                        <button type="button" data-value="6" class="option-btn-headshot selected">6 Foto</button>
                                        <button type="button" data-value="8" class="option-btn-headshot">8 Foto</button>
                                    </div>
                                </div>

                                <!-- Generate Button -->
                                <button id="headshot-generate-btn" class="w-full text-white font-bold py-4 px-6 rounded-xl flex items-center justify-center text-lg shadow-lg hover:shadow-xl hover:-translate-y-1 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:translate-y-0" style="background: linear-gradient(135deg, #4f46e5 0%, #1e40af 100%);" disabled>
                                    <i class="fas fa-camera-retro mr-2"></i>
                                    <span>Buat Headshot Profesional</span>
                                </button>

                                <div class="bg-gradient-to-r from-indigo-50 to-blue-50 p-4 rounded-lg border border-indigo-200">
                                    <p class="text-xs text-indigo-800">
                                        <i class="fas fa-lightbulb mr-1"></i>
                                        <strong>Tips:</strong> Gunakan foto close-up dengan pencahayaan baik. AI akan membuat foto headshot profesional dengan tema dan background yang Anda pilih.
                                    </p>
                                </div>

                                <div class="text-center text-xs text-gray-500 mt-2">
                                    ‚ö° Proses: ~20-30 detik per foto
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Right Panel: Results -->
                    <div class="w-full lg:w-7/12 flex flex-col">
                        <div class="card p-6 h-full flex flex-col">
                            <!-- Placeholder -->
                            <div id="headshot-results-placeholder" class="flex flex-grow flex-col items-center justify-center text-center text-slate-500">
                                <i class="fas fa-id-badge" style="font-size: 4rem; color: #cbd5e1; margin-bottom: 1rem;"></i>
                                <h3 class="font-semibold text-lg text-slate-600">Headshot Profesional Anda</h3>
                                <p class="mt-1 text-sm">Foto headshot profesional akan muncul di sini</p>
                                <div class="mt-6 grid grid-cols-1 md:grid-cols-2 gap-4 max-w-2xl">
                                    <div class="p-4 bg-gradient-to-br from-blue-50 to-indigo-50 rounded-lg border border-blue-200">
                                        <div class="flex items-start gap-3">
                                            <i class="fab fa-linkedin text-2xl text-blue-600 mt-1"></i>
                                            <div class="text-left">
                                                <h4 class="font-bold text-sm text-gray-800">LinkedIn Ready</h4>
                                                <p class="text-xs text-gray-600 mt-1">Perfect untuk profil profesional Anda</p>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="p-4 bg-gradient-to-br from-purple-50 to-pink-50 rounded-lg border border-purple-200">
                                        <div class="flex items-start gap-3">
                                            <i class="fas fa-briefcase text-2xl text-purple-600 mt-1"></i>
                                            <div class="text-left">
                                                <h4 class="font-bold text-sm text-gray-800">Business Ready</h4>
                                                <p class="text-xs text-gray-600 mt-1">Siap untuk CV dan portfolio</p>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="p-4 bg-gradient-to-br from-green-50 to-emerald-50 rounded-lg border border-green-200">
                                        <div class="flex items-start gap-3">
                                            <i class="fas fa-globe text-2xl text-green-600 mt-1"></i>
                                            <div class="text-left">
                                                <h4 class="font-bold text-sm text-gray-800">Website Ready</h4>
                                                <p class="text-xs text-gray-600 mt-1">Untuk profil tim dan company</p>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="p-4 bg-gradient-to-br from-orange-50 to-red-50 rounded-lg border border-orange-200">
                                        <div class="flex items-start gap-3">
                                            <i class="fas fa-user-tie text-2xl text-orange-600 mt-1"></i>
                                            <div class="text-left">
                                                <h4 class="font-bold text-sm text-gray-800">AI Enhanced</h4>
                                                <p class="text-xs text-gray-600 mt-1">Professional lighting & styling</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Results Container -->
                            <div id="headshot-results-container" class="hidden">
                                <!-- Results Header -->
                                <div class="flex flex-col md:flex-row items-center justify-between mb-6 bg-gradient-to-r from-indigo-50 to-blue-50 p-4 rounded-xl border-2 border-indigo-200">
                                    <h3 class="text-xl md:text-2xl font-bold text-gray-800">
                                        üëî Headshot Profesional Anda üì∏
                                    </h3>
                                    <button id="headshot-download-all-btn" class="mt-4 md:mt-0 bg-gradient-to-r from-indigo-600 to-blue-600 hover:from-indigo-700 hover:to-blue-700 text-white px-6 py-2 rounded-full font-semibold shadow-lg transition transform hover:scale-105 flex items-center gap-2">
                                        <i class="fas fa-download"></i>
                                        Download Semua
                                    </button>
                                </div>

                                <!-- Results Grid -->
                                <div id="headshot-results-grid" class="grid grid-cols-2 md:grid-cols-3 gap-4 md:gap-6"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- TAB: DESAIN RUMAH -->
        <div id="content-desain-rumah" class="main-content-panel hidden">
            <div class="container mx-auto max-w-7xl">
                <header class="text-center mb-8">
                    <h1 class="text-4xl md:text-5xl font-bold mb-3">
                        <i class="fas fa-home mr-3"></i>ReDesain Rumah
                    </h1>
                    <p class="text-lg text-gray-600">
                        Desain ulang ruangan interior atau renovasi eksterior rumah Anda dengan AI
                    </p>
                </header>

                <div class="mb-8 max-w-md mx-auto p-1.5 bg-slate-100 rounded-xl flex items-center justify-center gap-2 shadow-inner">
                    <button id="dr-tab-interior" class="option-btn-desain selected w-full text-center">
                        Interior
                    </button>
                    <button id="dr-tab-eksterior" class="option-btn-desain w-full text-center">
                        Eksterior
                        <span class="bg-red-500 text-white text-xs font-bold px-1.5 py-0.5 rounded-full ml-1">New</span>
                    </button>
                </div>

                <!-- INTERIOR TAB -->
                <div id="dr-content-interior">
                    <div class="mb-6 flex items-center gap-3 p-3 sm:p-4 rounded-xl border text-left" style="background: linear-gradient(to right, #E0F2FE, #E0F2FE); border-color: #0EA5E9; color: #0284C7;">
                        <div class="flex-shrink-0"><i class="fas fa-info-circle" style="color: #0EA5E9;"></i></div>
                        <p class="text-sm md:text-base">Unggah foto ruangan, tambahkan furnitur, pilih gaya, dan biarkan AI mendesain ulang ruangan Anda secara ajaib.</p>
                    </div>
                    <div class="mt-8 flex flex-col lg:flex-row gap-8 w-full">
                        <div class="w-full lg:w-5/12 flex-shrink-0">
                            <div class="card p-4 sm:p-6 sticky top-6">
                                <div class="flex flex-col gap-5">
                                    <div>
                                        <h3 class="text-base font-semibold mb-3 text-gray-800">1. Unggah Foto Ruangan</h3>
                                        <label for="dr-interior-room-input" id="dr-interior-room-upload-box" class="upload-box-desain w-full h-48 rounded-lg flex items-center justify-center cursor-pointer relative overflow-hidden border-2 border-dashed border-gray-300">
                                            <div id="dr-interior-room-placeholder" class="text-center text-gray-500 p-2">
                                                <i class="fas fa-door-open" style="font-size: 2.5rem;"></i>
                                                <p class="mt-2 text-sm">Klik atau seret foto</p>
                                            </div>
                                            <img id="dr-interior-room-preview" class="hidden absolute top-0 left-0 w-full h-full object-contain" alt="Pratinjau Ruangan">
                                            <button type="button" id="dr-interior-remove-room-btn" class="hidden absolute top-2 right-2 bg-red-600 text-white rounded-full p-1 hover:bg-red-700 z-10">
                                                <i class="fas fa-times"></i>
                                            </button>
                                        </label>
                                        <input type="file" id="dr-interior-room-input" class="hidden" accept="image/png, image/jpeg, image/webp, .heic, .HEIC">
                                    </div>
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <div>
                                            <h3 class="text-base font-semibold mb-2 text-gray-800">2. Tambah Furnitur AI</h3>
                                            <div class="flex gap-2">
                                                <input type="text" id="dr-interior-furniture-prompt" class="w-full p-2 text-sm rounded-lg border border-gray-300" placeholder="sofa modern...">
                                                <button type="button" id="dr-interior-add-furniture-btn" class="text-white font-semibold px-3 rounded-lg disabled:opacity-50" style="background-color: #0EA5E9;" disabled>
                                                    <i class="fas fa-wand-magic"></i>
                                                </button>
                                            </div>
                                            <div id="dr-interior-ai-furniture-container" class="mt-2 grid grid-cols-3 gap-2 min-h-[5rem] bg-gray-50 p-2 rounded-lg border">
                                                <p id="dr-interior-ai-furniture-placeholder" class="col-span-full text-center text-gray-400 text-xs self-center">Furnitur AI akan muncul di sini.</p>
                                            </div>
                                        </div>
                                        <div>
                                            <h3 class="text-base font-semibold mb-2 text-gray-800">3. Unggah Furnitur</h3>
                                            <label for="dr-interior-manual-furniture-input" class="text-white text-sm px-3 py-2 rounded-lg cursor-pointer inline-flex items-center gap-2" style="background-color: #0EA5E9;">
                                                <i class="fas fa-plus"></i> Tambah
                                            </label>
                                            <input type="file" id="dr-interior-manual-furniture-input" class="hidden" accept="image/png, image/jpeg, image/webp" multiple>
                                            <div id="dr-interior-manual-furniture-container" class="mt-2 grid grid-cols-3 gap-2 min-h-[5rem] bg-gray-50 p-2 rounded-lg border"></div>
                                        </div>
                                    </div>
                                    <div>
                                        <h3 class="text-base font-semibold mb-2 text-gray-800">4. Instruksi & Rasio</h3>
                                        <div class="relative mb-3">
                                            <textarea id="dr-interior-instruction-input" class="w-full p-2.5 text-sm rounded-lg border border-gray-300 pr-12" rows="3" placeholder="Contoh: Letakkan sofa di depan jendela..."></textarea>
                                            <button type="button" id="dr-interior-magic-instruction-btn" class="absolute right-2 top-1/2 -translate-y-1/2 p-2 rounded-lg bg-white border disabled:opacity-50" disabled title="Buat Instruksi Otomatis">
                                                <i class="fas fa-wand-magic"></i>
                                            </button>
                                        </div>
                                        <div id="dr-interior-ratio-options" class="grid grid-cols-3 gap-3">
                                            <button type="button" data-value="1:1" class="option-btn-desain selected justify-center gap-2">
                                                <i class="fas fa-square"></i><span>1:1</span>
                                            </button>
                                            <button type="button" data-value="16:9" class="option-btn-desain justify-center gap-2">
                                                <i class="fas fa-rectangle-landscape"></i><span>16:9</span>
                                            </button>
                                            <button type="button" data-value="9:16" class="option-btn-desain justify-center gap-2">
                                                <i class="fas fa-rectangle-portrait"></i><span>9:16</span>
                                            </button>
                                        </div>
                                    </div>
                                    <button id="dr-interior-generate-btn" class="w-full text-white font-bold py-3 px-6 rounded-lg flex items-center justify-center text-lg shadow-md hover:shadow-lg hover:-translate-y-px transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed" style="background: linear-gradient(to right, #0EA5E9, #0284C7);" disabled>
                                        <i class="fas fa-magic mr-2"></i><span>Desain Ruangan</span>
                                    </button>
                                </div>
                            </div>
                        </div>

                        <div class="w-full lg:w-7/12 flex flex-col">
                            <div class="card p-4 sm:p-6 h-full flex flex-col">
                                <div id="dr-interior-results-placeholder" class="flex flex-grow flex-col items-center justify-center text-center text-slate-500">
                                    <i class="fas fa-image" style="font-size: 4rem; color: #cbd5e1; margin-bottom: 1rem;"></i>
                                    <h3 class="font-semibold text-lg text-slate-600">Hasil Desain Interior</h3>
                                    <p class="mt-1 text-sm">Hasil desain ruangan Anda akan muncul di sini.</p>
                                </div>
                                <div id="dr-interior-results-container" class="hidden">
                                    <div id="dr-interior-results-grid" class="grid grid-cols-1 sm:grid-cols-2 gap-4"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- EKSTERIOR TAB -->
                <div id="dr-content-eksterior" class="hidden">
                    <div class="mb-6 flex items-center gap-3 p-3 sm:p-4 rounded-xl border text-left" style="background: linear-gradient(to right, #E0F2FE, #E0F2FE); border-color: #0EA5E9; color: #0284C7;">
                        <div class="flex-shrink-0"><i class="fas fa-info-circle" style="color: #0EA5E9;"></i></div>
                        <p class="text-sm md:text-base">Unggah foto luar rumah Anda, pilih gaya renovasi, dan biarkan AI menyulap fasad rumah Anda menjadi baru.</p>
                    </div>
                    <div class="mt-8 flex flex-col lg:flex-row gap-8 w-full">
                        <div class="w-full lg:w-5/12 flex-shrink-0">
                            <div class="card p-4 sm:p-6 sticky top-6">
                                <div class="flex flex-col gap-5">
                                    <div>
                                        <h3 class="text-base font-semibold mb-3 text-gray-800">1. Unggah Foto Luar Rumah</h3>
                                        <label for="dr-eksterior-house-input" id="dr-eksterior-house-upload-box" class="upload-box-desain w-full h-48 rounded-lg flex items-center justify-center cursor-pointer relative overflow-hidden border-2 border-dashed border-gray-300">
                                            <div id="dr-eksterior-house-placeholder" class="text-center text-gray-500 p-2">
                                                <i class="fas fa-building" style="font-size: 2.5rem;"></i>
                                                <p class="mt-2 text-sm">Klik atau seret foto</p>
                                            </div>
                                            <img id="dr-eksterior-house-preview" class="hidden absolute top-0 left-0 w-full h-full object-contain" alt="Pratinjau Rumah">
                                            <button type="button" id="dr-eksterior-remove-house-btn" class="hidden absolute top-2 right-2 bg-red-600 text-white rounded-full p-1 hover:bg-red-700 z-10">
                                                <i class="fas fa-times"></i>
                                            </button>
                                        </label>
                                        <input type="file" id="dr-eksterior-house-input" class="hidden" accept="image/png, image/jpeg, image/webp, .heic, .HEIC">
                                    </div>
                                    <div>
                                        <h3 class="text-base font-semibold mb-3 text-gray-800">2. Pilih Gaya Renovasi</h3>
                                        <div id="dr-eksterior-style-options" class="grid grid-cols-2 sm:grid-cols-3 gap-2 text-sm">
                                            <button type="button" data-value="Ganti Warna Cat" class="checkbox-btn-desain justify-center">Ganti Cat</button>
                                            <button type="button" data-value="Modernisasi Fasad" class="checkbox-btn-desain justify-center">Modern</button>
                                            <button type="button" data-value="Tambah Taman Depan" class="checkbox-btn-desain justify-center">Taman</button>
                                            <button type="button" data-value="Ganti Pagar" class="checkbox-btn-desain justify-center">Pagar</button>
                                            <button type="button" data-value="Gaya Minimalis" class="checkbox-btn-desain justify-center">Minimalis</button>
                                            <button type="button" data-value="Gaya Tropis" class="checkbox-btn-desain justify-center">Tropis</button>
                                            <button type="button" data-value="Kustom" class="checkbox-btn-desain justify-center">Kustom</button>
                                        </div>
                                        <div id="dr-eksterior-kustom-container" class="hidden mt-2">
                                            <input type="text" id="dr-eksterior-kustom-input" class="w-full p-2 text-sm rounded-lg border border-gray-300" placeholder="Tulis gaya kustom Anda...">
                                        </div>
                                    </div>
                                    <div>
                                        <h3 class="text-base font-semibold mb-2 text-gray-800">3. Instruksi & Rasio</h3>
                                        <div class="relative mb-3">
                                            <textarea id="dr-eksterior-instruction-input" class="w-full p-2.5 text-sm rounded-lg border border-gray-300 pr-12" rows="3" placeholder="Contoh: Ganti cat menjadi putih, dengan aksen kayu..."></textarea>
                                            <button type="button" id="dr-eksterior-magic-instruction-btn" class="absolute right-2 top-1/2 -translate-y-1/2 p-2 rounded-lg bg-white border disabled:opacity-50" disabled title="Buat Instruksi Otomatis">
                                                <i class="fas fa-wand-magic"></i>
                                            </button>
                                        </div>
                                        <div id="dr-eksterior-ratio-options" class="grid grid-cols-3 gap-3">
                                            <button type="button" data-value="1:1" class="option-btn-desain justify-center gap-2">
                                                <i class="fas fa-square"></i><span>1:1</span>
                                            </button>
                                            <button type="button" data-value="16:9" class="option-btn-desain selected justify-center gap-2">
                                                <i class="fas fa-rectangle-landscape"></i><span>16:9</span>
                                            </button>
                                            <button type="button" data-value="9:16" class="option-btn-desain justify-center gap-2">
                                                <i class="fas fa-rectangle-portrait"></i><span>9:16</span>
                                            </button>
                                        </div>
                                    </div>
                                    <button id="dr-eksterior-generate-btn" class="w-full text-white font-bold py-3 px-6 rounded-lg flex items-center justify-center text-lg shadow-md hover:shadow-lg hover:-translate-y-px transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed" style="background: linear-gradient(to right, #0EA5E9, #0284C7);" disabled>
                                        <i class="fas fa-magic mr-2"></i><span>Redesain Rumah</span>
                                    </button>
                                </div>
                            </div>
                        </div>

                        <div class="w-full lg:w-7/12 flex flex-col">
                            <div class="card p-4 sm:p-6 h-full flex flex-col">
                                <div id="dr-eksterior-results-placeholder" class="flex flex-grow flex-col items-center justify-center text-center text-slate-500">
                                    <i class="fas fa-image" style="font-size: 4rem; color: #cbd5e1; margin-bottom: 1rem;"></i>
                                    <h3 class="font-semibold text-lg text-slate-600">Hasil Desain Eksterior</h3>
                                    <p class="mt-1 text-sm">Hasil redesain rumah Anda akan muncul di sini.</p>
                                </div>
                                <div id="dr-eksterior-results-container" class="hidden">
                                    <div id="dr-eksterior-results-grid" class="grid grid-cols-1 sm:grid-cols-2 gap-4"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- TAB: SKETSA GAMBAR -->
        <div id="content-sketsa-gambar" class="main-content-panel hidden">
            <div class="container mx-auto max-w-7xl">
                <header class="text-center mb-8">
                    <h1 class="text-4xl md:text-5xl font-bold mb-3">
                        <i class="fas fa-pencil-ruler mr-3"></i>Ubah Sketsa Jadi Gambar
                    </h1>
                    <p class="text-lg text-gray-600">
                        Unggah sketsa Anda, pilih tujuan, dan biarkan AI mengubahnya menjadi karya seni digital yang menakjubkan.
                    </p>
                </header>

                <div class="mt-8 flex flex-col lg:flex-row gap-8 w-full">
                    <div class="w-full lg:w-5/12 flex-shrink-0">
                        <div class="card p-4 sm:p-6 sticky top-6">
                            <div class="flex flex-col gap-5">
                                <div>
                                    <h3 class="text-base font-semibold mb-3 text-gray-800">1. Unggah Gambar Sketsa</h3>
                                    <label for="sti-image-input" id="sti-upload-box" class="upload-box-sketsa w-full h-48 rounded-lg flex items-center justify-center cursor-pointer relative overflow-hidden border-2 border-dashed border-gray-300">
                                        <div id="sti-placeholder" class="text-center text-gray-500 p-2">
                                            <i class="fas fa-pencil-alt" style="font-size: 2.5rem;"></i>
                                            <p class="mt-2 text-sm">Klik atau seret sketsa</p>
                                        </div>
                                        <img id="sti-preview" class="hidden absolute top-0 left-0 w-full h-full object-contain" alt="Pratinjau Sketsa">
                                        <button type="button" id="sti-remove-btn" class="hidden absolute top-2 right-2 bg-red-600 text-white rounded-full p-1 hover:bg-red-700 z-10">
                                            <i class="fas fa-times"></i>
                                        </button>
                                    </label>
                                    <input type="file" id="sti-image-input" class="hidden" accept="image/png, image/jpeg, image/webp, .heic, .HEIC">
                                </div>
                                <div>
                                    <h3 class="text-base font-semibold mb-3 text-gray-800">2. Tujuan Gambar</h3>
                                    <div id="sti-purpose-options" class="grid grid-cols-2 sm:grid-cols-4 gap-2 text-sm">
                                        <button type="button" data-value="Logo" class="option-btn-sketsa selected">Logo</button>
                                        <button type="button" data-value="Banner" class="option-btn-sketsa">Banner</button>
                                        <button type="button" data-value="Foto Produk" class="option-btn-sketsa">Produk</button>
                                        <button type="button" data-value="3D Render" class="option-btn-sketsa">3D Render</button>
                                        <button type="button" data-value="Gaya Kartun" class="option-btn-sketsa">Kartun</button>
                                        <button type="button" data-value="Foto Realistis" class="option-btn-sketsa">Realistis</button>
                                        <button type="button" data-value="Kustom" class="option-btn-sketsa col-span-2 sm:col-span-full">Kustom</button>
                                    </div>
                                    <div id="sti-custom-purpose-container" class="hidden mt-2">
                                        <input type="text" id="sti-custom-purpose-input" class="w-full p-2 text-sm rounded-lg border border-gray-300" placeholder="Tulis tujuan kustom Anda di sini...">
                                    </div>
                                </div>
                                <div>
                                    <h3 class="text-base font-semibold mb-3 text-gray-800">3. Instruksi</h3>
                                    <div class="relative">
                                        <textarea id="sti-prompt-input" class="w-full p-2.5 text-sm rounded-lg border border-gray-300 pr-12" rows="3" placeholder="Klik tombol magic untuk mengisi otomatis..."></textarea>
                                        <button type="button" id="sti-magic-prompt-btn" class="absolute right-2 top-1/2 -translate-y-1/2 p-2 rounded-lg bg-white border disabled:opacity-50" disabled title="Buat Instruksi Otomatis">
                                            <i class="fas fa-wand-magic"></i>
                                        </button>
                                    </div>
                                </div>
                                <div>
                                    <h3 class="text-base font-semibold mb-3 text-gray-800">4. Pilih Rasio</h3>
                                    <div id="sti-ratio-options" class="grid grid-cols-3 gap-3">
                                        <button type="button" data-value="1:1" class="option-btn-sketsa selected gap-2">
                                            <i class="fas fa-square"></i><span>1:1</span>
                                        </button>
                                        <button type="button" data-value="16:9" class="option-btn-sketsa gap-2">
                                            <i class="fas fa-rectangle-landscape"></i><span>16:9</span>
                                        </button>
                                        <button type="button" data-value="9:16" class="option-btn-sketsa gap-2">
                                            <i class="fas fa-rectangle-portrait"></i><span>9:16</span>
                                        </button>
                                    </div>
                                </div>
                                <button id="sti-generate-btn" class="w-full text-white font-bold py-3 px-6 rounded-lg flex items-center justify-center text-lg shadow-md hover:shadow-lg hover:-translate-y-px transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed" style="background: linear-gradient(to right, #8B5CF6, #7C3AED);" disabled>
                                    <i class="fas fa-magic mr-2"></i>
                                    <span>Buat 4 Gambar</span>
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="w-full lg:w-7/12 flex flex-col">
                        <div class="card p-4 sm:p-6 h-full flex flex-col">
                            <div id="sti-results-placeholder" class="flex flex-grow flex-col items-center justify-center text-center text-slate-500">
                                <i class="fas fa-image" style="font-size: 4rem; color: #cbd5e1; margin-bottom: 1rem;"></i>
                                <h3 class="font-semibold text-lg text-slate-600">Hasil dari Sketsa Anda</h3>
                                <p class="mt-1 text-sm">Empat variasi gambar akan muncul di sini.</p>
                            </div>
                            <div id="sti-results-container" class="hidden">
                                <div id="sti-results-grid" class="grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-6"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- BIKIN CAROUSEL TAB -->
        <div id="content-bikin-carousel" class="main-content-panel hidden">
            <div class="max-w-7xl mx-auto">
                <div class="text-center mb-6">
                    <h2 class="text-2xl sm:text-3xl font-bold text-transparent bg-clip-text" style="background: linear-gradient(to right, #EC4899, #DB2777); -webkit-background-clip: text; background-clip: text;">Bikin Carousel Produk</h2>
                    <div class="mt-4 flex items-center gap-3 p-3 sm:p-4 rounded-xl border text-left max-w-4xl mx-auto" style="background: linear-gradient(to right, #FCE7F3, #FCE7F3); border-color: #EC4899; color: #DB2777;">
                        <div class="flex-shrink-0">
                            <i class="fas fa-info-circle" style="color: #EC4899;"></i>
                        </div>
                        <p class="text-sm md:text-base">Unggah satu foto produk, dan biarkan AI membuatkan satu set carousel yang menarik untuk media sosial atau marketplace Anda.</p>
                    </div>
                </div>

                <div class="mt-8 flex flex-col lg:flex-row gap-8 w-full">
                    <div class="w-full lg:w-5/12 flex-shrink-0">
                        <div class="card p-4 sm:p-6 sticky top-6">
                            <div class="flex flex-col gap-5">
                                <div>
                                    <h3 class="text-base font-semibold mb-3 text-gray-800">1. Unggah Gambar Produk</h3>
                                    <label for="crsl-image-input" id="crsl-upload-box" class="upload-box w-full h-48 rounded-lg flex items-center justify-center cursor-pointer relative overflow-hidden">
                                        <div id="crsl-placeholder" class="text-center text-gray-500 p-2">
                                            <i class="fas fa-box text-4xl mx-auto mb-2"></i>
                                            <p class="mt-2 text-sm">Klik atau seret foto</p>
                                        </div>
                                        <img id="crsl-preview" class="hidden absolute top-0 left-0 w-full h-full object-contain" alt="Pratinjau Produk">
                                        <button id="crsl-remove-btn" class="hidden absolute top-2 right-2 bg-red-600 text-white rounded-full p-1 hover:bg-red-700 z-10"><i class="fas fa-times"></i></button>
                                    </label>
                                    <input type="file" id="crsl-image-input" class="hidden" accept="image/png, image/jpeg, image/webp, .heic, .HEIC">
                                </div>
                                <div>
                                    <div class="flex justify-between items-center mb-2">
                                        <h3 class="text-base font-semibold text-gray-800">2. Nama & Deskripsi</h3>
                                        <div class="relative">
                                            <button id="crsl-auto-btn" class="flex items-center gap-2 text-sm font-semibold transition disabled:opacity-50" style="color: #EC4899;" disabled>
                                                <i class="fas fa-wand-magic-sparkles w-4 h-4"></i><span>Otomatis</span>
                                            </button>
                                            <div id="crsl-auto-name-tooltip" class="crsl-tooltip">Klik untuk buat nama & deskripsi otomatis</div>
                                        </div>
                                    </div>
                                    <div class="grid grid-cols-1 gap-3">
                                        <input type="text" id="crsl-name-input" class="w-full p-2.5 rounded-lg text-sm border focus:ring-2 focus:outline-none" placeholder="Nama Produk...">
                                        <textarea id="crsl-desc-input" class="w-full p-2.5 rounded-lg text-sm border focus:ring-2 focus:outline-none" rows="2" placeholder="Deskripsi singkat produk..."></textarea>
                                    </div>
                                </div>
                                <div>
                                    <h3 class="text-base font-semibold mb-3 text-gray-800">3. Pengaturan</h3>
                                    <div class="grid grid-cols-1 gap-4">
                                        <div class="grid grid-cols-2 gap-4">
                                            <div>
                                                <h4 class="font-medium text-xs mb-2 text-gray-600">Jumlah Slide</h4>
                                                <div id="crsl-slides-options" class="grid grid-cols-3 gap-2">
                                                    <button data-value="3" class="option-btn justify-center text-sm !p-2">3</button>
                                                    <button data-value="5" class="option-btn selected justify-center text-sm !p-2">5</button>
                                                    <button data-value="7" class="option-btn justify-center text-sm !p-2">7</button>
                                                </div>
                                            </div>
                                            <div>
                                                <h4 class="font-medium text-xs mb-2 text-gray-600">Aspek Rasio</h4>
                                                <div id="crsl-ratio-options" class="grid grid-cols-3 gap-2">
                                                    <button data-value="1:1" class="option-btn selected justify-center text-xs !p-2 flex-col">
                                                        <i class="fas fa-square text-base mb-1"></i>
                                                        <span>1:1</span>
                                                    </button>
                                                    <button data-value="16:9" class="option-btn justify-center text-xs !p-2 flex-col">
                                                        <i class="fas fa-rectangle-landscape text-base mb-1"></i>
                                                        <span>16:9</span>
                                                    </button>
                                                    <button data-value="9:16" class="option-btn justify-center text-xs !p-2 flex-col">
                                                        <i class="fas fa-rectangle-portrait text-base mb-1"></i>
                                                        <span>9:16</span>
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                        <div>
                                            <h4 class="font-medium text-xs mb-2 text-gray-600">Tampilan</h4>
                                            <div id="crsl-style-options" class="grid grid-cols-2 sm:grid-cols-4 gap-2 text-xs">
                                                <button data-value="Minimalis & Cerah" class="option-btn selected justify-center">Minimalis</button>
                                                <button data-value="Elegan & Mewah" class="option-btn justify-center">Elegan</button>
                                                <button data-value="Modern & Gelap" class="option-btn justify-center">Modern</button>
                                                <button data-value="Warna-warni & Ceria" class="option-btn justify-center">Ceria</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="flex items-center justify-between">
                                    <h3 class="text-base font-semibold text-gray-800">4. Tambahkan Teks</h3>
                                    <label class="toggle-switch">
                                        <input type="checkbox" id="crsl-text-mode-toggle" checked>
                                        <span class="slider"></span>
                                    </label>
                                </div>

                                <div id="crsl-script-section" class="space-y-3">
                                    <div class="flex justify-between items-center">
                                        <h4 class="text-sm font-semibold text-gray-700">Script Konten</h4>
                                        <div class="relative">
                                            <button id="crsl-auto-script-btn" class="flex items-center gap-2 text-sm font-semibold transition disabled:opacity-50" style="color: #EC4899;" disabled>
                                                <i class="fas fa-wand-magic-sparkles w-4 h-4"></i><span>Buat Script</span>
                                            </button>
                                            <div id="crsl-auto-script-tooltip" class="crsl-tooltip">Klik untuk bikin konten slide otomatis</div>
                                        </div>
                                    </div>
                                    <div id="crsl-script-type-options" class="grid grid-cols-2 sm:grid-cols-4 gap-2 text-xs">
                                        <button data-type="showcase" class="option-btn selected justify-center">Showcase</button>
                                        <button data-type="edukasi" class="option-btn justify-center">Edukasi</button>
                                        <button data-type="storytelling" class="option-btn justify-center">Story</button>
                                        <button data-type="kustom" class="option-btn justify-center">Kustom</button>
                                    </div>
                                    <div id="crsl-kustom-script-container" class="hidden">
                                        <input type="text" id="crsl-kustom-script-input" class="w-full p-2 text-sm rounded-lg border focus:ring-2 focus:outline-none" placeholder="Tulis jenis script kustom...">
                                    </div>
                                    <div id="crsl-script-editor-container" class="space-y-3 max-h-48 overflow-y-auto pr-2">
                                    </div>
                                </div>

                                <div id="crsl-text-settings-section">
                                    <h3 class="text-base font-semibold mb-3 text-gray-800">5. Posisi Tulisan & Font</h3>
                                    <div class="grid grid-cols-1 gap-y-4">
                                        <div>
                                            <h4 class="font-medium text-xs mb-2 text-gray-600">Posisi Tulisan</h4>
                                            <div id="crsl-position-options" class="grid grid-cols-3 gap-2">
                                                <button data-value="top-center" class="option-btn justify-center !p-2" title="Teks di Atas"><i class="fas fa-align-center -rotate-90"></i></button>
                                                <button data-value="middle-center" class="option-btn justify-center !p-2" title="Teks di Tengah"><i class="fas fa-align-center"></i></button>
                                                <button data-value="bottom-center" class="option-btn selected justify-center !p-2" title="Teks di Bawah"><i class="fas fa-align-center rotate-90"></i></button>
                                            </div>
                                        </div>
                                        <div>
                                            <h4 class="font-medium text-xs mb-2 text-gray-600">Jenis Font</h4>
                                            <div id="crsl-font-options" class="grid grid-cols-3 gap-2 text-xs">
                                                <button data-value="'Poppins', sans-serif" class="option-btn selected justify-center" style="font-family: 'Poppins', sans-serif;">Modern</button>
                                                <button data-value="'Georgia', serif" class="option-btn justify-center" style="font-family: 'Georgia', serif;">Elegan</button>
                                                <button data-value="'Comic Sans MS', cursive" class="option-btn justify-center" style="font-family: 'Comic Sans MS', cursive;">Santai</button>
                                            </div>
                                        </div>
                                        <div>
                                            <h4 class="font-medium text-xs mb-2 text-gray-600">Warna Font</h4>
                                            <div id="crsl-font-color-options" class="grid grid-cols-4 gap-2 text-xs">
                                                <button data-value="auto" class="option-btn selected justify-center flex items-center gap-1"><i class="fas fa-wand-magic-sparkles w-3 h-3"></i> Auto</button>
                                                <button data-value="#FFFFFF" class="option-btn justify-center" style="background-color: #FFFFFF; color: #333; border: 1px solid #ccc;">Putih</button>
                                                <button data-value="#000000" class="option-btn justify-center" style="background-color: #000000; color: #FFF;">Hitam</button>
                                                <button data-value="#FFD700" class="option-btn justify-center" style="background-color: #FFD700; color: #333; border: 1px solid #ccc;">Emas</button>
                                            </div>
                                            <div id="crsl-auto-color-preview-container" class="mt-2 text-xs text-gray-600 items-center gap-2 hidden">
                                                Warna Otomatis: <span id="crsl-auto-color-preview" class="w-4 h-4 rounded border"></span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <button id="crsl-generate-btn" class="w-full mt-4 text-white font-bold py-3 px-6 rounded-lg flex items-center justify-center text-lg shadow-md hover:shadow-lg hover:-translate-y-px transition-all duration-300 disabled:bg-slate-200 disabled:shadow-none disabled:translate-y-0" style="background: linear-gradient(to right, #EC4899, #DB2777);" disabled>
                                    <i class="fas fa-sparkles w-5 h-5 mr-2"></i>
                                    <span>Buat Carousel</span>
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="w-full lg:w-7/12 flex flex-col">
                        <div class="card p-4 sm:p-6 h-full flex flex-col">
                            <div id="crsl-results-placeholder" class="flex flex-grow flex-col items-center justify-center text-center text-slate-500">
                                <i class="fas fa-images text-6xl text-slate-400 mb-4"></i>
                                <h3 class="font-semibold text-lg text-slate-600">Hasil Carousel Anda</h3>
                                <p class="mt-1 text-sm">Carousel yang sudah jadi akan muncul di sini.</p>
                            </div>
                            <div id="crsl-results-container" class="hidden flex-grow flex flex-col">
                                <div id="crsl-results-grid" class="grid grid-cols-1 gap-6">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- TAB 10: VEO GENERATOR -->
        <div id="content-veo" class="main-content-panel hidden">
            <iframe src="https://veogenerator-rho.vercel.app/" class="w-full h-[85vh] border-0 rounded-lg shadow-lg" title="VEO Generator" allow="camera; microphone"></iframe>
        </div>

        <!-- TAB: OPAL IMAGE TO VIDEO -->
        <div id="content-opal" class="main-content-panel hidden">
            <div class="container mx-auto max-w-4xl">
                <header class="text-center mb-8">
                    <h1 class="text-4xl md:text-5xl font-bold mb-3 bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent">
                        <i class="fas fa-magic mr-3"></i>Opal Image to Video
                    </h1>
                    <p class="text-lg text-gray-600 mb-6">
                        Transform your images into stunning AI-powered videos with Google Opal (Veo 3)
                    </p>

                    <!-- Tombol Buka Opal -->
                    <a href="https://opal.google/?flow=drive:/1b2ZoJJ12TqN6DYhzS9MHLUs63sG3xVDa&shared&mode=app"
                       target="_blank"
                       rel="noopener noreferrer"
                       class="inline-flex items-center gap-3 bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 text-white font-bold py-4 px-8 rounded-full shadow-lg transform hover:scale-105 transition-all duration-300">
                        <i class="fas fa-external-link-alt text-xl"></i>
                        <span class="text-lg">Buka Opal Image to Video</span>
                    </a>
                </header>

                <!-- Info Cards -->
                <div class="grid md:grid-cols-2 gap-6 mb-8">
                    <!-- Card 1: Tentang Opal -->
                    <div class="bg-white rounded-xl shadow-lg p-6 border-t-4 border-purple-500">
                        <div class="flex items-center mb-4">
                            <div class="bg-purple-100 p-3 rounded-full mr-3">
                                <i class="fas fa-robot text-purple-600 text-xl"></i>
                            </div>
                            <h2 class="text-xl font-bold text-gray-800">Tentang Opal</h2>
                        </div>
                        <ul class="space-y-3 text-gray-700">
                            <li class="flex items-start">
                                <i class="fas fa-check-circle text-green-500 mt-1 mr-2"></i>
                                <span>Menggunakan <strong>AI Model Veo 3</strong> dari Google</span>
                            </li>
                            <li class="flex items-start">
                                <i class="fas fa-check-circle text-green-500 mt-1 mr-2"></i>
                                <span>Hasil video dapat <strong>berbicara sesuai prompt</strong> yang Anda berikan</span>
                            </li>
                            <li class="flex items-start">
                                <i class="fas fa-check-circle text-green-500 mt-1 mr-2"></i>
                                <span>Kualitas video <strong>sangat realistis</strong> dan natural</span>
                            </li>
                        </ul>
                    </div>

                    <!-- Card 2: Batasan & Tips -->
                    <div class="bg-white rounded-xl shadow-lg p-6 border-t-4 border-pink-500">
                        <div class="flex items-center mb-4">
                            <div class="bg-pink-100 p-3 rounded-full mr-3">
                                <i class="fas fa-exclamation-triangle text-pink-600 text-xl"></i>
                            </div>
                            <h2 class="text-xl font-bold text-gray-800">Batasan & Tips</h2>
                        </div>
                        <ul class="space-y-3 text-gray-700">
                            <li class="flex items-start">
                                <i class="fas fa-info-circle text-blue-500 mt-1 mr-2"></i>
                                <span><strong>GRATIS 10 video per hari</strong> per akun Google</span>
                            </li>
                            <li class="flex items-start">
                                <i class="fas fa-info-circle text-blue-500 mt-1 mr-2"></i>
                                <span><strong>Hanya orientasi HORIZONTAL</strong>, tidak support vertikal</span>
                            </li>
                            <li class="flex items-start">
                                <i class="fas fa-lightbulb text-yellow-500 mt-1 mr-2"></i>
                                <span>Gunakan <strong>beberapa akun Google</strong> atau tunggu besok untuk generate lebih banyak</span>
                            </li>
                        </ul>
                    </div>
                </div>

                <!-- Cara Penggunaan -->
                <div class="bg-gradient-to-br from-blue-50 to-indigo-50 rounded-xl shadow-lg p-8 border border-blue-200">
                    <div class="flex items-center mb-6">
                        <div class="bg-blue-500 p-3 rounded-full mr-3">
                            <i class="fas fa-play-circle text-white text-2xl"></i>
                        </div>
                        <h2 class="text-2xl font-bold text-gray-800">Cara Menggunakan Opal</h2>
                    </div>

                    <div class="grid md:grid-cols-2 gap-6">
                        <div class="space-y-4">
                            <div class="flex items-start bg-white rounded-lg p-4 shadow-sm">
                                <div class="bg-blue-100 text-blue-600 font-bold rounded-full w-8 h-8 flex items-center justify-center mr-3 flex-shrink-0">1</div>
                                <div>
                                    <h3 class="font-semibold text-gray-800 mb-1">Upload Gambar</h3>
                                    <p class="text-sm text-gray-600">Klik tombol di atas untuk buka Opal, lalu upload gambar horizontal Anda</p>
                                </div>
                            </div>

                            <div class="flex items-start bg-white rounded-lg p-4 shadow-sm">
                                <div class="bg-blue-100 text-blue-600 font-bold rounded-full w-8 h-8 flex items-center justify-center mr-3 flex-shrink-0">2</div>
                                <div>
                                    <h3 class="font-semibold text-gray-800 mb-1">Tulis Prompt</h3>
                                    <p class="text-sm text-gray-600">Deskripsikan gerakan dan dialog yang ingin ditambahkan pada video</p>
                                </div>
                            </div>
                        </div>

                        <div class="space-y-4">
                            <div class="flex items-start bg-white rounded-lg p-4 shadow-sm">
                                <div class="bg-blue-100 text-blue-600 font-bold rounded-full w-8 h-8 flex items-center justify-center mr-3 flex-shrink-0">3</div>
                                <div>
                                    <h3 class="font-semibold text-gray-800 mb-1">Generate Video</h3>
                                    <p class="text-sm text-gray-600">Klik tombol Generate dan tunggu AI memproses (beberapa menit)</p>
                                </div>
                            </div>

                            <div class="flex items-start bg-white rounded-lg p-4 shadow-sm">
                                <div class="bg-blue-100 text-blue-600 font-bold rounded-full w-8 h-8 flex items-center justify-center mr-3 flex-shrink-0">4</div>
                                <div>
                                    <h3 class="font-semibold text-gray-800 mb-1">Download Hasil</h3>
                                    <p class="text-sm text-gray-600">Download video yang sudah jadi dan gunakan untuk konten Anda</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Tips Pro -->
                <div class="mt-8 bg-gradient-to-r from-purple-500 to-pink-500 rounded-xl shadow-xl p-6 text-white">
                    <div class="flex items-center mb-4">
                        <i class="fas fa-star text-yellow-300 text-2xl mr-3"></i>
                        <h2 class="text-2xl font-bold">Tips Pro</h2>
                    </div>
                    <div class="grid md:grid-cols-3 gap-4 text-sm">
                        <div class="bg-white/10 backdrop-blur rounded-lg p-4">
                            <i class="fas fa-image text-yellow-300 mb-2 text-lg"></i>
                            <p><strong>Gunakan gambar berkualitas tinggi</strong> dengan resolusi minimal 1080p untuk hasil terbaik</p>
                        </div>
                        <div class="bg-white/10 backdrop-blur rounded-lg p-4">
                            <i class="fas fa-comment-dots text-yellow-300 mb-2 text-lg"></i>
                            <p><strong>Tulis prompt yang detail</strong> termasuk ekspresi wajah, gerakan, dan dialog yang diinginkan</p>
                        </div>
                        <div class="bg-white/10 backdrop-blur rounded-lg p-4">
                            <i class="fas fa-users text-yellow-300 mb-2 text-lg"></i>
                            <p><strong>Siapkan beberapa akun Google</strong> untuk generate lebih dari 10 video per hari</p>
                        </div>
                    </div>
                </div>

                <!-- Tombol Bawah -->
                <div class="text-center mt-8">
                    <a href="https://opal.google/?flow=drive:/1b2ZoJJ12TqN6DYhzS9MHLUs63sG3xVDa&shared&mode=app"
                       target="_blank"
                       rel="noopener noreferrer"
                       class="inline-flex items-center gap-3 bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 text-white font-bold py-4 px-10 rounded-full shadow-lg transform hover:scale-105 transition-all duration-300">
                        <i class="fas fa-rocket text-xl"></i>
                        <span class="text-lg">Mulai Buat Video Sekarang</span>
                        <i class="fas fa-arrow-right text-xl"></i>
                    </a>
                </div>
            </div>
        </div>

        <!-- TAB 11: VOICE OVER GENERATOR -->
        <div id="content-voice-over" class="main-content-panel hidden">
            <div class="w-full max-w-5xl mx-auto bg-gradient-to-br from-indigo-50 via-purple-50 to-pink-50 rounded-2xl shadow-2xl p-6 md:p-10 space-y-8">
                <!-- Header -->
                <div class="text-center">
                    <div class="flex items-center justify-center mb-4">
                        <div class="bg-gradient-to-r from-indigo-600 to-purple-600 p-4 rounded-2xl shadow-2xl">
                            <i class="fas fa-microphone-alt text-4xl text-white"></i>
                        </div>
                    </div>
                    <h1 class="text-4xl md:text-5xl font-bold bg-gradient-to-r from-indigo-600 via-purple-600 to-pink-600 bg-clip-text text-transparent mb-3">
                        Voice Over Studio Pro
                    </h1>
                    <p class="text-gray-600 text-lg max-w-2xl mx-auto">
                        Transform text to natural speech dengan kontrol profesional lengkap
                    </p>
                </div>

                <!-- Form Input -->
                <div class="bg-white rounded-xl shadow-lg p-6 space-y-6">
                    <!-- Text Templates -->
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-3 flex items-center gap-2">
                            <i class="fas fa-file-alt text-purple-600"></i>
                            Quick Templates
                        </label>
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-2">
                            <button data-template="intro" class="vo-template-btn text-xs bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white px-3 py-2 rounded-lg font-semibold shadow-md transform hover:scale-105 transition-all">
                                <i class="fas fa-play-circle mr-1"></i>Intro
                            </button>
                            <button data-template="narasi" class="vo-template-btn text-xs bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white px-3 py-2 rounded-lg font-semibold shadow-md transform hover:scale-105 transition-all">
                                <i class="fas fa-book-open mr-1"></i>Narasi
                            </button>
                            <button data-template="iklan" class="vo-template-btn text-xs bg-gradient-to-r from-orange-500 to-orange-600 hover:from-orange-600 hover:to-orange-700 text-white px-3 py-2 rounded-lg font-semibold shadow-md transform hover:scale-105 transition-all">
                                <i class="fas fa-bullhorn mr-1"></i>Iklan
                            </button>
                            <button data-template="podcast" class="vo-template-btn text-xs bg-gradient-to-r from-purple-500 to-purple-600 hover:from-purple-600 hover:to-purple-700 text-white px-3 py-2 rounded-lg font-semibold shadow-md transform hover:scale-105 transition-all">
                                <i class="fas fa-podcast mr-1"></i>Podcast
                            </button>
                        </div>
                    </div>

                    <!-- Text Input -->
                    <div>
                        <div class="flex justify-between items-center mb-2">
                            <label for="vo-text-input" class="block text-sm font-semibold text-gray-700 flex items-center gap-2">
                                <i class="fas fa-keyboard text-purple-600"></i>
                                Masukkan Teks
                            </label>
                            <div class="flex items-center space-x-2">
                                <button id="vo-copy-text-btn" title="Salin Teks" class="text-gray-400 hover:text-purple-600 transition-colors">
                                    <i class="fas fa-copy"></i>
                                </button>
                                <button id="vo-clear-text-btn" title="Hapus Teks" class="text-gray-400 hover:text-red-600 transition-colors">
                                    <i class="fas fa-trash-alt"></i>
                                </button>
                            </div>
                        </div>
                        <textarea id="vo-text-input" rows="6" class="w-full p-4 border-2 border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-purple-500 transition-all bg-gray-50 font-mono text-sm" placeholder="Contoh: Halo semuanya! Hari ini kita akan membahas penemuan terbaru di dunia sains..."></textarea>
                        <div class="flex justify-between items-center mt-2">
                            <div class="text-xs text-gray-500" id="vo-char-counter">0 / 5000 characters</div>
                            <div class="text-xs text-gray-500" id="vo-word-counter">0 words</div>
                        </div>
                    </div>
                    <div>
                        <div class="flex items-center justify-between mb-2">
                            <label for="vo-style-input" class="block text-sm font-medium text-gray-700">Kontrol Gaya Bicara (Opsional):</label>
                            <button id="vo-open-guidance-btn" class="text-gray-400 hover:text-blue-600 transition-colors flex items-center space-x-1 text-xs" title="Lihat Panduan">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                                <span>Panduan</span>
                            </button>
                        </div>
                        <input type="text" id="vo-style-input" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-shadow" placeholder="Contoh: Ucapkan dengan nada gembira dan bersemangat">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Pilih Suara:</label>
                        <div id="vo-voice-list" class="space-y-2 max-h-48 overflow-y-auto border rounded-lg p-2 bg-gray-50"></div>
                    </div>
                    <!-- Advanced Audio Controls -->
                    <div class="bg-gradient-to-r from-purple-50 to-pink-50 rounded-xl p-5 border-2 border-purple-200">
                        <h3 class="text-sm font-bold text-gray-800 mb-4 flex items-center gap-2">
                            <i class="fas fa-sliders-h text-purple-600"></i>
                            Advanced Controls
                        </h3>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-5">
                            <!-- Pitch Control -->
                            <div>
                                <div class="flex justify-between items-center mb-2">
                                    <label for="vo-pitch-slider" class="block text-xs font-semibold text-gray-700 flex items-center gap-1">
                                        <i class="fas fa-music text-indigo-600"></i>Pitch
                                    </label>
                                    <div class="flex items-center space-x-2">
                                        <span id="vo-pitch-value" class="text-xs font-mono font-bold text-indigo-600 bg-indigo-100 px-2 py-1 rounded-lg">0.0</span>
                                        <button id="vo-reset-pitch-btn" title="Reset Pitch" class="text-gray-400 hover:text-indigo-600 transition-colors">
                                            <i class="fas fa-redo text-xs"></i>
                                        </button>
                                    </div>
                                </div>
                                <input type="range" id="vo-pitch-slider" min="-20" max="20" value="0" step="0.1" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer slider-purple">
                            </div>

                            <!-- Volume Control -->
                            <div>
                                <div class="flex justify-between items-center mb-2">
                                    <label for="vo-volume-slider" class="block text-xs font-semibold text-gray-700 flex items-center gap-1">
                                        <i class="fas fa-volume-up text-purple-600"></i>Volume
                                    </label>
                                    <div class="flex items-center space-x-2">
                                        <span id="vo-volume-value" class="text-xs font-mono font-bold text-purple-600 bg-purple-100 px-2 py-1 rounded-lg">0.0 dB</span>
                                        <button id="vo-reset-volume-btn" title="Reset Volume" class="text-gray-400 hover:text-purple-600 transition-colors">
                                            <i class="fas fa-redo text-xs"></i>
                                        </button>
                                    </div>
                                </div>
                                <input type="range" id="vo-volume-slider" min="-20" max="20" value="0" step="1" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer slider-purple">
                            </div>

                            <!-- Speed Control -->
                            <div>
                                <div class="flex justify-between items-center mb-2">
                                    <label for="vo-speed-slider" class="block text-xs font-semibold text-gray-700 flex items-center gap-1">
                                        <i class="fas fa-tachometer-alt text-pink-600"></i>Speed
                                    </label>
                                    <div class="flex items-center space-x-2">
                                        <span id="vo-speed-value" class="text-xs font-mono font-bold text-pink-600 bg-pink-100 px-2 py-1 rounded-lg">1.0x</span>
                                        <button id="vo-reset-speed-btn" title="Reset Speed" class="text-gray-400 hover:text-pink-600 transition-colors">
                                            <i class="fas fa-redo text-xs"></i>
                                        </button>
                                    </div>
                                </div>
                                <input type="range" id="vo-speed-slider" min="0.25" max="2" value="1" step="0.25" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer slider-purple">
                                <div class="flex justify-between text-xs text-gray-500 mt-1">
                                    <span>0.25x</span>
                                    <span>1x</span>
                                    <span>2x</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Tombol Aksi -->
                <div class="text-center pt-4">
                    <button id="vo-generate-btn" class="bg-gradient-to-r from-indigo-600 via-purple-600 to-pink-600 hover:from-indigo-700 hover:via-purple-700 hover:to-pink-700 text-white font-bold py-4 px-10 rounded-xl shadow-2xl text-lg focus:outline-none focus:ring-4 focus:ring-purple-300 transition-all transform hover:scale-105 inline-flex items-center gap-3">
                        <i class="fas fa-magic"></i>
                        <span>Generate Voice Over</span>
                    </button>
                </div>

                <!-- Area Hasil -->
                <div id="vo-result-container" class="hidden space-y-6">
                    <!-- Loading -->
                    <div class="flex items-center justify-center hidden bg-white rounded-xl p-8 shadow-lg" id="vo-loader-container">
                        <div class="loader">
                            <div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div>
                        </div>
                        <p class="ml-4 text-gray-700 font-semibold text-lg">Generating audio...</p>
                    </div>

                    <!-- Audio Player -->
                    <div id="vo-audio-container" class="hidden bg-white rounded-xl p-6 shadow-xl border-2 border-purple-200">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-xl font-bold text-gray-800 flex items-center gap-2">
                                <i class="fas fa-check-circle text-green-500"></i>
                                Audio Generated Successfully
                            </h3>
                            <span class="text-xs bg-purple-100 text-purple-700 px-3 py-1 rounded-full font-semibold" id="vo-audio-duration">0:00</span>
                        </div>

                        <!-- Audio Player with Waveform Placeholder -->
                        <div class="bg-gradient-to-r from-indigo-100 via-purple-100 to-pink-100 rounded-xl p-4 mb-4">
                            <audio id="vo-audio-player" controls class="w-full rounded-lg shadow-md"></audio>
                        </div>

                        <!-- Action Buttons -->
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                            <button id="vo-download-btn" class="bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white font-bold py-3 px-6 rounded-lg shadow-lg transform hover:scale-105 transition-all inline-flex items-center justify-center gap-2">
                                <i class="fas fa-download"></i>
                                <span>Download Audio (.wav)</span>
                            </button>
                            <button id="vo-add-to-history-btn" class="bg-gradient-to-r from-purple-500 to-purple-600 hover:from-purple-600 hover:to-purple-700 text-white font-bold py-3 px-6 rounded-lg shadow-lg transform hover:scale-105 transition-all inline-flex items-center justify-center gap-2">
                                <i class="fas fa-save"></i>
                                <span>Save to History</span>
                            </button>
                        </div>
                    </div>

                    <!-- Error Message -->
                    <div id="vo-error-message" class="hidden text-center text-red-600 bg-red-100 p-5 rounded-xl border-2 border-red-300 shadow-lg font-semibold"></div>
                </div>

                <!-- Audio History -->
                <div id="vo-history-container" class="hidden bg-white rounded-xl p-6 shadow-lg">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-bold text-gray-800 flex items-center gap-2">
                            <i class="fas fa-history text-purple-600"></i>
                            Audio History
                        </h3>
                        <button id="vo-clear-history-btn" class="text-xs text-red-500 hover:text-red-700 font-semibold">
                            <i class="fas fa-trash mr-1"></i>Clear All
                        </button>
                    </div>
                    <div id="vo-history-list" class="space-y-2 max-h-60 overflow-y-auto"></div>
                </div>
            </div>

            <!-- Modal Panduan -->
            <div id="vo-guidance-modal" class="hidden fixed inset-0 bg-gray-800 bg-opacity-60 overflow-y-auto h-full w-full flex items-center justify-center p-4 z-50">
                <div class="relative mx-auto p-6 border w-full max-w-lg shadow-lg rounded-xl bg-white">
                    <div class="text-center">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-xl leading-6 font-bold text-gray-900">Panduan Gaya Bicara</h3>
                            <button id="vo-close-guidance-btn" class="text-gray-400 hover:text-gray-600 transition-colors">
                                <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                            </button>
                        </div>
                        <div class="mt-4 text-left text-sm text-gray-600 space-y-4 max-h-[60vh] overflow-y-auto pr-2">
                            <p class="font-medium text-gray-800">Berikan perintah dalam bahasa alami kepada AI tentang bagaimana cara mengucapkan teks Anda.</p>
                            <div>
                                <h4 class="font-semibold text-gray-800 mt-4 border-b pb-1 mb-2">Contoh Berdasarkan Emosi:</h4>
                                <ul class="list-disc list-inside space-y-1">
                                    <li>Ucapkan dengan gembira dan penuh semangat</li>
                                    <li>Katakan dengan nada sedih dan pelan</li>
                                    <li>Bicaralah dengan nada marah dan tegas</li>
                                </ul>
                            </div>
                            <div>
                                <h4 class="font-semibold text-gray-800 mt-4 border-b pb-1 mb-2">Contoh Berdasarkan Nada:</h4>
                                <ul class="list-disc list-inside space-y-1">
                                    <li>Bicaralah secara formal seperti pembaca berita</li>
                                    <li>Gunakan gaya kasual seperti sedang mengobrol</li>
                                    <li>Katakan dengan nada berbisik</li>
                                </ul>
                            </div>
                            <div>
                                <h4 class="font-semibold text-gray-800 mt-4 border-b pb-1 mb-2">Contoh Berdasarkan Peran:</h4>
                                <ul class="list-disc list-inside space-y-1">
                                    <li>Bertingkahlah seperti narator film dokumenter</li>
                                    <li>Bicaralah seperti guru yang sedang mengajar</li>
                                    <li>Ucapkan seperti pengisi suara iklan produk mewah</li>
                                </ul>
                            </div>
                            <div>
                                <h4 class="font-semibold text-gray-800 mt-4 border-b pb-1 mb-2">Tips Pro:</h4>
                                <ul class="list-disc list-inside space-y-1">
                                    <li><strong class="font-semibold">Jadilah Spesifik:</strong> Semakin deskriptif, hasilnya semakin baik.</li>
                                    <li><strong class="font-semibold">Eksperimen:</strong> Jangan takut mencoba berbagai kombinasi gaya.</li>
                                </ul>
                            </div>
                        </div>
                        <div class="mt-6">
                            <button id="vo-understand-btn" class="btn btn-primary w-full font-semibold py-3 px-6 rounded-lg">Saya Mengerti</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- VIDEO ANALYZER -->
        <div id="content-video-analyzer" class="main-content-panel hidden">
            <div class="w-full max-w-6xl mx-auto">
                <div class="glass-card p-6 md:p-10" style="background: linear-gradient(135deg, #1e1b4b 0%, #312e81 50%, #1e1b4b 100%); color: #e5e7eb; border: 2px solid #4c1d95;">
                    <header class="text-center mb-8">
                        <div class="flex items-center justify-center mb-4">
                            <div class="bg-gradient-to-r from-purple-500 to-pink-500 p-4 rounded-2xl shadow-2xl">
                                <i class="fas fa-video text-4xl text-white"></i>
                            </div>
                        </div>
                        <h1 class="text-4xl md:text-5xl font-bold bg-gradient-to-r from-purple-400 via-pink-400 to-purple-400 bg-clip-text text-transparent mb-3">
                            Video Analyzer Pro
                        </h1>
                        <p class="text-gray-300 text-lg max-w-2xl mx-auto">
                            Ekstrak frames dari video dan generate AI prompt yang detail untuk recreate video serupa
                        </p>
                    </header>

                    <main>
                        <!-- Input Section -->
                        <div id="va-input-section" class="mb-8">
                            <div class="text-center mb-6">
                                <label for="va-video-upload" class="cursor-pointer inline-flex items-center gap-3 bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 text-white font-bold py-4 px-8 rounded-xl shadow-2xl transform hover:scale-105 transition-all duration-300">
                                    <i class="fas fa-cloud-upload-alt text-2xl"></i>
                                    <span class="text-lg">Upload Video</span>
                                </label>
                                <input id="va-video-upload" type="file" class="hidden" accept="video/*">
                                <p id="va-file-name" class="text-gray-400 text-sm mt-3">Belum ada video dipilih</p>
                            </div>

                            <!-- Video Info -->
                            <div id="va-video-info" class="hidden bg-gray-800/50 backdrop-blur-sm rounded-xl p-4 mb-6 border border-gray-700">
                                <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-center">
                                    <div>
                                        <div class="text-gray-400 text-xs mb-1">Durasi</div>
                                        <div id="va-duration" class="text-white font-semibold">-</div>
                                    </div>
                                    <div>
                                        <div class="text-gray-400 text-xs mb-1">Resolusi</div>
                                        <div id="va-resolution" class="text-white font-semibold">-</div>
                                    </div>
                                    <div>
                                        <div class="text-gray-400 text-xs mb-1">Size</div>
                                        <div id="va-filesize" class="text-white font-semibold">-</div>
                                    </div>
                                    <div>
                                        <div class="text-gray-400 text-xs mb-1">Format</div>
                                        <div id="va-format" class="text-white font-semibold">-</div>
                                    </div>
                                </div>
                            </div>

                            <!-- Frame Count Selector -->
                            <div id="va-frame-selector" class="hidden mb-6">
                                <label class="block text-white font-semibold mb-3 text-center">
                                    <i class="fas fa-sliders-h mr-2"></i>Jumlah Frames untuk Analisis:
                                </label>
                                <div class="flex justify-center gap-3">
                                    <button data-frames="3" class="va-frame-btn bg-gray-700 hover:bg-purple-600 text-white font-semibold py-3 px-6 rounded-lg transition-all duration-300">3 Frames</button>
                                    <button data-frames="5" class="va-frame-btn bg-purple-600 text-white font-semibold py-3 px-6 rounded-lg transition-all duration-300 ring-2 ring-purple-400">5 Frames</button>
                                    <button data-frames="10" class="va-frame-btn bg-gray-700 hover:bg-purple-600 text-white font-semibold py-3 px-6 rounded-lg transition-all duration-300">10 Frames</button>
                                    <button data-frames="15" class="va-frame-btn bg-gray-700 hover:bg-purple-600 text-white font-semibold py-3 px-6 rounded-lg transition-all duration-300">15 Frames</button>
                                </div>
                            </div>
                        </div>

                        <!-- Video Preview -->
                        <div id="va-video-container" class="mb-8 hidden">
                            <video id="video-preview" class="w-full rounded-xl bg-black shadow-2xl border-2 border-purple-500/30" controls></video>
                        </div>

                        <!-- Action Button -->
                        <div class="text-center mb-8">
                            <button id="va-analyze-btn" class="bg-gradient-to-r from-pink-600 to-purple-600 hover:from-pink-700 hover:to-purple-700 text-white font-bold py-4 px-10 rounded-xl shadow-2xl text-lg disabled:opacity-50 disabled:cursor-not-allowed transform hover:scale-105 transition-all duration-300 inline-flex items-center gap-3" disabled>
                                <i class="fas fa-magic"></i>
                                <span>Mulai Analisis</span>
                            </button>
                        </div>

                        <!-- Output Section -->
                        <div id="va-output-section" class="hidden">
                            <!-- Loading Indicator -->
                            <div id="va-loading-indicator" class="mb-6 hidden">
                                <div class="bg-gray-800/50 backdrop-blur-sm rounded-xl p-6 border border-gray-700">
                                    <div class="flex items-center justify-center mb-4">
                                        <svg class="animate-spin h-8 w-8 text-purple-500 mr-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                                        </svg>
                                        <span class="text-white font-semibold text-lg" id="va-loading-text">Extracting frames...</span>
                                    </div>
                                    <div class="w-full bg-gray-700 rounded-full h-3 overflow-hidden">
                                        <div id="va-progress-bar" class="bg-gradient-to-r from-purple-500 to-pink-500 h-3 rounded-full transition-all duration-300" style="width: 0%"></div>
                                    </div>
                                    <p class="text-center text-gray-400 text-sm mt-2" id="va-progress-text">0%</p>
                                </div>
                            </div>

                            <!-- Frames Gallery -->
                            <div id="va-frames-gallery" class="hidden mb-6">
                                <h3 class="text-xl font-bold text-white mb-4 flex items-center gap-2">
                                    <i class="fas fa-images text-purple-400"></i>
                                    Extracted Frames
                                </h3>
                                <div id="va-frames-grid" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-4"></div>
                            </div>

                            <!-- Prompt Result -->
                            <div id="va-prompt-container" class="hidden">
                                <div class="bg-gray-800/50 backdrop-blur-sm rounded-xl p-6 border border-gray-700">
                                    <div class="flex items-center justify-between mb-4">
                                        <h2 class="text-2xl font-bold text-white flex items-center gap-2">
                                            <i class="fas fa-wand-magic-sparkles text-purple-400"></i>
                                            AI Generated Prompt
                                        </h2>
                                        <span class="text-xs text-gray-400 bg-gray-700 px-3 py-1 rounded-full" id="va-char-count">0 characters</span>
                                    </div>
                                    <textarea id="va-prompt-output" rows="12" class="w-full p-4 bg-gray-900 border-2 border-gray-700 rounded-xl text-gray-200 focus:ring-2 focus:ring-purple-500 focus:border-purple-500 focus:outline-none transition-all font-mono text-sm leading-relaxed" readonly></textarea>
                                    <div class="mt-5 flex flex-wrap gap-3">
                                        <button id="va-copy-btn" class="flex-1 bg-gradient-to-r from-purple-600 to-purple-700 hover:from-purple-700 hover:to-purple-800 text-white font-semibold py-3 px-6 rounded-lg shadow-lg transform hover:scale-105 transition-all duration-300 inline-flex items-center justify-center gap-2">
                                            <i class="fas fa-copy"></i>
                                            <span id="va-copy-text">Copy Prompt</span>
                                        </button>
                                        <button id="va-download-prompt-btn" class="flex-1 bg-gradient-to-r from-pink-600 to-pink-700 hover:from-pink-700 hover:to-pink-800 text-white font-semibold py-3 px-6 rounded-lg shadow-lg transform hover:scale-105 transition-all duration-300 inline-flex items-center justify-center gap-2">
                                            <i class="fas fa-download"></i>
                                            <span>Download .txt</span>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- Error Message -->
                        <div id="va-error-message" class="hidden text-center text-red-300 p-5 bg-red-900/50 rounded-xl mt-6 border border-red-700 backdrop-blur-sm"></div>
                    </main>
                </div>
                <canvas id="va-canvas" class="hidden"></canvas>
            </div>
        </div>

        <!-- TAB 12: STICKER TEMPEL -->
        <div id="content-sticker" class="main-content-panel hidden">
            <!-- Decorative background elements -->
            <div class="decorative-shape shape-1"></div>
            <div class="decorative-shape shape-2"></div>
            <div class="decorative-shape shape-3"></div>

            <!-- Cartoon decorations -->
            <svg class="absolute top-5 left-10 w-16 h-16 text-yellow-300 opacity-80 transform -rotate-12" fill="currentColor" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path></svg>
            <svg class="absolute bottom-5 right-5 w-20 h-20 text-pink-300 opacity-80 transform rotate-12" viewBox="0 0 128 128" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M11.6364 64C11.6364 33.3284 33.3284 11.6364 64 11.6364C94.6716 11.6364 116.364 33.3284 116.364 64C116.364 88.5837 100.222 109.43 79.5186 116.364C71.1818 119.33 64 113.682 64 104.727V64C64 54.6081 54.6081 45.2163 45.2163 45.2163C35.8244 45.2163 26.4325 54.6081 26.4325 64C26.4325 94.6716 50.0409 118.28 80.7125 118.28" stroke="currentColor" stroke-width="12" stroke-linecap="round" stroke-linejoin="round"/></svg>

            <div class="w-full max-w-5xl mx-auto main-container-sticker">
                <header class="text-center mb-8">
                    <h1 class="text-4xl md:text-5xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-pink-500 to-orange-400">
                        Sticker Tempel
                    </h1>
                    <p class="text-gray-600 mt-2 max-w-2xl mx-auto">
                        Buat stiker kustom dari fotomu dan tempelkan di atas foto aslinya!
                    </p>
                </header>

                <main class="grid grid-cols-1 md:grid-cols-2 gap-8 bg-white/70 backdrop-blur-xl p-6 sm:p-8 rounded-2xl shadow-xl border border-gray-200/50">
                    <!-- Input Section -->
                    <div class="flex flex-col space-y-4 text-gray-800">
                        <h2 class="text-2xl font-semibold text-center md:text-left">1. Unggah Foto</h2>
                        <div id="sticker-image-upload-area" class="img-preview-container rounded-lg flex items-center justify-center text-gray-500 border-2 border-dashed border-gray-300">
                            <img id="sticker-image-preview" class="img-preview rounded-lg hidden" alt="Pratinjau Gambar">
                            <span id="sticker-upload-placeholder">Pilih gambar untuk memulai...</span>
                        </div>
                        <input type="file" id="sticker-image-input" accept="image/*" class="hidden">
                        <button id="sticker-upload-button" class="w-full bg-cyan-500 hover:bg-cyan-600 text-white font-bold py-3 px-4 rounded-lg transition duration-300 shadow-md hover:shadow-lg">
                            Pilih Gambar
                        </button>
                        <div class="pt-2">
                            <label for="sticker-prompt-addition" class="block text-sm font-medium text-gray-600 mb-1">Tambahkan gaya spesifik (opsional):</label>
                            <input type="text" id="sticker-prompt-addition" class="w-full bg-gray-100 border border-gray-300 text-gray-800 rounded-lg px-3 py-2 focus:ring-2 focus:ring-pink-400 focus:outline-none" placeholder="Contoh: gaya pixel art, cat air, komik">
                        </div>
                        <button id="sticker-generate-button" class="w-full bg-orange-500 hover:bg-orange-600 text-white font-bold py-3 px-4 rounded-lg transition duration-300 disabled:bg-gray-400 disabled:cursor-not-allowed shadow-md hover:shadow-lg">
                            Buat Stiker!
                        </button>
                    </div>

                    <!-- Output Section -->
                    <div class="flex flex-col space-y-4 text-gray-800">
                        <h2 class="text-2xl font-semibold text-center md:text-left">2. Hasil Stiker</h2>
                        <div id="sticker-output-area" class="img-preview-container rounded-lg border-2 border-gray-300">
                            <div id="sticker-output-area-content">
                                <div id="sticker-loading-spinner" class="loader-sticker hidden"></div>
                                <div id="sticker-result-container" class="hidden w-full h-full relative">
                                    <img id="sticker-original-output-image" class="w-full h-full object-contain rounded-lg" alt="Gambar Asli" crossOrigin="anonymous">
                                    <div id="sticker-sticker-wrapper" class="hidden" style="bottom: 1rem; right: 1rem; width: 33.33%;">
                                        <img id="sticker-cartoon-output-image" class="w-full h-full object-contain" alt="Hasil Stiker" crossOrigin="anonymous">
                                        <div id="sticker-resize-handle"></div>
                                    </div>
                                </div>
                                <span id="sticker-output-placeholder" class="text-gray-500 text-center p-4">Hasil stiker akan muncul di sini...</span>
                                <div id="sticker-error-message" class="text-red-500 text-center p-4 hidden"></div>
                            </div>
                        </div>
                        <p id="sticker-drag-instruction" class="text-center text-gray-500 text-sm hidden">Tips: Anda bisa menggeser dan mengubah ukuran stiker!</p>

                        <div id="sticker-tolerance-slider-container" class="w-full pt-2 hidden">
                            <label for="sticker-tolerance-slider" class="block text-sm font-medium text-center text-gray-600 mb-1">Geser untuk Atur Toleransi Latar</label>
                            <input type="range" id="sticker-tolerance-slider" min="1" max="255" value="160" class="w-full">
                        </div>

                        <div id="sticker-button-container" class="grid grid-cols-2 gap-4">
                            <button id="sticker-remove-bg-button" class="w-full text-center bg-teal-500 hover:bg-teal-600 text-white font-bold py-3 px-4 rounded-lg transition duration-300 hidden shadow-md hover:shadow-lg">
                                Hapus Latar
                            </button>
                            <button id="sticker-download-button" class="w-full text-center bg-lime-500 hover:bg-lime-600 text-white font-bold py-3 px-4 rounded-lg transition duration-300 hidden shadow-md hover:shadow-lg">
                                Unduh Hasil
                            </button>
                        </div>
                    </div>
                </main>
            </div>
        </div>

        <!-- TAB 13: HAIR GENERATOR -->
        <div id="content-hair-generator" class="main-content-panel hidden">
            <div class="flex flex-col lg:flex-row h-full">

                <!-- Panel Kontrol (Kiri) -->
                <div class="w-full lg:w-1/3 xl:w-1/4 p-6 control-panel overflow-y-auto">
                    <h1 class="text-2xl font-bold text-center mb-6 text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-purple-500">
                        Generator Perubah Rambut
                    </h1>

                    <div class="space-y-6">
                        <!-- 1. Unggah Foto -->
                        <div>
                            <label class="w-full cursor-pointer bg-gray-800 hover:bg-gray-700 border border-gray-700 text-white font-semibold py-3 px-4 rounded-lg flex items-center justify-center transition-colors">
                                <i class="fas fa-upload mr-2"></i>
                                <span id="hair-upload-text">Unggah Foto</span>
                                <input
                                    type="file"
                                    id="hair-image-input"
                                    accept="image/png, image/jpeg, image/webp, image/heic, .heic"
                                    class="hidden"
                                />
                            </label>
                            <!-- Preview Image (Mobile) -->
                            <div id="hair-preview-container" class="mt-3 hidden lg:hidden">
                                <img id="hair-image-preview" src="" alt="Preview" class="w-full rounded-lg shadow-lg max-h-48 object-cover">
                                <button id="hair-remove-preview" class="mt-2 w-full bg-red-600 hover:bg-red-700 text-white text-sm py-2 px-3 rounded-lg transition-colors">
                                    <i class="fas fa-times mr-1"></i> Hapus Foto
                                </button>
                            </div>
                        </div>

                        <!-- 2. Pilih Gender -->
                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">Pilih Gender</label>
                            <div class="flex w-full bg-gray-800 rounded-lg p-1">
                                <button
                                    id="hair-gender-wanita"
                                    class="gender-btn active w-1/2 py-2 rounded-md text-sm font-medium text-gray-300 hover:bg-gray-700"
                                >
                                    Wanita
                                </button>
                                <button
                                    id="hair-gender-pria"
                                    class="gender-btn w-1/2 py-2 rounded-md text-sm font-medium text-gray-300 hover:bg-gray-700"
                                >
                                    Pria
                                </button>
                            </div>
                        </div>

                        <!-- 3. Pilihan Gaya -->
                        <div class="w-full">
                            <label class="block text-sm font-medium text-gray-300 mb-1">Pilih Gaya Rambut</label>
                            <select
                                id="hair-style-select"
                                class="w-full bg-gray-800 border border-gray-700 text-white rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:outline-none"
                            >
                            </select>
                        </div>

                        <!-- 4. Pilihan Warna -->
                        <div class="w-full">
                            <label class="block text-sm font-medium text-gray-300 mb-1">Pilih Warna Rambut</label>
                            <select
                                id="hair-color-select"
                                class="w-full bg-gray-800 border border-gray-700 text-white rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:outline-none"
                            >
                            </select>
                        </div>

                        <!-- 5. Pilih Rasio Gambar -->
                        <div class="w-full">
                            <label class="block text-sm font-medium text-gray-300 mb-2">Rasio Gambar</label>
                            <div id="hair-ratio-options" class="grid grid-cols-2 gap-2">
                                <button type="button" data-value="1:1" class="hair-ratio-btn bg-gray-800 hover:bg-gray-700 text-gray-300 px-3 py-2 rounded-lg border border-gray-700 transition-all text-sm">
                                    <i class="fas fa-square mr-1"></i>1:1
                                </button>
                                <button type="button" data-value="16:9" class="hair-ratio-btn bg-gray-800 hover:bg-gray-700 text-gray-300 px-3 py-2 rounded-lg border border-gray-700 transition-all text-sm">
                                    <i class="fas fa-rectangle-landscape mr-1"></i>16:9
                                </button>
                                <button type="button" data-value="3:4" class="hair-ratio-btn hair-ratio-selected bg-blue-600 text-white px-3 py-2 rounded-lg border-2 border-blue-500 transition-all text-sm font-medium">
                                    <i class="fas fa-rectangle-portrait mr-1"></i>3:4
                                </button>
                                <button type="button" data-value="9:16" class="hair-ratio-btn bg-gray-800 hover:bg-gray-700 text-gray-300 px-3 py-2 rounded-lg border border-gray-700 transition-all text-sm">
                                    <i class="fas fa-mobile-alt mr-1"></i>9:16
                                </button>
                            </div>
                        </div>

                        <!-- 6. Tombol Generate -->
                        <button
                            id="hair-generate-btn"
                            class="w-full bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white font-bold py-3 px-4 rounded-lg flex items-center justify-center transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed shadow-lg"
                        >
                            <i class="fas fa-magic mr-2"></i>
                            ubah Rambutnya!
                        </button>

                        <!-- 6. Pesan Error -->
                        <div id="hair-error-message" class="hidden bg-red-900/50 border border-red-700 text-red-200 px-4 py-3 rounded-lg flex items-start">
                            <i class="fas fa-exclamation-triangle mr-3 mt-1"></i>
                            <p class="text-sm" id="hair-error-text"></p>
                        </div>
                    </div>
                </div>

                <!-- Panel Gambar (Kanan) -->
                <div class="w-full lg:w-2/3 xl:w-3/4 p-6 md:p-10 overflow-y-auto">
                    <!-- Placeholder -->
                    <div id="hair-results-placeholder" class="flex flex-col items-center justify-center h-full text-center">
                        <div class="w-24 h-24 rounded-full bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center mb-6 shadow-lg">
                            <i class="fas fa-cut text-white text-4xl"></i>
                        </div>
                        <h3 class="text-2xl font-bold text-gray-300 mb-3">Hasil Hair Generator Anda</h3>
                        <p class="text-gray-500 max-w-md">Upload foto dan pilih gaya rambut. Akan generate 4 variasi hasil yang bisa di-preview dan download!</p>
                        <div class="mt-6 flex items-center gap-4">
                            <div class="flex items-center gap-2">
                                <i class="fas fa-check-circle text-blue-500"></i>
                                <span class="text-sm text-gray-400">4 Variasi</span>
                            </div>
                            <div class="flex items-center gap-2">
                                <i class="fas fa-bolt text-purple-500"></i>
                                <span class="text-sm text-gray-400">HD Quality</span>
                            </div>
                        </div>
                    </div>

                    <!-- Results Container -->
                    <div id="hair-results-container" class="hidden">
                        <div class="flex items-center justify-between mb-6 bg-gradient-to-r from-blue-900/30 to-purple-900/30 p-4 rounded-xl border-2 border-blue-700">
                            <h3 class="text-xl font-bold text-gray-200">
                                <i class="fas fa-sparkles mr-2 text-blue-400"></i>
                                Hasil Hair Generator
                            </h3>
                            <button id="hair-download-all-btn" class="bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white px-6 py-2 rounded-full font-semibold shadow-lg transition transform hover:scale-105 flex items-center gap-2">
                                <i class="fas fa-download"></i>
                                Download Semua
                            </button>
                        </div>
                        <div id="hair-results-grid" class="grid grid-cols-1 md:grid-cols-2 gap-6"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- TAB 14: POV TANGAN -->
        <div id="content-pov-tangan" class="main-content-panel hidden">
            <div class="container mx-auto max-w-7xl">
                <header class="text-center mb-8">
                    <h1 class="text-4xl md:text-5xl font-bold mb-3 drop-shadow-lg">
                        <i class="fas fa-hand-holding mr-3"></i>POV Tangan Generator
                    </h1>
                    <p class="text-lg opacity-90">
                        Buat 7 foto POV tangan memegang produk dengan background custom atau aesthetic otomatis
                    </p>
                    <p class="text-sm opacity-75 mt-2">
                        Upload foto lokasi apapun ‚Üí Produk Anda akan ditempatkan di lokasi tersebut!
                    </p>
                </header>

                <div class="card mb-8">
                    <!-- Upload Section -->
                    <div class="mb-6">
                        <h2 class="text-2xl font-bold mb-4 text-gray-800">
                            <i class="fas fa-cloud-upload-alt mr-2"></i>Upload Foto Produk
                        </h2>
                        <div id="pov-upload-area" class="upload-area cursor-pointer">
                            <div id="pov-upload-placeholder" style="display: block;">
                                <i class="fas fa-images text-6xl text-purple-500 mb-4"></i>
                                <p class="text-xl font-semibold text-gray-700 mb-2">
                                    Klik atau drag foto produk Anda di sini
                                </p>
                                <p class="text-sm text-gray-500">
                                    Format: JPG, PNG, WEBP (Max 10MB)
                                </p>
                            </div>
                            <div id="pov-preview-container" class="hidden">
                                <img id="pov-preview-image" alt="Preview" class="preview-image" />
                            </div>
                        </div>
                        <input
                            type="file"
                            id="pov-image-input"
                            accept="image/*"
                            class="hidden"
                        />
                    </div>

                    <!-- Custom Background Section (NEW) -->
                    <div class="mb-6">
                        <h3 class="text-xl font-bold mb-3 text-gray-800">
                            <i class="fas fa-image mr-2"></i>Background Custom (Opsional)
                        </h3>
                        <div id="pov-bg-upload-area" class="upload-area cursor-pointer" style="min-height: 150px;">
                            <div id="pov-bg-placeholder" style="display: block;">
                                <i class="fas fa-panorama text-4xl text-indigo-500 mb-3"></i>
                                <p class="text-lg font-semibold text-gray-700 mb-1">
                                    Upload foto lokasi/background (Opsional)
                                </p>
                                <p class="text-xs text-gray-500">
                                    Produk akan ditempatkan di lokasi ini
                                </p>
                            </div>
                            <div id="pov-bg-preview-container" class="hidden relative">
                                <img id="pov-bg-preview-image" alt="Background Preview" class="preview-image" />
                                <button id="pov-bg-remove-btn" class="absolute top-2 right-2 bg-red-500 hover:bg-red-600 text-white rounded-full w-8 h-8 flex items-center justify-center transition-all">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                        </div>
                        <input
                            type="file"
                            id="pov-bg-input"
                            accept="image/*"
                            class="hidden"
                        />
                        <p class="text-xs text-gray-500 mt-2">
                            <i class="fas fa-magic mr-1"></i>
                            Tips: Upload foto lokasi apapun (bengkel, cafe, kamar, taman, dll). Produk akan digabungkan ke lokasi tersebut dengan POV tangan
                        </p>
                    </div>

                    <!-- Background Description Section -->
                    <div class="mb-6">
                        <h3 class="text-xl font-bold mb-3 text-gray-800">
                            <i class="fas fa-image mr-2"></i>Deskripsi Background (Opsional)
                        </h3>
                        <textarea
                            id="pov-product-description"
                            placeholder="Contoh: Meja kayu minimalis dengan tanaman hijau, Cafe aesthetic Korea dengan latte, Background pink aesthetic dengan pegboard, dll..."
                            class="w-full p-4 border-2 border-purple-200 rounded-lg focus:border-purple-500 focus:ring-2 focus:ring-purple-200 transition-all"
                            rows="3"
                        ></textarea>
                        <p class="text-xs text-gray-500 mt-2">
                            <i class="fas fa-lightbulb mr-1"></i>
                            Tips: Deskripsikan background/setting yang Anda inginkan. Kosongkan untuk mendapatkan berbagai aesthetic background otomatis.
                        </p>
                    </div>

                    <!-- Hand Count Selection -->
                    <div class="mb-6">
                        <h3 class="text-xl font-bold mb-3 text-gray-800">
                            <i class="fas fa-hand-paper mr-2"></i>Jumlah Tangan
                        </h3>
                        <div id="pov-hand-count-selection" class="grid grid-cols-2 gap-3">
                            <button type="button" data-hand-count="1" class="hand-count-btn-pov selected">
                                <i class="fas fa-hand-paper mr-2"></i>1 Tangan
                            </button>
                            <button type="button" data-hand-count="2" class="hand-count-btn-pov">
                                <i class="fas fa-hands mr-2"></i>2 Tangan
                            </button>
                        </div>
                        <p class="text-xs text-gray-500 mt-2">
                            <i class="fas fa-lightbulb mr-1"></i>
                            Pilih apakah produk akan digenggam dengan 1 tangan atau 2 tangan
                        </p>
                    </div>

                    <!-- Aspect Ratio Selection -->
                    <div class="mb-6">
                        <h3 class="text-xl font-bold mb-3 text-gray-800">
                            <i class="fas fa-expand-arrows-alt mr-2"></i>Rasio Aspek
                        </h3>
                        <div id="pov-ratio-selection" class="grid grid-cols-2 sm:grid-cols-4 gap-3">
                            <button type="button" data-ratio="1:1" class="ratio-btn-pov">
                                <i class="fas fa-square mr-2"></i>1:1
                            </button>
                            <button type="button" data-ratio="16:9" class="ratio-btn-pov selected">
                                <i class="fas fa-rectangle-landscape mr-2"></i>16:9
                            </button>
                            <button type="button" data-ratio="3:4" class="ratio-btn-pov">
                                <i class="fas fa-rectangle-portrait mr-2"></i>3:4
                            </button>
                            <button type="button" data-ratio="9:16" class="ratio-btn-pov">
                                <i class="fas fa-mobile-alt mr-2"></i>9:16
                            </button>
                        </div>
                        <p class="text-xs text-gray-500 mt-2">
                            <i class="fas fa-lightbulb mr-1"></i>
                            Pilih rasio aspek untuk semua foto POV yang akan di-generate
                        </p>
                    </div>

                    <!-- Generate Button -->
                    <div class="text-center">
                        <button
                            id="pov-generate-btn"
                            class="btn-generate disabled:opacity-50"
                            disabled
                        >
                            <i class="fas fa-magic mr-3"></i>
                            Generate 7 Foto POV Tangan
                        </button>
                    </div>
                </div>

                <!-- Loading Section -->
                <div id="pov-loading-section" class="hidden text-center py-12">
                    <div class="card inline-block">
                        <div class="flex flex-col items-center">
                            <div class="pov-loader mb-6"></div>
                            <h3 class="text-2xl font-bold text-gray-800 mb-2">
                                Sedang Membuat Foto POV Tangan...
                            </h3>
                            <p class="text-gray-600 mb-4">
                                Mohon tunggu, AI sedang menghasilkan <span id="pov-progress-text">0/7</span> foto
                            </p>
                            <div class="w-full max-w-md bg-gray-200 rounded-full h-3">
                                <div
                                    id="pov-progress-bar"
                                    class="bg-gradient-to-r from-purple-500 to-indigo-600 h-3 rounded-full transition-all duration-300"
                                    style="width: 0%"
                                ></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Results Section -->
                <div id="pov-results-section" class="hidden">
                    <div class="card">
                        <div class="flex justify-between items-center mb-6">
                            <h2 class="text-3xl font-bold text-gray-800">
                                <i class="fas fa-check-circle text-green-500 mr-2"></i>
                                Hasil POV Tangan (<span id="pov-result-count">0</span> foto)
                            </h2>
                            <button
                                id="pov-download-all-btn"
                                class="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-6 rounded-full transition-all"
                            >
                                <i class="fas fa-download mr-2"></i>
                                Download Semua
                            </button>
                        </div>
                        <div id="pov-results-grid" class="result-grid">
                            <!-- Results will be inserted here -->
                        </div>
                    </div>
                </div>

                <!-- Error Section -->
                <div id="pov-error-section" class="hidden">
                    <div class="card bg-red-50 border-2 border-red-300">
                        <div class="flex items-start">
                            <i class="fas fa-exclamation-triangle text-red-500 text-3xl mr-4 mt-1"></i>
                            <div>
                                <h3 class="text-xl font-bold text-red-800 mb-2">Terjadi Kesalahan</h3>
                                <p id="pov-error-message" class="text-red-700"></p>
                                <button
                                    id="pov-retry-btn"
                                    class="mt-4 bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-6 rounded-lg transition-all"
                                >
                                    <i class="fas fa-redo mr-2"></i>Coba Lagi
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Universal Modal for Popups -->
    <div id="universal-modal" class="modal-backdrop">
        <div class="modal-content-universal">
            <div class="flex justify-between items-center mb-4">
                <h3 id="modal-title" class="text-xl font-bold text-gray-900"></h3>
                <button id="close-modal-btn" class="text-gray-500 text-3xl font-bold hover:text-gray-800">&times;</button>
            </div>
            <div id="modal-body"></div>
        </div>
    </div>
    
    <!-- Pose Selection Modal for AffiliateGo Tab (Remains outside for simplicity) -->
    <div id="poses-poseModal" class="hidden fixed inset-0 bg-black/70 flex items-center justify-center p-4 z-50">
        <div class="bg-white border border-gray-300 rounded-2xl w-full max-w-2xl flex flex-col max-h-[90vh]">
            <div class="p-6 border-b border-gray-300">
                <h3 class="text-2xl font-bold">Pilih Hingga 6 Pose</h3>
                <p class="text-gray-500">Terpilih: <span id="poses-selectionCounter" class="font-bold">0</span>/6</p>
            </div>
            <div id="poses-poseListContainer" class="p-6 overflow-y-auto"></div>
            <div class="p-6 border-t border-gray-300 flex justify-end gap-4">
                <button id="poses-cancelModalBtn" class="bg-gray-300 text-gray-700 font-semibold py-2 px-6 rounded-lg hover:bg-gray-400">Batal</button>
                <button id="poses-generateBtn" disabled class="bg-cyan-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-cyan-700 disabled:bg-gray-300">Buat Pose</button>
            </div>
        </div>
    </div>

    <!-- TAB: Poster Generator -->
        <div id="content-poster-generator" class="main-content-panel hidden">
            <div class="container mx-auto max-w-7xl">
                <!-- Header -->
                <header class="text-center mb-10">
                    <div class="inline-flex items-center gap-3 mb-4">
                        <div class="w-16 h-16 rounded-2xl flex items-center justify-center shadow-lg" style="background: linear-gradient(135deg, #8B5CF6 0%, #EC4899 100%);">
                            <i class="fas fa-image text-white text-3xl"></i>
                        </div>
                        <div class="flex flex-col items-start">
                            <h1 class="text-4xl md:text-5xl font-bold text-transparent bg-clip-text" style="background: linear-gradient(135deg, #8B5CF6 0%, #EC4899 100%);">
                                Professional Poster Generator
                            </h1>
                            <span class="text-xs font-semibold px-3 py-1 rounded-full mt-1 text-white" style="background: linear-gradient(135deg, #8B5CF6 0%, #EC4899 100%);">üé® AI-Powered Design</span>
                        </div>
                    </div>
                    <p class="text-lg text-gray-600 max-w-3xl mx-auto">
                        Buat poster profesional untuk berbagai kebutuhan dalam hitungan detik! Event, promosi, social media, dan banyak lagi dengan AI.
                    </p>
                </header>

                <div class="flex flex-col lg:flex-row gap-8">
                    <!-- Left Panel: Controls -->
                    <div class="w-full lg:w-5/12 flex-shrink-0">
                        <div class="card p-6 sticky top-6">
                            <div class="flex flex-col gap-6">

                                <!-- Step 1: Upload Image (Optional) -->
                                <div>
                                    <div class="flex items-center gap-3 mb-4">
                                        <div class="flex items-center justify-center w-8 h-8 rounded-full text-white font-bold text-sm shadow-lg" style="background: linear-gradient(135deg, #8B5CF6, #EC4899);">1</div>
                                        <h3 class="text-lg font-bold text-gray-800">Upload Foto (Opsional)</h3>
                                    </div>
                                    <div id="poster-upload-box" class="upload-box-poster">
                                        <input type="file" id="poster-image-input" accept="image/*" class="hidden">
                                        <div class="text-center">
                                            <i class="fas fa-cloud-upload-alt text-5xl mb-3" style="background: linear-gradient(135deg, #8B5CF6, #EC4899); -webkit-background-clip: text; -webkit-text-fill-color: transparent;"></i>
                                            <p class="text-gray-700 font-semibold mb-1">Click atau drag foto</p>
                                            <p class="text-gray-500 text-sm">JPG, PNG, HEIC (Max 10MB)</p>
                                            <p class="text-gray-400 text-xs mt-2">Foto akan diintegrasikan ke dalam poster</p>
                                        </div>
                                    </div>
                                    <div id="poster-preview-container" class="hidden mt-3">
                                        <div class="relative">
                                            <img id="poster-preview-image" class="w-full rounded-lg border-2 border-purple-200">
                                            <button id="poster-remove-image" class="absolute top-2 right-2 bg-red-500 hover:bg-red-600 text-white rounded-full w-8 h-8 flex items-center justify-center shadow-lg transition-all">
                                                <i class="fas fa-times"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>

                                <!-- Step 2: Poster Type -->
                                <div>
                                    <div class="flex items-center gap-3 mb-4">
                                        <div class="flex items-center justify-center w-8 h-8 rounded-full text-white font-bold text-sm shadow-lg" style="background: linear-gradient(135deg, #8B5CF6, #EC4899);">2</div>
                                        <h3 class="text-lg font-bold text-gray-800">Jenis Poster</h3>
                                    </div>
                                    <select id="poster-type" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-purple-500 focus:ring-2 focus:ring-purple-200 transition-all">
                                        <option value="event">Event / Acara</option>
                                        <option value="promo">Promosi / Sale / Diskon</option>
                                        <option value="social-media">Social Media Post</option>
                                        <option value="workshop">Workshop / Pelatihan</option>
                                        <option value="seminar">Seminar / Webinar</option>
                                        <option value="concert">Konser / Musik</option>
                                        <option value="sport">Olahraga / Turnamen</option>
                                        <option value="movie">Film / Cinema</option>
                                        <option value="food">Makanan / Kuliner</option>
                                        <option value="recruitment">Lowongan Kerja</option>
                                        <option value="announcement">Pengumuman / Info</option>
                                        <option value="custom">Custom</option>
                                    </select>
                                </div>

                                <!-- Step 3: Poster Title -->
                                <div>
                                    <div class="flex items-center gap-3 mb-4">
                                        <div class="flex items-center justify-center w-8 h-8 rounded-full text-white font-bold text-sm shadow-lg" style="background: linear-gradient(135deg, #8B5CF6, #EC4899);">3</div>
                                        <h3 class="text-lg font-bold text-gray-800">Judul Poster <span class="text-red-500">*</span></h3>
                                    </div>
                                    <input type="text" id="poster-title" placeholder="Contoh: GRAND OPENING, FESTIVAL MUSIK 2025, FLASH SALE 50%" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-purple-500 focus:ring-2 focus:ring-purple-200 transition-all">
                                </div>

                                <!-- Step 4: Subtitle -->
                                <div>
                                    <div class="flex items-center gap-3 mb-4">
                                        <div class="flex items-center justify-center w-8 h-8 rounded-full text-white font-bold text-sm shadow-lg" style="background: linear-gradient(135deg, #8B5CF6, #EC4899);">4</div>
                                        <h3 class="text-lg font-bold text-gray-800">Subjudul / Tagline</h3>
                                    </div>
                                    <input type="text" id="poster-subtitle" placeholder="Contoh: Diskon hingga 70%, Join us for amazing experience" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-purple-500 focus:ring-2 focus:ring-purple-200 transition-all">
                                </div>

                                <!-- Step 5: Description/Details -->
                                <div>
                                    <div class="flex items-center gap-3 mb-4">
                                        <div class="flex items-center justify-center w-8 h-8 rounded-full text-white font-bold text-sm shadow-lg" style="background: linear-gradient(135deg, #8B5CF6, #EC4899);">5</div>
                                        <h3 class="text-lg font-bold text-gray-800">Detail Informasi</h3>
                                    </div>
                                    <textarea id="poster-description" rows="3" placeholder="Tanggal, waktu, lokasi, info penting lainnya..." class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-purple-500 focus:ring-2 focus:ring-purple-200 transition-all"></textarea>
                                </div>

                                <!-- Step 6: Contact Info -->
                                <div>
                                    <div class="flex items-center gap-3 mb-4">
                                        <div class="flex items-center justify-center w-8 h-8 rounded-full text-white font-bold text-sm shadow-lg" style="background: linear-gradient(135deg, #8B5CF6, #EC4899);">6</div>
                                        <h3 class="text-lg font-bold text-gray-800">Kontak / Website</h3>
                                    </div>
                                    <input type="text" id="poster-contact" placeholder="Phone, email, website, atau Instagram" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-purple-500 focus:ring-2 focus:ring-purple-200 transition-all">
                                </div>

                                <!-- Step 7: Color Theme -->
                                <div>
                                    <div class="flex items-center gap-3 mb-4">
                                        <div class="flex items-center justify-center w-8 h-8 rounded-full text-white font-bold text-sm shadow-lg" style="background: linear-gradient(135deg, #8B5CF6, #EC4899);">7</div>
                                        <h3 class="text-lg font-bold text-gray-800">Tema Warna</h3>
                                    </div>
                                    <div class="grid grid-cols-4 gap-3">
                                        <button class="poster-color-btn active" data-color="vibrant" style="background: linear-gradient(135deg, #F59E0B 0%, #EF4444 100%);">
                                            <span class="text-white text-xs font-semibold">Vibrant</span>
                                        </button>
                                        <button class="poster-color-btn" data-color="professional" style="background: linear-gradient(135deg, #1E40AF 0%, #4F46E5 100%);">
                                            <span class="text-white text-xs font-semibold">Pro</span>
                                        </button>
                                        <button class="poster-color-btn" data-color="elegant" style="background: linear-gradient(135deg, #000000 0%, #374151 100%);">
                                            <span class="text-white text-xs font-semibold">Elegant</span>
                                        </button>
                                        <button class="poster-color-btn" data-color="nature" style="background: linear-gradient(135deg, #10B981 0%, #059669 100%);">
                                            <span class="text-white text-xs font-semibold">Nature</span>
                                        </button>
                                        <button class="poster-color-btn" data-color="sunset" style="background: linear-gradient(135deg, #F97316 0%, #DC2626 100%);">
                                            <span class="text-white text-xs font-semibold">Sunset</span>
                                        </button>
                                        <button class="poster-color-btn" data-color="ocean" style="background: linear-gradient(135deg, #06B6D4 0%, #0284C7 100%);">
                                            <span class="text-white text-xs font-semibold">Ocean</span>
                                        </button>
                                        <button class="poster-color-btn" data-color="pastel" style="background: linear-gradient(135deg, #FCA5A5 0%, #C4B5FD 100%);">
                                            <span class="text-white text-xs font-semibold">Pastel</span>
                                        </button>
                                        <button class="poster-color-btn" data-color="neon" style="background: linear-gradient(135deg, #A855F7 0%, #EC4899 100%);">
                                            <span class="text-white text-xs font-semibold">Neon</span>
                                        </button>
                                    </div>
                                </div>

                                <!-- Step 8: Design Style -->
                                <div>
                                    <div class="flex items-center gap-3 mb-4">
                                        <div class="flex items-center justify-center w-8 h-8 rounded-full text-white font-bold text-sm shadow-lg" style="background: linear-gradient(135deg, #8B5CF6, #EC4899);">8</div>
                                        <h3 class="text-lg font-bold text-gray-800">Style Desain</h3>
                                    </div>
                                    <div class="grid grid-cols-2 gap-3">
                                        <button class="poster-style-btn active" data-style="modern">
                                            <i class="fas fa-sparkles mr-2"></i>Modern
                                        </button>
                                        <button class="poster-style-btn" data-style="minimalist">
                                            <i class="fas fa-minus mr-2"></i>Minimalist
                                        </button>
                                        <button class="poster-style-btn" data-style="bold">
                                            <i class="fas fa-bold mr-2"></i>Bold & Colorful
                                        </button>
                                        <button class="poster-style-btn" data-style="vintage">
                                            <i class="fas fa-history mr-2"></i>Vintage
                                        </button>
                                        <button class="poster-style-btn" data-style="professional">
                                            <i class="fas fa-briefcase mr-2"></i>Professional
                                        </button>
                                        <button class="poster-style-btn" data-style="creative">
                                            <i class="fas fa-palette mr-2"></i>Creative
                                        </button>
                                        <button class="poster-style-btn" data-style="elegant">
                                            <i class="fas fa-gem mr-2"></i>Elegant
                                        </button>
                                        <button class="poster-style-btn" data-style="playful">
                                            <i class="fas fa-smile mr-2"></i>Playful
                                        </button>
                                    </div>
                                </div>

                                <!-- Step 9: Poster Size -->
                                <div>
                                    <div class="flex items-center gap-3 mb-4">
                                        <div class="flex items-center justify-center w-8 h-8 rounded-full text-white font-bold text-sm shadow-lg" style="background: linear-gradient(135deg, #8B5CF6, #EC4899);">9</div>
                                        <h3 class="text-lg font-bold text-gray-800">Ukuran Poster</h3>
                                    </div>
                                    <div class="grid grid-cols-2 gap-3">
                                        <button class="poster-size-btn active" data-ratio="3:4">
                                            <i class="fas fa-mobile-alt mr-2"></i>3:4 (Portrait)
                                        </button>
                                        <button class="poster-size-btn" data-ratio="1:1">
                                            <i class="fas fa-square mr-2"></i>1:1 (Square)
                                        </button>
                                        <button class="poster-size-btn" data-ratio="4:3">
                                            <i class="fas fa-desktop mr-2"></i>4:3 (Landscape)
                                        </button>
                                        <button class="poster-size-btn" data-ratio="9:16">
                                            <i class="fas fa-mobile mr-2"></i>9:16 (Story)
                                        </button>
                                        <button class="poster-size-btn" data-ratio="16:9">
                                            <i class="fas fa-tv mr-2"></i>16:9 (Wide)
                                        </button>
                                        <button class="poster-size-btn" data-ratio="4:5">
                                            <i class="fab fa-instagram mr-2"></i>4:5 (IG Post)
                                        </button>
                                    </div>
                                </div>

                                <!-- Step 10: Number of Variations -->
                                <div>
                                    <div class="flex items-center gap-3 mb-4">
                                        <div class="flex items-center justify-center w-8 h-8 rounded-full text-white font-bold text-sm shadow-lg" style="background: linear-gradient(135deg, #8B5CF6, #EC4899);">10</div>
                                        <h3 class="text-lg font-bold text-gray-800">Jumlah Variasi</h3>
                                    </div>
                                    <div class="grid grid-cols-3 gap-3">
                                        <button class="poster-count-btn active" data-count="3">3 Poster</button>
                                        <button class="poster-count-btn" data-count="6">6 Poster</button>
                                        <button class="poster-count-btn" data-count="9">9 Poster</button>
                                    </div>
                                </div>

                                <!-- Generate Button -->
                                <button id="poster-generate-btn" class="w-full py-4 px-6 rounded-lg text-white font-bold text-lg shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300" style="background: linear-gradient(135deg, #8B5CF6 0%, #EC4899 100%);">
                                    <i class="fas fa-magic mr-2"></i>Generate Poster
                                </button>

                            </div>
                        </div>
                    </div>

                    <!-- Right Panel: Results -->
                    <div class="flex-1">
                        <div class="card p-6">
                            <div class="flex justify-between items-center mb-6">
                                <h2 class="text-2xl font-bold text-gray-800">
                                    <i class="fas fa-images mr-2 text-purple-600"></i>Hasil Poster
                                </h2>
                                <button id="poster-download-all-btn" class="hidden px-4 py-2 rounded-lg text-white font-semibold shadow-md hover:shadow-lg transition-all" style="background: linear-gradient(135deg, #8B5CF6, #EC4899);">
                                    <i class="fas fa-download mr-2"></i>Download Semua
                                </button>
                            </div>

                            <!-- Results Grid -->
                            <div id="poster-results-grid" class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4 hidden"></div>

                            <!-- Placeholder -->
                            <div id="poster-placeholder" class="flex flex-col items-center justify-center py-20 text-gray-400">
                                <i class="fas fa-image text-8xl mb-4"></i>
                                <p class="text-xl font-semibold mb-2">Poster Anda akan muncul di sini</p>
                                <p class="text-sm">Lengkapi form dan klik Generate Poster</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- OBJECT REMOVER -->
        <div id="content-object-remover" class="main-content-panel hidden">
            <div class="content-wrapper">
                <div class="space-y-6">
                    <!-- Header -->
                    <div class="card p-6">
                        <h1 class="text-3xl font-bold bg-gradient-to-r from-red-500 to-red-600 bg-clip-text text-transparent mb-2">
                            <i class="fas fa-eraser mr-2"></i>Hapus Object
                        </h1>
                        <p class="text-gray-600">Hilangkan objek yang tidak diinginkan dari foto Anda secara otomatis atau manual dengan brush tool profesional</p>
                    </div>

                    <!-- Main Form -->
                    <div class="card p-6">
                        <div class="space-y-6">
                            <!-- Step 1: Upload Photo -->
                            <div>
                                <div class="flex items-center gap-3 mb-4">
                                    <div class="flex items-center justify-center w-8 h-8 rounded-full bg-gradient-to-br from-red-500 to-red-600 text-white font-bold text-sm shadow-lg">1</div>
                                    <h3 class="text-lg font-bold text-gray-800">Upload Foto</h3>
                                </div>
                                <div class="upload-box-remover" id="remover-upload-box">
                                    <input type="file" id="remover-upload-input" class="hidden" accept="image/*,.heic">
                                    <div id="remover-upload-placeholder" class="space-y-4">
                                        <div class="flex justify-center">
                                            <div class="w-24 h-24 rounded-full bg-gradient-to-br from-red-100 to-red-200 flex items-center justify-center">
                                                <i class="fas fa-cloud-upload-alt text-4xl text-red-600"></i>
                                            </div>
                                        </div>
                                        <div>
                                            <p class="text-lg font-semibold text-gray-700 mb-1">Klik atau Drag & Drop Foto</p>
                                            <p class="text-sm text-gray-500">Mendukung JPG, PNG, HEIC (Max 10MB)</p>
                                        </div>
                                    </div>
                                    <div id="remover-preview-container" class="hidden">
                                        <img id="remover-preview-image" class="max-w-full h-auto rounded-lg shadow-lg" alt="Preview">
                                        <button id="remover-change-photo-btn" class="mt-4 px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors">
                                            <i class="fas fa-sync-alt mr-2"></i>Ganti Foto
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!-- Step 2: Pilih Mode -->
                            <div id="remover-mode-section" class="hidden">
                                <div class="flex items-center gap-3 mb-4">
                                    <div class="flex items-center justify-center w-8 h-8 rounded-full bg-gradient-to-br from-red-500 to-red-600 text-white font-bold text-sm shadow-lg">2</div>
                                    <h3 class="text-lg font-bold text-gray-800">Pilih Mode Penghapusan</h3>
                                </div>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <button class="remover-mode-btn active" data-mode="auto">
                                        <div class="relative z-10">
                                            <i class="fas fa-magic text-2xl mb-2"></i>
                                            <p class="font-bold text-lg">Otomatis (AI)</p>
                                            <p class="text-sm mt-1 opacity-80">AI deteksi & hapus objek mengganggu</p>
                                        </div>
                                    </button>
                                    <button class="remover-mode-btn" data-mode="manual">
                                        <div class="relative z-10">
                                            <i class="fas fa-paint-brush text-2xl mb-2"></i>
                                            <p class="font-bold text-lg">Manual (Brush)</p>
                                            <p class="text-sm mt-1 opacity-80">Pilih area dengan kuas</p>
                                        </div>
                                    </button>
                                </div>
                            </div>

                            <!-- Step 3: Manual Mode Tools (Hidden by default) -->
                            <div id="remover-manual-tools" class="hidden">
                                <div class="flex items-center gap-3 mb-4">
                                    <div class="flex items-center justify-center w-8 h-8 rounded-full bg-gradient-to-br from-red-500 to-red-600 text-white font-bold text-sm shadow-lg">3</div>
                                    <h3 class="text-lg font-bold text-gray-800">Tandai Area yang Akan Dihapus</h3>
                                </div>

                                <!-- Canvas Container -->
                                <div class="mb-6 text-center">
                                    <div id="remover-canvas-container" class="inline-block">
                                        <canvas id="remover-canvas"></canvas>
                                    </div>
                                </div>

                                <!-- Brush Controls -->
                                <div class="bg-gray-50 rounded-lg p-6 space-y-4">
                                    <div>
                                        <label class="block text-sm font-semibold text-gray-700 mb-3">
                                            <i class="fas fa-circle mr-2 text-red-500"></i>Ukuran Kuas: <span id="brush-size-value" class="text-red-600">20</span>px
                                        </label>
                                        <input type="range" id="remover-brush-size" class="brush-size-slider" min="5" max="100" value="20">
                                    </div>

                                    <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                                        <button id="remover-undo-btn" class="remover-tool-btn">
                                            <i class="fas fa-undo mr-2"></i>Undo
                                        </button>
                                        <button id="remover-redo-btn" class="remover-tool-btn">
                                            <i class="fas fa-redo mr-2"></i>Redo
                                        </button>
                                        <button id="remover-clear-btn" class="remover-tool-btn danger">
                                            <i class="fas fa-trash mr-2"></i>Clear All
                                        </button>
                                        <button id="remover-reset-btn" class="remover-tool-btn">
                                            <i class="fas fa-sync mr-2"></i>Reset
                                        </button>
                                    </div>

                                    <div class="bg-blue-50 border border-blue-200 rounded-lg p-3">
                                        <p class="text-sm text-blue-800">
                                            <i class="fas fa-info-circle mr-2"></i>
                                            <strong>Tips:</strong> Sapukan kuas pada area yang ingin dihapus. Area yang ditandai akan berwarna merah transparan.
                                        </p>
                                    </div>
                                </div>
                            </div>

                            <!-- Step 4: Auto Mode Options -->
                            <div id="remover-auto-options" class="hidden">
                                <div class="flex items-center gap-3 mb-4">
                                    <div class="flex items-center justify-center w-8 h-8 rounded-full bg-gradient-to-br from-red-500 to-red-600 text-white font-bold text-sm shadow-lg">3</div>
                                    <h3 class="text-lg font-bold text-gray-800">Opsi Penghapusan Otomatis</h3>
                                </div>
                                <div class="bg-gradient-to-br from-red-50 to-orange-50 rounded-xl p-6 border-2 border-red-200">
                                    <div class="flex items-start gap-4">
                                        <div class="w-12 h-12 rounded-full bg-red-500 flex items-center justify-center flex-shrink-0">
                                            <i class="fas fa-magic text-white text-xl"></i>
                                        </div>
                                        <div>
                                            <h4 class="font-bold text-gray-800 text-lg mb-2">AI Smart Detection</h4>
                                            <p class="text-gray-700 text-sm mb-3">
                                                AI akan otomatis mendeteksi dan menghapus objek yang mengganggu seperti:
                                            </p>
                                            <ul class="text-sm text-gray-700 space-y-1">
                                                <li><i class="fas fa-check-circle text-green-500 mr-2"></i>Orang di background</li>
                                                <li><i class="fas fa-check-circle text-green-500 mr-2"></i>Objek yang tidak diinginkan</li>
                                                <li><i class="fas fa-check-circle text-green-500 mr-2"></i>Watermark atau logo</li>
                                                <li><i class="fas fa-check-circle text-green-500 mr-2"></i>Kabel, tiang, atau gangguan lainnya</li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Step 5: Number of Variations -->
                            <div id="remover-variation-section" class="hidden">
                                <div class="flex items-center gap-3 mb-4">
                                    <div class="flex items-center justify-center w-8 h-8 rounded-full bg-gradient-to-br from-red-500 to-red-600 text-white font-bold text-sm shadow-lg">4</div>
                                    <h3 class="text-lg font-bold text-gray-800">Jumlah Variasi Hasil</h3>
                                </div>
                                <div class="grid grid-cols-3 gap-4">
                                    <button class="remover-variation-btn active" data-count="2">
                                        <i class="fas fa-images mr-2"></i>2 Variasi
                                    </button>
                                    <button class="remover-variation-btn" data-count="3">
                                        <i class="fas fa-images mr-2"></i>3 Variasi
                                    </button>
                                    <button class="remover-variation-btn" data-count="4">
                                        <i class="fas fa-images mr-2"></i>4 Variasi
                                    </button>
                                </div>
                            </div>

                            <!-- Generate Button -->
                            <div id="remover-generate-section" class="hidden">
                                <button id="remover-generate-btn" class="w-full py-4 rounded-xl text-white text-lg font-bold shadow-xl hover:shadow-2xl transition-all duration-300 flex items-center justify-center gap-3" style="background: linear-gradient(135deg, #EF4444 0%, #DC2626 100%);">
                                    <i class="fas fa-magic text-xl"></i>
                                    <span>Hapus Object Sekarang</span>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Results Section -->
                    <div id="remover-results-section" class="card p-6 hidden">
                        <div class="flex justify-between items-center mb-6">
                            <h2 class="text-2xl font-bold text-gray-800">
                                <i class="fas fa-images mr-2 text-red-600"></i>Hasil Penghapusan
                            </h2>
                            <button id="remover-download-all-btn" class="hidden px-4 py-2 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg font-semibold shadow-md hover:shadow-lg transition-all">
                                <i class="fas fa-download mr-2"></i>Download Semua
                            </button>
                        </div>

                        <!-- Results Grid -->
                        <div id="remover-results-grid" class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4"></div>
                    </div>
                </div>
            </div>
        </div>

    <!-- Floating Support Button -->
    <button id="support-button" class="bg-sky-500 hover:bg-sky-600 text-white rounded-full w-16 h-16 flex items-center justify-center shadow-lg">
        <i class="fas fa-question-circle fa-2x"></i>
    </button>

        <!-- TAB: Rencana Bisnis & SWOT -->
        <div id="content-rencana-bisnis" class="main-content-panel hidden">
            <div class="container mx-auto max-w-6xl">
                <header class="text-center mb-8">
                    <h1 class="text-4xl md:text-5xl font-bold mb-4 text-transparent bg-clip-text bg-gradient-to-r from-green-600 to-teal-600">
                        <i class="fas fa-chart-line mr-3"></i>Generator Rencana Bisnis & Analisis SWOT
                    </h1>
                    <p class="text-lg text-gray-600 mb-2">
                        Buat rencana bisnis dan analisis SWOT profesional untuk UMKM & bisnis besar
                    </p>
                </header>

                <div class="grid lg:grid-cols-2 gap-6">
                    <div class="card p-6">
                        <h2 class="text-2xl font-bold mb-6 text-gray-800">
                            <i class="fas fa-edit mr-2 text-green-600"></i>Input Bisnis
                        </h2>

                        <div class="space-y-5">
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">
                                    Jenis Bisnis <span class="text-red-500">*</span>
                                </label>
                                <input type="text" id="bp-jenis-bisnis" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-green-500 focus:ring-2 focus:ring-green-200 transition-all" placeholder="Contoh: Kafe, E-commerce Fashion, Jasa Konsultan">
                            </div>

                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">
                                    Lokasi Bisnis
                                </label>
                                <input type="text" id="bp-lokasi" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-green-500 focus:ring-2 focus:ring-green-200 transition-all" placeholder="Contoh: Jakarta Selatan, Online/Nasional">
                            </div>

                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">
                                    Target Pasar
                                </label>
                                <textarea id="bp-target-pasar" rows="2" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-green-500 focus:ring-2 focus:ring-green-200 transition-all" placeholder="Contoh: Milenial urban 25-35 tahun, kelas menengah"></textarea>
                            </div>

                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">
                                    Modal Awal (Opsional)
                                </label>
                                <input type="text" id="bp-modal" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-green-500 focus:ring-2 focus:ring-green-200 transition-all" placeholder="Contoh: Rp 50 juta">
                            </div>

                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">
                                    Informasi Tambahan
                                </label>
                                <textarea id="bp-info-tambahan" rows="3" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-green-500 focus:ring-2 focus:ring-green-200 transition-all" placeholder="Produk/layanan utama, keunggulan kompetitif, dll"></textarea>
                            </div>

                            <button id="bp-generate-btn" class="w-full bg-gradient-to-r from-green-600 to-teal-600 text-white font-bold py-4 px-6 rounded-lg shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300">
                                <i class="fas fa-sparkles mr-2"></i>Generate Rencana Bisnis
                            </button>
                        </div>
                    </div>

                    <div class="card p-6">
                        <h2 class="text-2xl font-bold mb-6 text-gray-800">
                            <i class="fas fa-file-alt mr-2 text-green-600"></i>Hasil Rencana Bisnis
                        </h2>

                        <div id="bp-output-container" class="hidden space-y-4">
                            <div class="bg-gradient-to-r from-green-50 to-teal-50 rounded-lg p-4 border border-green-200">
                                <div class="flex justify-between items-start mb-2">
                                    <h3 class="font-bold text-gray-800">Rencana Bisnis & SWOT</h3>
                                    <button id="bp-copy-btn" class="text-green-600 hover:text-green-700 font-semibold text-sm flex items-center gap-1">
                                        <i class="fas fa-copy"></i>Salin
                                    </button>
                                </div>
                                <div id="bp-output" class="text-gray-700 whitespace-pre-wrap leading-relaxed text-sm max-h-[70vh] md:max-h-96 overflow-y-auto" style="-webkit-overflow-scrolling: touch;"></div>
                            </div>
                        </div>

                        <div id="bp-placeholder" class="flex flex-col items-center justify-center h-96 text-center text-gray-400">
                            <i class="fas fa-chart-line text-6xl mb-4"></i>
                            <p class="text-lg font-semibold">Rencana Bisnis Anda</p>
                            <p class="text-sm">Isi form dan generate rencana bisnis profesional</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- TAB: HR Assistant -->
        <div id="content-hr-assistant" class="main-content-panel hidden">
            <div class="container mx-auto max-w-6xl">
                <header class="text-center mb-8">
                    <h1 class="text-4xl md:text-5xl font-bold mb-4 text-transparent bg-clip-text bg-gradient-to-r from-blue-600 to-indigo-600">
                        <i class="fas fa-users mr-3"></i>HR Assistant - Deskripsi Pekerjaan & Wawancara
                    </h1>
                    <p class="text-lg text-gray-600 mb-2">
                        Buat deskripsi pekerjaan lengkap dan pertanyaan wawancara profesional
                    </p>
                </header>

                <div class="grid lg:grid-cols-2 gap-6">
                    <div class="card p-6">
                        <h2 class="text-2xl font-bold mb-6 text-gray-800">
                            <i class="fas fa-edit mr-2 text-blue-600"></i>Detail Posisi
                        </h2>

                        <div class="space-y-5">
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">
                                    Nama Posisi <span class="text-red-500">*</span>
                                </label>
                                <input type="text" id="hr-posisi" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all" placeholder="Contoh: Sales Manager, Barista, Data Scientist">
                            </div>

                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">
                                    Industri/Bidang Usaha
                                </label>
                                <input type="text" id="hr-industri" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all" placeholder="Contoh: Retail, F&B, Teknologi, Keuangan">
                            </div>

                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">
                                    Level Posisi
                                </label>
                                <select id="hr-level" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all">
                                    <option value="entry">Entry Level / Fresh Graduate</option>
                                    <option value="junior">Junior (1-3 tahun)</option>
                                    <option value="senior">Senior (3-5 tahun)</option>
                                    <option value="lead">Lead / Supervisor</option>
                                    <option value="manager">Manager</option>
                                    <option value="director">Director / C-Level</option>
                                </select>
                            </div>

                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">
                                    Keahlian Khusus (Opsional)
                                </label>
                                <textarea id="hr-keahlian" rows="2" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all" placeholder="Contoh: MS Excel, Photoshop, Python, Komunikasi, Kepemimpinan"></textarea>
                            </div>

                            <button id="hr-generate-btn" class="w-full bg-gradient-to-r from-blue-600 to-indigo-600 text-white font-bold py-4 px-6 rounded-lg shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300">
                                <i class="fas fa-sparkles mr-2"></i>Generate Job Description
                            </button>
                        </div>
                    </div>

                    <div class="card p-6">
                        <h2 class="text-2xl font-bold mb-6 text-gray-800">
                            <i class="fas fa-file-alt mr-2 text-blue-600"></i>Hasil HR
                        </h2>

                        <div id="hr-output-container" class="hidden space-y-4">
                            <div class="bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg p-4 border border-blue-200">
                                <div class="flex justify-between items-start mb-2">
                                    <h3 class="font-bold text-gray-800">Deskripsi Pekerjaan & Wawancara</h3>
                                    <button id="hr-copy-btn" class="text-blue-600 hover:text-blue-700 font-semibold text-sm flex items-center gap-1">
                                        <i class="fas fa-copy"></i>Salin
                                    </button>
                                </div>
                                <div id="hr-output" class="text-gray-700 whitespace-pre-wrap leading-relaxed text-sm max-h-[70vh] md:max-h-96 overflow-y-auto" style="-webkit-overflow-scrolling: touch;"></div>
                            </div>
                        </div>

                        <div id="hr-placeholder" class="flex flex-col items-center justify-center h-96 text-center text-gray-400">
                            <i class="fas fa-users text-6xl mb-4"></i>
                            <p class="text-lg font-semibold">Job Description & Interview Questions</p>
                            <p class="text-sm">Isi detail posisi untuk generate</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- TAB: Konten Marketing -->
        <div id="content-konten-marketing" class="main-content-panel hidden">
            <div class="container mx-auto max-w-6xl">
                <header class="text-center mb-8">
                    <h1 class="text-4xl md:text-5xl font-bold mb-4 text-transparent bg-clip-text bg-gradient-to-r from-orange-500 to-red-500">
                        <i class="fas fa-bullhorn mr-3"></i>Generator Konten Marketing Multi-Platform
                    </h1>
                    <p class="text-lg text-gray-600 mb-2">
                        Buat konten marketing untuk Instagram, Facebook, Email, dan Google Ads sekaligus
                    </p>
                </header>

                <div class="grid lg:grid-cols-2 gap-6">
                    <div class="card p-6">
                        <h2 class="text-2xl font-bold mb-6 text-gray-800">
                            <i class="fas fa-edit mr-2 text-orange-500"></i>Info Promosi
                        </h2>

                        <div class="space-y-5">
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">
                                    Nama Produk/Layanan <span class="text-red-500">*</span>
                                </label>
                                <input type="text" id="km-produk" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-orange-500 focus:ring-2 focus:ring-orange-200 transition-all" placeholder="Contoh: Kopi Premium, Sepatu Running">
                            </div>

                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">
                                    Jenis Promosi
                                </label>
                                <input type="text" id="km-promosi" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-orange-500 focus:ring-2 focus:ring-orange-200 transition-all" placeholder="Contoh: Diskon 50%, Beli 1 Gratis 1, Flash Sale">
                            </div>

                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">
                                    Platform Target
                                </label>
                                <div class="grid grid-cols-2 gap-3">
                                    <label class="flex items-center gap-2 p-3 border-2 border-gray-300 rounded-lg cursor-pointer hover:border-orange-500">
                                        <input type="checkbox" id="km-platform-ig" checked class="w-4 h-4">
                                        <span class="text-sm">Instagram</span>
                                    </label>
                                    <label class="flex items-center gap-2 p-3 border-2 border-gray-300 rounded-lg cursor-pointer hover:border-orange-500">
                                        <input type="checkbox" id="km-platform-fb" checked class="w-4 h-4">
                                        <span class="text-sm">Facebook</span>
                                    </label>
                                    <label class="flex items-center gap-2 p-3 border-2 border-gray-300 rounded-lg cursor-pointer hover:border-orange-500">
                                        <input type="checkbox" id="km-platform-email" checked class="w-4 h-4">
                                        <span class="text-sm">Email</span>
                                    </label>
                                    <label class="flex items-center gap-2 p-3 border-2 border-gray-300 rounded-lg cursor-pointer hover:border-orange-500">
                                        <input type="checkbox" id="km-platform-ads" checked class="w-4 h-4">
                                        <span class="text-sm">Google Ads</span>
                                    </label>
                                </div>
                            </div>

                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">
                                    Informasi Tambahan
                                </label>
                                <textarea id="km-info" rows="3" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-orange-500 focus:ring-2 focus:ring-orange-200 transition-all" placeholder="USP, keunggulan produk, target audience, periode promo, dll"></textarea>
                            </div>

                            <button id="km-generate-btn" class="w-full bg-gradient-to-r from-orange-500 to-red-500 text-white font-bold py-4 px-6 rounded-lg shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300">
                                <i class="fas fa-sparkles mr-2"></i>Generate Konten Marketing
                            </button>
                        </div>
                    </div>

                    <div class="card p-6">
                        <h2 class="text-2xl font-bold mb-6 text-gray-800">
                            <i class="fas fa-file-alt mr-2 text-orange-500"></i>Hasil Konten
                        </h2>

                        <div id="km-output-container" class="hidden space-y-4 max-h-[70vh] md:max-h-96 overflow-y-auto" style="-webkit-overflow-scrolling: touch;">
                            <div class="bg-gradient-to-r from-orange-50 to-red-50 rounded-lg p-4 border border-orange-200">
                                <div class="flex justify-between items-start mb-2">
                                    <h3 class="font-bold text-gray-800">Konten Multi-Platform</h3>
                                    <button id="km-copy-btn" class="text-orange-600 hover:text-orange-700 font-semibold text-sm flex items-center gap-1">
                                        <i class="fas fa-copy"></i>Salin Semua
                                    </button>
                                </div>
                                <div id="km-output" class="text-gray-700 whitespace-pre-wrap leading-relaxed text-sm"></div>
                            </div>
                        </div>

                        <div id="km-placeholder" class="flex flex-col items-center justify-center h-96 text-center text-gray-400">
                            <i class="fas fa-bullhorn text-6xl mb-4"></i>
                            <p class="text-lg font-semibold">Konten Marketing Anda</p>
                            <p class="text-sm">Isi info promosi untuk generate</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- TAB: Riset Pasar -->
        <div id="content-riset-pasar" class="main-content-panel hidden">
            <div class="container mx-auto max-w-6xl">
                <header class="text-center mb-8">
                    <h1 class="text-4xl md:text-5xl font-bold mb-4 text-transparent bg-clip-text bg-gradient-to-r from-purple-600 to-pink-600">
                        <i class="fas fa-search-dollar mr-3"></i>Asisten Riset Pasar & Ide Produk AI
                    </h1>
                    <p class="text-lg text-gray-600 mb-2">
                        Dapatkan ide produk baru dan insight tren pasar terkini
                    </p>
                </header>

                <div class="grid lg:grid-cols-2 gap-6">
                    <div class="card p-6">
                        <h2 class="text-2xl font-bold mb-6 text-gray-800">
                            <i class="fas fa-edit mr-2 text-purple-600"></i>Info Riset
                        </h2>

                        <div class="space-y-5">
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">
                                    Jenis Bisnis Saat Ini <span class="text-red-500">*</span>
                                </label>
                                <input type="text" id="rm-bisnis" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-purple-500 focus:ring-2 focus:ring-purple-200 transition-all" placeholder="Contoh: Kafe, Toko Online Fashion, Salon">
                            </div>

                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">
                                    Tujuan Riset
                                </label>
                                <select id="rm-tujuan" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-purple-500 focus:ring-2 focus:ring-purple-200 transition-all">
                                    <option value="produk-baru">Ide Produk/Menu Baru</option>
                                    <option value="ekspansi">Peluang Ekspansi Bisnis</option>
                                    <option value="tren">Analisis Tren Pasar</option>
                                    <option value="kompetitor">Analisis Kompetitor</option>
                                </select>
                            </div>

                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">
                                    Lokasi/Target Market
                                </label>
                                <input type="text" id="rm-target" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-purple-500 focus:ring-2 focus:ring-purple-200 transition-all" placeholder="Contoh: Jakarta, Indonesia, Gen Z">
                            </div>

                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">
                                    Preferensi Khusus (Opsional)
                                </label>
                                <textarea id="rm-preferensi" rows="3" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-purple-500 focus:ring-2 focus:ring-purple-200 transition-all" placeholder="Contoh: Ramah lingkungan, budget terbatas, viral di media sosial, dll"></textarea>
                            </div>

                            <button id="rm-generate-btn" class="w-full bg-gradient-to-r from-purple-600 to-pink-600 text-white font-bold py-4 px-6 rounded-lg shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300">
                                <i class="fas fa-sparkles mr-2"></i>Generate Riset & Ide
                            </button>
                        </div>
                    </div>

                    <div class="card p-6">
                        <h2 class="text-2xl font-bold mb-6 text-gray-800">
                            <i class="fas fa-lightbulb mr-2 text-purple-600"></i>Hasil Riset
                        </h2>

                        <div id="rm-output-container" class="hidden space-y-4">
                            <div class="bg-gradient-to-r from-purple-50 to-pink-50 rounded-lg p-4 border border-purple-200">
                                <div class="flex justify-between items-start mb-2">
                                    <h3 class="font-bold text-gray-800">Riset Pasar & Ide Produk</h3>
                                    <button id="rm-copy-btn" class="text-purple-600 hover:text-purple-700 font-semibold text-sm flex items-center gap-1">
                                        <i class="fas fa-copy"></i>Salin
                                    </button>
                                </div>
                                <div id="rm-output" class="text-gray-700 whitespace-pre-wrap leading-relaxed text-sm max-h-[70vh] md:max-h-96 overflow-y-auto" style="-webkit-overflow-scrolling: touch;"></div>
                            </div>
                        </div>

                        <div id="rm-placeholder" class="flex flex-col items-center justify-center h-96 text-center text-gray-400">
                            <i class="fas fa-search-dollar text-6xl mb-4"></i>
                            <p class="text-lg font-semibold">Hasil Riset & Ide</p>
                            <p class="text-sm">Isi info bisnis untuk mulai riset</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- TAB: Financial Forecast -->
        <div id="content-financial-forecast" class="main-content-panel hidden">
            <div class="container mx-auto max-w-6xl">
                <header class="text-center mb-8">
                    <h1 class="text-4xl md:text-5xl font-bold mb-4 text-transparent bg-clip-text bg-gradient-to-r from-emerald-600 to-cyan-600">
                        <i class="fas fa-calculator mr-3"></i>Simulator Anggaran & Perkiraan Keuangan
                    </h1>
                    <p class="text-lg text-gray-600 mb-2">
                        Buat proyeksi anggaran dan skenario keuangan untuk bisnis Anda
                    </p>
                </header>

                <div class="grid lg:grid-cols-2 gap-6">
                    <div class="card p-6">
                        <h2 class="text-2xl font-bold mb-6 text-gray-800">
                            <i class="fas fa-edit mr-2 text-emerald-600"></i>Data Keuangan
                        </h2>

                        <div class="space-y-5">
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">
                                    Proyeksi Pendapatan Bulanan <span class="text-red-500">*</span>
                                </label>
                                <input type="text" id="ff-pendapatan" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-emerald-500 focus:ring-2 focus:ring-emerald-200 transition-all" placeholder="Contoh: Rp 50.000.000 atau 50 juta">
                            </div>

                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">
                                    Tipe Bisnis
                                </label>
                                <select id="ff-tipe" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-emerald-500 focus:ring-2 focus:ring-emerald-200 transition-all">
                                    <option value="umkm">UMKM / Bisnis Kecil</option>
                                    <option value="menengah">Bisnis Menengah</option>
                                    <option value="besar">Bisnis Besar</option>
                                    <option value="startup">Startup</option>
                                </select>
                            </div>

                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">
                                    Industri
                                </label>
                                <input type="text" id="ff-industri" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-emerald-500 focus:ring-2 focus:ring-emerald-200 transition-all" placeholder="Contoh: F&B, Retail, Jasa, E-commerce">
                            </div>

                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">
                                    Skenario yang Ingin Disimulasikan
                                </label>
                                <select id="ff-skenario" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-emerald-500 focus:ring-2 focus:ring-emerald-200 transition-all">
                                    <option value="normal">Normal - Alokasi Anggaran Standar</option>
                                    <option value="growth">Growth - Fokus Ekspansi & Marketing</option>
                                    <option value="efficiency">Efficiency - Fokus Penghematan</option>
                                    <option value="custom">Custom Scenario</option>
                                </select>
                            </div>

                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">
                                    Detail Tambahan (Opsional)
                                </label>
                                <textarea id="ff-detail" rows="3" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-emerald-500 focus:ring-2 focus:ring-emerald-200 transition-all" placeholder="Contoh: Jumlah karyawan, rencana investasi, target profit margin, dll"></textarea>
                            </div>

                            <button id="ff-generate-btn" class="w-full bg-gradient-to-r from-emerald-600 to-cyan-600 text-white font-bold py-4 px-6 rounded-lg shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300">
                                <i class="fas fa-sparkles mr-2"></i>Generate Proyeksi Anggaran
                            </button>
                        </div>
                    </div>

                    <div class="card p-6">
                        <h2 class="text-2xl font-bold mb-6 text-gray-800">
                            <i class="fas fa-chart-pie mr-2 text-emerald-600"></i>Hasil Proyeksi
                        </h2>

                        <div id="ff-output-container" class="hidden space-y-4">
                            <div class="bg-gradient-to-r from-emerald-50 to-cyan-50 rounded-lg p-4 border border-emerald-200">
                                <div class="flex justify-between items-start mb-2">
                                    <h3 class="font-bold text-gray-800">Proyeksi Anggaran & Saran</h3>
                                    <button id="ff-copy-btn" class="text-emerald-600 hover:text-emerald-700 font-semibold text-sm flex items-center gap-1">
                                        <i class="fas fa-copy"></i>Salin
                                    </button>
                                </div>
                                <div id="ff-output" class="text-gray-700 whitespace-pre-wrap leading-relaxed text-sm max-h-[70vh] md:max-h-96 overflow-y-auto" style="-webkit-overflow-scrolling: touch;"></div>
                            </div>
                        </div>

                        <div id="ff-placeholder" class="flex flex-col items-center justify-center h-96 text-center text-gray-400">
                            <i class="fas fa-calculator text-6xl mb-4"></i>
                            <p class="text-lg font-semibold">Proyeksi Keuangan Anda</p>
                            <p class="text-sm">Isi data untuk simulasi anggaran</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- TAB: Script Story Iklan -->
        <div id="content-script-story-iklan" class="main-content-panel hidden">
            <div class="container mx-auto max-w-6xl">
                <header class="text-center mb-8">
                    <h1 class="text-4xl md:text-5xl font-bold mb-4 text-transparent bg-clip-text bg-gradient-to-r from-blue-500 to-indigo-600">
                        <i class="fas fa-book-open mr-3"></i>Generator Script Story Iklan
                    </h1>
                    <p class="text-lg text-gray-600 mb-2">
                        Buat narasi iklan yang natural dan meyakinkan untuk promosi produk affiliate
                    </p>
                </header>

                <div class="grid lg:grid-cols-2 gap-6">
                    <!-- Input Section -->
                    <div class="card p-6">
                        <h2 class="text-2xl font-bold mb-6 text-gray-800">
                            <i class="fas fa-pen mr-2 text-blue-500"></i>Input Story
                        </h2>

                        <div class="space-y-5">
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">
                                    Target Audience <span class="text-red-500">*</span>
                                </label>
                                <select
                                    id="story-target-audience"
                                    class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all"
                                >
                                    <option value="">Pilih Target Audience...</option>
                                    <option value="ibu-rumah-tangga">Ibu Rumah Tangga</option>
                                    <option value="mahasiswa">Mahasiswa</option>
                                    <option value="pekerja-kantoran">Pekerja Kantoran</option>
                                    <option value="pebisnis">Pebisnis/Entrepreneur</option>
                                    <option value="remaja">Remaja (15-20 tahun)</option>
                                    <option value="dewasa-muda">Dewasa Muda (20-30 tahun)</option>
                                    <option value="orang-tua">Orang Tua</option>
                                </select>
                            </div>

                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">
                                    Nama Produk <span class="text-red-500">*</span>
                                </label>
                                <input
                                    type="text"
                                    id="story-product-name"
                                    class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all"
                                    placeholder="Contoh: Serum Anti-Aging Premium"
                                />
                            </div>

                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">
                                    Masalah yang Dipecahkan <span class="text-red-500">*</span>
                                </label>
                                <textarea
                                    id="story-problem"
                                    rows="3"
                                    class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all"
                                    placeholder="Contoh: Kulit kusam, keriput, tidak kencang"
                                ></textarea>
                            </div>

                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">
                                    Manfaat/Solusi Produk
                                </label>
                                <textarea
                                    id="story-benefits"
                                    rows="3"
                                    class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all"
                                    placeholder="Contoh: Mencerahkan, mengencangkan, mengurangi kerutan dalam 2 minggu"
                                ></textarea>
                            </div>

                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">
                                    Tone/Gaya Bahasa
                                </label>
                                <div class="grid grid-cols-2 gap-3">
                                    <button class="story-tone-btn active" data-tone="friendly">
                                        <i class="fas fa-smile mr-2"></i>Ramah
                                    </button>
                                    <button class="story-tone-btn" data-tone="professional">
                                        <i class="fas fa-briefcase mr-2"></i>Profesional
                                    </button>
                                    <button class="story-tone-btn" data-tone="casual">
                                        <i class="fas fa-coffee mr-2"></i>Santai
                                    </button>
                                    <button class="story-tone-btn" data-tone="enthusiastic">
                                        <i class="fas fa-fire mr-2"></i>Antusias
                                    </button>
                                </div>
                            </div>

                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">
                                    Panjang Script
                                </label>
                                <div class="grid grid-cols-2 gap-3">
                                    <button class="story-length-btn active" data-length="short">
                                        <i class="fas fa-clock mr-2"></i>Pendek (30-60s)
                                    </button>
                                    <button class="story-length-btn" data-length="long">
                                        <i class="fas fa-hourglass mr-2"></i>Panjang (60-120s)
                                    </button>
                                </div>
                            </div>

                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">
                                    Sertakan Link Affiliate?
                                </label>
                                <input
                                    type="text"
                                    id="story-affiliate-link"
                                    class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all"
                                    placeholder="https://s.shopee.co.id/... (opsional)"
                                />
                            </div>

                            <button
                                id="story-script-generate-btn"
                                class="w-full bg-gradient-to-r from-blue-500 to-indigo-600 text-white font-bold py-4 px-6 rounded-lg shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300"
                            >
                                <i class="fas fa-wand-magic-sparkles mr-2"></i>Generate Script Story
                            </button>
                        </div>
                    </div>

                    <!-- Output Section -->
                    <div class="card p-6">
                        <h2 class="text-2xl font-bold mb-6 text-gray-800">
                            <i class="fas fa-scroll mr-2 text-blue-500"></i>Script Narasi
                        </h2>

                        <div id="story-script-output-container" class="hidden space-y-4">
                            <!-- Script Section -->
                            <div class="bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg p-5 border-2 border-blue-300">
                                <div class="flex justify-between items-start mb-3">
                                    <h3 class="font-bold text-gray-800 flex items-center gap-2">
                                        <i class="fas fa-file-alt text-blue-500"></i>
                                        Script Narasi Iklan
                                    </h3>
                                    <button
                                        id="story-script-copy-btn"
                                        class="text-blue-600 hover:text-blue-700 font-semibold text-sm flex items-center gap-1"
                                    >
                                        <i class="fas fa-copy"></i>Salin
                                    </button>
                                </div>
                                <div id="story-script-output" class="text-gray-700 whitespace-pre-wrap leading-relaxed text-sm"></div>
                            </div>

                            <!-- CTA Suggestion -->
                            <div class="bg-green-50 rounded-lg p-4 border border-green-200">
                                <h3 class="font-bold text-gray-800 mb-2 flex items-center gap-2">
                                    <i class="fas fa-bullseye text-green-500"></i>
                                    Call-to-Action (CTA)
                                </h3>
                                <div id="story-cta" class="text-gray-700 text-sm"></div>
                            </div>

                            <!-- Tips Section -->
                            <div class="bg-yellow-50 rounded-lg p-4 border border-yellow-200">
                                <h3 class="font-bold text-gray-800 mb-2 flex items-center gap-2">
                                    <i class="fas fa-lightbulb text-yellow-500"></i>
                                    Tips Penyampaian
                                </h3>
                                <ul class="text-sm text-gray-700 space-y-1 list-disc list-inside">
                                    <li>Gunakan intonasi yang natural dan tidak terlalu jualan</li>
                                    <li>Ceritakan pengalaman pribadi atau testimoni nyata</li>
                                    <li>Tunjukkan before-after atau hasil penggunaan</li>
                                    <li>Buat penonton merasa relate dengan masalah yang dibahas</li>
                                    <li>Akhiri dengan CTA yang jelas tapi tidak memaksa</li>
                                </ul>
                            </div>
                        </div>

                        <div id="story-script-placeholder" class="flex flex-col items-center justify-center h-96 text-center text-gray-400">
                            <i class="fas fa-book-open text-6xl mb-4"></i>
                            <p class="text-lg font-semibold">Script Story Iklan Anda</p>
                            <p class="text-sm">Isi form dan generate script yang meyakinkan!</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- TAB: Ide Konten TikTok -->
        <div id="content-ide-konten-tiktok" class="main-content-panel hidden">
            <div class="container mx-auto max-w-6xl">
                <header class="text-center mb-8">
                    <h1 class="text-4xl md:text-5xl font-bold mb-4 text-transparent bg-clip-text bg-gradient-to-r from-pink-500 to-purple-600">
                        <i class="fab fa-tiktok mr-3"></i>Generator Ide Konten TikTok Affiliate
                    </h1>
                    <p class="text-lg text-gray-600 mb-2">
                        Dapatkan hook viral dan struktur video yang bikin audience berhenti scroll!
                    </p>
                </header>

                <div class="grid lg:grid-cols-2 gap-6">
                    <!-- Input Section -->
                    <div class="card p-6">
                        <h2 class="text-2xl font-bold mb-6 text-gray-800">
                            <i class="fas fa-lightbulb mr-2 text-pink-500"></i>Input Konten
                        </h2>

                        <div class="space-y-5">
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">
                                    Kategori Produk <span class="text-red-500">*</span>
                                </label>
                                <select
                                    id="tiktok-category"
                                    class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-pink-500 focus:ring-2 focus:ring-pink-200 transition-all"
                                >
                                    <option value="">Pilih Kategori...</option>
                                    <option value="skincare">Skincare & Kecantikan</option>
                                    <option value="fashion">Fashion & OOTD</option>
                                    <option value="gadget">Gadget & Elektronik</option>
                                    <option value="makanan">Makanan & Minuman</option>
                                    <option value="lifestyle">Lifestyle & Daily Vlog</option>
                                    <option value="home">Home & Living</option>
                                    <option value="fitness">Fitness & Kesehatan</option>
                                    <option value="edukasi">Tips & Edukasi</option>
                                </select>
                            </div>

                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">
                                    Nama/Jenis Produk
                                </label>
                                <input
                                    type="text"
                                    id="tiktok-product"
                                    class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-pink-500 focus:ring-2 focus:ring-pink-200 transition-all"
                                    placeholder="Contoh: Lip tint Korea, Smartwatch, Dress casual"
                                />
                            </div>

                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">
                                    Target Audience
                                </label>
                                <select
                                    id="tiktok-audience"
                                    class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-pink-500 focus:ring-2 focus:ring-pink-200 transition-all"
                                >
                                    <option value="gen-z">Gen Z (18-25 tahun)</option>
                                    <option value="milenial">Milenial (26-40 tahun)</option>
                                    <option value="ibu-rumah-tangga">Ibu Rumah Tangga</option>
                                    <option value="pekerja">Pekerja Kantoran</option>
                                    <option value="pelajar">Pelajar/Mahasiswa</option>
                                    <option value="umum">Umum</option>
                                </select>
                            </div>

                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">
                                    Tipe Konten
                                </label>
                                <div class="grid grid-cols-2 gap-3">
                                    <button class="tiktok-type-btn active" data-type="review">
                                        <i class="fas fa-star mr-2"></i>Review
                                    </button>
                                    <button class="tiktok-type-btn" data-type="tutorial">
                                        <i class="fas fa-graduation-cap mr-2"></i>Tutorial
                                    </button>
                                    <button class="tiktok-type-btn" data-type="unboxing">
                                        <i class="fas fa-box-open mr-2"></i>Unboxing
                                    </button>
                                    <button class="tiktok-type-btn" data-type="comparison">
                                        <i class="fas fa-balance-scale mr-2"></i>Perbandingan
                                    </button>
                                </div>
                            </div>

                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">
                                    Durasi Video Target
                                </label>
                                <div class="grid grid-cols-3 gap-3">
                                    <button class="tiktok-duration-btn active" data-duration="short">
                                        15-30s
                                    </button>
                                    <button class="tiktok-duration-btn" data-duration="medium">
                                        30-60s
                                    </button>
                                    <button class="tiktok-duration-btn" data-duration="long">
                                        60s+
                                    </button>
                                </div>
                            </div>

                            <button
                                id="tiktok-generate-btn"
                                class="w-full bg-gradient-to-r from-pink-500 to-purple-600 text-white font-bold py-4 px-6 rounded-lg shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300"
                            >
                                <i class="fas fa-magic mr-2"></i>Generate Ide Konten
                            </button>
                        </div>
                    </div>

                    <!-- Output Section -->
                    <div class="card p-6">
                        <h2 class="text-2xl font-bold mb-6 text-gray-800">
                            <i class="fas fa-video mr-2 text-pink-500"></i>Ide Konten Video
                        </h2>

                        <div id="tiktok-output-container" class="hidden space-y-4">
                            <!-- Hook Section -->
                            <div class="bg-gradient-to-r from-pink-50 to-purple-50 rounded-lg p-4 border-2 border-pink-300">
                                <div class="flex justify-between items-start mb-2">
                                    <h3 class="font-bold text-gray-800 flex items-center gap-2">
                                        <i class="fas fa-bullhorn text-pink-500"></i>
                                        Hook Pembuka (3 detik pertama)
                                    </h3>
                                    <button class="tiktok-copy-btn text-pink-600 hover:text-pink-700 text-sm" data-target="tiktok-hook">
                                        <i class="fas fa-copy"></i>
                                    </button>
                                </div>
                                <div id="tiktok-hook" class="text-gray-700 text-sm whitespace-pre-wrap max-h-60 overflow-y-auto" style="-webkit-overflow-scrolling: touch;"></div>
                            </div>

                            <!-- Structure Section -->
                            <div class="bg-blue-50 rounded-lg p-4 border border-blue-200">
                                <div class="flex justify-between items-start mb-2">
                                    <h3 class="font-bold text-gray-800 flex items-center gap-2">
                                        <i class="fas fa-list-ol text-blue-500"></i>
                                        Struktur Video
                                    </h3>
                                    <button class="tiktok-copy-btn text-blue-600 hover:text-blue-700 text-sm" data-target="tiktok-structure">
                                        <i class="fas fa-copy"></i>
                                    </button>
                                </div>
                                <div id="tiktok-structure" class="text-gray-700 text-sm whitespace-pre-wrap max-h-60 overflow-y-auto" style="-webkit-overflow-scrolling: touch;"></div>
                            </div>

                            <!-- Audio Suggestion Section -->
                            <div class="bg-purple-50 rounded-lg p-4 border border-purple-200">
                                <div class="flex justify-between items-start mb-2">
                                    <h3 class="font-bold text-gray-800 flex items-center gap-2">
                                        <i class="fas fa-music text-purple-500"></i>
                                        Saran Audio/Musik
                                    </h3>
                                    <button class="tiktok-copy-btn text-purple-600 hover:text-purple-700 text-sm" data-target="tiktok-audio">
                                        <i class="fas fa-copy"></i>
                                    </button>
                                </div>
                                <div id="tiktok-audio" class="text-gray-700 text-sm whitespace-pre-wrap max-h-60 overflow-y-auto" style="-webkit-overflow-scrolling: touch;"></div>
                            </div>

                            <!-- Hashtag Suggestion -->
                            <div class="bg-green-50 rounded-lg p-4 border border-green-200">
                                <div class="flex justify-between items-start mb-2">
                                    <h3 class="font-bold text-gray-800 flex items-center gap-2">
                                        <i class="fas fa-hashtag text-green-500"></i>
                                        Hashtag Rekomendasi
                                    </h3>
                                    <button class="tiktok-copy-btn text-green-600 hover:text-green-700 text-sm" data-target="tiktok-hashtags">
                                        <i class="fas fa-copy"></i>
                                    </button>
                                </div>
                                <div id="tiktok-hashtags" class="text-gray-700 text-sm whitespace-pre-wrap max-h-60 overflow-y-auto" style="-webkit-overflow-scrolling: touch;"></div>
                            </div>
                        </div>

                        <div id="tiktok-placeholder" class="flex flex-col items-center justify-center h-96 text-center text-gray-400">
                            <i class="fab fa-tiktok text-6xl mb-4"></i>
                            <p class="text-lg font-semibold">Ide Konten TikTok Anda</p>
                            <p class="text-sm">Pilih kategori dan generate ide viral!</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- TAB: Deskripsi Produk SEO -->
        <div id="content-deskripsi-produk" class="main-content-panel hidden">
            <div class="container mx-auto max-w-6xl">
                <header class="text-center mb-8">
                    <h1 class="text-4xl md:text-5xl font-bold mb-4 text-transparent bg-clip-text bg-gradient-to-r from-orange-500 to-red-500">
                        <i class="fas fa-tags mr-3"></i>Generator Deskripsi Produk SEO
                    </h1>
                    <p class="text-lg text-gray-600 mb-2">
                        Buat deskripsi produk yang menarik dan optimal untuk Shopee & TikTok Shop
                    </p>
                </header>

                <div class="grid lg:grid-cols-2 gap-6">
                    <!-- Input Section -->
                    <div class="card p-6">
                        <h2 class="text-2xl font-bold mb-6 text-gray-800">
                            <i class="fas fa-edit mr-2 text-orange-500"></i>Input Produk
                        </h2>

                        <div class="space-y-5">
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">
                                    Nama/Judul Produk <span class="text-red-500">*</span>
                                </label>
                                <input
                                    type="text"
                                    id="desc-product-name"
                                    class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-orange-500 focus:ring-2 focus:ring-orange-200 transition-all"
                                    placeholder="Contoh: Serum Vitamin C Premium 30ml"
                                />
                            </div>

                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">
                                    Link Produk (Opsional)
                                </label>
                                <input
                                    type="text"
                                    id="desc-product-link"
                                    class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-orange-500 focus:ring-2 focus:ring-orange-200 transition-all"
                                    placeholder="https://shopee.co.id/... atau https://shop.tiktok.com/..."
                                />
                            </div>

                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">
                                    Kategori Produk
                                </label>
                                <select
                                    id="desc-product-category"
                                    class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-orange-500 focus:ring-2 focus:ring-orange-200 transition-all"
                                >
                                    <option value="">Pilih Kategori...</option>
                                    <option value="fashion">Fashion & Pakaian</option>
                                    <option value="kecantikan">Kecantikan & Perawatan</option>
                                    <option value="elektronik">Elektronik & Gadget</option>
                                    <option value="rumah-tangga">Rumah Tangga & Dekorasi</option>
                                    <option value="makanan">Makanan & Minuman</option>
                                    <option value="olahraga">Olahraga & Outdoor</option>
                                    <option value="hobi">Hobi & Koleksi</option>
                                    <option value="bayi">Ibu & Bayi</option>
                                    <option value="kesehatan">Kesehatan</option>
                                    <option value="otomotif">Otomotif</option>
                                </select>
                            </div>

                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">
                                    Fitur/Keunggulan Produk
                                </label>
                                <textarea
                                    id="desc-product-features"
                                    rows="3"
                                    class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-orange-500 focus:ring-2 focus:ring-orange-200 transition-all"
                                    placeholder="Contoh: Mengandung vitamin C murni 15%, aman untuk kulit sensitif, teruji BPOM"
                                ></textarea>
                            </div>

                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">
                                    Platform Target
                                </label>
                                <div class="grid grid-cols-2 gap-3">
                                    <button class="desc-platform-btn active" data-platform="shopee">
                                        <i class="fas fa-shopping-bag mr-2"></i>Shopee
                                    </button>
                                    <button class="desc-platform-btn" data-platform="tiktok">
                                        <i class="fab fa-tiktok mr-2"></i>TikTok Shop
                                    </button>
                                </div>
                            </div>

                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">
                                    Panjang Deskripsi
                                </label>
                                <div class="grid grid-cols-2 gap-3">
                                    <button class="desc-length-btn active" data-length="short">
                                        <i class="fas fa-align-left mr-2"></i>Pendek
                                    </button>
                                    <button class="desc-length-btn" data-length="long">
                                        <i class="fas fa-align-justify mr-2"></i>Panjang
                                    </button>
                                </div>
                            </div>

                            <button
                                id="desc-generate-btn"
                                class="w-full bg-gradient-to-r from-orange-500 to-red-500 text-white font-bold py-4 px-6 rounded-lg shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed"
                            >
                                <i class="fas fa-sparkles mr-2"></i>Generate Deskripsi
                            </button>
                        </div>
                    </div>

                    <!-- Output Section -->
                    <div class="card p-6">
                        <h2 class="text-2xl font-bold mb-6 text-gray-800">
                            <i class="fas fa-file-alt mr-2 text-orange-500"></i>Hasil Deskripsi
                        </h2>

                        <div id="desc-output-container" class="hidden space-y-4">
                            <div class="bg-gradient-to-r from-orange-50 to-red-50 rounded-lg p-4 border border-orange-200">
                                <div class="flex justify-between items-start mb-2">
                                    <h3 class="font-bold text-gray-800 flex items-center gap-2">
                                        <i class="fas fa-file-text text-orange-500"></i>
                                        Deskripsi <span id="desc-platform-label"></span>
                                    </h3>
                                    <button
                                        id="desc-copy-btn"
                                        class="text-orange-600 hover:text-orange-700 font-semibold text-sm flex items-center gap-1"
                                    >
                                        <i class="fas fa-copy"></i>Salin
                                    </button>
                                </div>
                                <div id="desc-output" class="text-gray-700 whitespace-pre-wrap leading-relaxed"></div>
                            </div>

                            <div class="bg-blue-50 rounded-lg p-4 border border-blue-200">
                                <h4 class="font-bold text-gray-800 mb-2 flex items-center gap-2">
                                    <i class="fas fa-lightbulb text-blue-500"></i>Tips Optimasi SEO:
                                </h4>
                                <ul class="text-sm text-gray-700 space-y-1 list-disc list-inside">
                                    <li>Gunakan emoji yang relevan untuk menarik perhatian üî•</li>
                                    <li>Masukkan kata kunci pencarian populer di awal</li>
                                    <li>Tambahkan hashtag yang sedang trending</li>
                                    <li>Sertakan call-to-action yang jelas</li>
                                    <li>Update deskripsi secara berkala</li>
                                </ul>
                            </div>
                        </div>

                        <div id="desc-placeholder" class="flex flex-col items-center justify-center h-96 text-center text-gray-400">
                            <i class="fas fa-file-text text-6xl mb-4"></i>
                            <p class="text-lg font-semibold">Deskripsi Produk Anda</p>
                            <p class="text-sm">Isi form di samping dan klik Generate</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        </main>
    </div>

<script type="module">
// --- FIREBASE IMPORTS (needed for Family tab) ---
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
import { getAuth, signInAnonymously, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
import { getFirestore, setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";


document.addEventListener('DOMContentLoaded', () => {
    // --- MAIN TAB SWITCHING LOGIC (MOVED UP) ---
    const mainTabButtons = document.querySelectorAll('.main-tab-btn');
    const mobileTabButtons = document.querySelectorAll('.mobile-tab-btn');
    const mainContentPanels = document.querySelectorAll('.main-content-panel');

    function switchTab(tabName) {
        // Update sidebar tabs
        mainTabButtons.forEach(btn => btn.classList.remove('active'));
        const sidebarBtn = document.querySelector(`.main-tab-btn[data-tab="${tabName}"]`);
        if (sidebarBtn) sidebarBtn.classList.add('active');

        // Update mobile tabs
        mobileTabButtons.forEach(btn => btn.classList.remove('active'));
        const mobileBtn = document.querySelector(`.mobile-tab-btn[data-tab="${tabName}"]`);
        if (mobileBtn) {
            mobileBtn.classList.add('active');
            // Auto-scroll to active tab in mobile view
            mobileBtn.scrollIntoView({ behavior: 'smooth', inline: 'center', block: 'nearest' });
        }

        // Switch content panels
        mainContentPanels.forEach(panel => {
            panel.classList.toggle('hidden', panel.id !== `content-${tabName}`);
        });
    }

    // ============================================
    // SISTEM LOGIN EKSKLUSIF (EMAIL VALIDATION)
    // ============================================
    
    // Daftar Email yang Diizinkan (BISA ANDA TAMBAH/UBAH SESUKA HATI)
    const allowedEmails = [
        'basmedia341@gmail.com',
        'oraclefotostudio@gmail.com',
        'jocinvajurgojik@gmail.com', // Sesuai prompt (typo)
        // 'email.lain@gmail.com', // Cara menambah email baru
    ];

    const appSidebar = document.querySelector('.sidebar');
    const appMobileNav = document.querySelector('.mobile-bottom-nav');
    const appToggleBtn = document.getElementById('toggle-sidebar-btn');
    const mainHeader = document.getElementById('main-header');
    const mainContentWrapper = document.getElementById('main-content-wrapper');
    const floatingSupportBtn = document.getElementById('support-button');
    const mobileHeader = document.querySelector('.mobile-header');

    // Elemen Login
    const loginView = document.getElementById('login-view');
    const welcomeView = document.getElementById('welcome-view');
    const loginEmailInput = document.getElementById('login-email-input');
    const loginSubmitBtn = document.getElementById('login-submit-btn');
    const loginErrorMsg = document.getElementById('login-error-msg');
    const welcomeUserEmail = document.getElementById('welcome-user-email');
    const logoutBtn = document.getElementById('logout-btn');

    function checkAuthentication() {
        const loggedInEmail = localStorage.getItem('oracle_studio_email');
        
        if (loggedInEmail && allowedEmails.includes(loggedInEmail)) {
            // JIKA LOGIN BERHASIL / SUDAH LOGIN
            loginView.classList.add('hidden');
            welcomeView.classList.remove('hidden');
            welcomeUserEmail.textContent = loggedInEmail;
            
            // Tampilkan kembali elemen aplikasi
            appSidebar.style.display = '';
            appMobileNav.style.display = '';
            if (appToggleBtn) appToggleBtn.style.display = '';
            if (mainHeader) mainHeader.style.display = '';
            if (floatingSupportBtn) floatingSupportBtn.style.display = '';
            if (mobileHeader) mobileHeader.style.display = '';

            // Kembalikan style container seperti semula (layout sidebar)
            mainContentWrapper.style.marginLeft = '';
            mainContentWrapper.style.width = '';
            
            // Hide sidebar on mobile load naturally
            if (window.innerWidth <= 768) {
                appSidebar.style.display = 'none';
            }
        } else {
            // JIKA BELUM LOGIN ATAU EMAIL TIDAK VALID
            loginView.classList.remove('hidden');
            welcomeView.classList.add('hidden');
            
            // Sembunyikan semua elemen navigasi aplikasi
            appSidebar.style.display = 'none';
            appMobileNav.style.display = 'none';
            if (appToggleBtn) appToggleBtn.style.display = 'none';
            if (mainHeader) mainHeader.style.display = 'none';
            if (floatingSupportBtn) floatingSupportBtn.style.display = 'none';
            if (mobileHeader) mobileHeader.style.display = 'none';

            // Paksa container menempati layar penuh di tengah
            mainContentWrapper.style.marginLeft = '0';
            mainContentWrapper.style.width = '100%';
            
            // Pastikan tab "beranda" aktif agar form login terlihat
            switchTab('beranda');
        }
    }

    if (loginSubmitBtn) {
        loginSubmitBtn.addEventListener('click', () => {
            const email = loginEmailInput.value.trim().toLowerCase();
            
            // Validasi format email dasar
            if (!email) {
                loginErrorMsg.innerHTML = '<i class="fas fa-exclamation-triangle mr-1"></i> Mohon masukkan email Anda!';
                loginErrorMsg.classList.remove('hidden');
                return;
            }

            // Validasi email dari database (array)
            if (allowedEmails.includes(email)) {
                // Sukses
                localStorage.setItem('oracle_studio_email', email);
                loginErrorMsg.classList.add('hidden');
                
                // Efek loading sedikit
                loginSubmitBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i> Memproses...';
                setTimeout(() => {
                    loginSubmitBtn.innerHTML = '<i class="fas fa-sign-in-alt mr-2"></i> Masuk Sekarang';
                    checkAuthentication();
                }, 800);
            } else {
                // Gagal
                loginErrorMsg.innerHTML = '<i class="fas fa-exclamation-triangle mr-1"></i> Email tidak terdaftar. Lakukan Pembelian Dulu!';
                loginErrorMsg.classList.remove('hidden');
                
                // Efek getar untuk error
                loginEmailInput.classList.add('border-red-500');
                setTimeout(() => loginEmailInput.classList.remove('border-red-500'), 2000);
            }
        });

        // Trigger login pada tombol Enter
        loginEmailInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                loginSubmitBtn.click();
            }
        });
    }

    if (logoutBtn) {
        logoutBtn.addEventListener('click', () => {
            localStorage.removeItem('oracle_studio_email');
            loginEmailInput.value = '';
            checkAuthentication();
        });
    }

    // Eksekusi Pengecekan Login Saat Dimuat
    checkAuthentication();

    // --- SIDEBAR TOGGLE FUNCTIONALITY ---
    const toggleSidebarBtn = document.getElementById('toggle-sidebar-btn');
    const sidebar = document.querySelector('.sidebar');

    // Load saved sidebar state from localStorage
    const sidebarCollapsed = localStorage.getItem('sidebarCollapsed') === 'true';
    if (sidebarCollapsed) {
        sidebar.classList.add('collapsed');
        mainContentWrapper.classList.add('expanded');
        toggleSidebarBtn.classList.add('collapsed');
    }

    toggleSidebarBtn.addEventListener('click', () => {
        const isCollapsed = sidebar.classList.toggle('collapsed');
        mainContentWrapper.classList.toggle('expanded');
        toggleSidebarBtn.classList.toggle('collapsed');

        // Save state to localStorage
        localStorage.setItem('sidebarCollapsed', isCollapsed);
    });

    // Global Preview Modal Function
    window.showPreviewModal = function(imageUrl) {
        const modal = document.createElement('div');
        modal.className = 'image-preview-modal';
        modal.innerHTML = `
            <div class="preview-modal-overlay"></div>
            <div class="preview-modal-content">
                <button class="preview-close-btn" aria-label="Close">
                    <i class="fas fa-times"></i>
                </button>
                <img src="${imageUrl}" alt="Preview" class="preview-modal-image">
            </div>
        `;
        document.body.appendChild(modal);

        // Close modal handlers
        const closeBtn = modal.querySelector('.preview-close-btn');
        const overlay = modal.querySelector('.preview-modal-overlay');

        const closeModal = () => {
            modal.classList.add('closing');
            setTimeout(() => modal.remove(), 300);
        };

        closeBtn.addEventListener('click', closeModal);
        overlay.addEventListener('click', closeModal);

        // ESC key to close
        const handleEsc = (e) => {
            if (e.key === 'Escape') {
                closeModal();
                document.removeEventListener('keydown', handleEsc);
            }
        };
        document.addEventListener('keydown', handleEsc);

        // Touch feedback for mobile
        closeBtn.addEventListener('touchstart', function() {
            this.style.transform = 'scale(0.9)';
        }, { passive: true });
        closeBtn.addEventListener('touchend', function() {
            this.style.transform = '';
        }, { passive: true });

        // Animate in
        setTimeout(() => modal.classList.add('show'), 10);
    };

    // Sidebar tab buttons
    mainTabButtons.forEach(button => {
        button.addEventListener('click', () => {
            switchTab(button.dataset.tab);
        });
    });

    // Mobile tab buttons
    mobileTabButtons.forEach(button => {
        button.addEventListener('click', () => {
            switchTab(button.dataset.tab);
        });
    });

    // --- UNIVERSAL MODAL LOGIC ---
    const universalModal = document.getElementById('universal-modal');
    const modalTitle = document.getElementById('modal-title');
    const modalBody = document.getElementById('modal-body');
    const closeModalBtn = document.getElementById('close-modal-btn');

    // Make universalModal globally accessible
    window.universalModal = universalModal;

    function showUniversalModal(title, content) {
        modalTitle.innerText = title;
        modalBody.innerHTML = content;
        universalModal.classList.add('visible');
    }
    window.showUniversalModal = showUniversalModal;

    async function downloadImage(imageUrl, filename) {
        console.log('downloadImage called:', filename);

        try {
            // Method 1: Try using fetch + blob (works on most modern browsers)
            if (imageUrl.startsWith('data:')) {
                // For data URLs, direct download
                const a = document.createElement('a');
                a.href = imageUrl;
                a.download = filename;
                a.style.display = 'none';
                document.body.appendChild(a);

                // Force click - important for mobile
                setTimeout(() => {
                    a.click();
                    setTimeout(() => {
                        document.body.removeChild(a);
                    }, 100);
                }, 10);

                console.log('Downloaded via data URL method');
                return;
            }

            // For regular URLs
            const response = await fetch(imageUrl);
            if (!response.ok) throw new Error('Network response was not ok');

            const blob = await response.blob();

            // Try multiple methods for maximum compatibility

            // Method 2: Try using FileSaver.js if available
            if (typeof saveAs !== 'undefined') {
                console.log('Using FileSaver.js');
                saveAs(blob, filename);
                return;
            }

            // Method 3: Create object URL and trigger download
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            a.style.display = 'none';

            document.body.appendChild(a);

            // Trigger download - use timeout for better mobile support
            setTimeout(() => {
                a.click();
                setTimeout(() => {
                    window.URL.revokeObjectURL(url);
                    document.body.removeChild(a);
                }, 100);
            }, 10);

            console.log('Downloaded via blob method');

        } catch (error) {
            console.error('Error downloading image:', error);

            // Fallback: Open in new tab for mobile
            try {
                const newWindow = window.open(imageUrl, '_blank');
                if (newWindow) {
                    showUniversalModal('Download', `<p class="mb-4">Gambar dibuka di tab baru. Tekan dan tahan gambar untuk menyimpan.</p>`);
                } else {
                    throw new Error('Popup blocked');
                }
            } catch (fallbackError) {
                // Last resort: Show in modal
                showUniversalModal('Download Gambar', `
                    <p class="mb-4 text-gray-700">Tekan dan tahan gambar di bawah, lalu pilih "Simpan Gambar" atau "Download Image".</p>
                    <div class="bg-gray-100 p-4 rounded-lg">
                        <img src="${imageUrl}" class="w-full rounded-lg border-2 border-gray-300" alt="${filename}">
                    </div>
                    <p class="mt-4 text-sm text-gray-500">Nama file: ${filename}</p>
                `);
            }
        }
    }
    window.downloadImage = downloadImage;

    // Alias untuk showModal
    window.showModal = showUniversalModal;

    // ============================================
    // HELPER FUNCTIONS FOR AFFILIATE FEATURES
    // ============================================

    // Helper function untuk toggle buttons (Platform, Length, Type, dll)
    function setupToggleButtons(containerSelector, btnClass) {
        const container = document.querySelector(containerSelector);
        if (!container) return;

        container.addEventListener('click', (e) => {
            const btn = e.target.closest(`.${btnClass}`);
            if (!btn) return;

            container.querySelectorAll(`.${btnClass}`).forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
        });
    }

    // Helper function untuk copy to clipboard
    function setupCopyButton(buttonId, targetId) {
        const button = document.getElementById(buttonId);
        const target = document.getElementById(targetId);

        if (!button || !target) return;

        const handleCopy = async (e) => {
            e.preventDefault();
            e.stopPropagation();

            try {
                await navigator.clipboard.writeText(target.textContent);
                const originalText = button.innerHTML;
                button.innerHTML = '<i class="fas fa-check"></i>Tersalin!';
                setTimeout(() => {
                    button.innerHTML = originalText;
                }, 2000);
            } catch (err) {
                console.error('Failed to copy:', err);
            }
        };

        button.addEventListener('click', handleCopy);

        // Add touchend support for mobile to prevent page refresh
        button.addEventListener('touchend', (e) => {
            e.preventDefault();
            e.stopPropagation();
            handleCopy(e);
        });
    }

    // Helper function untuk membersihkan markdown dari teks
    function cleanMarkdown(text) {
        if (!text) return text;
        // Hapus bold markdown ** atau __
        let cleaned = text.replace(/\*\*(.*?)\*\*/g, '$1');
        cleaned = cleaned.replace(/__(.*?)__/g, '$1');
        // Hapus italic markdown * atau _
        cleaned = cleaned.replace(/\*(.*?)\*/g, '$1');
        cleaned = cleaned.replace(/_(.*?)_/g, '$1');
        // Hapus markdown heading ###
        cleaned = cleaned.replace(/^#{1,6}\s+/gm, '');
        return cleaned;
    }

    // Copy to clipboard function
    async function copyToClipboard(text, button) {
        try {
            await navigator.clipboard.writeText(text);
            const originalText = button.innerHTML;
            button.innerHTML = '<i class="fas fa-check"></i> Tersalin!';
            button.classList.add('bg-green-500');
            setTimeout(() => {
                button.innerHTML = originalText;
                button.classList.remove('bg-green-500');
            }, 2000);
        } catch (error) {
            console.error('Error copying to clipboard:', error);
            // Fallback untuk browser yang tidak mendukung clipboard API
            const textarea = document.createElement('textarea');
            textarea.value = text;
            textarea.style.position = 'fixed';
            textarea.style.opacity = '0';
            document.body.appendChild(textarea);
            textarea.select();
            try {
                document.execCommand('copy');
                const originalText = button.innerHTML;
                button.innerHTML = '<i class="fas fa-check"></i> Tersalin!';
                button.classList.add('bg-green-500');
                setTimeout(() => {
                    button.innerHTML = originalText;
                    button.classList.remove('bg-green-500');
                }, 2000);
            } catch (err) {
                showUniversalModal('Gagal Menyalin', '<p class="text-red-500">Gagal menyalin ke clipboard. Silakan salin secara manual.</p>');
            }
            document.body.removeChild(textarea);
        }
    }
    window.copyToClipboard = copyToClipboard;

    // Helper function to add mobile touch support to buttons
    function addMobileTouchSupport(button) {
        if (!button) return;

        // Add touchend event to prevent page refresh on mobile
        button.addEventListener('touchend', (e) => {
            e.preventDefault();
            e.stopPropagation();
        });
    }
    window.addMobileTouchSupport = addMobileTouchSupport;

    closeModalBtn.addEventListener('click', () => universalModal.classList.remove('visible'));
    universalModal.addEventListener('click', (e) => {
        if (e.target.classList.contains('modal-backdrop')) {
             universalModal.classList.remove('visible');
        }
    });

    // --- MINIATURE ME LOGIC ---
    (function() {
        const uploader = document.getElementById('miniature-person-image-uploader');
        const fileInput = document.getElementById('miniature-person-file-input');
        const uploadPrompt = document.getElementById('miniature-person-upload-prompt');
        const imagePreview = document.getElementById('miniature-person-image-preview');
        const ratioSelection = document.getElementById('miniature-ratio-selection');
        const manualPrompt = document.getElementById('miniature-manual-prompt');
        const generateBtn = document.getElementById('miniature-generate-btn');
        const loader = document.getElementById('miniature-loader');
        const placeholderResult = document.getElementById('miniature-placeholder-result');
        const resultContent = document.getElementById('miniature-result-content');
        const errorMessage = document.getElementById('miniature-error-message');
        let personBase64Image = null;
        let selectedRatio = '16:9';

        function setupUploader(uploaderEl, inputEl, previewEl, promptEl, storageCallback) {
            uploaderEl.addEventListener('click', () => inputEl.click());
            uploaderEl.addEventListener('dragover', (e) => { e.preventDefault(); uploaderEl.classList.add('border-indigo-400', 'bg-indigo-50'); });
            uploaderEl.addEventListener('dragleave', () => uploaderEl.classList.remove('border-indigo-400', 'bg-indigo-50'));
            uploaderEl.addEventListener('drop', (e) => {
                e.preventDefault();
                uploaderEl.classList.remove('border-indigo-400', 'bg-indigo-50');
                if (e.dataTransfer.files.length > 0) {
                    inputEl.files = e.dataTransfer.files;
                    handleFileSelect({ target: inputEl }, previewEl, promptEl, storageCallback);
                }
            });
            inputEl.addEventListener('change', (e) => handleFileSelect(e, previewEl, promptEl, storageCallback));
        }

        function handleFileSelect(event, preview, prompt, storageCallback) {
            const file = event.target.files[0];
            if (file && file.type.startsWith('image/')) {
                const reader = new FileReader();
                reader.onloadend = () => {
                    storageCallback(reader.result.split(',')[1]);
                    preview.src = reader.result;
                    preview.classList.remove('hidden');
                    prompt.classList.add('hidden');
                    validateInputs();
                };
                reader.readAsDataURL(file);
            }
        }

        setupUploader(uploader, fileInput, imagePreview, uploadPrompt, (data) => { personBase64Image = data; });
        ratioSelection.addEventListener('click', (e) => {
            const button = e.target.closest('.ratio-btn-mini');
            if (button) {
                document.querySelectorAll('#miniature-ratio-selection .ratio-btn-mini').forEach(btn => btn.classList.remove('selected'));
                button.classList.add('selected');
                selectedRatio = button.dataset.ratio;
            }
        });

        [fileInput, manualPrompt].forEach(el => el.addEventListener('input', validateInputs));
        function validateInputs() { generateBtn.disabled = !personBase64Image; }

        async function generateImageWithRetry(payload, retries = 3, delay = 1000) {
           for (let i = 0; i < retries; i++) {
                try {
                    const apiKey = ""; 
                    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-image-preview:generateContent?key=${apiKey}`;
                    const response = await fetch(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
                    const responseText = await response.text();
                    if (!response.ok) {
                        let errorMsg = response.statusText;
                        try { errorMsg = JSON.parse(responseText).error?.message || errorMsg; } catch(e) { if(responseText) errorMsg = responseText; }
                        throw new Error(`API Error: ${errorMsg}`);
                    }
                    try { return JSON.parse(responseText); } catch (e) { throw new Error("Invalid JSON response."); }
                } catch (error) {
                    console.error(`Attempt ${i + 1} failed:`, error);
                    if (i === retries - 1) return null;
                    await new Promise(res => setTimeout(res, delay * Math.pow(2, i)));
                }
            }
            return null;
        }

        generateBtn.addEventListener('click', async () => {
            if (generateBtn.disabled) { showError("Silakan unggah foto Anda."); return; }
            showLoading(true);
            showError('');
            resultContent.innerHTML = '';
            const miniaturePrompts = [
                "figur skala 1/7 realistis di meja komputer.",
                "berdiri di atas layar HP raksasa.",
                "gantungan kunci action figure.",
                "mockup produk figur miniatur.",
                "memegang figur miniatur dirinya di studio.",
                "action figure di dalam lemari kaca.",
                "miniatur duduk di atas buku tebal.",
                "figur kecil di atas keyboard laptop.",
                "action figure di dashboard mobil.",
                "miniatur berdiri di atas cangkir kopi.",
                "figur kecil di dalam botol kaca.",
                "miniatur di atas tumpukan koin.",
                "action figure pose superhero di meja kerja.",
                "figur kecil dengan latar cityscape miniatur.",
                "miniatur di atas tanaman pot kecil.",
                "action figure di rak display koleksi.",
                "figur kecil sedang naik tangga pensil.",
                "miniatur dengan lighting studio profesional.",
                "action figure di antara makanan miniatur.",
                "figur kecil di landscape diorama."
            ];
            const generationPromises = miniaturePrompts.map(basePrompt => {
                let finalPrompt = `Based on the uploaded image, create a photorealistic image of the person as a miniature figure. Aspect ratio: ${selectedRatio}. Scene: ${basePrompt}.`;
                if(manualPrompt.value.trim()) { finalPrompt += ` Additional style: ${manualPrompt.value.trim()}.` }
                // Use selected aspect ratio directly
                const payload = { contents: [{ parts: [{ text: finalPrompt }, { inlineData: { mimeType: "image/jpeg", data: personBase64Image } } ] }], generationConfig: { responseModalities: ['IMAGE'], imageConfig: { aspectRatio: selectedRatio } }, };
                return generateImageWithRetry(payload);
            });
            try {
                const results = await Promise.all(generationPromises);
                results.forEach((result, index) => {
                    const card = document.createElement('div');
                    card.className = 'text-center';
                    const base64Data = result?.candidates?.[0]?.content?.parts?.find(p => p.inlineData)?.inlineData?.data;
                    const aspectClass = selectedRatio === '1:1' ? 'aspect-square' : selectedRatio === '16:9' ? 'aspect-video' : selectedRatio === '3:4' ? 'aspect-[3/4]' : 'aspect-[9/16]';
                    if (base64Data) {
                        const imageUrl = `data:image/png;base64,${base64Data}`;
                        card.innerHTML = `<img src="${imageUrl}" class="rounded-lg shadow-md w-full h-auto ${aspectClass} object-cover"><a href="#" data-base64="${base64Data}" data-filename="miniature-${index}.png" class="download-btn mt-2 inline-block bg-[#4f46e5] text-white py-1 px-4 rounded-full text-xs hover:bg-[#4338ca]"><i class="fas fa-download mr-1"></i> Download</a>`;
                    } else {
                        card.innerHTML = `<div class="rounded-lg shadow-md w-full ${aspectClass} bg-gray-200 flex items-center justify-center p-2 text-xs text-gray-600"><i class="fas fa-exclamation-triangle mr-1"></i> Gagal</div>`;
                    }
                    resultContent.appendChild(card);
                });
                resultContent.classList.remove('hidden');
            } catch (error) { showError(`Kesalahan: ${error.message}`); } finally { showLoading(false); }
        });
        
        resultContent.addEventListener('click', async function(e) {
            const btn = e.target.closest('.download-btn');
            if (btn) {
                e.preventDefault();
                e.stopPropagation();
                const base64 = btn.dataset.base64;
                const filename = btn.dataset.filename;
                if (base64 && filename) {
                    const imageUrl = `data:image/png;base64,${base64}`;
                    if (window.downloadDataURINew) {
                        await window.downloadDataURINew(imageUrl, filename);
                    } else if (window.downloadImage) {
                        await window.downloadImage(imageUrl, filename);
                    }
                }
            }
        });

        function showLoading(isLoading) {
            loader.classList.toggle('hidden', !isLoading);
            loader.classList.toggle('flex', isLoading);
            placeholderResult.classList.toggle('hidden', isLoading);
            resultContent.classList.toggle('hidden', !resultContent.children.length > 0 || isLoading);
            generateBtn.disabled = isLoading;
        }

        function showError(message) {
            errorMessage.textContent = message;
            errorMessage.classList.toggle('hidden', !message);
            if(message) { placeholderResult.classList.add('hidden'); resultContent.classList.add('hidden'); }
        }
        
        validateInputs();
    })();

    // --- HALU IDOL LOGIC ---
    (function() {
        const imageInput = document.getElementById('halu-image-input');
        const imageUploadArea = document.getElementById('halu-image-upload-area');
        const imagePreviewContainer = document.getElementById('halu-image-preview-container');
        const imagePreview = document.getElementById('halu-image-preview');
        const removeImageBtn = document.getElementById('halu-remove-image-btn');
        const idolImageInput = document.getElementById('halu-idol-image-input');
        const idolImageUploadArea = document.getElementById('halu-idol-image-upload-area');
        const idolImagePreviewContainer = document.getElementById('halu-idol-image-preview-container');
        const idolImagePreview = document.getElementById('halu-idol-image-preview');
        const removeIdolImageBtn = document.getElementById('halu-remove-idol-image-btn');
        const momentDescInput = document.getElementById('halu-moment-desc-input');
        const photoStyleInput = document.getElementById('halu-photo-style-input');
        const generateBtn = document.getElementById('halu-generate-btn');
        const bRollGrid = document.getElementById('halu-b-roll-grid');
        const haluRatioSelection = document.getElementById('halu-ratio-selection');

        let uploadedImageBase64 = null, imageMimeType = null;
        let uploadedIdolImageBase64 = null, idolImageMimeType = null;
        let selectedHaluRatio = '16:9';

        function updateButtonState() {
            generateBtn.disabled = !uploadedImageBase64 || !uploadedIdolImageBase64;
        }

        function setupImageUpload(input, uploadArea, previewContainer, previewImg, removeBtn, onUpload) {
            input.addEventListener('change', (event) => {
                const file = event.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        previewImg.src = e.target.result;
                        const [header, base64] = e.target.result.split(',');
                        const mimeType = header.match(/:(.*?);/)[1];
                        onUpload(base64, mimeType);
                        uploadArea.classList.add('hidden');
                        previewContainer.classList.remove('hidden');
                        updateButtonState();
                    };
                    reader.readAsDataURL(file);
                }
            });
            removeBtn.addEventListener('click', () => {
                onUpload(null, null);
                input.value = '';
                uploadArea.classList.remove('hidden');
                previewContainer.classList.add('hidden');
                updateButtonState();
            });
        }
        
        setupImageUpload(imageInput, imageUploadArea, imagePreviewContainer, imagePreview, removeImageBtn, (base64, mime) => { uploadedImageBase64 = base64; imageMimeType = mime; });
        setupImageUpload(idolImageInput, idolImageUploadArea, idolImagePreviewContainer, idolImagePreview, removeIdolImageBtn, (base64, mime) => { uploadedIdolImageBase64 = base64; idolImageMimeType = mime; });
        
        if (haluRatioSelection) {
            haluRatioSelection.addEventListener('click', (e) => {
                const button = e.target.closest('.ratio-btn-halu');
                if (button) {
                    document.querySelectorAll('#halu-ratio-selection .ratio-btn-halu').forEach(btn => btn.classList.remove('selected'));
                    button.classList.add('selected');
                    selectedHaluRatio = button.dataset.ratio;
                }
            });
        }
        
        const createInitialPlaceholders = () => {
            bRollGrid.innerHTML = '';
            for(let i = 1; i <= 6; i++) {
                const card = document.createElement('div');
                card.className = 'b-roll-card card p-4 flex flex-col justify-between animate-pulse';
                card.innerHTML = `<div class="h-6 bg-pink-200 rounded w-3/4 mb-4"></div><div class="mt-4 aspect-square bg-pink-100 rounded-md"></div>`;
                bRollGrid.appendChild(card);
            }
        };
        createInitialPlaceholders();
        
        generateBtn.addEventListener('click', async () => {
            if (!uploadedImageBase64 || !uploadedIdolImageBase64) return;
            generateBtn.disabled = true;
            generateBtn.innerHTML = `<div class="loader"></div><span class="ml-2">Mencari Ide...</span>`;
            
            try {
                const bRollIdeas = await analyzeAndGetPrompts();
                generateBtn.innerHTML = `<div class="loader"></div><span class="ml-2">Membuat Foto...</span>`;
                createDynamicCards(bRollIdeas);
                const generationPromises = bRollIdeas.map((idea, index) => generateSingleBroll(index + 1, idea.title, idea.prompt));
                await Promise.allSettled(generationPromises);
            } catch (error) {
                console.error("Error:", error);
            } finally {
                generateBtn.disabled = false;
                generateBtn.innerHTML = `<span>Buat 6 Foto Halu</span>`;
            }
        });

        async function analyzeAndGetPrompts() {
             const apiKey = "";
             const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
             const systemPrompt = `You are an AI photo blending assistant. Analyze a fan's photo and an idol's photo. Generate 6 distinct, creative photo concepts where they appear together as a couple. For each, provide a short title (in Indonesian) and a detailed prompt (in English) for an AI image generator. Respond ONLY with a valid JSON array of 6 objects with 'title' and 'prompt' keys.`;
             let userQuery = `Moment: "${momentDescInput.value.trim()}"\nStyle: "${photoStyleInput.value.trim()}"\nAspect Ratio: "${selectedHaluRatio}"`;
             const parts = [{ text: userQuery }, { inlineData: { mimeType: imageMimeType, data: uploadedImageBase64 } }, { inlineData: { mimeType: idolImageMimeType, data: uploadedIdolImageBase64 } }];
             const payload = { contents: [{ parts }], systemInstruction: { parts: [{ text: systemPrompt }] }, generationConfig: { responseMimeType: "application/json", responseSchema: { type: "ARRAY", items: { type: "OBJECT", properties: { "title": { "type": "STRING" }, "prompt": { "type": "STRING" } } } } } };
             const response = await fetch(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
             if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
             const result = await response.json();
             return JSON.parse(result.candidates[0].content.parts[0].text);
        }

        async function generateSingleBroll(id, title, prompt) {
            const card = document.getElementById(`halu-card-${id}`);
            if (!card) return;
            const outputContainer = card.querySelector('.aspect-square');
            try {
                const apiKey = "";
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-image-preview:generateContent?key=${apiKey}`;
                const finalPrompt = `${prompt}, realistic photo, romantic, candid moment, high quality, detailed faces, cinematic lighting, 8k, aspect ratio ${selectedHaluRatio}`;
                const parts = [{ text: finalPrompt }, { inlineData: { mimeType: imageMimeType, data: uploadedImageBase64 } }, { inlineData: { mimeType: idolImageMimeType, data: uploadedIdolImageBase64 } }];
                // Use selected aspect ratio directly
                const payload = { contents: [{ parts }], generationConfig: { responseModalities: ['IMAGE'], imageConfig: { aspectRatio: selectedHaluRatio } } };
                const response = await fetch(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
                if (!response.ok) throw new Error(`API error: ${response.statusText}`);
                const result = await response.json();
                const base64Data = result?.candidates?.[0]?.content?.parts?.find(p => p.inlineData)?.inlineData?.data;
                if (base64Data) {
                    const imageUrl = `data:image/png;base64,${base64Data}`;
                    const safeTitle = title.replace(/[^a-z0-9]/gi, '_').toLowerCase();
                    outputContainer.innerHTML = `
                        <div class="relative w-full h-full group">
                            <img src="${imageUrl}" class="w-full h-full object-cover rounded-md" alt="${title}">
                            <div class="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/70 via-black/50 to-transparent p-4 opacity-0 group-hover:opacity-100 transition-all duration-300 ease-in-out rounded-b-md">
                                <div class="flex gap-2 justify-end">
                                    <button data-action="halu-download" data-image-url="${imageUrl}" data-filename="halu_${id}_${safeTitle}.png" class="action-btn bg-pink-600 text-white px-3 py-2 rounded-lg hover:bg-pink-700 active:scale-95 transition-all duration-200 shadow-lg hover:shadow-xl flex items-center gap-2 text-sm font-medium" title="Unduh Gambar">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd" /></svg>
                                        <span class="hidden sm:inline">Unduh</span>
                                    </button>
                                </div>
                            </div>
                        </div>`;
                } else { throw new Error("No image data from API."); }
            } catch (error) {
                outputContainer.innerHTML = `<div class="text-xs text-red-500 p-2 text-center">Gagal.</div>`;
            }
        }
        
        const createDynamicCards = (prompts) => {
            bRollGrid.innerHTML = '';
            prompts.forEach((p, index) => {
                const card = document.createElement('div');
                card.id = `halu-card-${index + 1}`;
                card.className = 'b-roll-card card p-4 flex flex-col justify-between';
                card.innerHTML = `<div><h3 class="text-lg font-semibold text-gray-800 mb-4">${p.title}</h3></div> <div class="aspect-square bg-pink-100 rounded-md flex items-center justify-center"><div class="loader"></div></div>`;
                bRollGrid.appendChild(card);
            });
        };

        const heartsContainer = document.querySelector('#content-halu .hearts-container');
        if (heartsContainer) {
            for (let i = 0; i < 20; i++) {
                const heart = document.createElement('div');
                heart.className = 'heart';
                heart.style.left = `${Math.random() * 100}vw`;
                heart.style.animationDuration = `${8 + Math.random() * 10}s`;
                heart.style.animationDelay = `${Math.random() * 7}s`;
                heartsContainer.appendChild(heart);
            }
        }

        // Event delegation for halu download buttons
        if (bRollGrid) {
            bRollGrid.addEventListener('click', async (e) => {
                const downloadBtn = e.target.closest('[data-action="halu-download"]');
                if (downloadBtn) {
                    e.stopPropagation();
                    const imageUrl = downloadBtn.dataset.imageUrl;
                    const filename = downloadBtn.dataset.filename;
                    if (imageUrl && filename) {
                        if (window.downloadDataURINew) {
                            await window.downloadDataURINew(imageUrl, filename);
                        } else if (window.downloadImage) {
                            await window.downloadImage(imageUrl, filename);
                        }
                    }
                }
            });
        }
    })();

    // --- FOTO PRODUK (AFFILIATE GO) LOGIC ---
    (function() {
        // --- B-Roll (Foto Produk) Logic ---
        const brollImageInput = document.getElementById('broll-image-input');
        const brollImageUploadArea = document.getElementById('broll-image-upload-area');
        const brollImagePreviewContainer = document.getElementById('broll-image-preview-container');
        const brollImagePreview = document.getElementById('broll-image-preview');
        const brollRemoveImageBtn = document.getElementById('broll-remove-image-btn');
        const brollModelImageInput = document.getElementById('broll-model-image-input');
        const brollModelImageUploadArea = document.getElementById('broll-model-image-upload-area');
        const brollModelImagePreviewContainer = document.getElementById('broll-model-image-preview-container');
        const brollModelImagePreview = document.getElementById('broll-model-image-preview');
        const brollRemoveModelImageBtn = document.getElementById('broll-remove-model-image-btn');
        const brollBackgroundImageInput = document.getElementById('broll-background-image-input');
        const brollBackgroundImageUploadArea = document.getElementById('broll-background-image-upload-area');
        const brollBackgroundImagePreviewContainer = document.getElementById('broll-background-image-preview-container');
        const brollBackgroundImagePreview = document.getElementById('broll-background-image-preview');
        const brollRemoveBackgroundImageBtn = document.getElementById('broll-remove-background-image-btn');
        const brollProductDescInput = document.getElementById('broll-product-desc-input');
        const brollGenerateBtn = document.getElementById('broll-generate-btn');
        const brollGrid = document.getElementById('broll-b-roll-grid');
        const brollGenerateDescBtn = document.getElementById('broll-generate-desc-btn');
        const brollResultsHeader = document.getElementById('broll-results-header');
        const brollResultCount = document.getElementById('broll-result-count');
        const brollDownloadAllBtn = document.getElementById('broll-download-all-btn');
        const brollCountSelection = document.getElementById('broll-count-selection');
        const brollCountText = document.getElementById('broll-count-text');
        let brollProductImages = [];
        let brollModelImageBase64 = null, brollModelImageMimeType = null;
        let brollBackgroundImageBase64 = null, brollBackgroundImageMimeType = null;
        const brollRatioSelection = document.getElementById('broll-ratio-selection');
        let selectedBrollRatio = '16:9';
        let selectedBrollCount = 7;
        let generatedBrollImages = [];
        
        function updateBrollButtonState() {
            if(brollGenerateBtn) brollGenerateBtn.disabled = brollProductImages.length === 0 || !brollProductDescInput.value.trim();
            if(brollGenerateDescBtn) brollGenerateDescBtn.disabled = brollProductImages.length === 0;
        }

        // Handle multiple product images
        function handleBrollProductFiles(files) {
            if (!files || files.length === 0) return;

            brollImageUploadArea.classList.add('hidden');
            brollImagePreviewContainer.classList.remove('hidden');

            let filesToProcess = files.length;

            Array.from(files).forEach((file) => {
                const reader = new FileReader();
                reader.onload = (e) => {
                    const [header, base64] = e.target.result.split(',');
                    const mimeType = header.match(/:(.*?);/)[1];
                    const imageData = {
                        id: Date.now() + Math.random(),
                        base64: base64,
                        mimeType: mimeType
                    };

                    brollProductImages.push(imageData);

                    const previewWrapper = document.createElement('div');
                    previewWrapper.className = 'relative group';
                    previewWrapper.innerHTML = `
                        <img src="${e.target.result}" alt="Pratinjau Produk" class="rounded-lg w-full h-24 object-cover">
                        <button data-id="${imageData.id}" class="absolute top-1 right-1 bg-red-500 text-white rounded-full p-1 opacity-0 group-hover:opacity-100 transition-opacity focus:opacity-100">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                        </button>
                    `;

                    brollImagePreviewContainer.appendChild(previewWrapper);

                    previewWrapper.querySelector('button').addEventListener('click', (btnEvent) => {
                        const idToRemove = parseFloat(btnEvent.currentTarget.getAttribute('data-id'));
                        brollProductImages = brollProductImages.filter(img => img.id !== idToRemove);
                        previewWrapper.remove();
                        if (brollProductImages.length === 0) {
                            brollImageUploadArea.classList.remove('hidden');
                            brollImagePreviewContainer.classList.add('hidden');
                            const addButton = document.getElementById('broll-add-more-button');
                            if (addButton) addButton.remove();
                        }
                        updateBrollButtonState();
                    });

                    updateBrollButtonState();

                    filesToProcess--;
                    if (filesToProcess === 0) {
                        manageAddMoreButton();
                    }
                };
                reader.readAsDataURL(file);
            });
        }

        function manageAddMoreButton() {
            const existingButton = document.getElementById('broll-add-more-button');
            if (existingButton) {
                existingButton.remove();
            }

            const addButtonWrapper = document.createElement('div');
            addButtonWrapper.id = 'broll-add-more-button';
            addButtonWrapper.className = 'relative group cursor-pointer';
            addButtonWrapper.innerHTML = `
                <div class="rounded-lg w-full h-24 border-2 border-dashed border-gray-400 hover:border-cyan-500 bg-gray-50 hover:bg-cyan-50 transition-colors flex items-center justify-center">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-gray-400 group-hover:text-cyan-500" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg>
                </div>
            `;

            addButtonWrapper.addEventListener('click', () => {
                brollImageInput.click();
            });

            brollImagePreviewContainer.appendChild(addButtonWrapper);
        }

        if (brollImageInput) {
            brollImageInput.addEventListener('change', (event) => {
                handleBrollProductFiles(event.target.files);
                event.target.value = null;
            });
        }

        // Setup model image upload (single image)
        function setupBrollModelImageUpload(input, uploadArea, previewContainer, previewImg, removeBtn) {
            if (!input) return;
            input.addEventListener('change', (event) => {
                const file = event.target.files[0];
                if (!file) return;
                const reader = new FileReader();
                reader.onload = (e) => {
                    previewImg.src = e.target.result;
                    const [header, base64] = e.target.result.split(',');
                    const mimeType = header.match(/:(.*?);/)[1];
                    brollModelImageBase64 = base64;
                    brollModelImageMimeType = mimeType;
                    uploadArea.classList.add('hidden');
                    previewContainer.classList.remove('hidden');
                };
                reader.readAsDataURL(file);
            });
            removeBtn.addEventListener('click', () => {
                brollModelImageBase64 = null;
                brollModelImageMimeType = null;
                input.value = '';
                uploadArea.classList.remove('hidden');
                previewContainer.classList.add('hidden');
            });
        }
        setupBrollModelImageUpload(brollModelImageInput, brollModelImageUploadArea, brollModelImagePreviewContainer, brollModelImagePreview, brollRemoveModelImageBtn);

        // Setup background image upload (single image)
        function setupBrollBackgroundImageUpload(input, uploadArea, previewContainer, previewImg, removeBtn) {
            if (!input) return;
            input.addEventListener('change', (event) => {
                const file = event.target.files[0];
                if (!file) return;
                const reader = new FileReader();
                reader.onload = (e) => {
                    previewImg.src = e.target.result;
                    const [header, base64] = e.target.result.split(',');
                    const mimeType = header.match(/:(.*?);/)[1];
                    brollBackgroundImageBase64 = base64;
                    brollBackgroundImageMimeType = mimeType;
                    uploadArea.classList.add('hidden');
                    previewContainer.classList.remove('hidden');
                };
                reader.readAsDataURL(file);
            });
            removeBtn.addEventListener('click', () => {
                brollBackgroundImageBase64 = null;
                brollBackgroundImageMimeType = null;
                input.value = '';
                uploadArea.classList.remove('hidden');
                previewContainer.classList.add('hidden');
            });
        }
        setupBrollBackgroundImageUpload(brollBackgroundImageInput, brollBackgroundImageUploadArea, brollBackgroundImagePreviewContainer, brollBackgroundImagePreview, brollRemoveBackgroundImageBtn);

        if(brollProductDescInput) brollProductDescInput.addEventListener('input', updateBrollButtonState);

        if(brollRatioSelection) {
            brollRatioSelection.addEventListener('click', (e) => {
                const button = e.target.closest('.ratio-btn-broll');
                if (button) {
                    document.querySelectorAll('#broll-ratio-selection .ratio-btn-broll').forEach(btn => btn.classList.remove('selected'));
                    button.classList.add('selected');
                    selectedBrollRatio = button.dataset.ratio;
                }
            });
        }

        // Handle count selection
        if(brollCountSelection) {
            brollCountSelection.addEventListener('click', (e) => {
                const button = e.target.closest('[data-count]');
                if (button) {
                    document.querySelectorAll('#broll-count-selection [data-count]').forEach(btn => btn.classList.remove('selected'));
                    button.classList.add('selected');
                    selectedBrollCount = parseInt(button.dataset.count, 10);
                    if (brollCountText) brollCountText.textContent = selectedBrollCount;
                }
            });
        }

        const createInitialBrollPlaceholders = () => {
            if(!brollGrid) return;
            brollGrid.innerHTML = Array.from({length: 20}, () => `
                <div class="result-card card p-4 flex flex-col justify-between animate-pulse">
                    <div><div class="h-6 bg-gray-200 rounded w-3/4 mb-4"></div></div>
                    <div class="mt-4 aspect-video bg-gray-300 rounded-md"></div>
                </div>`).join('');
        };
        createInitialBrollPlaceholders();

        if(brollGenerateBtn) brollGenerateBtn.addEventListener('click', async () => {
            if (brollGenerateBtn.disabled) return;
            brollGenerateBtn.disabled = true;
            brollGenerateBtn.innerHTML = `<div class="loader"></div><span class="ml-2">Menganalisa...</span>`;

            // Clear previous generated images
            generatedBrollImages = [];
            if (brollResultsHeader) brollResultsHeader.classList.add('hidden');

            try {
                const ideas = await analyzeAndGetPrompts();
                brollGenerateBtn.innerHTML = `<div class="loader"></div><span class="ml-2">Membuat Visual...</span>`;
                createBrollDynamicCards(ideas);
                await Promise.allSettled(ideas.map((idea, i) => generateSingleBroll(i + 1, idea.title, idea.prompt)));

                // Show results header and update count
                if (generatedBrollImages.length > 0) {
                    if (brollResultsHeader) brollResultsHeader.classList.remove('hidden');
                    if (brollResultCount) brollResultCount.textContent = generatedBrollImages.length;
                }
            } catch (error) {
                console.error("Error:", error);
                brollGrid.innerHTML = `<p class="text-red-500 col-span-full text-center">Gagal membuat ide: ${error.message}</p>`;
            } finally {
                brollGenerateBtn.disabled = false;
                brollGenerateBtn.innerHTML = `<span>Buat <span id="broll-count-text">${selectedBrollCount}</span> Pose Produk</span>`;
                updateBrollButtonState();
            }
        });

        // Download all button event listener
        if (brollDownloadAllBtn) {
            brollDownloadAllBtn.addEventListener('click', async () => {
                if (generatedBrollImages.length === 0) return;

                brollDownloadAllBtn.disabled = true;
                brollDownloadAllBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Downloading...';

                for (let i = 0; i < generatedBrollImages.length; i++) {
                    const img = generatedBrollImages[i];
                    if (window.downloadDataURINew) {
                        await window.downloadDataURINew(img.url, img.filename);
                        await new Promise(resolve => setTimeout(resolve, 500));
                    }
                }

                brollDownloadAllBtn.disabled = false;
                brollDownloadAllBtn.innerHTML = '<i class="fas fa-download mr-2"></i>Download Semua';
            });
        }

        async function analyzeAndGetPrompts() {
             const apiKey = ""; const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

             let systemPrompt;
             if (brollModelImageBase64) {
                 systemPrompt = `You are a professional product photographer's AI assistant. Analyze product image(s), description, and a model's photo. Generate ${selectedBrollCount} distinct, creative, professional shots. If multiple product images are provided (e.g., a shirt and pants), generate prompts that show the model wearing or using ALL products together in a complete outfit/setup. The model MUST naturally interact with or wear ALL the products. ${brollBackgroundImageBase64 ? 'A custom background image is provided - use it as the setting/backdrop for the photos.' : ''} For each, provide a short, descriptive title (in Indonesian) and a detailed prompt (in English) for an AI image generator, emphasizing a high-end commercial aesthetic. Respond ONLY with a valid JSON array of ${selectedBrollCount} objects.`;
             } else {
                 systemPrompt = `You are a professional product photographer's AI assistant. Analyze product image(s) and description. Generate ${selectedBrollCount} distinct, creative, professional product-only shots with NO human models. If multiple products are provided, show them together in creative compositions. ${brollBackgroundImageBase64 ? 'A custom background image is provided - use it as the setting/backdrop for the product photos.' : ''} Focus on creative backgrounds, lighting, and product arrangements. For each, provide a short, descriptive title (in Indonesian) and a detailed prompt (in English) for an AI image generator, emphasizing a high-end commercial aesthetic. Respond ONLY with a valid JSON array of ${selectedBrollCount} objects.`;
             }

             const theme = document.getElementById('broll-photo-theme-input').value.trim();
             let userQuery = `Product Description: "${brollProductDescInput.value.trim()}" ${theme ? `\nPhoto Theme: "${theme}"` : ''} ${brollBackgroundImageBase64 ? '\nNote: A custom background image is provided for the product photos.' : ''} \nAspect Ratio: "${selectedBrollRatio}"`;

             const parts = [{ text: userQuery }];
             brollProductImages.forEach(img => {
                 parts.push({ inlineData: { mimeType: img.mimeType, data: img.base64 } });
             });
             if (brollModelImageBase64) {
                 parts.push({ inlineData: { mimeType: brollModelImageMimeType, data: brollModelImageBase64 } });
             }
             if (brollBackgroundImageBase64) {
                 parts.push({ inlineData: { mimeType: brollBackgroundImageMimeType, data: brollBackgroundImageBase64 } });
             }

             const payload = { contents: [{ parts }], systemInstruction: { parts: [{ text: systemPrompt }] }, generationConfig: { responseMimeType: "application/json", responseSchema: { type: "ARRAY", items: { type: "OBJECT", properties: { "title": { "type": "STRING" }, "prompt": { "type": "STRING" } }, required: ["title", "prompt"] } } } };
             const response = await fetch(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
             if (!response.ok) { const err = await response.json(); throw new Error(err.error?.message || response.statusText); }
             const result = await response.json();
             return JSON.parse(result.candidates[0].content.parts[0].text);
        }

        async function generateSingleBroll(id, title, prompt) {
            const card = document.getElementById(`broll-card-${id}`);
            const outputContainer = card.querySelector('.aspect-video');
            try {
                const apiKey = ""; const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-image-preview:generateContent?key=${apiKey}`;
                const finalPrompt = `${prompt}, elegant, cinematic, professional product photography, dramatic lighting, 8k, photorealistic, aspect ratio ${selectedBrollRatio}`;
                const parts = [{ text: finalPrompt }];

                // Add all product images
                brollProductImages.forEach(img => {
                    parts.push({ inlineData: { mimeType: img.mimeType, data: img.base64 } });
                });

                // Add model image if available
                if (brollModelImageBase64) {
                    parts.push({ inlineData: { mimeType: brollModelImageMimeType, data: brollModelImageBase64 } });
                }

                // Add background image if available
                if (brollBackgroundImageBase64) {
                    parts.push({ inlineData: { mimeType: brollBackgroundImageMimeType, data: brollBackgroundImageBase64 } });
                }

                // Use selected aspect ratio directly
                const payload = { contents: [{ parts }], generationConfig: { responseModalities: ['IMAGE'], imageConfig: { aspectRatio: selectedBrollRatio } } };
                const response = await fetch(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
                if (!response.ok) throw new Error(`API error: ${response.statusText}`);
                const result = await response.json();
                const base64Data = result?.candidates?.[0]?.content?.parts?.find(p => p.inlineData)?.inlineData?.data;
                if (!base64Data) throw new Error("No image data from API.");
                const imageUrl = `data:image/png;base64,${base64Data}`;
                const safeTitle = title.replace(/[^a-z0-9]/gi, '_').toLowerCase();

                // Add to generated images array for download all functionality
                generatedBrollImages.push({
                    url: imageUrl,
                    filename: `affiliatego_${id}_${safeTitle}.png`
                });

                // Store generation parameters for regeneration
                if (!window.brollGenerationParams) window.brollGenerationParams = [];
                window.brollGenerationParams[id - 1] = {
                    prompt: prompt,
                    title: title,
                    productImages: brollProductImages,
                    modelImage: brollModelImageBase64 ? { base64: brollModelImageBase64, mimeType: brollModelImageMimeType } : null,
                    ratio: selectedBrollRatio
                };

                outputContainer.innerHTML = `<div class="relative w-full h-full group"><img src="${imageUrl}" class="w-full h-full object-cover rounded-md" alt="${title}"><div class="absolute bottom-2 right-2 flex flex-wrap gap-2 opacity-0 group-hover:opacity-100 transition-opacity"><button data-action="broll-preview" data-image-url="${imageUrl}" class="action-btn bg-blue-500 text-white p-2 rounded-full hover:bg-blue-600" title="Preview"><i class="fas fa-search-plus"></i></button><button data-action="broll-edit" data-index="${id - 1}" data-prompt="${prompt.replace(/"/g, '&quot;')}" class="action-btn bg-purple-500 text-white p-2 rounded-full hover:bg-purple-600" title="Edit Prompt"><i class="fas fa-edit"></i></button><button data-action="broll-regenerate" data-index="${id - 1}" class="action-btn bg-green-500 text-white p-2 rounded-full hover:bg-green-600" title="Regenerate"><i class="fas fa-sync-alt"></i></button><button data-action="broll-video" data-image-url="${imageUrl}" data-title="${title.replace(/"/g, '&quot;')}" class="action-btn bg-fuchsia-500 text-white p-2 rounded-full hover:bg-fuchsia-600" title="Buat Prompt Video"><i class="fas fa-film"></i></button><button data-action="broll-caption" data-image-url="${imageUrl}" data-title="${title.replace(/"/g, '&quot;')}" class="action-btn bg-rose-500 text-white p-2 rounded-full hover:bg-rose-600" title="Buat Caption"><i class="fas fa-pencil-alt"></i></button><button data-action="broll-download" data-image-url="${imageUrl}" data-filename="affiliatego_${id}_${safeTitle}.png" class="action-btn bg-cyan-600 text-white p-2 rounded-full hover:bg-cyan-700" title="Unduh"><i class="fas fa-download"></i></button></div></div>`;
            } catch (error) { outputContainer.innerHTML = `<div class="text-xs text-red-500 p-2 text-center">Gagal.</div>`; }
        }

        const createBrollDynamicCards = (prompts) => {
            brollGrid.innerHTML = prompts.map((p, i) => `
                <div id="broll-card-${i + 1}" class="result-card card p-4 flex flex-col justify-between">
                    <div><h3 class="text-lg font-semibold text-gray-800 mb-4">${p.title}</h3></div>
                    <div class="aspect-video bg-gray-100 rounded-md flex items-center justify-center"><div class="loader"></div></div>
                </div>`).join('');
        };
        
        if(brollGenerateDescBtn) brollGenerateDescBtn.addEventListener('click', async () => {
            const originalButtonText = brollGenerateDescBtn.innerHTML;
            brollGenerateDescBtn.innerHTML = `<div class="loader !w-4 !h-4 !border-2"></div>`;
            brollGenerateDescBtn.disabled = true;
            try {
                const apiKey = "";
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
                const systemPrompt = `You are a professional copywriter. Analyze the product(s) in the image(s) and write a concise, compelling, and SEO-friendly product description in Indonesian. Highlight key features and potential benefits for customers. Keep it under 500 characters.`;
                const parts = [ { text: "Buatkan deskripsi produk untuk gambar ini." }];
                if (brollProductImages.length > 0) {
                     parts.push({ inlineData: { mimeType: brollProductImages[0].mimeType, data: brollProductImages[0].base64 } });
                }
                const payload = {
                    contents: [{ parts: parts }],
                    systemInstruction: { parts: [{ text: systemPrompt }] }
                };
                const response = await fetch(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
                if (!response.ok) { const errorData = await response.json(); throw new Error(errorData.error?.message || `HTTP error! status: ${response.status}`); }
                const result = await response.json();
                const description = result.candidates[0].content.parts[0].text;
                brollProductDescInput.value = description.trim();
                updateBrollButtonState();
            } catch(error) {
                console.error("Error generating description:", error);
                brollProductDescInput.value = "Gagal membuat deskripsi. Coba lagi.";
            } finally {
                brollGenerateDescBtn.innerHTML = originalButtonText;
                brollGenerateDescBtn.disabled = false;
            }
        });
        window.handleAffiliateCaption = async (imageUrl, title) => {
            try {
                // Tampilkan loading modal
                const modal = document.createElement('div');
                modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4 overflow-y-auto';
                modal.style.WebkitOverflowScrolling = 'touch'; // Enable smooth scrolling on iOS
                modal.innerHTML = `
                    <div class="bg-white rounded-xl p-6 max-w-2xl w-full my-8" onclick="event.stopPropagation()">
                        <h3 class="text-xl font-bold mb-4 text-gray-800">
                            <i class="fas fa-pencil-alt text-rose-500 mr-2"></i>Membuat Caption...
                        </h3>
                        <div class="flex items-center justify-center py-8">
                            <div class="loader !border-l-rose-500"></div>
                        </div>
                    </div>
                `;
                document.body.appendChild(modal);

                // Close modal on backdrop click
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) {
                        modal.remove();
                    }
                });

                // Konversi imageUrl ke base64
                const response = await fetch(imageUrl);
                const blob = await response.blob();
                const reader = new FileReader();
                const base64Promise = new Promise((resolve) => {
                    reader.onloadend = () => {
                        const base64 = reader.result.split(',')[1];
                        resolve(base64);
                    };
                    reader.readAsDataURL(blob);
                });
                const base64Data = await base64Promise;

                // Call Gemini API untuk generate caption
                const apiKey = "";
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

                const systemPrompt = `You are an expert social media copywriter and content strategist. Analyze this product image and create 3 engaging, conversion-focused Instagram captions in Indonesian.

Each caption should:
1. Hook attention in the first line
2. Highlight product benefits or create desire
3. Include relevant emojis naturally
4. End with a clear call-to-action (CTA)
5. Be optimized for engagement and sales
6. Have different tones: Professional, Casual/Fun, and Inspirational

Format your response as JSON with this structure:
{
  "professional": "caption text",
  "casual": "caption text",
  "inspirational": "caption text"
}`;

                const payload = {
                    contents: [{
                        parts: [
                            { text: `Analyze this product image titled "${title}" and create 3 engaging Instagram captions in Indonesian for different audiences.` },
                            { inlineData: { mimeType: 'image/png', data: base64Data } }
                        ]
                    }],
                    systemInstruction: { parts: [{ text: systemPrompt }] },
                    generationConfig: {
                        responseMimeType: "application/json"
                    }
                };

                const apiResponse = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!apiResponse.ok) {
                    const errorData = await apiResponse.json();
                    throw new Error(errorData.error?.message || 'API request failed');
                }

                const result = await apiResponse.json();
                const captionText = result.candidates[0].content.parts[0].text;
                const captions = JSON.parse(captionText);

                // Update modal dengan hasil caption
                const modalContent = modal.querySelector('.bg-white');
                modalContent.innerHTML = `
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-xl font-bold text-gray-800">
                            <i class="fas fa-pencil-alt text-rose-500 mr-2"></i>Caption Instagram
                        </h3>
                        <button data-action="close-modal" class="text-gray-500 hover:text-gray-700 text-2xl leading-none" title="Tutup">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>

                    <div class="space-y-4 mb-6 max-h-[60vh] overflow-y-auto" style="-webkit-overflow-scrolling: touch;">
                        ${Object.entries(captions).map(([tone, caption]) => `
                            <div class="border border-gray-200 rounded-lg p-4 bg-gray-50">
                                <div class="flex items-center justify-between mb-2">
                                    <label class="text-sm font-bold text-gray-700 uppercase">${tone === 'professional' ? 'üéØ Profesional' : tone === 'casual' ? 'üòä Casual & Fun' : '‚ú® Inspiratif'}</label>
                                    <button data-action="copy-caption" data-caption="${caption.replace(/"/g, '&quot;')}"
                                        class="caption-copy-btn text-xs bg-rose-500 hover:bg-rose-600 text-white px-3 py-1 rounded-full transition-colors flex-shrink-0">
                                        <i class="fas fa-copy mr-1"></i>Salin
                                    </button>
                                </div>
                                <p class="text-sm text-gray-800 whitespace-pre-wrap leading-relaxed">${caption}</p>
                            </div>
                        `).join('')}
                    </div>

                    <div class="bg-blue-50 border border-blue-200 rounded-lg p-3 mb-4">
                        <p class="text-xs text-blue-800">
                            <i class="fas fa-info-circle mr-1"></i>
                            <strong>Tips:</strong> Pilih caption yang sesuai dengan brand voice Anda!
                        </p>
                    </div>

                    <button data-action="close-modal"
                        class="w-full bg-gray-500 hover:bg-gray-600 text-white font-bold py-3 px-4 rounded-lg transition-colors">
                        Tutup
                    </button>
                `;

                // Add event delegation for copy and close buttons (works on desktop & mobile)
                modalContent.addEventListener('click', async (e) => {
                    e.stopPropagation();

                    const copyBtn = e.target.closest('[data-action="copy-caption"]');
                    const closeBtn = e.target.closest('[data-action="close-modal"]');

                    if (copyBtn) {
                        const captionText = copyBtn.dataset.caption;
                        try {
                            await navigator.clipboard.writeText(captionText);
                            const originalHTML = copyBtn.innerHTML;
                            copyBtn.innerHTML = '<i class="fas fa-check mr-1"></i>Tersalin!';
                            copyBtn.classList.remove('bg-rose-500');
                            copyBtn.classList.add('bg-green-500');
                            setTimeout(() => {
                                copyBtn.innerHTML = originalHTML;
                                copyBtn.classList.remove('bg-green-500');
                                copyBtn.classList.add('bg-rose-500');
                            }, 2000);
                        } catch (err) {
                            console.error('Failed to copy:', err);
                            // Fallback for older browsers
                            alert('Caption berhasil dipilih. Salin dengan Ctrl+C atau Command+C');
                        }
                    } else if (closeBtn) {
                        modal.remove();
                    }
                });

            } catch (error) {
                console.error('Error generating caption:', error);

                // Tampilkan error modal
                const errorModal = document.createElement('div');
                errorModal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4';
                errorModal.innerHTML = `
                    <div class="bg-white rounded-xl p-6 max-w-md w-full">
                        <h3 class="text-xl font-bold mb-4 text-red-600">
                            <i class="fas fa-exclamation-triangle mr-2"></i>Error
                        </h3>
                        <p class="text-gray-700 mb-4">${error.message}</p>
                        <button onclick="this.closest('.fixed').remove()"
                            class="w-full bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded-lg transition-colors">
                            Tutup
                        </button>
                    </div>
                `;
                document.body.appendChild(errorModal);

                // Remove loading modal if it exists
                const existingModal = document.querySelector('.fixed.inset-0');
                if (existingModal && existingModal !== errorModal) {
                    existingModal.remove();
                }
            }
        };

        window.handleAffiliateVideoPrompt = async (imageUrl, title) => {
            try {
                // Tampilkan loading
                const modal = document.createElement('div');
                modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4';
                modal.innerHTML = `
                    <div class="bg-white rounded-xl p-6 max-w-2xl w-full max-h-[80vh] overflow-y-auto">
                        <h3 class="text-xl font-bold mb-4 text-gray-800">
                            <i class="fas fa-film text-fuchsia-500 mr-2"></i>Membuat Prompt Video...
                        </h3>
                        <div class="flex items-center justify-center py-8">
                            <div class="loader !border-l-fuchsia-500"></div>
                        </div>
                    </div>
                `;
                document.body.appendChild(modal);

                // Konversi imageUrl ke base64
                const response = await fetch(imageUrl);
                const blob = await response.blob();
                const reader = new FileReader();
                const base64Promise = new Promise((resolve) => {
                    reader.onloadend = () => {
                        const base64 = reader.result.split(',')[1];
                        resolve(base64);
                    };
                    reader.readAsDataURL(blob);
                });
                const base64Data = await base64Promise;

                // Call Gemini API untuk generate prompt
                const apiKey = "";
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

                const systemPrompt = `You are an expert video prompt engineer. Analyze this product image and create a detailed, cinematic prompt for an AI image-to-video generator (like Runway, Pika, or Stable Video Diffusion).

The prompt should:
1. Describe the product's visual appearance and key features
2. Suggest natural, engaging camera movements (zoom in, pan, rotation, etc.)
3. Include dynamic elements (floating particles, light effects, product rotation)
4. Specify lighting and atmosphere
5. Be optimized for text-to-video AI models
6. Be in English for maximum compatibility
7. Keep it under 200 words but highly detailed

Output ONLY the video prompt, nothing else.`;

                const payload = {
                    contents: [{
                        parts: [
                            { text: `Create a cinematic video prompt for this product image titled "${title}". Make it dynamic and engaging for image-to-video AI.` },
                            { inlineData: { mimeType: 'image/png', data: base64Data } }
                        ]
                    }],
                    systemInstruction: { parts: [{ text: systemPrompt }] }
                };

                const apiResponse = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!apiResponse.ok) {
                    const errorData = await apiResponse.json();
                    throw new Error(errorData.error?.message || 'Failed to generate prompt');
                }

                const result = await apiResponse.json();
                const videoPrompt = result.candidates[0].content.parts[0].text.trim();

                // Tampilkan hasil
                modal.innerHTML = `
                    <div class="bg-white rounded-xl p-6 max-w-2xl w-full max-h-[80vh] overflow-y-auto">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-xl font-bold text-gray-800">
                                <i class="fas fa-film text-fuchsia-500 mr-2"></i>Prompt Video untuk: ${title}
                            </h3>
                            <button onclick="this.closest('.fixed').remove()" class="text-gray-500 hover:text-gray-700">
                                <i class="fas fa-times text-xl"></i>
                            </button>
                        </div>

                        <div class="mb-4">
                            <img src="${imageUrl}" alt="${title}" class="w-full rounded-lg mb-3 max-h-64 object-contain bg-gray-100">
                        </div>

                        <div class="bg-gray-50 border-2 border-gray-200 rounded-lg p-4 mb-4">
                            <div class="flex items-center justify-between mb-2">
                                <label class="text-sm font-semibold text-gray-700">Video Prompt:</label>
                                <button id="copyPromptBtn" class="text-xs bg-fuchsia-500 hover:bg-fuchsia-600 text-white px-3 py-1 rounded-full transition-colors">
                                    <i class="fas fa-copy mr-1"></i>Copy
                                </button>
                            </div>
                            <textarea id="videoPromptText" rows="8" readonly class="w-full p-3 border border-gray-300 rounded-lg bg-white text-gray-800 text-sm font-mono resize-none focus:outline-none focus:ring-2 focus:ring-fuchsia-500">${videoPrompt}</textarea>
                        </div>

                        <div class="bg-blue-50 border border-blue-200 rounded-lg p-3 mb-4">
                            <p class="text-xs text-blue-800">
                                <i class="fas fa-info-circle mr-1"></i>
                                <strong>Cara Pakai:</strong> Copy prompt ini dan gunakan di platform Image-to-Video seperti Runway, Pika Labs, Stable Video Diffusion, atau yang lainnya. Upload gambar produk Anda dan paste prompt ini untuk hasil terbaik.
                            </p>
                        </div>

                        <div class="flex gap-2">
                            <button onclick="this.closest('.fixed').remove()" class="flex-1 bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-lg transition-colors">
                                Tutup
                            </button>
                        </div>
                    </div>
                `;

                // Add copy to clipboard functionality
                const copyBtn = modal.querySelector('#copyPromptBtn');
                const promptTextarea = modal.querySelector('#videoPromptText');

                copyBtn.addEventListener('click', () => {
                    promptTextarea.select();
                    document.execCommand('copy');
                    copyBtn.innerHTML = '<i class="fas fa-check mr-1"></i>Copied!';
                    copyBtn.classList.remove('bg-fuchsia-500', 'hover:bg-fuchsia-600');
                    copyBtn.classList.add('bg-green-500');
                    setTimeout(() => {
                        copyBtn.innerHTML = '<i class="fas fa-copy mr-1"></i>Copy';
                        copyBtn.classList.remove('bg-green-500');
                        copyBtn.classList.add('bg-fuchsia-500', 'hover:bg-fuchsia-600');
                    }, 2000);
                });

            } catch (error) {
                console.error('Error generating video prompt:', error);
                // Tampilkan error
                const errorModal = document.createElement('div');
                errorModal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4';
                errorModal.innerHTML = `
                    <div class="bg-white rounded-xl p-6 max-w-md w-full">
                        <h3 class="text-xl font-bold mb-4 text-red-600">
                            <i class="fas fa-exclamation-triangle mr-2"></i>Error
                        </h3>
                        <p class="text-gray-700 mb-4">${error.message}</p>
                        <button onclick="this.closest('.fixed').remove()" class="w-full bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded-lg">
                            Tutup
                        </button>
                    </div>
                `;
                document.body.appendChild(errorModal);

                // Remove existing loading modal if exists
                const existingModal = document.querySelector('.fixed.inset-0');
                if (existingModal && existingModal !== errorModal) {
                    existingModal.remove();
                }
            }
        };

        // Event delegation for broll grid action buttons (works on desktop & mobile)
        if (brollGrid) {
            brollGrid.addEventListener('click', async (e) => {
                e.stopPropagation();

                const actionBtn = e.target.closest('.action-btn[data-action]');
                if (!actionBtn) return;

                const action = actionBtn.dataset.action;
                const imageUrl = actionBtn.dataset.imageUrl;
                const title = actionBtn.dataset.title;
                const filename = actionBtn.dataset.filename;
                const index = actionBtn.dataset.index;

                if (action === 'broll-preview' && imageUrl) {
                    showPreviewModal(imageUrl);
                } else if (action === 'broll-edit' && index !== undefined) {
                    handleEditBroll(parseInt(index), actionBtn.dataset.prompt);
                } else if (action === 'broll-regenerate' && index !== undefined) {
                    await handleRegenerateBroll(parseInt(index));
                } else if (action === 'broll-video' && imageUrl && title) {
                    window.handleAffiliateVideoPrompt(imageUrl, title);
                } else if (action === 'broll-caption' && imageUrl && title) {
                    window.handleAffiliateCaption(imageUrl, title);
                } else if (action === 'broll-download' && imageUrl && filename) {
                    if (window.downloadDataURINew) {
                        await window.downloadDataURINew(imageUrl, filename);
                    }
                }
            });

            // Handler functions for edit and regenerate
            function handleEditBroll(index, currentPrompt) {
                const modal = document.createElement('div');
                modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4';
                modal.innerHTML = `
                    <div class="bg-white rounded-xl p-6 max-w-2xl w-full">
                        <h3 class="text-xl font-bold mb-4 text-gray-800">
                            <i class="fas fa-edit text-purple-500 mr-2"></i>Edit Scene Prompt
                        </h3>
                        <div class="mb-4">
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Scene Description:</label>
                            <textarea id="edit-broll-input" rows="4" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-purple-500 focus:outline-none resize-none" placeholder="Contoh: A serene mountain landscape with a river flowing through, vibrant flowers in foreground, golden hour lighting...">${currentPrompt}</textarea>
                            <p class="text-xs text-gray-500 mt-2">
                                <i class="fas fa-info-circle mr-1"></i>
                                Edit deskripsi scene/style untuk hasil yang berbeda
                            </p>
                        </div>
                        <div class="flex gap-2">
                            <button onclick="this.closest('.fixed').remove()" class="flex-1 bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-lg transition-colors">
                                Batal
                            </button>
                            <button id="confirm-edit-broll-btn" class="flex-1 bg-purple-500 hover:bg-purple-600 text-white font-bold py-2 px-4 rounded-lg transition-colors">
                                <i class="fas fa-check mr-2"></i>Generate Ulang
                            </button>
                        </div>
                    </div>
                `;
                document.body.appendChild(modal);

                const confirmBtn = modal.querySelector('#confirm-edit-broll-btn');
                const promptInput = modal.querySelector('#edit-broll-input');

                confirmBtn.addEventListener('click', async () => {
                    const newPrompt = promptInput.value.trim();
                    if (!newPrompt) return;

                    modal.remove();

                    // Update the prompt for this image
                    if (window.brollGenerationParams && window.brollGenerationParams[index]) {
                        window.brollGenerationParams[index].prompt = newPrompt;
                    }

                    await handleRegenerateBroll(index);
                });
            }

            async function handleRegenerateBroll(index) {
                const targetCard = document.getElementById(`broll-card-${index + 1}`);
                if (!targetCard) return;

                const params = window.brollGenerationParams ? window.brollGenerationParams[index] : null;
                if (!params) return;

                // Show loading state
                const outputContainer = targetCard.querySelector('.aspect-video, .relative');
                if (!outputContainer) return;

                outputContainer.innerHTML = `
                    <div class="flex flex-col items-center justify-center h-full min-h-[200px]">
                        <div class="loader !border-l-purple-500"></div>
                        <p class="mt-4 text-sm text-gray-600">Regenerating...</p>
                    </div>
                `;

                try {
                    const apiKey = "";
                    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-image-preview:generateContent?key=${apiKey}`;

                    // Add variation to ensure different results
                    const variations = [
                        ', slightly different angle',
                        ', alternative perspective',
                        ', different composition',
                        ', varied lighting mood',
                        ', alternative styling',
                        ', different camera angle'
                    ];
                    const randomVariation = variations[Math.floor(Math.random() * variations.length)];
                    const variedPrompt = params.prompt + randomVariation;

                    const parts = [{ text: variedPrompt }];

                    // Add all product images
                    params.productImages.forEach(img => {
                        parts.push({ inlineData: { mimeType: img.mimeType, data: img.base64 } });
                    });

                    // Add model image if available
                    if (params.modelImage) {
                        parts.push({ inlineData: { mimeType: params.modelImage.mimeType, data: params.modelImage.base64 } });
                    }

                    const payload = { contents: [{ parts }], generationConfig: { responseModalities: ['IMAGE'], imageConfig: { aspectRatio: params.ratio } } };
                    const response = await fetch(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });

                    if (!response.ok) throw new Error(`API error: ${response.statusText}`);

                    const result = await response.json();
                    const base64Data = result?.candidates?.[0]?.content?.parts?.find(p => p.inlineData)?.inlineData?.data;

                    if (base64Data) {
                        const imageUrl = `data:image/png;base64,${base64Data}`;
                        const safeTitle = params.title.replace(/[^a-z0-9]/gi, '_').toLowerCase();
                        const safePrompt = params.prompt.replace(/"/g, '&quot;');

                        // Update stored image in generatedBrollImages
                        if (generatedBrollImages[index]) {
                            generatedBrollImages[index].url = imageUrl;
                        }

                        outputContainer.innerHTML = `<div class="relative w-full h-full group"><img src="${imageUrl}" class="w-full h-full object-cover rounded-md" alt="${params.title}"><div class="absolute bottom-2 right-2 flex flex-wrap gap-2 opacity-0 group-hover:opacity-100 transition-opacity"><button data-action="broll-preview" data-image-url="${imageUrl}" class="action-btn bg-blue-500 text-white p-2 rounded-full hover:bg-blue-600" title="Preview"><i class="fas fa-search-plus"></i></button><button data-action="broll-edit" data-index="${index}" data-prompt="${safePrompt}" class="action-btn bg-purple-500 text-white p-2 rounded-full hover:bg-purple-600" title="Edit Prompt"><i class="fas fa-edit"></i></button><button data-action="broll-regenerate" data-index="${index}" class="action-btn bg-green-500 text-white p-2 rounded-full hover:bg-green-600" title="Regenerate"><i class="fas fa-sync-alt"></i></button><button data-action="broll-video" data-image-url="${imageUrl}" data-title="${params.title.replace(/"/g, '&quot;')}" class="action-btn bg-fuchsia-500 text-white p-2 rounded-full hover:bg-fuchsia-600" title="Buat Prompt Video"><i class="fas fa-film"></i></button><button data-action="broll-caption" data-image-url="${imageUrl}" data-title="${params.title.replace(/"/g, '&quot;')}" class="action-btn bg-rose-500 text-white p-2 rounded-full hover:bg-rose-600" title="Buat Caption"><i class="fas fa-pencil-alt"></i></button><button data-action="broll-download" data-image-url="${imageUrl}" data-filename="affiliatego_${index + 1}_${safeTitle}.png" class="action-btn bg-cyan-600 text-white p-2 rounded-full hover:bg-cyan-700" title="Unduh"><i class="fas fa-download"></i></button></div></div>`;
                    } else {
                        throw new Error('Failed to generate image');
                    }
                } catch (error) {
                    console.error('Regenerate error:', error);
                    outputContainer.innerHTML = `
                        <div class="flex flex-col items-center justify-center h-full min-h-[200px] text-red-600">
                            <i class="fas fa-exclamation-triangle text-3xl mb-2"></i>
                            <p class="text-sm">Gagal regenerate</p>
                            <button onclick="location.reload()" class="mt-2 text-xs bg-red-500 text-white px-3 py-1 rounded-full hover:bg-red-600">
                                Refresh
                            </button>
                        </div>
                    `;
                }
            }

        }
    })();

    // --- VIRTUAL TRY-ON LOGIC ---
    (function() {
        const tryonProductUploadBox = document.getElementById('tryon-product-upload-box');
        const tryonProductInput = document.getElementById('tryon-product-input');
        const tryonProductPreview = document.getElementById('tryon-product-preview');
        const tryonProductPlaceholder = document.getElementById('tryon-product-placeholder');
        const tryonModelUploadBox = document.getElementById('tryon-model-upload-box');
        const tryonModelInput = document.getElementById('tryon-model-input');
        const tryonModelPreview = document.getElementById('tryon-model-preview');
        const tryonModelPlaceholder = document.getElementById('tryon-model-placeholder');
        const tryonGenerateBtn = document.getElementById('tryon-generate-btn');
        const tryonStatusMessage = document.getElementById('tryon-status-message');
        const tryonOutputPlaceholder = document.getElementById('tryon-output-placeholder');
        const tryonLoader = document.getElementById('tryon-loader');
        const tryonResultImage = document.getElementById('tryon-result-image');
        const tryonOutputControls = document.getElementById('tryon-output-controls');
        const tryonImageDimensions = document.getElementById('tryon-image-dimensions');
        let tryonProductData = null;
        let tryonModelData = null;
        
        function setupTryonImageUploader(uploadBox, input, preview, placeholder, dataStore) {
            if (!uploadBox) return;
            uploadBox.addEventListener('click', () => input.click());
            uploadBox.addEventListener('dragover', (e) => { e.preventDefault(); uploadBox.classList.add('dragging'); });
            uploadBox.addEventListener('dragleave', () => uploadBox.classList.remove('dragging'));
            uploadBox.addEventListener('drop', (e) => { e.preventDefault(); uploadBox.classList.remove('dragging'); if (e.dataTransfer.files[0]) handleTryonFile(e.dataTransfer.files[0], preview, placeholder, dataStore); });
            input.addEventListener('change', (e) => { if (e.target.files[0]) handleTryonFile(e.target.files[0], preview, placeholder, dataStore); });
        }
        function handleTryonFile(file, preview, placeholder, dataStore) {
            const reader = new FileReader();
            reader.onload = (e) => {
                preview.src = e.target.result;
                preview.classList.remove('hidden');
                placeholder.classList.add('hidden');
                const data = { mimeType: file.type, base64: e.target.result.split(',')[1] };
                if (dataStore === 'product') tryonProductData = data; else tryonModelData = data;
                updateTryonButtonState();
            };
            reader.readAsDataURL(file);
        }
        function updateTryonButtonState() { if(tryonGenerateBtn) tryonGenerateBtn.disabled = !tryonProductData || !tryonModelData; }
        setupTryonImageUploader(tryonProductUploadBox, tryonProductInput, tryonProductPreview, tryonProductPlaceholder, 'product');
        setupTryonImageUploader(tryonModelUploadBox, tryonModelInput, tryonModelPreview, tryonModelPlaceholder, 'model');
        
        async function generateTryonImage(prompt, product, model, retries = 3, delay = 1000) {
            const apiKey = "";
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-image-preview:generateContent?key=${apiKey}`;
            const payload = {
                contents: [{ parts: [ { text: prompt }, { inlineData: { mimeType: product.mimeType, data: product.base64 } }, { inlineData: { mimeType: model.mimeType, data: model.base64 } } ] }],
                generationConfig: { responseModalities: ['IMAGE'] }
            };
            for (let i = 0; i < retries; i++) {
                try {
                    const response = await fetch(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
                    if (!response.ok) { const error = await response.json(); throw new Error(`API Error: ${error.error?.message || response.statusText}`); }
                    const result = await response.json();
                    const base64Data = result?.candidates?.[0]?.content?.parts?.find(p => p.inlineData)?.inlineData?.data;
                    if (!base64Data) { throw new Error("Tidak ada data gambar yang diterima dari AI."); }
                    return `data:image/png;base64,${base64Data}`;
                } catch (error) {
                    console.error(`Attempt ${i + 1} failed:`, error);
                    if (i === retries - 1) { throw error; }
                    await new Promise(res => setTimeout(res, delay * Math.pow(2, i)));
                }
            }
        }

        if(tryonGenerateBtn) tryonGenerateBtn.addEventListener('click', async () => {
             if (!tryonProductData || !tryonModelData) { tryonStatusMessage.textContent = 'Harap unggah foto produk dan model.'; return; }
             tryonStatusMessage.textContent = '';
             tryonGenerateBtn.disabled = true;
             tryonGenerateBtn.textContent = 'Memproses...';
             tryonOutputPlaceholder.classList.add('hidden');
             tryonResultImage.classList.add('hidden');
             tryonOutputControls.classList.add('hidden');
             tryonLoader.classList.remove('hidden');
             const prompt = `Dengan menggunakan foto produk dan foto model yang tersedia, buatlah sebuah gambar fotorealistis baru di mana model tersebut sedang mengenakan atau menggunakan produk tersebut. Pastikan hasilnya berkualitas tinggi dan terlihat seperti sesi pemotretan profesional. Pertahankan penampilan model dan detail produk.`;
             try {
                 const imageUrl = await generateTryonImage(prompt, tryonProductData, tryonModelData);
                 const img = new Image();
                 img.onload = function() {
                     tryonImageDimensions.textContent = `${this.naturalWidth}x${this.naturalHeight}px`;
                     tryonResultImage.src = imageUrl;
                     const downloadBtn = document.getElementById('tryon-download-btn');
                     if (downloadBtn) {
                         // Remove old listeners
                         downloadBtn.onclick = null;

                         // Add proper event listener (works on desktop & mobile)
                         const handleDownload = async (e) => {
                             e.stopPropagation();
                             if (window.downloadDataURINew) {
                                 await window.downloadDataURINew(imageUrl, 'affiliatego-tryon.png');
                             }
                         };

                         downloadBtn.addEventListener('click', handleDownload);
                     }
                     tryonResultImage.classList.remove('hidden');
                     tryonOutputControls.classList.remove('hidden');
                 };
                 img.src = imageUrl;
             } catch (error) {
                 console.error('Gagal generate gambar:', error);
                 tryonStatusMessage.textContent = 'Maaf, terjadi kesalahan saat generate gambar. Coba lagi.';
                 tryonOutputPlaceholder.classList.remove('hidden');
             } finally {
                 tryonLoader.classList.add('hidden');
                 tryonGenerateBtn.disabled = false;
                 tryonGenerateBtn.textContent = 'Generate Gambar';
             }
        });
    })();

    // --- POSE FASHION LOGIC ---
    (function() {
        const posesUploadArea = document.getElementById('poses-uploadArea');
        const posesImageUpload = document.getElementById('poses-imageUpload');
        const posesPreviewContainer = document.getElementById('poses-previewContainer');
        const posesImagePreview = document.getElementById('poses-imagePreview');
        const posesFileName = document.getElementById('poses-fileName');
        const posesSelectPoseBtn = document.getElementById('poses-selectPoseBtn');
        const posesGenerateBtn = document.getElementById('poses-generateBtn');
        const posesResultsContainer = document.getElementById('poses-resultsContainer');
        const posesResultsGrid = document.getElementById('poses-resultsGrid');
        const posesErrorContainer = document.getElementById('poses-errorContainer');
        const posesErrorMessage = document.getElementById('poses-errorMessage');
        const posesPoseModal = document.getElementById('poses-poseModal');
        const posesCancelModalBtn = document.getElementById('poses-cancelModalBtn');
        const posesPoseListContainer = document.getElementById('poses-poseListContainer');
        const posesSelectionCounter = document.getElementById('poses-selectionCounter');
        const posesCustomPoseInput = document.getElementById('poses-customPoseInput');
        const posesDownloadAllBtn = document.getElementById('poses-download-all-btn');
        let posesUploadedFileAsDataUrl = null;
        let generatedPosesImages = [];
        const ALL_POSES = ['Pose fashion dinamis dengan satu tangan di pinggul dan tangan lainnya diangkat ke atas', 'Pose klasik dengan tangan di saku celana', 'Menyender ke dinding dengan santai, satu kaki ditekuk', 'Pose fashion dinamis membentuk huruf S dengan tubuh', 'Berdiri tegak dengan tatapan kuat, tangan menyilang di dada', 'Pose contrapposto, berat badan pada satu kaki, pinggul miring', 'Berdiri dengan kaki terbuka lebar, pose yang kuat dan percaya diri', 'Pose dari belakang (standing backpose), menoleh sedikit ke kamera', 'Pose dari samping (side profile), menatap lurus ke depan', 'Satu tangan di pinggul, tangan lain memegang kerah baju atau aksesori', 'Pose asimetris, satu bahu lebih tinggi dari yang lain', 'Pose minimalis, berdiri lurus menatap kamera dengan ekspresi netral', 'Pose berjalan, seolah-olah tertangkap kamera sedang melangkah', 'Pose melompat kecil dengan ekspresi ceria', 'Pose berputar (spinning), dengan gaun atau rambut yang bergerak', 'Pose berlari kecil dengan gaya candid', 'Duduk di kursi dengan elegan, satu kaki menyilang di atas yang lain', 'Duduk di lantai dengan santai, satu lutut ditekuk ke atas', 'Duduk di tangga, menatap ke arah atas atau bawah', 'Duduk di lantai dengan kaki lurus ke depan, menonjolkan sepatu', 'Beauty shot close-up, fokus pada wajah dan riasan, dengan senyuman lembut', 'Tangan membingkai wajah atau menyentuh rambut dengan lembut', 'Pose half-body yang elegan, satu tangan diangkat ke dekat dagu', 'Menatap tajam ke kamera dengan ekspresi serius (fierce)', 'Tertawa lepas, candid close-up', 'Satu tangan di bahu, tubuh sedikit miring ke samping', 'Melihat ke belakang lewat bahu (over-the-shoulder)', 'Pose dramatis dengan permainan bayangan yang kuat pada wajah atau tubuh', 'Berinteraksi dengan properti (misal: memegang topi, kacamata, atau tas)', 'Pose berbaring di lantai atau sofa dengan gaya high fashion'];
        
        function initializePosesList() { 
            if(!posesPoseListContainer) return; 
            posesPoseListContainer.innerHTML = '';
            ALL_POSES.forEach(pose => {
                const div = document.createElement('div');
                div.className = 'flex items-center p-3 rounded-lg hover:bg-gray-100 transition-colors';
                const id = `pose-${pose.replace(/[^a-zA-Z0-9]/g, '-')}`;
                div.innerHTML = `<input type="checkbox" id="${id}" value="${pose}" class="w-5 h-5 bg-gray-200 border-gray-300 rounded text-cyan-600 focus:ring-cyan-600 cursor-pointer"><label for="${id}" class="ml-3 text-gray-700 cursor-pointer">${pose}</label>`;
                posesPoseListContainer.appendChild(div);
            });
            posesPoseListContainer.addEventListener('change', updatePosesSelectionCount);
        }
        function updatePosesSelectionCount() {
            if(!posesPoseListContainer) return;
            const checkedBoxes = posesPoseListContainer.querySelectorAll('input[type="checkbox"]:checked');
            const count = checkedBoxes.length;
            posesSelectionCounter.textContent = count;
            posesGenerateBtn.disabled = count === 0;
            const allBoxes = posesPoseListContainer.querySelectorAll('input[type="checkbox"]');
            allBoxes.forEach(box => { box.disabled = count >= 6 && !box.checked; });
        }
        function posesShowError(message) { if(posesErrorMessage) { posesErrorMessage.textContent = message; posesErrorContainer.classList.remove('hidden');} }
        function posesHideError() { if(posesErrorContainer) posesErrorContainer.classList.add('hidden'); }
        function handlePosesFileSelect(e) { 
            if(!posesImageUpload) return; 
            const file = e.target.files[0];
            if (file) {
                posesHideError();
                posesResultsContainer.classList.add('hidden');
                posesResultsGrid.innerHTML = '';
                const reader = new FileReader();
                reader.onload = (event) => {
                    posesUploadedFileAsDataUrl = event.target.result;
                    posesImagePreview.src = posesUploadedFileAsDataUrl;
                };
                reader.readAsDataURL(file);
                posesFileName.textContent = file.name;
                posesPreviewContainer.classList.remove('hidden');
                posesSelectPoseBtn.disabled = false;
            }
        }
        async function runPosesGeneration() {
            if (!posesUploadedFileAsDataUrl) { posesShowError("Silakan unggah gambar."); return; }
            const selectedPoses = Array.from(posesPoseListContainer.querySelectorAll('input[type="checkbox"]:checked')).map(cb => cb.value);
            if (selectedPoses.length === 0) { posesShowError("Pilih setidaknya satu pose."); return; }

            // Clear previous images
            generatedPosesImages = [];
            if (posesDownloadAllBtn) posesDownloadAllBtn.classList.add('hidden');

            posesPoseModal.classList.add('hidden');
            posesSelectPoseBtn.disabled = true;
            posesGenerateBtn.disabled = true;
            posesHideError();
            posesPreviewContainer.classList.add('hidden');
            posesResultsContainer.classList.remove('hidden');
            posesResultsContainer.querySelector('h2').textContent = "AI sedang bekerja...";
            posesResultsGrid.innerHTML = '';
            const base64Data = posesUploadedFileAsDataUrl.split(',')[1];
            const mimeType = posesUploadedFileAsDataUrl.split(',')[0].split(':')[1].split(';')[0];
            selectedPoses.forEach((pose, index) => {
                const card = createPosesCard(`poses-loader-${index}`, pose);
                card.innerHTML = `<div class="w-full aspect-[3/4] flex items-center justify-center bg-gray-100/50"><div class="loader card-loader"></div></div><div class="p-3 text-center"><p class="text-sm text-gray-500">Membuat pose...</p></div>`;
                posesResultsGrid.appendChild(card);
            });
            for (let i = 0; i < selectedPoses.length; i++) {
                const poseText = selectedPoses[i];
                try {
                    const generatedImageBase64 = await generatePosesImageWithNanoBanana(base64Data, mimeType, poseText);
                    updatePosesCardWithResult(`poses-loader-${i}`, `data:image/png;base64,${generatedImageBase64}`, poseText);
                } catch (err) {
                    updatePosesCardWithError(`poses-loader-${i}`, poseText, err.message);
                }
            }
            posesResultsContainer.querySelector('h2').textContent = "Hasil Pose Telah Siap!";
            posesSelectPoseBtn.disabled = false;
        }
        async function generatePosesImageWithNanoBanana(base64ImageData, mimeType, prompt) {
            const apiKey = ""; const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-image-preview:generateContent?key=${apiKey}`;
            const payload = { contents: [{ parts: [{ text: `Dari gambar yang diberikan, ubah pose model sesuai instruksi: '${prompt}'. Penting: Jangan ubah pakaian, latar belakang, atau tema foto asli. Pertahankan semuanya, hanya ubah pose model.` }, { inlineData: { mimeType: mimeType, data: base64ImageData } } ] }], generationConfig: { responseModalities: ['IMAGE'] } };
            const response = await fetch(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
            if (!response.ok) { const err = await response.json(); throw new Error(`API Error: ${err.error.message}`); }
            const result = await response.json();
            const base64Data = result.candidates?.[0]?.content?.parts?.find(p => p.inlineData)?.inlineData?.data;
            if (!base64Data) { throw new Error("Tidak ada data gambar dari API."); }
            return base64Data;
        }
        function createPosesCard(id, poseText) {
            const card = document.createElement('div');
            card.id = id;
            card.className = "bg-gray-100/50 rounded-lg overflow-hidden border border-gray-300";
            card.setAttribute('data-pose', poseText);
            return card;
        }
        function updatePosesCardWithResult(cardId, imageUrl, poseText) {
            const card = document.getElementById(cardId);
            const safeFilename = poseText.replace(/\s/g, '_').replace(/[^a-z0-9_]/gi, '');

            // Track generated image
            generatedPosesImages.push({
                url: imageUrl,
                filename: `${safeFilename}.png`
            });

            // Show download all button if we have images
            if (generatedPosesImages.length > 0 && posesDownloadAllBtn) {
                posesDownloadAllBtn.classList.remove('hidden');
            }

            if (card) card.innerHTML = `<img src="${imageUrl}" alt="Generated ${poseText}" class="w-full h-auto object-cover aspect-[3/4]"><div class="p-3 text-center"><button data-action="poses-download" data-image-url="${imageUrl}" data-filename="${safeFilename}.png" class="btn-primary text-sm font-semibold py-2 px-4 rounded-md">Unduh</button></div>`;
        }
        function updatePosesCardWithError(cardId, poseText, errorMessage) {
            const card = document.getElementById(cardId);
            if (card) card.innerHTML = `<div class="w-full aspect-[3/4] flex flex-col items-center justify-center bg-red-100/30 text-red-600 p-4"><p class="text-sm font-semibold text-center">Gagal</p></div><div class="p-3 text-center"><button onclick="window.retryPosesGenerationForCard('${cardId}', \`${poseText}\`)" class="bg-yellow-400 text-sm font-semibold py-2 px-4 rounded-md">Ulangi</button></div>`;
        }
        async function retryPosesGenerationForCard(cardId, poseText) {
            const card = document.getElementById(cardId);
            if (!card || !posesUploadedFileAsDataUrl) return;
            card.innerHTML = `<div class="w-full aspect-[3/4] flex items-center justify-center bg-gray-100/50"><div class="loader card-loader"></div></div><div class="p-3 text-center"><p class="text-sm text-gray-500">Mencoba lagi...</p></div>`;
            try {
                const base64Data = posesUploadedFileAsDataUrl.split(',')[1];
                const mimeType = posesUploadedFileAsDataUrl.split(',')[0].split(':')[1].split(';')[0];
                const generatedImageBase64 = await generatePosesImageWithNanoBanana(base64Data, mimeType, poseText);
                updatePosesCardWithResult(cardId, `data:image/png;base64,${generatedImageBase64}`, poseText);
            } catch (err) {
                updatePosesCardWithError(cardId, poseText, err.message);
            }
        }
        window.retryPosesGenerationForCard = retryPosesGenerationForCard;

        // Function to generate 6 variations using custom pose
        async function runPosesGenerationWithCustomPose(customPose) {
            if (!posesUploadedFileAsDataUrl) {
                posesShowError("Silakan unggah gambar terlebih dahulu.");
                return;
            }

            // Clear previous images
            generatedPosesImages = [];
            if (posesDownloadAllBtn) posesDownloadAllBtn.classList.add('hidden');

            posesSelectPoseBtn.disabled = true;
            posesHideError();
            posesPreviewContainer.classList.add('hidden');
            posesResultsContainer.classList.remove('hidden');
            posesResultsContainer.querySelector('h2').textContent = "AI sedang bekerja...";
            posesResultsGrid.innerHTML = '';

            const base64Data = posesUploadedFileAsDataUrl.split(',')[1];
            const mimeType = posesUploadedFileAsDataUrl.split(',')[0].split(':')[1].split(';')[0];

            // Create 6 variations with slight differences
            const variations = [
                `${customPose}, variation 1: slightly different angle`,
                `${customPose}, variation 2: different perspective`,
                `${customPose}, variation 3: alternative view`,
                `${customPose}, variation 4: slightly adjusted position`,
                `${customPose}, variation 5: different angle`,
                `${customPose}, variation 6: unique perspective`
            ];

            // Create loading cards
            variations.forEach((pose, index) => {
                const card = createPosesCard(`poses-loader-${index}`, pose);
                card.innerHTML = `<div class="w-full aspect-[3/4] flex items-center justify-center bg-gray-100/50"><div class="loader card-loader"></div></div><div class="p-3 text-center"><p class="text-sm text-gray-500">Membuat pose...</p></div>`;
                posesResultsGrid.appendChild(card);
            });

            // Generate all 6 variations
            for (let i = 0; i < variations.length; i++) {
                const poseText = variations[i];
                try {
                    const generatedImageBase64 = await generatePosesImageWithNanoBanana(base64Data, mimeType, poseText);
                    updatePosesCardWithResult(`poses-loader-${i}`, `data:image/png;base64,${generatedImageBase64}`, `Custom Pose ${i + 1}`);
                } catch (err) {
                    updatePosesCardWithError(`poses-loader-${i}`, `Custom Pose ${i + 1}`, err.message);
                }
            }

            posesResultsContainer.querySelector('h2').textContent = "Hasil Pose Telah Siap!";
            posesSelectPoseBtn.disabled = false;
        }

        if(posesUploadArea) posesUploadArea.addEventListener('dragover', (e) => { e.preventDefault(); posesUploadArea.classList.add('border-cyan-500'); });
        if(posesUploadArea) posesUploadArea.addEventListener('dragleave', () => posesUploadArea.classList.remove('border-cyan-500'));
        if(posesUploadArea) posesUploadArea.addEventListener('drop', (e) => { e.preventDefault(); posesUploadArea.classList.remove('border-cyan-500'); if (e.dataTransfer.files[0]) { posesImageUpload.files = e.dataTransfer.files; handlePosesFileSelect({ target: posesImageUpload }); } });
        if(posesImageUpload) posesImageUpload.addEventListener('change', handlePosesFileSelect);
        if(posesSelectPoseBtn) posesSelectPoseBtn.addEventListener('click', () => {
            // Check if custom pose is provided
            const customPose = posesCustomPoseInput ? posesCustomPoseInput.value.trim() : '';

            if (customPose) {
                // Use custom pose - generate 6 variations automatically
                runPosesGenerationWithCustomPose(customPose);
            } else {
                // Show modal to select from predefined poses
                posesPoseModal.classList.remove('hidden');
            }
        });
        if(posesCancelModalBtn) posesCancelModalBtn.addEventListener('click', () => posesPoseModal.classList.add('hidden'));
        if(posesGenerateBtn) posesGenerateBtn.addEventListener('click', runPosesGeneration);

        // Download all button event listener (works on desktop & mobile like Umrah)
        if (posesDownloadAllBtn) {
            posesDownloadAllBtn.addEventListener('click', async () => {
                if (generatedPosesImages.length === 0) return;

                posesDownloadAllBtn.disabled = true;
                posesDownloadAllBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Downloading...';

                for (let i = 0; i < generatedPosesImages.length; i++) {
                    const img = generatedPosesImages[i];
                    if (window.downloadDataURINew) {
                        await window.downloadDataURINew(img.url, img.filename);
                        await new Promise(resolve => setTimeout(resolve, 500));
                    }
                }

                posesDownloadAllBtn.disabled = false;
                posesDownloadAllBtn.innerHTML = '<i class="fas fa-download mr-2"></i>Download Semua';
            });
        }

        // Event delegation for poses results grid (works on desktop & mobile)
        if (posesResultsGrid) {
            posesResultsGrid.addEventListener('click', async (e) => {
                const downloadBtn = e.target.closest('[data-action="poses-download"]');
                if (downloadBtn) {
                    e.stopPropagation();
                    const imageUrl = downloadBtn.dataset.imageUrl;
                    const filename = downloadBtn.dataset.filename;
                    if (imageUrl && filename && window.downloadDataURINew) {
                        await window.downloadDataURINew(imageUrl, filename);
                    }
                }
            });
        }

        initializePosesList();
    })();

    // --- FAMILY PHOTO LOGIC ---
    (function() {
        const fileInputArea = document.getElementById('family-file-input-area');
        const addPhotoBtn = document.getElementById('family-add-photo-btn');
        const contentFamily = document.getElementById('content-family');
        const ratioOptions = document.getElementById('family-ratio-options');
        const customThemeInput = document.getElementById('family-custom-theme-input');
        const generateBtn = document.getElementById('family-generate-btn');
        const loadingIndicator = document.getElementById('loading-indicator');
        const resultImageContainer = document.getElementById('result-image-container');
        const resultsPlaceholder = document.getElementById('family-results-placeholder');
        const resultsHeader = document.getElementById('family-results-header');
        const downloadAllBtn = document.getElementById('family-download-all-btn');
        const randomThemeBtn = document.getElementById('family-random-theme-btn');
        const modal = document.getElementById('family-custom-modal');
        const modalMessage = document.getElementById('family-modal-message');

        let photos = [null, null]; // Will store base64 strings
        let photoMimeTypes = [null, null]; // Will store mime types
        let selectedRatio = '3:4'; // Default aspect ratio
        let generatedImages = []; // Store generated images for download all
        let currentTheme = ''; // Store current theme for regenerate

        function familyShowModal(message) {
            if (modalMessage) modalMessage.textContent = message;
            if (modal) modal.style.display = 'flex';
        }

        window.familyCloseModal = () => {
            if (modal) modal.style.display = 'none';
        };

        function updateFileInputs() {
            if (!fileInputArea) return;
            fileInputArea.innerHTML = '';
            photos.forEach((photo, i) => {
                const wrapper = document.createElement('div');
                wrapper.className = 'file-input-wrapper';
                if (photo) wrapper.classList.add('has-photo');

                const input = document.createElement('input');
                input.type = 'file';
                input.accept = 'image/*';
                input.className = 'file-input';
                input.dataset.index = i;
                input.addEventListener('change', handleFileChange);

                const preview = document.createElement('img');
                preview.className = 'file-preview';
                if (photo) {
                    preview.src = `data:${photoMimeTypes[i]};base64,${photo}`;
                } else {
                    preview.classList.add('hidden');
                }
                
                const placeholder = document.createElement('span');
                placeholder.className = 'text-gray-500 text-center text-sm';
                if (!photo) placeholder.textContent = 'Tambahkan Foto';

                const deleteBtn = document.createElement('button');
                deleteBtn.className = 'delete-btn';
                deleteBtn.innerHTML = '√ó';
                deleteBtn.onclick = (e) => familyDeletePhoto(e, i);

                wrapper.append(input, preview, placeholder, deleteBtn);
                fileInputArea.appendChild(wrapper);
            });
        }

        function handleFileChange(e) {
            const index = parseInt(e.target.dataset.index, 10);
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (event) => {
                    photos[index] = event.target.result.split(',')[1];
                    photoMimeTypes[index] = file.type;
                    updateFileInputs();
                };
                reader.readAsDataURL(file);
            }
        }
        
        window.familyDeletePhoto = (event, index) => {
            event.stopPropagation();
            photos[index] = null;
            photoMimeTypes[index] = null;
            // Only remove the slot if there are more than 2
            if (photos.length > 2) {
                photos.splice(index, 1);
                photoMimeTypes.splice(index, 1);
            }
            updateFileInputs();
        };

        if (addPhotoBtn) {
            addPhotoBtn.addEventListener('click', () => {
                if (photos.length < 10) {
                    photos.push(null);
                    photoMimeTypes.push(null);
                    updateFileInputs();
                } else {
                    familyShowModal('Anda hanya dapat menambahkan maksimal 10 foto.');
                }
            });
        }

        // Event delegation for theme buttons
        if (contentFamily) {
            contentFamily.addEventListener('click', (e) => {
                if (e.target.classList.contains('theme-btn') && e.target.id !== 'family-random-theme-btn') {
                    contentFamily.querySelectorAll('.theme-btn').forEach(btn => btn.classList.remove('active'));
                    e.target.classList.add('active');
                }
            });
        }

        if (randomThemeBtn) {
            randomThemeBtn.addEventListener('click', () => {
                if (contentFamily) {
                    const allThemeButtons = Array.from(contentFamily.querySelectorAll('.theme-btn:not(#family-random-theme-btn)'));
                    if (allThemeButtons.length > 0) {
                        contentFamily.querySelectorAll('.theme-btn').forEach(btn => btn.classList.remove('active'));
                        const randomIndex = Math.floor(Math.random() * allThemeButtons.length);
                        allThemeButtons[randomIndex].classList.add('active');
                    }
                }
            });
        }

        // Ratio button selection handler
        if (ratioOptions) {
            ratioOptions.addEventListener('click', (e) => {
                const button = e.target.closest('.option-btn-family');
                if (button) {
                    ratioOptions.querySelectorAll('.option-btn-family').forEach(btn => btn.classList.remove('selected'));
                    button.classList.add('selected');
                    selectedRatio = button.dataset.value;
                }
            });
        }

        if (generateBtn) {
            generateBtn.addEventListener('click', async () => {
                const uploadedFiles = photos.map((p, i) => ({ base64: p, mimeType: photoMimeTypes[i] })).filter(f => f.base64);

                if (uploadedFiles.length < 2) {
                    familyShowModal('Silakan unggah minimal 2 foto keluarga.');
                    return;
                }

                // Check for custom theme or selected theme
                const customTheme = customThemeInput ? customThemeInput.value.trim() : '';
                const activeThemeBtn = contentFamily ? contentFamily.querySelector('.theme-btn.active') : null;

                let finalTheme = '';
                if (customTheme) {
                    finalTheme = customTheme;
                } else if (activeThemeBtn) {
                    finalTheme = activeThemeBtn.dataset.theme;
                } else {
                    familyShowModal('Silakan pilih tema atau tulis tema custom terlebih dahulu.');
                    return;
                }

                if (resultsPlaceholder) resultsPlaceholder.classList.add('hidden');
                if (resultsHeader) resultsHeader.classList.add('hidden');
                loadingIndicator.style.display = 'flex';
                resultImageContainer.style.display = 'none';
                resultImageContainer.innerHTML = '';
                generatedImages = [];
                currentTheme = finalTheme;

                const promptText = `PENTING: Buat foto keluarga yang sangat realistis dan fotorealistis. Gabungkan semua orang dari semua foto yang diunggah ke dalam satu adegan yang kohesif. Pastikan semua wajah terlihat jelas dan menyerupai orang di foto aslinya. Tema foto adalah: '${finalTheme}'. Gunakan pencahayaan sinematik dan komposisi profesional.`;

                const parts = [{ text: promptText }];
                uploadedFiles.forEach(file => {
                    parts.push({ inlineData: { mimeType: file.mimeType, data: file.base64 } });
                });

                const payload = {
                    contents: [{ parts }],
                    generationConfig: {
                        responseModalities: ['IMAGE'],
                        imageConfig: { aspectRatio: selectedRatio }
                    },
                };
                
                const apiKey = "";
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-image-preview:generateContent?key=${apiKey}`;

                try {
                    const generationPromises = [];
                    for (let i = 0; i < 6; i++) {
                        generationPromises.push(generateImageWithRetry(apiUrl, payload));
                    }
                    
                    const results = await Promise.all(generationPromises);

                    results.forEach((result, i) => {
                        const base64Data = result?.candidates?.[0]?.content?.parts?.find(p => p.inlineData)?.inlineData?.data;
                        if (base64Data) {
                            const imageUrl = `data:image/png;base64,${base64Data}`;
                            generatedImages.push({ url: imageUrl, filename: `family_photo_${i + 1}.png`, index: i });

                            const imageCard = document.createElement('div');
                            imageCard.className = 'image-card group relative';
                            imageCard.style.animationDelay = `${i * 0.1}s`;
                            imageCard.dataset.index = i;

                            imageCard.innerHTML = `
                                <img src="${imageUrl}" alt="Generated family photo ${i + 1}" class="generated-image w-full rounded-lg"/>
                                <div class="absolute inset-0 bg-gradient-to-t from-black/70 via-black/30 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300 rounded-lg flex flex-col justify-end p-4 gap-2">
                                    <div class="flex gap-2">
                                        <button data-action="family-preview" data-index="${i}" class="action-btn flex-1 bg-blue-500 hover:bg-blue-600 text-white px-3 py-2 rounded-lg text-sm font-semibold transition flex items-center justify-center gap-1">
                                            <i class="fas fa-eye"></i>
                                            <span class="hidden sm:inline">Preview</span>
                                        </button>
                                        <button data-action="family-edit" data-index="${i}" class="action-btn flex-1 bg-purple-500 hover:bg-purple-600 text-white px-3 py-2 rounded-lg text-sm font-semibold transition flex items-center justify-center gap-1">
                                            <i class="fas fa-edit"></i>
                                            <span class="hidden sm:inline">Edit</span>
                                        </button>
                                    </div>
                                    <div class="flex gap-2">
                                        <button data-action="family-regenerate" data-index="${i}" class="action-btn flex-1 bg-green-500 hover:bg-green-600 text-white px-3 py-2 rounded-lg text-sm font-semibold transition flex items-center justify-center gap-1">
                                            <i class="fas fa-sync-alt"></i>
                                            <span class="hidden sm:inline">Regenerate</span>
                                        </button>
                                        <button data-action="family-download" data-index="${i}" class="action-btn flex-1 bg-cyan-600 hover:bg-cyan-700 text-white px-3 py-2 rounded-lg text-sm font-semibold transition flex items-center justify-center gap-1">
                                            <i class="fas fa-download"></i>
                                            <span class="hidden sm:inline">Download</span>
                                        </button>
                                    </div>
                                </div>
                            `;

                            resultImageContainer.appendChild(imageCard);
                        }
                    });

                    if (resultImageContainer.children.length > 0) {
                        resultImageContainer.style.display = 'grid';
                        if (resultsHeader) resultsHeader.classList.remove('hidden');
                    } else {
                        familyShowModal('Maaf, tidak ada gambar yang dapat dihasilkan. Silakan coba lagi.');
                    }
                } catch (error) {
                    console.error('Error generating images:', error);
                    familyShowModal(`Terjadi kesalahan: ${error.message}. Silakan coba lagi.`);
                } finally {
                    loadingIndicator.style.display = 'none';
                }
            });
        }
        
        async function generateImageWithRetry(apiUrl, payload, retries = 3, delay = 1000) {
            for (let i = 0; i < retries; i++) {
                try {
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });
                    if (!response.ok) {
                        const errorText = await response.text();
                        throw new Error(`API Error (${response.status}): ${errorText}`);
                    }
                    return await response.json();
                } catch (error) {
                    console.error(`Attempt ${i + 1} failed:`, error);
                    if (i === retries - 1) throw error;
                    await new Promise(res => setTimeout(res, delay * Math.pow(2, i)));
                }
            }
        }

        // Download all button
        if (downloadAllBtn) {
            downloadAllBtn.addEventListener('click', async () => {
                for (let i = 0; i < generatedImages.length; i++) {
                    const img = generatedImages[i];
                    if (window.downloadDataURINew) {
                        await window.downloadDataURINew(img.url, img.filename);
                        await new Promise(resolve => setTimeout(resolve, 200)); // Delay between downloads
                    } else if (window.downloadImage) {
                        await window.downloadImage(img.url, img.filename);
                        await new Promise(resolve => setTimeout(resolve, 200)); // Delay between downloads
                    }
                }
            });

            // Add mobile touch support
            if (window.addMobileTouchSupport) {
                window.addMobileTouchSupport(downloadAllBtn);
            }
        }

        // Event delegation for action buttons
        if (resultImageContainer) {
            resultImageContainer.addEventListener('click', async (e) => {
                e.stopPropagation();

                const actionBtn = e.target.closest('.action-btn[data-action]');
                if (!actionBtn) return;

                const action = actionBtn.dataset.action;
                const index = parseInt(actionBtn.dataset.index, 10);
                const imageData = generatedImages[index];

                if (action === 'family-preview') {
                    if (window.showPreviewModal) {
                        window.showPreviewModal(imageData.url);
                    }
                } else if (action === 'family-edit') {
                    handleEditTheme(index);
                } else if (action === 'family-regenerate') {
                    await handleRegenerateImage(index);
                } else if (action === 'family-download') {
                    if (window.downloadDataURINew) {
                        await window.downloadDataURINew(imageData.url, imageData.filename);
                    } else if (window.downloadImage) {
                        await window.downloadImage(imageData.url, imageData.filename);
                    }
                }
            });
        }

        // Edit theme function
        function handleEditTheme(index) {
            const editModal = document.createElement('div');
            editModal.className = 'fixed inset-0 bg-black/70 flex items-center justify-center z-50 p-4';
            editModal.innerHTML = `
                <div class="bg-white rounded-2xl p-6 max-w-md w-full shadow-2xl">
                    <h3 class="text-xl font-bold mb-4" style="color: #0d9488;">Edit Tema</h3>
                    <textarea id="edit-theme-input" rows="4" class="w-full p-3 border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-teal-500 focus:border-teal-500 transition resize-none" placeholder="Tulis tema baru...">${currentTheme}</textarea>
                    <div class="flex gap-3 mt-4">
                        <button id="confirm-edit-btn" class="flex-1 px-6 py-3 rounded-xl font-semibold text-white shadow-lg hover:shadow-xl transition" style="background: linear-gradient(135deg, #14b8a6, #0d9488);">
                            <i class="fas fa-check mr-2"></i>Regenerate
                        </button>
                        <button id="cancel-edit-btn" class="flex-1 px-6 py-3 bg-gray-200 hover:bg-gray-300 rounded-xl font-semibold text-gray-700 transition">
                            Batal
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(editModal);

            document.getElementById('confirm-edit-btn').addEventListener('click', async () => {
                const newTheme = document.getElementById('edit-theme-input').value.trim();
                if (newTheme) {
                    currentTheme = newTheme;
                    document.body.removeChild(editModal);
                    await handleRegenerateImage(index);
                }
            });

            document.getElementById('cancel-edit-btn').addEventListener('click', () => {
                document.body.removeChild(editModal);
            });
        }

        // Regenerate image function
        async function handleRegenerateImage(index) {
            const card = resultImageContainer.querySelector(`[data-index="${index}"]`);
            if (!card) return;

            const img = card.querySelector('.generated-image');
            const originalSrc = img.src;

            // Show loading state
            img.style.opacity = '0.5';
            img.style.filter = 'blur(4px)';

            try {
                const uploadedFiles = photos.map((p, i) => ({ base64: p, mimeType: photoMimeTypes[i] })).filter(f => f.base64);
                const promptText = `PENTING: Buat foto keluarga yang sangat realistis dan fotorealistis. Gabungkan semua orang dari semua foto yang diunggah ke dalam satu adegan yang kohesif. Pastikan semua wajah terlihat jelas dan menyerupai orang di foto aslinya. Tema foto adalah: '${currentTheme}'. Gunakan pencahayaan sinematik dan komposisi profesional.`;

                const parts = [{ text: promptText }];
                uploadedFiles.forEach(file => {
                    parts.push({ inlineData: { mimeType: file.mimeType, data: file.base64 } });
                });

                const payload = {
                    contents: [{ parts }],
                    generationConfig: {
                        responseModalities: ['IMAGE'],
                        imageConfig: { aspectRatio: selectedRatio }
                    },
                };

                const apiKey = "";
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-image-preview:generateContent?key=${apiKey}`;

                const result = await generateImageWithRetry(apiUrl, payload);
                const base64Data = result?.candidates?.[0]?.content?.parts?.find(p => p.inlineData)?.inlineData?.data;

                if (base64Data) {
                    const newImageUrl = `data:image/png;base64,${base64Data}`;
                    img.src = newImageUrl;
                    generatedImages[index].url = newImageUrl;
                }
            } catch (error) {
                console.error('Error regenerating image:', error);
                img.src = originalSrc; // Restore original on error
                familyShowModal('Gagal regenerate gambar. Silakan coba lagi.');
            } finally {
                img.style.opacity = '1';
                img.style.filter = 'none';
            }
        }

        updateFileInputs(); // Initial call
    })();

    // --- FOOD SELFIE LOGIC ---
    (function() {
        const foodImageUploader = document.getElementById('food-selfie-food-image-uploader');
        const foodFileInput = document.getElementById('food-selfie-food-file-input');
        const foodUploadPrompt = document.getElementById('food-selfie-food-upload-prompt');
        const foodImagePreview = document.getElementById('food-selfie-food-image-preview');

        const styleImageUploader = document.getElementById('food-selfie-style-image-uploader');
        const styleFileInput = document.getElementById('food-selfie-style-file-input');
        const styleUploadPrompt = document.getElementById('food-selfie-style-upload-prompt');
        const styleImagePreview = document.getElementById('food-selfie-style-image-preview');
        
        const themeSelection = document.getElementById('food-selfie-theme-selection');
        const generateBtn = document.getElementById('food-selfie-generate-btn');
        const loader = document.getElementById('food-selfie-loader');
        const placeholderResult = document.getElementById('food-selfie-placeholder-result');
        const resultContent = document.getElementById('food-selfie-result-content');
        const errorMessage = document.getElementById('food-selfie-error-message');
        const resultsHeader = document.getElementById('food-selfie-results-header');
        const resultCount = document.getElementById('food-selfie-result-count');
        const downloadAllBtn = document.getElementById('food-selfie-download-all-btn');

        let foodBase64Image = null;
        let styleBase64Image = null;
        let foodMimeType = null;
        let styleMimeType = null;
        let selectedTheme = null;
        const foodSelfieRatioSelection = document.getElementById('food-selfie-ratio-selection');
        let selectedFoodSelfieRatio = '16:9';
        let generatedFoodImages = [];
        let currentGenerationParams = {};

        function setupUploader(uploader, input, preview, prompt, storageCallback) {
            if (!uploader) return;
            uploader.addEventListener('click', () => input.click());
            uploader.addEventListener('dragover', (e) => { e.preventDefault(); uploader.classList.add('border-green-400', 'bg-green-50'); });
            uploader.addEventListener('dragleave', () => { uploader.classList.remove('border-green-400', 'bg-green-50'); });
            uploader.addEventListener('drop', (e) => {
                e.preventDefault();
                uploader.classList.remove('border-green-400', 'bg-green-50');
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    input.files = files;
                    handleFileSelect({ target: input }, preview, prompt, storageCallback);
                }
            });
            input.addEventListener('change', (e) => handleFileSelect(e, preview, prompt, storageCallback));
        }

        function handleFileSelect(event, preview, prompt, storageCallback) {
            const file = event.target.files[0];
            if (file && file.type.startsWith('image/')) {
                const reader = new FileReader();
                reader.onloadend = () => {
                    const [header, base64] = reader.result.split(',');
                    const mimeType = header.match(/:(.*?);/)[1];
                    storageCallback(base64, mimeType);
                    preview.src = reader.result;
                    preview.classList.remove('hidden');
                    prompt.classList.add('hidden');
                    validateInputs();
                };
                reader.readAsDataURL(file);
            }
        }

        setupUploader(foodImageUploader, foodFileInput, foodImagePreview, foodUploadPrompt, (data, mime) => {
            foodBase64Image = data;
            foodMimeType = mime;
        });
        setupUploader(styleImageUploader, styleFileInput, styleImagePreview, styleUploadPrompt, (data, mime) => {
            styleBase64Image = data;
            styleMimeType = mime;
            validateInputs();
        });
        
        if (themeSelection) {
            themeSelection.addEventListener('click', (e) => {
                const button = e.target.closest('.theme-btn');
                if (button) {
                    document.querySelectorAll('#food-selfie-theme-selection .theme-btn').forEach(btn => btn.classList.remove('selected'));
                    button.classList.add('selected');
                    selectedTheme = button.dataset.theme;
                    validateInputs();
                }
            });
        }

        if (foodSelfieRatioSelection) {
            foodSelfieRatioSelection.addEventListener('click', (e) => {
                const button = e.target.closest('.ratio-btn-food');
                if (button) {
                    document.querySelectorAll('#food-selfie-ratio-selection .ratio-btn-food').forEach(btn => btn.classList.remove('selected'));
                    button.classList.add('selected');
                    selectedFoodSelfieRatio = button.dataset.ratio;
                }
            });
        }


        function validateInputs() {
            if (generateBtn) {
                 generateBtn.disabled = !(foodBase64Image && (selectedTheme !== null || styleBase64Image));
            }
        }

        async function generateImageWithRetry(payload, retries = 3, delay = 1000) {
           for (let i = 0; i < retries; i++) {
                try {
                    const apiKey = "";
                    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-image-preview:generateContent?key=${apiKey}`;
                    
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    const responseText = await response.text();

                    if (!response.ok) {
                        let errorMsg = response.statusText;
                        try {
                           const errorJson = JSON.parse(responseText);
                           errorMsg = errorJson.error?.message || errorMsg;
                        } catch(e) {
                           if(responseText) errorMsg = responseText;
                        }
                        throw new Error(`API Error: ${errorMsg}`);
                    }
                    
                    try {
                        return JSON.parse(responseText);
                    } catch (e) {
                        console.error("Failed to parse successful response:", responseText);
                        throw new Error("Received an invalid JSON response from the server.");
                    }

                } catch (error) {
                    console.error(`Attempt ${i + 1} failed:`, error);
                    if (i === retries - 1) return null;
                    await new Promise(res => setTimeout(res, delay * Math.pow(2, i)));
                }
            }
            return null;
        }

        if (generateBtn) generateBtn.addEventListener('click', async () => {
            validateInputs();
            if (generateBtn.disabled) {
                showError("Unggah foto makanan dan pilih tema atau gambar referensi.");
                return;
            }

            // Clear previous results
            generatedFoodImages = [];
            if (resultsHeader) resultsHeader.classList.add('hidden');

            // Save current generation parameters for regenerate
            currentGenerationParams = {
                foodBase64Image,
                foodMimeType,
                styleBase64Image,
                styleMimeType,
                selectedTheme,
                selectedFoodSelfieRatio
            };

            showLoading(true);
            showError('');
            resultContent.innerHTML = '';

            const stylesAndAngles = [
                'Top-Down Flat Lay',
                'Classic 45-Degree Angle',
                'Dynamic Action Shot (e.g., pouring, steam)',
                'Close-up Macro Shot',
                'Minimalist Studio Shot (Clean Background)',
                'Bright Natural Window Light',
                'Moody Dark Background'
            ];

            const generationPromises = stylesAndAngles.map(style => {
                let prompt = '';
                const parts = [];

                if (styleBase64Image) {
                    prompt = `IMPORTANT: Your task is to place the food from the first image into the exact scene of the second image. The final output MUST perfectly replicate the composition, camera angle, and lighting from the second uploaded image. The setting and photographic style must be identical. The food from the first image is the new subject, but it must be integrated photorealistically into the replicated scene. The final image must have a ${selectedFoodSelfieOrientation} orientation.`;
                    if (selectedTheme) {
                        prompt += ` The overall mood should have a '${selectedTheme}' feel.`;
                    }
                    parts.push({ text: prompt });
                    parts.push({ inlineData: { mimeType: foodMimeType, data: foodBase64Image } });
                    parts.push({ inlineData: { mimeType: styleMimeType, data: styleBase64Image } });
                } else {
                    prompt = `Create a professional, esthetic photograph featuring the exact food from the uploaded image. The overall setting is '${selectedTheme || 'general food photography'}'. The specific photographic style is a '${style}'. The image must have ${selectedFoodSelfieRatio} aspect ratio. The image must be high quality, sharp focus, with beautiful lighting and cinematic composition suitable for that style.`;
                    parts.push({ text: prompt });
                    parts.push({ inlineData: { mimeType: foodMimeType, data: foodBase64Image } });
                }

                const payload = {
                    contents: [{ parts }],
                    generationConfig: { responseModalities: ['IMAGE'], imageConfig: { aspectRatio: selectedFoodSelfieRatio } },
                };

                return generateImageWithRetry(payload);
            });
            
            try {
                const results = await Promise.all(generationPromises);

                results.forEach((result, index) => {
                    const imagePart = result?.candidates?.[0]?.content?.parts?.find(p => p.inlineData);
                    const base64Data = imagePart?.inlineData?.data;
                    const currentStyle = stylesAndAngles[index];

                    if (base64Data) {
                        const imageUrl = `data:image/png;base64,${base64Data}`;
                        const fileName = `food-creation-${currentStyle.replace(/[^a-z0-9]/gi, '-').toLowerCase()}.png`;
                        const safeTitle = currentStyle.replace(/"/g, '&quot;');

                        // Track for download all
                        generatedFoodImages.push({
                            url: imageUrl,
                            filename: fileName,
                            style: currentStyle
                        });

                        const card = document.createElement('div');
                        card.className = 'result-card card p-4 flex flex-col justify-between';
                        card.innerHTML = `
                            <div><h3 class="text-lg font-semibold text-gray-800 mb-4">${styleBase64Image ? 'Hasil ' + (index + 1) : currentStyle}</h3></div>
                            <div class="relative w-full h-full group">
                                <img src="${imageUrl}" class="w-full h-full object-cover rounded-md" alt="${currentStyle}">
                                <div class="absolute bottom-2 right-2 flex gap-2 opacity-0 group-hover:opacity-100 transition-opacity">
                                    <button data-action="food-preview" data-image-url="${imageUrl}" class="action-btn bg-blue-500 text-white p-2 rounded-full hover:bg-blue-600" title="Preview">
                                        <i class="fas fa-search-plus"></i>
                                    </button>
                                    <button data-action="food-edit" data-index="${index}" data-style="${safeTitle}" class="action-btn bg-purple-500 text-white p-2 rounded-full hover:bg-purple-600" title="Edit Prompt">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button data-action="food-regenerate" data-index="${index}" data-style="${safeTitle}" class="action-btn bg-green-500 text-white p-2 rounded-full hover:bg-green-600" title="Regenerate">
                                        <i class="fas fa-sync-alt"></i>
                                    </button>
                                    <button data-action="food-download" data-image-url="${imageUrl}" data-filename="${fileName}" class="action-btn bg-cyan-600 text-white p-2 rounded-full hover:bg-cyan-700" title="Unduh">
                                        <i class="fas fa-download"></i>
                                    </button>
                                </div>
                            </div>
                        `;
                        resultContent.appendChild(card);
                    } else {
                        const card = document.createElement('div');
                        card.className = 'result-card card p-4 flex items-center justify-center';
                        card.innerHTML = `<div class="text-center text-gray-600"><i class="fas fa-exclamation-triangle mr-1"></i> Gagal memuat gambar</div>`;
                        resultContent.appendChild(card);
                    }
                });

                // Show results header with count and download all button
                if (generatedFoodImages.length > 0) {
                    if (resultsHeader) resultsHeader.classList.remove('hidden');
                    if (resultCount) resultCount.textContent = generatedFoodImages.length;
                }

                resultContent.classList.remove('hidden');

            } catch (error) {
                console.error('Error during image generation:', error);
                showError(`Terjadi kesalahan: ${error.message}`);
            } finally {
                showLoading(false);
            }
        });

        // Event delegation for result actions (works on desktop & mobile)
        if (resultContent) {
            resultContent.addEventListener('click', async (e) => {
                e.stopPropagation();

                const actionBtn = e.target.closest('.action-btn[data-action]');
                if (!actionBtn) return;

                const action = actionBtn.dataset.action;
                const imageUrl = actionBtn.dataset.imageUrl;
                const filename = actionBtn.dataset.filename;
                const index = actionBtn.dataset.index;
                const style = actionBtn.dataset.style;

                if (action === 'food-preview' && imageUrl) {
                    if (window.showPreviewModal) {
                        window.showPreviewModal(imageUrl);
                    }
                } else if (action === 'food-edit' && index !== undefined) {
                    handleEditPrompt(parseInt(index), style);
                } else if (action === 'food-regenerate' && index !== undefined) {
                    await handleRegenerateImage(parseInt(index), style);
                } else if (action === 'food-download' && imageUrl && filename) {
                    if (window.downloadDataURINew) {
                        await window.downloadDataURINew(imageUrl, filename);
                    }
                }
            });
        }

        // Download all button handler (works on desktop & mobile)
        if (downloadAllBtn) {
            downloadAllBtn.addEventListener('click', async () => {
                if (generatedFoodImages.length === 0) return;

                downloadAllBtn.disabled = true;
                downloadAllBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Downloading...';

                for (let i = 0; i < generatedFoodImages.length; i++) {
                    const img = generatedFoodImages[i];
                    if (window.downloadDataURINew) {
                        await window.downloadDataURINew(img.url, img.filename);
                        await new Promise(resolve => setTimeout(resolve, 500));
                    }
                }

                downloadAllBtn.disabled = false;
                downloadAllBtn.innerHTML = '<i class="fas fa-download mr-2"></i>Download Semua';
            });
        }

        // Function to handle edit prompt
        function handleEditPrompt(index, currentStyle) {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4';
            modal.innerHTML = `
                <div class="bg-white rounded-xl p-6 max-w-2xl w-full">
                    <h3 class="text-xl font-bold mb-4 text-gray-800">
                        <i class="fas fa-edit text-purple-500 mr-2"></i>Edit Prompt untuk "${currentStyle}"
                    </h3>
                    <div class="mb-4">
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Custom Style/Prompt:</label>
                        <textarea id="edit-prompt-input" rows="4" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-purple-500 focus:outline-none resize-none" placeholder="Contoh: Top-down view with colorful background, dramatic lighting, close-up shot with bokeh effect, etc...">${currentStyle}</textarea>
                        <p class="text-xs text-gray-500 mt-2">
                            <i class="fas fa-info-circle mr-1"></i>
                            Edit style/angle prompt untuk hasil yang berbeda
                        </p>
                    </div>
                    <div class="flex gap-2">
                        <button onclick="this.closest('.fixed').remove()" class="flex-1 bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-lg transition-colors">
                            Batal
                        </button>
                        <button id="confirm-edit-btn" class="flex-1 bg-purple-500 hover:bg-purple-600 text-white font-bold py-2 px-4 rounded-lg transition-colors">
                            <i class="fas fa-check mr-2"></i>Generate Ulang
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);

            const confirmBtn = modal.querySelector('#confirm-edit-btn');
            const promptInput = modal.querySelector('#edit-prompt-input');

            confirmBtn.addEventListener('click', async () => {
                const newStyle = promptInput.value.trim();
                if (!newStyle) return;

                modal.remove();
                await handleRegenerateImage(index, newStyle);
            });
        }

        // Function to handle regenerate
        async function handleRegenerateImage(index, style) {
            const cards = resultContent.querySelectorAll('.result-card');
            const targetCard = cards[index];
            if (!targetCard) return;

            // Show loading state
            const originalContent = targetCard.innerHTML;
            targetCard.innerHTML = `
                <div class="flex flex-col items-center justify-center h-full">
                    <div class="loader !border-l-purple-500"></div>
                    <p class="mt-4 text-sm text-gray-600">Regenerating...</p>
                </div>
            `;

            try {
                const params = currentGenerationParams;
                let prompt = '';
                const parts = [];

                if (params.styleBase64Image) {
                    prompt = `IMPORTANT: Your task is to place the food from the first image into the exact scene of the second image. The final output MUST perfectly replicate the composition, camera angle, and lighting from the second uploaded image. The setting and photographic style must be identical. The food from the first image is the new subject, but it must be integrated photorealistically into the replicated scene. The final image must have a ${params.selectedFoodSelfieRatio} orientation.`;
                    if (params.selectedTheme) {
                        prompt += ` The overall mood should have a '${params.selectedTheme}' feel.`;
                    }
                    parts.push({ text: prompt });
                    parts.push({ inlineData: { mimeType: params.foodMimeType, data: params.foodBase64Image } });
                    parts.push({ inlineData: { mimeType: params.styleMimeType, data: params.styleBase64Image } });
                } else {
                    prompt = `Create a professional, esthetic photograph featuring the exact food from the uploaded image. The overall setting is '${params.selectedTheme || 'general food photography'}'. The specific photographic style is a '${style}'. The image must have ${params.selectedFoodSelfieRatio} aspect ratio. The image must be high quality, sharp focus, with beautiful lighting and cinematic composition suitable for that style.`;
                    parts.push({ text: prompt });
                    parts.push({ inlineData: { mimeType: params.foodMimeType, data: params.foodBase64Image } });
                }

                const payload = {
                    contents: [{ parts }],
                    generationConfig: { responseModalities: ['IMAGE'], imageConfig: { aspectRatio: params.selectedFoodSelfieRatio } },
                };

                const result = await generateImageWithRetry(payload);
                const imagePart = result?.candidates?.[0]?.content?.parts?.find(p => p.inlineData);
                const base64Data = imagePart?.inlineData?.data;

                if (base64Data) {
                    const imageUrl = `data:image/png;base64,${base64Data}`;
                    const fileName = `food-creation-${style.replace(/[^a-z0-9]/gi, '-').toLowerCase()}.png`;
                    const safeTitle = style.replace(/"/g, '&quot;');

                    // Update tracked image
                    generatedFoodImages[index] = {
                        url: imageUrl,
                        filename: fileName,
                        style: style
                    };

                    targetCard.className = 'result-card card p-4 flex flex-col justify-between';
                    targetCard.innerHTML = `
                        <div><h3 class="text-lg font-semibold text-gray-800 mb-4">${params.styleBase64Image ? 'Hasil ' + (index + 1) : style}</h3></div>
                        <div class="relative w-full h-full group">
                            <img src="${imageUrl}" class="w-full h-full object-cover rounded-md" alt="${style}">
                            <div class="absolute bottom-2 right-2 flex gap-2 opacity-0 group-hover:opacity-100 transition-opacity">
                                <button data-action="food-preview" data-image-url="${imageUrl}" class="action-btn bg-blue-500 text-white p-2 rounded-full hover:bg-blue-600" title="Preview">
                                    <i class="fas fa-search-plus"></i>
                                </button>
                                <button data-action="food-edit" data-index="${index}" data-style="${safeTitle}" class="action-btn bg-purple-500 text-white p-2 rounded-full hover:bg-purple-600" title="Edit Prompt">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button data-action="food-regenerate" data-index="${index}" data-style="${safeTitle}" class="action-btn bg-green-500 text-white p-2 rounded-full hover:bg-green-600" title="Regenerate">
                                    <i class="fas fa-sync-alt"></i>
                                </button>
                                <button data-action="food-download" data-image-url="${imageUrl}" data-filename="${fileName}" class="action-btn bg-cyan-600 text-white p-2 rounded-full hover:bg-cyan-700" title="Unduh">
                                    <i class="fas fa-download"></i>
                                </button>
                            </div>
                        </div>
                    `;
                } else {
                    throw new Error('Failed to generate image');
                }
            } catch (error) {
                console.error('Regenerate error:', error);
                targetCard.innerHTML = `
                    <div class="flex flex-col items-center justify-center h-full text-red-600">
                        <i class="fas fa-exclamation-triangle text-3xl mb-2"></i>
                        <p class="text-sm">Gagal regenerate</p>
                        <button onclick="location.reload()" class="mt-2 text-xs bg-red-500 text-white px-3 py-1 rounded-full hover:bg-red-600">
                            Refresh
                        </button>
                    </div>
                `;
            }
        }
        
        function showLoading(isLoading) {
            if (!loader || !placeholderResult || !generateBtn) return;
            if (isLoading) {
                loader.classList.remove('hidden');
                loader.classList.add('flex');
                placeholderResult.classList.add('hidden');
                resultContent.classList.add('hidden');
                generateBtn.disabled = true;
            } else {
                loader.classList.add('hidden');
                loader.classList.remove('flex');
                generateBtn.disabled = false;
            }
        }

        function showError(message) {
            if (!errorMessage) return;
            errorMessage.textContent = message;
            if (message) {
                errorMessage.classList.remove('hidden');
                if(placeholderResult) placeholderResult.classList.add('hidden');
                if(resultContent) resultContent.classList.add('hidden');
            } else {
                errorMessage.classList.add('hidden');
            }
        }

        validateInputs();
    })();

    // --- NEW BORN STUDIO LOGIC ---
    (function() {
        const imageUpload = document.getElementById('new-born-image-upload');
        const uploadButton = document.getElementById('new-born-upload-button');
        const imagePreview = document.getElementById('new-born-image-preview');
        const previewText = document.getElementById('new-born-preview-text');
        const generateButton = document.getElementById('new-born-generate-button');
        const loadingIndicator = document.getElementById('new-born-loading-indicator');
        const resultsGrid = document.getElementById('new-born-results-grid');
        const resultsHeader = document.getElementById('new-born-results-header');
        const downloadAllBtn = document.getElementById('new-born-download-all-btn');
        const errorMessage = document.getElementById('new-born-error-message');
        const customThemeInput = document.getElementById('new-born-custom-theme');
        const genderRadios = document.querySelectorAll('#content-new-born input[name="gender"]');
        const ratioOptions = document.getElementById('newborn-ratio-options');

        let base64ImageData = null;
        let selectedRatio = '3:4'; // Default aspect ratio
        let generatedImages = []; // Store generated images

        if (uploadButton) {
            uploadButton.addEventListener('click', () => imageUpload.click());
        }

        if (imageUpload) {
            imageUpload.addEventListener('change', event => {
                const file = event.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = e => {
                        imagePreview.src = e.target.result;
                        imagePreview.classList.remove('hidden');
                        previewText.classList.add('hidden');
                        base64ImageData = e.target.result.split(',')[1];
                    };
                    reader.readAsDataURL(file);
                    showError(''); // Clear previous error
                }
            });
        }

        // Ratio button selection handler
        if (ratioOptions) {
            ratioOptions.addEventListener('click', (e) => {
                const button = e.target.closest('.option-btn-newborn');
                if (button) {
                    ratioOptions.querySelectorAll('.option-btn-newborn').forEach(btn => btn.classList.remove('selected'));
                    button.classList.add('selected');
                    selectedRatio = button.dataset.value;
                }
            });
        }

        if (generateButton) {
            generateButton.addEventListener('click', async () => {
                if (!base64ImageData) {
                    showError("Harap pilih foto bayi terlebih dahulu.");
                    return;
                }
                resultsGrid.innerHTML = '';
                showError('');
                loadingIndicator.classList.remove('hidden');
                generateButton.disabled = true;
                generateButton.textContent = 'Memproses...';

                try {
                    generatedImages = []; // Reset array
                    const generationPromises = [];
                    for (let i = 0; i < 7; i++) {
                        generationPromises.push(generateSingleImageWithRetry());
                    }
                    await Promise.all(generationPromises);

                    // Show results header if there are images
                    if (generatedImages.length > 0 && resultsHeader) {
                        resultsHeader.classList.remove('hidden');
                    }
                } catch (error) {
                    console.error('An error occurred during image generation:', error);
                    showError('Terjadi kesalahan saat membuat gambar. Silakan coba lagi.');
                } finally {
                    loadingIndicator.classList.add('hidden');
                    generateButton.disabled = false;
                    generateButton.textContent = 'Generate 7 Foto Ajaib';
                }
            });
        }

        function showError(message) {
            if (message) {
                errorMessage.textContent = message;
                errorMessage.classList.remove('hidden');
            } else {
                errorMessage.classList.add('hidden');
            }
        }
        
        function getRandomPrompt() {
            // Check for custom theme first
            const customTheme = customThemeInput ? customThemeInput.value.trim() : '';

            const babyName = document.getElementById('new-born-name').value.trim();
            const babyDob = document.getElementById('new-born-dob').value;
            let detailsPrompt = '';
            if (babyName || babyDob) {
                let details = [];
                if (babyName) details.push(`the name "${babyName}"`);
                if (babyDob) {
                    const dateObj = new Date(babyDob);
                    if (!isNaN(dateObj)) {
                        const formattedDate = dateObj.toLocaleDateString('en-US', {
                            day: 'numeric', month: 'long', year: 'numeric'
                        });
                        details.push(`the date "${formattedDate}"`);
                    }
                }
                if (details.length > 0) {
                     detailsPrompt = ` Artistically include ${details.join(' and ')} as part of the photo's props (e.g., carved on wooden blocks, elegant calligraphy on a blanket), not as a digital text overlay.`;
                }
            }

            // If custom theme is provided, use it directly
            if (customTheme) {
                const finalPrompt = `Ultra-realistic, high-quality newborn studio photo of the provided baby. Theme: ${customTheme}.${detailsPrompt} Photo style: professional studio photography with natural skin texture and detail. The baby's face must be natural, cute, and the main focus. Important: 1080p quality, hyperrealistic.`;
                return finalPrompt;
            }

            // Otherwise, use random theme logic
            const maleThemes = ['superhero cilik', 'astronot penjelajah galaksi', 'petualang safari', 'pangeran kerajaan awan', 'pilot pesawat jet mainan', 'pembalap mobil mini'];
            const femaleThemes = ['peri di hutan ajaib', 'putri negeri dongeng', 'penari balet cilik', 'putri duyung di laut berkilau', 'gadis bunga di taman ajaib'];
            const neutralThemes = ['koki cilik di dapur mini', 'penyelam laut dalam', 'musisi kecil dengan gitar mini', 'pelukis dengan kanvas warna-warni', 'bayi hewan lucu (kostum singa/panda)', 'kurcaci di taman jamur'];
            const settings = ['di atas bulan sabit', 'di dalam buku cerita raksasa', 'terbang di antara awan permen kapas', 'di taman bunga ajaib', 'di planet penuh bintang', 'di istana bawah laut', 'di dapur yang nyaman', 'di tengah hutan belantara yang ceria', 'di kokpit pesawat luar angkasa mainan'];
            const styles = ['foto studio profesional high-end', 'sinematik, pencahayaan dramatis', 'hyperrealistic, detail sangat tajam', 'gaya fotografi potret profesional', 'cahaya lembut dan alami seperti di dekat jendela', 'pencahayaan high-key studio yang bersih dan cerah'];
            const elements = ['dikelilingi bintang berkelip', 'dengan kupu-kupu bercahaya', 'memegang balon berbentuk planet', 'duduk di atas jamur raksasa', 'menunggangi kura-kura laut yang ramah', 'tertawa di antara gelembung sabun'];

            const gender = document.querySelector('#content-new-born input[name="gender"]:checked').value;
            let availableThemes = (gender === 'laki-laki') ? [...maleThemes, ...neutralThemes] : [...femaleThemes, ...neutralThemes];

            const randomTheme = availableThemes[Math.floor(Math.random() * availableThemes.length)];
            const randomSetting = settings[Math.floor(Math.random() * settings.length)];
            const randomStyle = styles[Math.floor(Math.random() * styles.length)];
            const randomElement = elements[Math.floor(Math.random() * elements.length)];

            const finalPrompt = `Ultra-realistic, high-quality newborn studio photo of the provided baby. Theme: ${randomTheme}. The baby is ${randomSetting}, ${randomElement}.${detailsPrompt} Photo style: ${randomStyle}, with natural skin texture and detail. The baby's face must be natural, cute, and the main focus. Important: 1080p quality, hyperrealistic.`;

            return finalPrompt;
        }

        async function generateSingleImage() {
            const userPrompt = getRandomPrompt();
            const apiKey = "";
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-image-preview:generateContent?key=${apiKey}`;

            const payload = {
                contents: [{ parts: [ { text: userPrompt }, { inlineData: { mimeType: "image/png", data: base64ImageData } } ] }],
                generationConfig: {
                    responseModalities: ['IMAGE'],
                    imageConfig: { aspectRatio: selectedRatio }
                },
            };

            const response = await fetch(apiUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });

            if (!response.ok) {
               const errorBody = await response.text();
               console.error("API Error Response:", errorBody);
               throw new Error(`API request failed with status ${response.status}`);
            }

            const result = await response.json();
            const base64Data = result?.candidates?.[0]?.content?.parts?.find(p => p.inlineData)?.inlineData?.data;

            if (!base64Data) {
                console.error("No image data in response:", result);
                throw new Error("Gagal mendapatkan data gambar dari respons API.");
            }

            const imageUrl = `data:image/png;base64,${base64Data}`;
            const filename = `bayi-ajaib-${Date.now()}-${Math.random().toString(36).substr(2, 9)}.png`;

            // Store in array
            generatedImages.push({ url: imageUrl, filename: filename });

            displayImage(imageUrl, generatedImages.length - 1);
        }
        
        async function generateSingleImageWithRetry(maxRetries = 3) {
            let attempt = 0;
            while (attempt < maxRetries) {
                try {
                    await generateSingleImage();
                    return;
                } catch (error) {
                    attempt++;
                    console.warn(`Attempt ${attempt} failed. Retrying in ${attempt * 1000}ms...`, error);
                    if (attempt >= maxRetries) {
                        throw error;
                    }
                    await new Promise(resolve => setTimeout(resolve, attempt * 1000));
                }
            }
        }

        function displayImage(imageUrl, index) {
            const imgContainer = document.createElement('div');
            imgContainer.className = 'relative group aspect-w-1 aspect-h-1 bg-gray-200 rounded-lg overflow-hidden shadow-md';

            imgContainer.innerHTML = `
                <img src="${imageUrl}" alt="Generated baby photo ${index + 1}" class="w-full h-full object-cover transform group-hover:scale-105 transition-transform duration-300"/>
                <div class="absolute inset-0 bg-gradient-to-t from-black/70 via-black/30 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300 rounded-lg flex flex-col justify-end p-4 gap-2">
                    <div class="flex gap-2">
                        <button data-action="newborn-preview" data-index="${index}" class="action-btn flex-1 bg-blue-500 hover:bg-blue-600 text-white px-3 py-2 rounded-lg text-sm font-semibold transition flex items-center justify-center gap-1">
                            <i class="fas fa-eye"></i>
                            <span class="hidden sm:inline">Preview</span>
                        </button>
                        <button data-action="newborn-download" data-index="${index}" class="action-btn flex-1 bg-indigo-600 hover:bg-indigo-700 text-white px-3 py-2 rounded-lg text-sm font-semibold transition flex items-center justify-center gap-1">
                            <i class="fas fa-download"></i>
                            <span class="hidden sm:inline">Download</span>
                        </button>
                    </div>
                </div>
            `;

            resultsGrid.appendChild(imgContainer);
        }

        // Event delegation for action buttons
        if (resultsGrid) {
            resultsGrid.addEventListener('click', async (e) => {
                e.stopPropagation();

                const actionBtn = e.target.closest('.action-btn[data-action]');
                if (!actionBtn) return;

                const action = actionBtn.dataset.action;
                const index = parseInt(actionBtn.dataset.index, 10);
                const imageData = generatedImages[index];

                if (!imageData) return;

                if (action === 'newborn-preview') {
                    if (window.showPreviewModal) {
                        window.showPreviewModal(imageData.url);
                    }
                } else if (action === 'newborn-download') {
                    if (window.downloadDataURINew) {
                        await window.downloadDataURINew(imageData.url, imageData.filename);
                    } else if (window.downloadImage) {
                        await window.downloadImage(imageData.url, imageData.filename);
                    }
                }
            });
        }

        // Download all functionality
        if (downloadAllBtn) {
            downloadAllBtn.addEventListener('click', async () => {
                if (generatedImages.length === 0) return;

                downloadAllBtn.disabled = true;
                downloadAllBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Downloading...';

                for (let i = 0; i < generatedImages.length; i++) {
                    const img = generatedImages[i];
                    if (window.downloadDataURINew) {
                        await window.downloadDataURINew(img.url, img.filename);
                        // Small delay between downloads for better UX
                        await new Promise(resolve => setTimeout(resolve, 500));
                    } else if (window.downloadImage) {
                        await window.downloadImage(img.url, img.filename);
                        // Small delay between downloads for better UX
                        await new Promise(resolve => setTimeout(resolve, 500));
                    }
                }

                downloadAllBtn.disabled = false;
                downloadAllBtn.innerHTML = '<i class="fas fa-download mr-2"></i>Download Semua';
            });

            // Add mobile touch support
            if (window.addMobileTouchSupport) {
                window.addMobileTouchSupport(downloadAllBtn);
            }
        }
    })();

    // --- FOTO PROFESI ANAK LOGIC ---
    (function() {
        const imageUploadInput = document.getElementById('profesi-anak-image-upload');
        const previewContainer = document.getElementById('profesi-anak-preview-container');
        const imageGrid = document.getElementById('profesi-anak-image-grid');
        const uploadPrompt = document.getElementById('profesi-anak-upload-prompt');
        const ageSelect = document.getElementById('profesi-anak-age');
        const themeInput = document.getElementById('profesi-anak-theme');
        const ratioOptions = document.getElementById('profesi-ratio-options');
        const generateBtn = document.getElementById('profesi-anak-generate-btn');
        const loader = document.getElementById('profesi-anak-loader');
        const errorContainer = document.getElementById('profesi-anak-error');
        const placeholder = document.getElementById('profesi-anak-placeholder');
        const resultsGrid = document.getElementById('profesi-anak-results-grid');
        const resultsHeader = document.getElementById('profesi-anak-results-header');
        const downloadAllBtn = document.getElementById('profesi-anak-download-all-btn');

        let uploadedImages = []; // Array to store base64 strings
        let selectedRatio = '3:4'; // Default aspect ratio
        let generatedImages = []; // Store generated images with URLs and filenames

        // Populate age select
        for (let i = 1; i <= 10; i++) {
            const option = document.createElement('option');
            option.value = i;
            option.textContent = `${i} tahun`;
            ageSelect.appendChild(option);
        }
        ageSelect.value = 5;

        const handleImageUpload = (event) => {
            const files = Array.from(event.target.files);
            if (files.length === 0) return;

            const validFiles = files.filter(file => ["image/jpeg", "image/png"].includes(file.type));

            if (validFiles.length !== files.length) {
                showError("Beberapa file bukan format gambar yang didukung (JPG/PNG) dan diabaikan.");
            } else {
                hideError();
            }

            const readFiles = validFiles.map(file => new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onloadend = () => resolve(reader.result);
                reader.onerror = reject;
                reader.readAsDataURL(file);
            }));

            Promise.all(readFiles).then(newImages => {
                uploadedImages = [...uploadedImages, ...newImages];
                renderPreviews();
            }).catch(err => {
                console.error("Gagal membaca file:", err);
                showError("Terjadi kesalahan saat memuat gambar.");
            });
            
            event.target.value = null; // Reset input
        };
        
        const renderPreviews = () => {
            imageGrid.innerHTML = '';
            uploadedImages.forEach((image, index) => {
                const wrapper = document.createElement('div');
                wrapper.className = 'relative group';
                wrapper.innerHTML = `
                    <img src="${image}" alt="Pratinjau ${index+1}" class="w-full h-full object-cover rounded-md aspect-square border-2 border-gray-500"/>
                    <button data-index="${index}" class="remove-btn absolute -top-2 -right-2 bg-red-600 text-white rounded-full p-1 opacity-80 group-hover:opacity-100 transition-opacity">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                    </button>
                `;
                imageGrid.appendChild(wrapper);
            });

            if (uploadedImages.length > 0) {
                previewContainer.classList.remove('hidden');
                uploadPrompt.classList.add('hidden');
                ageSelect.disabled = true;
                ageSelect.classList.add('disabled:bg-gray-800', 'disabled:cursor-not-allowed', 'disabled:text-gray-500');
            } else {
                previewContainer.classList.add('hidden');
                uploadPrompt.classList.remove('hidden');
                ageSelect.disabled = false;
                ageSelect.classList.remove('disabled:bg-gray-800', 'disabled:cursor-not-allowed', 'disabled:text-gray-500');
            }
        };

        imageGrid.addEventListener('click', (e) => {
             const removeBtn = e.target.closest('.remove-btn');
             if (removeBtn) {
                 const indexToRemove = parseInt(removeBtn.dataset.index, 10);
                 uploadedImages = uploadedImages.filter((_, index) => index !== indexToRemove);
                 renderPreviews();
             }
        });

        // Ratio button selection handler
        if (ratioOptions) {
            ratioOptions.addEventListener('click', (e) => {
                const button = e.target.closest('.option-btn-profesi');
                if (button) {
                    ratioOptions.querySelectorAll('.option-btn-profesi').forEach(btn => btn.classList.remove('selected'));
                    button.classList.add('selected');
                    selectedRatio = button.dataset.value;
                }
            });
        }

        const showError = (message) => {
            errorContainer.textContent = message;
            errorContainer.classList.remove('hidden');
        };
        const hideError = () => errorContainer.classList.add('hidden');

        const generateImageAPI = async (prompt, imagesBase64 = [], retries = 3, delay = 1000) => {
            const apiKey = "";
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-image-preview:generateContent?key=${apiKey}`;
            
            const parts = [{ text: prompt }];
            imagesBase64.forEach(base64 => {
                parts.push({
                    inlineData: {
                        mimeType: base64.startsWith('data:image/png') ? 'image/png' : 'image/jpeg',
                        data: base64.split(',')[1]
                    }
                });
            });

            const payload = {
              contents: [{ parts }],
              generationConfig: {
                  responseModalities: ['IMAGE'],
                  imageConfig: { aspectRatio: selectedRatio }
              },
            };

            for (let i = 0; i < retries; i++) {
                try {
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });
                    if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                    const result = await response.json();
                    const base64Data = result?.candidates?.[0]?.content?.parts?.find(p => p.inlineData)?.inlineData?.data;
                    if (base64Data) return `data:image/png;base64,${base64Data}`;
                    else throw new Error("Data gambar tidak ditemukan dalam respons API.");
                } catch (err) {
                    if (i === retries - 1) throw err;
                    await new Promise(res => setTimeout(res, delay * Math.pow(2, i)));
                }
            }
        };

        const handleGenerate = async () => {
            generateBtn.disabled = true;
            generateBtn.textContent = '‚ú® Sedang Memproses... ‚ú®';
            loader.classList.remove('hidden');
            loader.classList.add('flex');
            hideError();
            resultsGrid.innerHTML = '';
            placeholder.classList.add('hidden');
            if (resultsHeader) resultsHeader.classList.add('hidden');
            generatedImages = []; // Reset array

            const RANDOM_THEMES = ['superhero in a dynamic pose', 'astronaut exploring a colorful galaxy', 'chef baking a giant cupcake', 'artist painting a masterpiece', 'pirate on a treasure island', 'royal prince or princess in a castle', 'fairy in an enchanted forest', 'musician playing an instrument on stage', 'scientist in a bubbly lab', 'firefighter with a shiny red truck', 'jungle explorer discovering ancient ruins', 'race car driver with a futuristic car', 'knight defending a magical kingdom', 'wizard casting a sparkling spell', 'ballet dancer on a grand stage', 'farmer with cute farm animals', 'doctor healing a teddy bear', 'pilot flying over mountains', 'underwater adventurer with friendly sea creatures', 'in a whimsical candy land', 'dinosaur ranger in a prehistoric park', 'little detective solving a mystery', 'story time in a cozy, magical library', 'building a magnificent sandcastle on a sunny beach', 'gardener in a vibrant, oversized garden'];
            const ETHNICITIES = ['Asian', 'Caucasian', 'Hispanic', 'African', 'Middle Eastern', 'South Asian'];
            const GENDERS = ['boy', 'girl'];

            try {
              const prompts = Array.from({ length: 7 }).map(() => {
                const selectedTheme = themeInput.value.trim() || RANDOM_THEMES[Math.floor(Math.random() * RANDOM_THEMES.length)];

                if (uploadedImages.length > 0) {
                  return `**CRITICAL INSTRUCTION: Maintain Character Identity.** You are provided with several reference photos of the SAME child. Your task is to generate a new image of this exact same child, but placed in a new scene with the theme: '${selectedTheme}'. **DO NOT alter the child's face, facial structure, eye color, hair style, or unique features.** The generated image MUST look like the same individual from the reference photos. The final image should be an ultra-realistic, professional studio photograph with cinematic lighting, high detail, sharp focus, and professional color grading. The background should be a clean studio setup that matches the theme. Negative prompt: different person, distorted features, inconsistent face.`;
                } else {
                  const selectedEthnicity = ETHNICITIES[Math.floor(Math.random() * ETHNICITIES.length)];
                  const selectedGender = GENDERS[Math.floor(Math.random() * GENDERS.length)];
                  const age = ageSelect.value;
                  const ageText = age === 1 ? '1-year-old' : `${age}-years-old`;
                  return `professional studio photography of a cute ${selectedEthnicity} ${selectedGender} child, ${ageText}, theme: ${selectedTheme}. cinematic lighting, ultra-realistic, photorealistic, high detail, sharp focus, professional color grading, clean studio background.`;
                }
              });

              const imagePromises = prompts.map(prompt => generateImageAPI(prompt, uploadedImages));
              const apiResults = (await Promise.all(imagePromises)).filter(img => img);

              resultsGrid.innerHTML = '';
              apiResults.forEach((src, index) => {
                  const filename = `studio-anak-${Date.now()}-${index + 1}.png`;
                  generatedImages.push({ url: src, filename: filename }); // Store for download all

                  const imageCard = document.createElement('div');
                  imageCard.className = 'group relative rounded-xl overflow-hidden shadow-2xl border-4 border-transparent hover:border-pink-500 transition-all duration-300 transform hover:scale-105';
                  imageCard.innerHTML = `
                      <img src="${src}" alt="Generated studio photo ${index + 1}" class="w-full h-full object-cover aspect-[9/12]"/>
                      <div class="absolute inset-0 bg-gradient-to-t from-black/80 via-black/40 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300 flex flex-col justify-end p-4 gap-2">
                          <div class="flex gap-2">
                              <button data-action="profesi-preview" data-index="${index}" class="action-btn flex-1 bg-blue-500 hover:bg-blue-600 text-white px-3 py-2 rounded-full text-sm font-bold transition flex items-center justify-center gap-1 shadow-lg">
                                  <i class="fas fa-eye"></i>
                                  <span class="hidden sm:inline">Preview</span>
                              </button>
                              <button data-action="profesi-download" data-index="${index}" class="action-btn flex-1 bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600 text-white px-3 py-2 rounded-full text-sm font-bold transition flex items-center justify-center gap-1 shadow-lg">
                                  <i class="fas fa-download"></i>
                                  <span class="hidden sm:inline">Download</span>
                              </button>
                          </div>
                      </div>
                  `;
                  resultsGrid.appendChild(imageCard);
              });

              // Show results header
              if (generatedImages.length > 0 && resultsHeader) {
                  resultsHeader.classList.remove('hidden');
              }

            } catch (err) {
              console.error("Gagal menghasilkan gambar:", err);
              showError("Maaf, terjadi kesalahan saat membuat gambar. Silakan coba lagi.");
            } finally {
              generateBtn.disabled = false;
              generateBtn.textContent = '‚ú® Buat 7 Foto Ajaib! ‚ú®';
              loader.classList.add('hidden');
              loader.classList.remove('flex');
              if (resultsGrid.innerHTML === '') {
                 placeholder.classList.remove('hidden');
              }
            }
        };

        imageUploadInput.addEventListener('change', handleImageUpload);
        generateBtn.addEventListener('click', handleGenerate);

        // Event delegation for action buttons
        if (resultsGrid) {
            resultsGrid.addEventListener('click', async (e) => {
                e.stopPropagation();

                const actionBtn = e.target.closest('.action-btn[data-action]');
                if (!actionBtn) return;

                const action = actionBtn.dataset.action;
                const index = parseInt(actionBtn.dataset.index, 10);
                const imageData = generatedImages[index];

                if (!imageData) return;

                if (action === 'profesi-preview') {
                    if (window.showPreviewModal) {
                        window.showPreviewModal(imageData.url);
                    }
                } else if (action === 'profesi-download') {
                    if (window.downloadDataURINew) {
                        await window.downloadDataURINew(imageData.url, imageData.filename);
                    } else if (window.downloadImage) {
                        await window.downloadImage(imageData.url, imageData.filename);
                    }
                }
            });
        }

        // Download all functionality
        if (downloadAllBtn) {
            downloadAllBtn.addEventListener('click', async () => {
                if (generatedImages.length === 0) return;

                downloadAllBtn.disabled = true;
                downloadAllBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Downloading...';

                for (let i = 0; i < generatedImages.length; i++) {
                    const img = generatedImages[i];
                    if (window.downloadDataURINew) {
                        await window.downloadDataURINew(img.url, img.filename);
                        // Small delay between downloads for better UX
                        await new Promise(resolve => setTimeout(resolve, 500));
                    } else if (window.downloadImage) {
                        await window.downloadImage(img.url, img.filename);
                        // Small delay between downloads for better UX
                        await new Promise(resolve => setTimeout(resolve, 500));
                    }
                }

                downloadAllBtn.disabled = false;
                downloadAllBtn.innerHTML = '<i class="fas fa-download mr-2"></i>Download Semua';
            });

            // Add mobile touch support
            if (window.addMobileTouchSupport) {
                window.addMobileTouchSupport(downloadAllBtn);
            }
        }

    })();

    // --- STORY UPDATE GENERATOR LOGIC ---
    (function() {
        const form = document.getElementById('story-update-form');
        const generateBtn = document.getElementById('story-update-generate-btn');
        const loader = document.getElementById('story-update-loader');
        const resultsPlaceholder = document.getElementById('story-update-placeholder');
        const errorMessage = document.getElementById('story-update-error-message');
        const resultsWrapper = document.getElementById('story-update-results-wrapper');
        const downloadAllBtn = document.getElementById('story-download-all-btn');
        const resultGrid = document.getElementById('story-update-result-grid');
        const photoUpload = document.getElementById('story-update-photo-upload');
        const photoPreview = document.getElementById('story-update-photo-preview');
        const uploadLabel = document.getElementById('story-update-upload-label');

        // Aspect ratio selector
        const ratioButtons = document.querySelectorAll('.story-ratio-btn');
        let selectedRatio = '9:16'; // Default

        let uploadedImageBase64 = null;
        let uploadedMimeType = null;
        let generatedImages = [];
        generateBtn.disabled = true;

        // Aspect ratio selection handler
        ratioButtons.forEach(btn => {
            btn.addEventListener('click', () => {
                ratioButtons.forEach(b => b.classList.remove('story-ratio-selected'));
                btn.classList.add('story-ratio-selected');
                selectedRatio = btn.dataset.value;
            });
        });

        photoUpload.addEventListener('change', (event) => {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    uploadedImageBase64 = e.target.result.split(',')[1];
                    uploadedMimeType = file.type;
                    photoPreview.src = e.target.result;
                    photoPreview.style.display = 'block';
                    uploadLabel.textContent = 'Ganti Foto Referensi';
                    generateBtn.disabled = false;
                };
                reader.readAsDataURL(file);
            }
        });

        const getRandomElement = (arr) => arr[Math.floor(Math.random() * arr.length)];

        function constructPrompt(economicStatus, theme, photoStyle) {
            let scenario = '';
            const indoCities = ['Jakarta', 'Bandung', 'Yogyakarta', 'Surabaya', 'Semarang'];
            const internationalCities = ['Paris', 'Tokyo', 'New York', 'London', 'Singapore'];
            const themes = {
                'makan': 'eating',
                'jalan-jalan': 'traveling and sightseeing',
                'kerja': 'working',
                'kuliah': 'studying at a university campus',
                'olahraga': 'exercising',
                'nongkrong': 'hanging out'
            };
            let activity = themes[theme] || 'doing a daily activity';
            const specificActivity = document.getElementById('story-update-specific-activity').value.trim();

            if (specificActivity) {
                activity = specificActivity;
                scenario = `in a place that looks like ${getRandomElement(indoCities)}`;
            } else {
                switch (economicStatus) {
                    case 'gaji_bawah_umk':
                        switch (theme) {
                            case 'makan': scenario = getRandomElement([ `at a simple street food stall ('warteg') in ${getRandomElement(indoCities)}`,  `at a bustling 'mie ayam' cart on the sidewalk in ${getRandomElement(indoCities)}`,  `at a 'nasi goreng' street vendor at night in ${getRandomElement(indoCities)}`, `at a 'bubur ayam' street cart in the morning in ${getRandomElement(indoCities)}`, `at a 'sate padang' stall in a crowded market in ${getRandomElement(indoCities)}`, `at a 'ketoprak' or 'gado-gado' vendor in a residential area in ${getRandomElement(indoCities)}` ]); break;
                            case 'jalan-jalan': scenario = getRandomElement([ `walking through a traditional market ('pasar tradisional') in ${getRandomElement(indoCities)}`,  `sitting on a bench in a public city park ('alun-alun') in ${getRandomElement(indoCities)}`,  `exploring a crowded, narrow city alleyway ('gang') in ${getRandomElement(indoCities)}`, `visiting a free city museum on a quiet afternoon in ${getRandomElement(indoCities)}`, `window shopping at a local, non-branded mall in ${getRandomElement(indoCities)}`, `watching street performers at a bustling city square at night in ${getRandomElement(indoCities)}`, `taking photos on an iconic city bridge or flyover in ${getRandomElement(indoCities)}`, `relaxing at a city forest ('hutan kota') in ${getRandomElement(indoCities)}`, `enjoying the sunset from a public spot overlooking the city in ${getRandomElement(indoCities)}`, `visiting a historical monument in ${getRandomElement(indoCities)}` ]); break;
                            case 'kerja': scenario = getRandomElement([ `in a small, modest office in Indonesia`,  `at a cashier in a minimarket in ${getRandomElement(indoCities)}`,  `in a factory production line in an industrial area in Indonesia`, `as a ride-hailing driver waiting for an order`, `as a package courier sorting parcels`, `as a construction worker on a building site` ]); break;
                            case 'kuliah': scenario = getRandomElement([ `in a simple classroom at a public university in ${getRandomElement(indoCities)}`,  `studying in the campus library with old books in ${getRandomElement(indoCities)}`,  `eating at the university's cheap food court ('kantin') in ${getRandomElement(indoCities)}`, `discussing a group project on the campus floor corridor`, `photocopying lecture notes at a shop near campus` ]); break;
                            case 'olahraga': scenario = getRandomElement([ `jogging in a public city park ('alun-alun') in ${getRandomElement(indoCities)}`,  `playing badminton on a public court in ${getRandomElement(indoCities)}`,  `doing street workout at a public facility in ${getRandomElement(indoCities)}`, `playing football on a neighborhood field`, `joining a mass aerobics session during car-free day` ]); break;
                            case 'nongkrong': scenario = getRandomElement([ `at a humble streetside coffee stall ('warkop') in ${getRandomElement(indoCities)}`,  `sitting on the roadside with friends in ${getRandomElement(indoCities)}`,  `at a free public Wi-Fi corner in ${getRandomElement(indoCities)}`, `at a food stall ('angkringan') at night`, `playing guitar at a neighborhood security post ('pos ronda')` ]); break;
                        }
                        break;
                    case 'gaji_sesuai_umk':
                        switch (theme) {
                            case 'makan': scenario = getRandomElement([ `at a trendy, modern local cafe in ${getRandomElement(indoCities)}`,  `at a popular all-you-can-eat restaurant in ${getRandomElement(indoCities)}`,  `at a Japanese ramen shop in a mall in ${getRandomElement(indoCities)}`, `at a Korean BBQ restaurant with friends in ${getRandomElement(indoCities)}`, `at a popular pizza place in ${getRandomElement(indoCities)}`, `at a 'ayam geprek' restaurant with a high spice level in ${getRandomElement(indoCities)}` ]); break;
                            case 'jalan-jalan': scenario = getRandomElement([ `at a popular shopping mall in ${getRandomElement(indoCities)}`,  `visiting a local tourist attraction like a waterfall near Bandung`,  `watching a movie at the cinema in ${getRandomElement(indoCities)}`, `at a local zoo or botanical garden on the weekend`, `attending a concert of a popular local band`, `exploring a trendy, Instagrammable spot in the city` ]); break;
                            case 'kerja': scenario = getRandomElement([ `in a bright, modern co-working space in ${getRandomElement(indoCities)}`,  `in an open-plan office in ${getRandomElement(indoCities)}`,  `attending a meeting in a glass-walled conference room in ${getRandomElement(indoCities)}`, `working from home at a cozy desk setup`, `giving a presentation to clients`, `working overtime late at night in the office` ]); break;
                            case 'kuliah': scenario = getRandomElement([ `on a busy, modern university campus in ${getRandomElement(indoCities)}`,  `collaborating on a project at a campus cafe in ${getRandomElement(indoCities)}`,  `in a modern university laboratory in ${getRandomElement(indoCities)}`, `attending a seminar or workshop on campus`, `as a committee member for a campus event` ]); break;
                            case 'olahraga': scenario = getRandomElement([ `at a local commercial gym in ${getRandomElement(indoCities)}`,  `taking a zumba or yoga class in ${getRandomElement(indoCities)}`,  `cycling on the city's car-free day in ${getRandomElement(indoCities)}`, `playing futsal with office mates after work`, `joining a fun run event on the weekend` ]); break;
                            case 'nongkrong': scenario = getRandomElement([ `at a popular, bustling coffee shop in ${getRandomElement(indoCities)}`,  `at a cafe with live music in ${getRandomElement(indoCities)}`,  `at a modern food court with friends in ${getRandomElement(indoCities)}`, `at an art exhibition or local bazaar`, `watching a stand-up comedy show` ]); break;
                        }
                        break;
                    case 'gaji_diatas_umk':
                         switch (theme) {
                            case 'makan': scenario = getRandomElement([ `at an upscale fine dining restaurant in Jakarta`,  `at a rooftop bar with a city view in Jakarta`,  `at a private teppanyaki dinner in Jakarta`, `at a high-end sushi omakase restaurant in SCBD, Jakarta`, `at a premium steakhouse in a 5-star hotel in Jakarta`, `at a modern Indonesian gastronomy restaurant in South Jakarta` ]); break;
                            case 'jalan-jalan': scenario = getRandomElement([ `on a holiday at a private beach villa in Bali`,  `exploring a high-end resort in Labuan Bajo`,  `hiking a scenic mountain like Rinjani with premium gear`, `on a staycation at a 5-star hotel in Jakarta`, `on a liveaboard sailing trip around Komodo National Park`, `attending a major music festival like DWP` ]); break;
                            case 'kerja': scenario = getRandomElement([ `in a high-floor corporate office with a city view of SCBD, Jakarta`,  `giving a presentation in a large auditorium in Jakarta`,  `on a business lunch at a fancy restaurant in Jakarta`, `on a business trip, at an airport lounge`, `signing a major contract in a boardroom` ]); break;
                            case 'kuliah': scenario = getRandomElement([ `at a prestigious private university's modern library in Jakarta`,  `presenting a thesis in front of professors`,  `participating in an international student conference`, `joining an overseas student exchange program`, `working as a research assistant for a professor` ]); break;
                            case 'olahraga': scenario = getRandomElement([ `playing golf at a country club near Jakarta`,  `playing tennis at an exclusive sports club in Jakarta`,  `scuba diving in Raja Ampat`, `training for a marathon with a personal coach`, `doing reformer pilates at a boutique studio` ]); break;
                            case 'nongkrong': scenario = getRandomElement([ `at a fancy rooftop bar overlooking the city skyline of Jakarta`,  `at a premium lounge in a 5-star hotel in Jakarta`,  `attending a gallery opening in Kemang, Jakarta`, `at a wine tasting event`, `attending a movie premiere` ]); break;
                        }
                        break;
                    case 'orang_kaya_baru':
                        switch (theme) {
                            case 'makan': scenario = getRandomElement([ `at a famous, trendy Michelin-starred restaurant in ${getRandomElement(internationalCities)}`,  `popping a bottle of champagne at a beach club in Bali`,  `eating gold-flaked steak in Dubai`, `eating fresh caviar on a private jet`, `showcasing a tower of fresh seafood in Saint-Tropez`, `attending a celebrity chef's exclusive pop-up dinner` ]); break;
                            case 'jalan-jalan': scenario = getRandomElement([ `shopping in a luxury district like Orchard Road Singapore, holding many designer bags`,  `in a first-class airplane seat, showing off the amenities`,  `on a private helicopter tour over New York`, `driving a rented Ferrari through Monaco`, `attending Paris Fashion Week from a front-row seat`, `staying in a lavish overwater bungalow in the Maldives` ]); break;
                            case 'kerja': scenario = getRandomElement([ `working on a MacBook on a yacht in the Mediterranean`,  `taking a video call from a luxury hotel suite in Paris`,  `closing a deal in a supercar in London`, `as a guest speaker at a crypto conference`, `monitoring stock charts from a beachside villa` ]); break;
                            case 'kuliah': scenario = getRandomElement([ `next to a Lamborghini on the campus of Stanford`,  `studying in a penthouse apartment with a view of Tokyo Tower`,  `on a university trip to the Amazon rainforest`, `attending a spring break party in Cancun`, `joining a startup incubator program in Silicon Valley` ]); break;
                            case 'olahraga': scenario = getRandomElement([ `attending a Formula 1 Grand Prix in Monaco`,  `skiing in the Swiss Alps with branded gear`,  `watching a ringside boxing match in Las Vegas`, `skydiving over The Palm, Dubai`, `racing a supercar on a professional track` ]); break;
                            case 'nongkrong': scenario = getRandomElement([ `at an exclusive beach club in Ibiza`,  `partying in a VIP section of a famous nightclub in Mykonos`,  `on a yacht party with friends near the coast of Italy`, `attending a high-profile fashion week afterparty`, `flying to Las Vegas just to see a concert` ]); break;
                        }
                        break;
                    case 'orang_kaya_lama':
                        switch (theme) {
                            case 'makan': scenario = getRandomElement([ `having a quiet, elegant private dinner on a classic sailboat`,  `at a private wine tasting event in a vineyard in Tuscany`,  `hosting a garden party at a family estate in the English countryside`, `enjoying a bespoke multi-course meal prepared by a private chef at home`, `having a quiet lunch at a members-only countryside club`, `enjoying rare cheeses and vintage wine in a private family cellar` ]); break;
                            case 'jalan-jalan': scenario = getRandomElement([ `attending an art auction at Sotheby's in London`,  `visiting a classical music concert in Vienna`,  `on a cultural heritage tour in Rome`, `on a bespoke luxury safari in Tanzania`, `visiting their family's summer home in the South of France`, `attending the exclusive Venice Biennale art exhibition` ]); break;
                            case 'kerja': scenario = getRandomElement([ `in a classic, wood-paneled home library, reviewing documents`,  `attending a board meeting for a family foundation in Geneva`,  `inspecting a family-owned vineyard in Bordeaux`, `visiting a family-owned art gallery`, `attending a philanthropy event for charity` ]); break;
                            case 'kuliah': scenario = getRandomElement([ `participating in a polo match at Cambridge`,  `debating in a historic university hall at Oxford`,  `attending a lecture by a Nobel laureate at Harvard`, `joining a competitive rowing (regatta) team`, `studying philosophy in a historic campus garden` ]); break;
                            case 'olahraga': scenario = getRandomElement([ `horseback riding on a vast countryside estate`,  `sailing a classic yacht in the French Riviera`,  `playing a game of polo`, `fox hunting (dressage) in the English countryside`, `fencing at an exclusive club` ]); break;
                            case 'nongkrong': scenario = getRandomElement([ `attending a sophisticated charity gala event in New York`,  `at a private member's club in London`,  `at a classical music soiree in a private mansion`, `attending a horse racing event like the Royal Ascot`, `enjoying an opera at the Royal Opera House in London` ]); break;
                        }
                        break;
                }
            }

            let finalPrompt;
            if (photoStyle === 'sendiri') {
                const selfShotTypes = [ { type: 'classic_high_angle_selfie', description: 'The photo is a high-angle selfie, taken from the perspective of a camera held by the person themselves, looking up towards the camera. Do not show the phone or arm. It should feel like looking through the phone\'s camera.' }, { type: 'classic_low_angle_selfie', description: 'The photo is a low-angle selfie, taken from the perspective of a camera held by the person themselves, looking down towards the camera. Do not show the phone or arm. It should feel like looking through the phone\'s camera.' }, { type: 'candid_laughing_selfie', description: 'The photo is a candid selfie with a genuine laugh or smile, slightly off-center, as if taken in a happy moment. Taken from the perspective of their own phone camera. Do not show the phone or arm.' }, { type: 'close_up_selfie', description: 'The photo is a close-up selfie focusing on their expression, taken from the perspective of a camera held by the person. Do not show the phone or their arm holding it.' }, { type: 'mirror_selfie', description: 'The photo is a mirror selfie, showing them holding the phone to take the picture in a reflection.' }, { type: 'pov_hands', description: 'The photo is a point-of-view (POV) shot where only their hands are visible, interacting with an object (like a coffee cup, a book, or a passport). Their face is not visible.' }, { type: 'pov_feet', description: 'The photo is a feet-selfie (a shot looking down at their own feet), showing the interesting ground or environment below. Their face is not visible.' }, { type: 'half_face_selfie', description: 'The photo is an artistic selfie where only half of their face is in the frame, creating a candid look. Taken from the perspective of their own phone camera. Do not show the phone or arm.' }, { type: 'walking_selfie', description: 'The photo is a slightly motion-blurred selfie, as if taken while walking, capturing a dynamic and natural moment. Taken from the perspective of their own phone camera. Do not show the phone or arm.' } ];
                const chosenType = getRandomElement(selfShotTypes);
                finalPrompt = `A realistic, natural, candid photo for a social media story, featuring the person from the uploaded image. Match their face and features from the reference photo. ${chosenType.description} The person is ${activity} ${scenario}. Photographed on an iPhone 15 Pro, ultra-realistic, high detail, natural lighting. No text or social media UI elements.`;
            } else { // bareng_temen
                const friendCameraAngles = [ 'candid shot taken by another friend from a slight distance', 'a group selfie with the main person and their friends', 'a shot where everyone is laughing, taken from a natural, eye-level perspective by a friend', 'an over-the-shoulder shot from one friend, looking towards the main person and other friends' ];
                const randomAngle = getRandomElement(friendCameraAngles);
                activity = activity === 'hanging out' ? 'hanging out with friends' : `${activity} with friends`;
                finalPrompt = `A realistic, natural, candid photo for a social media story. It features the person from the uploaded image and one or two friends, all interacting happily. Match the main person's face and features from the reference photo. The photo is taken by another friend, capturing a genuine moment (${randomAngle}). They are ${activity} ${scenario}. Photographed on an iPhone 15 Pro, ultra-realistic, high detail, natural lighting. No text or social media UI elements.`;
            }
            return finalPrompt;
        }

        async function generateImages(base64ImageData, mimeType) {
            const apiKey = "";
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-image-preview:generateContent?key=${apiKey}`;

            const callApi = async () => {
                const finalPrompt = constructPrompt(
                    document.getElementById('story-update-economic-status').value,
                    document.getElementById('story-update-theme').value,
                    document.querySelector('#content-story-update input[name="photo-style"]:checked').value
                );
                console.log("Generated Prompt:", finalPrompt);
                const payload = {
                    contents: [{ parts: [ { text: finalPrompt }, { inlineData: { mimeType: mimeType, data: base64ImageData } } ] }],
                    generationConfig: {
                        responseModalities: ['IMAGE'],
                        imageConfig: { aspectRatio: selectedRatio }
                    },
                };
                let retries = 3;
                let delay = 1000;
                for (let i = 0; i < retries; i++) {
                    try {
                        const response = await fetch(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
                        if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                        const result = await response.json();
                        const base64Data = result?.candidates?.[0]?.content?.parts?.find(p => p.inlineData)?.inlineData?.data;
                        if (base64Data) return `data:image/png;base64,${base64Data}`;
                        else throw new Error("Invalid response structure from API.");
                    } catch (error) {
                        console.error(`Attempt ${i + 1} failed:`, error);
                        if (i < retries - 1) {
                            await new Promise(res => setTimeout(res, delay));
                            delay *= 2;
                        } else throw error;
                    }
                }
            };
            const promises = Array(10).fill(null).map(() => callApi());
            return Promise.all(promises);
        }


        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            if (!uploadedImageBase64) {
                alert("Silakan upload foto referensi terlebih dahulu.");
                return;
            }

            // Reset state
            generatedImages = [];
            generateBtn.disabled = true;
            generateBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Generating 10 Stories...';
            loader.classList.remove('hidden');
            resultsWrapper.classList.add('hidden');
            resultGrid.innerHTML = '';
            resultsPlaceholder.classList.add('hidden');
            errorMessage.classList.add('hidden');

            try {
                const imageUrls = await generateImages(uploadedImageBase64, uploadedMimeType);

                imageUrls.forEach((url, index) => {
                    if (url) {
                        const filename = `story-update-${index + 1}.png`;
                        generatedImages.push({ url, filename });

                        const imageCard = document.createElement('div');
                        imageCard.className = 'relative group rounded-xl overflow-hidden shadow-lg hover:shadow-2xl transition-all duration-300';
                        imageCard.innerHTML = `
                            <img src="${url}" alt="Story Update ${index + 1}" class="w-full h-auto object-cover">
                            <div class="absolute inset-0 bg-gradient-to-t from-black/80 via-black/40 to-transparent opacity-0 group-hover:opacity-100 transition-all duration-300 flex items-end justify-center gap-2 p-4">
                                <button data-action="preview" data-index="${index}" class="action-btn flex items-center gap-2 bg-gradient-to-r from-indigo-500 to-purple-600 text-white px-4 py-2 rounded-full font-semibold shadow-lg hover:scale-105 transition-all">
                                    <i class="fas fa-eye"></i>
                                    <span class="hidden sm:inline">Preview</span>
                                </button>
                                <button data-action="download" data-index="${index}" class="action-btn flex items-center gap-2 bg-gradient-to-r from-pink-500 to-rose-600 text-white px-4 py-2 rounded-full font-semibold shadow-lg hover:scale-105 transition-all">
                                    <i class="fas fa-download"></i>
                                    <span class="hidden sm:inline">Download</span>
                                </button>
                            </div>
                        `;
                        resultGrid.appendChild(imageCard);
                    }
                });

                if (generatedImages.length > 0) {
                    resultsWrapper.classList.remove('hidden');

                    // Scroll to results on mobile
                    setTimeout(() => {
                        resultsWrapper.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                    }, 300);
                }

            } catch (error) {
                console.error('Failed to generate image:', error);
                errorMessage.textContent = 'Maaf, gagal membuat gambar. Ini bisa terjadi karena permintaan yang tinggi atau gambar referensi kurang jelas. Silakan coba lagi.';
                errorMessage.classList.remove('hidden');
                resultsPlaceholder.classList.remove('hidden');
            } finally {
                generateBtn.disabled = false;
                generateBtn.innerHTML = '<i class="fas fa-magic mr-2"></i>Generate 10 Stories';
                loader.classList.add('hidden');
            }
        });

        // Event delegation for preview and download buttons
        if (resultGrid) {
            resultGrid.addEventListener('click', async (e) => {
                e.stopPropagation();

                const actionBtn = e.target.classList.contains('action-btn') ?
                    e.target : e.target.closest('.action-btn[data-action]');
                if (!actionBtn) return;

                const action = actionBtn.dataset.action;
                const index = parseInt(actionBtn.dataset.index, 10);
                const imageData = generatedImages[index];

                if (!imageData) return;

                if (action === 'preview') {
                    if (window.showPreviewModal) {
                        window.showPreviewModal(imageData.url);
                    }
                } else if (action === 'download') {
                    if (window.downloadDataURINew) {
                        await window.downloadDataURINew(imageData.url, imageData.filename);
                    } else if (window.downloadImage) {
                        await window.downloadImage(imageData.url, imageData.filename);
                    }
                }
            });
        }

        // Download all button handler
        if (downloadAllBtn) {
            downloadAllBtn.addEventListener('click', async (e) => {
                e.stopPropagation();

                // Prevent multiple clicks
                if (generatedImages.length === 0 || downloadAllBtn.disabled) return;

                const originalHTML = downloadAllBtn.innerHTML;
                downloadAllBtn.disabled = true;

                try {
                    for (let i = 0; i < generatedImages.length; i++) {
                        const img = generatedImages[i];
                        downloadAllBtn.innerHTML = `<i class="fas fa-spinner fa-spin mr-2"></i><span>Downloading ${i + 1}/${generatedImages.length}...</span>`;

                        try {
                            if (window.downloadDataURINew) {
                                await window.downloadDataURINew(img.url, img.filename);
                            } else if (window.downloadImage) {
                                await window.downloadImage(img.url, img.filename);
                            }
                            await new Promise(resolve => setTimeout(resolve, 500));
                        } catch (error) {
                            console.error(`Error downloading image ${i + 1}:`, error);
                            // Continue with next image even if one fails
                        }
                    }

                    downloadAllBtn.innerHTML = '<i class="fas fa-check mr-2"></i><span>Selesai!</span>';
                    setTimeout(() => {
                        downloadAllBtn.disabled = false;
                        downloadAllBtn.innerHTML = originalHTML;
                    }, 2000);
                } catch (error) {
                    console.error('Download all error:', error);
                    downloadAllBtn.innerHTML = '<i class="fas fa-times mr-2"></i><span>Error</span>';
                    setTimeout(() => {
                        downloadAllBtn.disabled = false;
                        downloadAllBtn.innerHTML = originalHTML;
                    }, 2000);
                }
            });
        }
    })();

    // --- PHOTO ANGLE GENERATOR PRO LOGIC ---
    (function() {
        // DOM Elements
        const uploadArea = document.getElementById('pa-upload-area');
        const photoUpload = document.getElementById('pa-photo-upload');
        const photoPreview = document.getElementById('pa-photo-preview');
        const uploadPlaceholder = document.getElementById('pa-upload-placeholder');
        const presetRadios = document.querySelectorAll('input[name="pa-preset"]');
        const ratioBtns = document.querySelectorAll('.pa-ratio-btn');
        const generateBtn = document.getElementById('pa-generate-btn');
        const placeholder = document.getElementById('pa-placeholder');
        const loading = document.getElementById('pa-loading');
        const loadingText = document.getElementById('pa-loading-text');
        const progressBar = document.getElementById('pa-progress-bar');
        const progressText = document.getElementById('pa-progress-text');
        const resultsHeader = document.getElementById('pa-results-header');
        const resultsGrid = document.getElementById('pa-results-grid');
        const downloadAllBtn = document.getElementById('pa-download-all-btn');
        const errorMessage = document.getElementById('pa-error-message');
        const errorText = document.getElementById('pa-error-text');

        let uploadedImageBase64 = null;
        let uploadedMimeType = null;
        let selectedPreset = 'all';
        let selectedRatio = '1:1';
        let generatedImages = [];

        // Angle definitions for each preset
        const anglePresets = {
            all: [
                { name: 'Front View', prompt: 'front-facing view, direct frontal angle, centered composition' },
                { name: 'Side View', prompt: 'side profile view, 90-degree angle, showing the side' },
                { name: 'Top View', prompt: 'bird\'s eye view, top-down perspective, overhead angle' },
                { name: 'Bottom View', prompt: 'low angle view, looking up perspective, worm\'s eye view' },
                { name: '45¬∞ Angle', prompt: '45-degree angle view, three-quarter perspective, diagonal view' },
                { name: 'Back View', prompt: 'rear view, back-facing angle, showing the back' }
            ],
            product: [
                { name: '0¬∞ View', prompt: 'straight front view, product facing forward' },
                { name: '60¬∞ View', prompt: '60-degree rotation, slight right side visible' },
                { name: '120¬∞ View', prompt: '120-degree rotation, right side view' },
                { name: '180¬∞ View', prompt: '180-degree rotation, back view of product' },
                { name: '240¬∞ View', prompt: '240-degree rotation, left side view' },
                { name: '300¬∞ View', prompt: '300-degree rotation, slight left side visible' }
            ],
            portrait: [
                { name: 'Full Face', prompt: 'straight portrait, face directly to camera, front view' },
                { name: 'Left Profile', prompt: 'left side profile, face turned 90 degrees left' },
                { name: 'Right Profile', prompt: 'right side profile, face turned 90 degrees right' },
                { name: '3/4 Left', prompt: 'three-quarter left view, face slightly turned left' },
                { name: '3/4 Right', prompt: 'three-quarter right view, face slightly turned right' },
                { name: 'Looking Up', prompt: 'upward looking angle, chin up, looking towards camera above' }
            ]
        };

        // Upload area click handler
        if (uploadArea) {
            uploadArea.addEventListener('click', () => photoUpload.click());
        }

        // File upload handler
        if (photoUpload) {
            photoUpload.addEventListener('change', async (event) => {
                const file = event.target.files[0];
                if (!file) return;

                try {
                    // Handle HEIC conversion
                    let processedFile = file;
                    if (file.type === 'image/heic' || file.name.toLowerCase().endsWith('.heic')) {
                        if (typeof heic2any !== 'undefined') {
                            const convertedBlob = await heic2any({ blob: file, toType: 'image/jpeg' });
                            processedFile = new File([convertedBlob], file.name.replace(/\.heic$/i, '.jpg'), { type: 'image/jpeg' });
                        }
                    }

                    const reader = new FileReader();
                    reader.onload = (e) => {
                        uploadedImageBase64 = e.target.result.split(',')[1];
                        uploadedMimeType = processedFile.type;
                        photoPreview.src = e.target.result;
                        photoPreview.classList.remove('hidden');
                        uploadPlaceholder.classList.add('hidden');
                        generateBtn.disabled = false;
                    };
                    reader.readAsDataURL(processedFile);
                } catch (error) {
                    console.error('Error processing image:', error);
                    showError('Failed to process image. Please try another file.');
                }
            });
        }

        // Preset selection
        presetRadios.forEach(radio => {
            radio.addEventListener('change', (e) => {
                selectedPreset = e.target.value;
            });
        });

        // Aspect ratio selection
        ratioBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                ratioBtns.forEach(b => {
                    b.classList.remove('bg-cyan-600', 'text-white', 'ring-2', 'ring-cyan-400');
                    b.classList.add('bg-gray-200', 'text-gray-700');
                });
                btn.classList.remove('bg-gray-200', 'text-gray-700');
                btn.classList.add('bg-cyan-600', 'text-white', 'ring-2', 'ring-cyan-400');
                selectedRatio = btn.dataset.ratio;
            });
        });

        // Generate button
        if (generateBtn) {
            generateBtn.addEventListener('click', async () => {
                if (!uploadedImageBase64) {
                    showError('Please upload a photo first.');
                    return;
                }

                // Reset state
                generatedImages = [];
                generateBtn.disabled = true;
                placeholder.classList.add('hidden');
                loading.classList.remove('hidden');
                resultsHeader.classList.add('hidden');
                resultsGrid.classList.add('hidden');
                resultsGrid.innerHTML = '';
                errorMessage.classList.add('hidden');
                progressBar.style.width = '0%';
                progressText.textContent = '0/6 completed';

                try {
                    const angles = anglePresets[selectedPreset];
                    const totalAngles = angles.length;

                    for (let i = 0; i < totalAngles; i++) {
                        const angle = angles[i];
                        loadingText.textContent = `Generating ${angle.name}...`;

                        const imageUrl = await generateAngle(angle, uploadedImageBase64, uploadedMimeType);

                        if (imageUrl) {
                            const filename = `photo-angle-${selectedPreset}-${i + 1}.png`;
                            generatedImages.push({ url: imageUrl, filename, angleName: angle.name });

                            // Update progress
                            const progress = Math.round(((i + 1) / totalAngles) * 100);
                            progressBar.style.width = `${progress}%`;
                            progressText.textContent = `${i + 1}/${totalAngles} completed`;
                        }
                    }

                    // Display results
                    displayResults();
                    loading.classList.add('hidden');
                    resultsHeader.classList.remove('hidden');
                    resultsGrid.classList.remove('hidden');

                } catch (error) {
                    console.error('Generation error:', error);
                    showError(error.message || 'Failed to generate angles. Please try again.');
                    loading.classList.add('hidden');
                    placeholder.classList.remove('hidden');
                } finally {
                    generateBtn.disabled = false;
                }
            });
        }

        // Generate single angle
        async function generateAngle(angle, base64Data, mimeType) {
            const apiKey = "";
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-image-preview:generateContent?key=${apiKey}`;

            const prompt = `Transform this image to show a ${angle.prompt}.

            IMPORTANT INSTRUCTIONS:
            - Maintain the exact same subject, object, or person from the original image
            - Change ONLY the camera angle and perspective as specified
            - Keep all details, colors, lighting, and characteristics identical
            - DO NOT add or remove any elements
            - DO NOT change the background significantly
            - Make it look like the same photo taken from a different angle
            - Ensure professional photo quality
            - Keep the composition natural and realistic

            Generate a ${angle.prompt} of the exact same subject.`;

            const payload = {
                contents: [{
                    parts: [
                        { text: prompt },
                        { inlineData: { mimeType: mimeType, data: base64Data } }
                    ]
                }],
                generationConfig: {
                    responseModalities: ['IMAGE'],
                    imageConfig: { aspectRatio: selectedRatio }
                }
            };

            const maxRetries = 3;
            let delay = 1000;

            for (let attempt = 0; attempt < maxRetries; attempt++) {
                try {
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (!response.ok) {
                        if (response.status === 429 && attempt < maxRetries - 1) {
                            await new Promise(resolve => setTimeout(resolve, delay));
                            delay *= 2;
                            continue;
                        }
                        throw new Error(`API Error: ${response.status}`);
                    }

                    const result = await response.json();
                    const base64Image = result?.candidates?.[0]?.content?.parts?.find(p => p.inlineData)?.inlineData?.data;

                    if (base64Image) {
                        return `data:image/png;base64,${base64Image}`;
                    } else {
                        throw new Error('No image data in response');
                    }
                } catch (error) {
                    if (attempt === maxRetries - 1) throw error;
                    await new Promise(resolve => setTimeout(resolve, delay));
                    delay *= 2;
                }
            }
        }

        // Display results
        function displayResults() {
            resultsGrid.innerHTML = '';

            generatedImages.forEach((img, index) => {
                const card = document.createElement('div');
                card.className = 'relative group rounded-xl overflow-hidden shadow-lg hover:shadow-2xl transition-all duration-300 transform hover:scale-105';
                card.innerHTML = `
                    <img src="${img.url}" alt="${img.angleName}" class="w-full h-auto object-cover">
                    <div class="absolute top-2 left-2 bg-cyan-600 text-white text-xs px-3 py-1 rounded-full font-semibold shadow-lg">
                        ${img.angleName}
                    </div>
                    <div class="absolute inset-0 bg-gradient-to-t from-black/80 via-black/40 to-transparent opacity-0 group-hover:opacity-100 transition-all duration-300 flex items-end justify-center gap-2 p-4">
                        <button data-action="preview" data-index="${index}" class="action-btn flex items-center gap-2 bg-gradient-to-r from-cyan-500 to-blue-600 text-white px-4 py-2 rounded-full font-semibold shadow-lg hover:scale-105 transition-all">
                            <i class="fas fa-eye"></i>
                            <span class="hidden sm:inline">Preview</span>
                        </button>
                        <button data-action="download" data-index="${index}" class="action-btn flex items-center gap-2 bg-gradient-to-r from-green-500 to-green-600 text-white px-4 py-2 rounded-full font-semibold shadow-lg hover:scale-105 transition-all">
                            <i class="fas fa-download"></i>
                            <span class="hidden sm:inline">Download</span>
                        </button>
                    </div>
                `;
                resultsGrid.appendChild(card);
            });
        }

        // Event delegation for action buttons
        if (resultsGrid) {
            resultsGrid.addEventListener('click', async (e) => {
                e.stopPropagation();

                const actionBtn = e.target.classList.contains('action-btn') ?
                    e.target : e.target.closest('.action-btn[data-action]');
                if (!actionBtn) return;

                const action = actionBtn.dataset.action;
                const index = parseInt(actionBtn.dataset.index, 10);
                const imageData = generatedImages[index];

                if (!imageData) return;

                if (action === 'preview') {
                    if (window.showPreviewModal) {
                        window.showPreviewModal(imageData.url);
                    }
                } else if (action === 'download') {
                    if (window.downloadDataURINew) {
                        await window.downloadDataURINew(imageData.url, imageData.filename);
                    } else if (window.downloadImage) {
                        await window.downloadImage(imageData.url, imageData.filename);
                    }
                }
            });
        }

        // Download all button
        if (downloadAllBtn) {
            downloadAllBtn.addEventListener('click', async () => {
                if (generatedImages.length === 0) return;

                downloadAllBtn.disabled = true;
                downloadAllBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Downloading...';

                for (let i = 0; i < generatedImages.length; i++) {
                    const img = generatedImages[i];
                    if (window.downloadDataURINew) {
                        await window.downloadDataURINew(img.url, img.filename);
                    } else if (window.downloadImage) {
                        await window.downloadImage(img.url, img.filename);
                    }
                    if (i < generatedImages.length - 1) {
                        await new Promise(resolve => setTimeout(resolve, 500));
                    }
                }

                downloadAllBtn.disabled = false;
                downloadAllBtn.innerHTML = '<i class="fas fa-download mr-2"></i>Download All';
            });

            // Add mobile touch support
            if (window.addMobileTouchSupport) {
                window.addMobileTouchSupport(downloadAllBtn);
            }
        }

        // Show error function
        function showError(message) {
            errorText.textContent = message;
            errorMessage.classList.remove('hidden');
            setTimeout(() => {
                errorMessage.classList.add('hidden');
            }, 5000);
        }
    })();

    // --- PHOTO STYLE MATCHER PRO LOGIC ---
    (function() {
        // DOM Elements
        const yourUploadArea = document.getElementById('sm-your-upload-area');
        const yourPhoto = document.getElementById('sm-your-photo');
        const yourPreview = document.getElementById('sm-your-preview');
        const yourPlaceholder = document.getElementById('sm-your-placeholder');

        const refUploadArea = document.getElementById('sm-ref-upload-area');
        const refPhoto = document.getElementById('sm-ref-photo');
        const refPreview = document.getElementById('sm-ref-preview');
        const refPlaceholder = document.getElementById('sm-ref-placeholder');

        const strengthRadios = document.querySelectorAll('input[name="sm-strength"]');
        const ratioBtns = document.querySelectorAll('.sm-ratio-btn');
        const generateBtn = document.getElementById('sm-generate-btn');

        const placeholder = document.getElementById('sm-placeholder');
        const loading = document.getElementById('sm-loading');
        const loadingText = document.getElementById('sm-loading-text');
        const progressBar = document.getElementById('sm-progress-bar');
        const progressText = document.getElementById('sm-progress-text');

        const resultsHeader = document.getElementById('sm-results-header');
        const resultsGrid = document.getElementById('sm-results-grid');
        const compareBtn = document.getElementById('sm-compare-btn');
        const downloadAllBtn = document.getElementById('sm-download-all-btn');

        const comparisonModal = document.getElementById('sm-comparison-modal');
        const closeComparison = document.getElementById('sm-close-comparison');
        const comparisonOriginal = document.getElementById('sm-comparison-original');
        const comparisonStyled = document.getElementById('sm-comparison-styled');

        const errorMessage = document.getElementById('sm-error-message');
        const errorText = document.getElementById('sm-error-text');

        let yourImageBase64 = null;
        let yourImageMimeType = null;
        let refImageBase64 = null;
        let refImageMimeType = null;
        let selectedStrength = 'moderate';
        let selectedRatio = '1:1';
        let generatedImages = [];

        // Style strength variations
        const strengthVariations = {
            subtle: [
                { name: 'Var 1', weight: 0.2 },
                { name: 'Var 2', weight: 0.25 },
                { name: 'Var 3', weight: 0.3 },
                { name: 'Var 4', weight: 0.35 },
                { name: 'Var 5', weight: 0.4 },
                { name: 'Var 6', weight: 0.45 }
            ],
            moderate: [
                { name: 'Var 1', weight: 0.4 },
                { name: 'Var 2', weight: 0.5 },
                { name: 'Var 3', weight: 0.6 },
                { name: 'Var 4', weight: 0.65 },
                { name: 'Var 5', weight: 0.7 },
                { name: 'Var 6', weight: 0.75 }
            ],
            strong: [
                { name: 'Var 1', weight: 0.7 },
                { name: 'Var 2', weight: 0.75 },
                { name: 'Var 3', weight: 0.8 },
                { name: 'Var 4', weight: 0.85 },
                { name: 'Var 5', weight: 0.9 },
                { name: 'Var 6', weight: 0.95 }
            ]
        };

        // Your photo upload
        if (yourUploadArea) {
            yourUploadArea.addEventListener('click', () => yourPhoto.click());
        }

        if (yourPhoto) {
            yourPhoto.addEventListener('change', async (event) => {
                const file = event.target.files[0];
                if (!file) return;

                try {
                    let processedFile = file;
                    if (file.type === 'image/heic' || file.name.toLowerCase().endsWith('.heic')) {
                        if (typeof heic2any !== 'undefined') {
                            const convertedBlob = await heic2any({ blob: file, toType: 'image/jpeg' });
                            processedFile = new File([convertedBlob], file.name.replace(/\.heic$/i, '.jpg'), { type: 'image/jpeg' });
                        }
                    }

                    const reader = new FileReader();
                    reader.onload = (e) => {
                        yourImageBase64 = e.target.result.split(',')[1];
                        yourImageMimeType = processedFile.type;
                        yourPreview.src = e.target.result;
                        yourPreview.classList.remove('hidden');
                        yourPlaceholder.classList.add('hidden');
                        checkReadyToGenerate();
                    };
                    reader.readAsDataURL(processedFile);
                } catch (error) {
                    console.error('Error processing your image:', error);
                    showError('Failed to process your photo. Please try another file.');
                }
            });
        }

        // Reference photo upload
        if (refUploadArea) {
            refUploadArea.addEventListener('click', () => refPhoto.click());
        }

        if (refPhoto) {
            refPhoto.addEventListener('change', async (event) => {
                const file = event.target.files[0];
                if (!file) return;

                try {
                    let processedFile = file;
                    if (file.type === 'image/heic' || file.name.toLowerCase().endsWith('.heic')) {
                        if (typeof heic2any !== 'undefined') {
                            const convertedBlob = await heic2any({ blob: file, toType: 'image/jpeg' });
                            processedFile = new File([convertedBlob], file.name.replace(/\.heic$/i, '.jpg'), { type: 'image/jpeg' });
                        }
                    }

                    const reader = new FileReader();
                    reader.onload = (e) => {
                        refImageBase64 = e.target.result.split(',')[1];
                        refImageMimeType = processedFile.type;
                        refPreview.src = e.target.result;
                        refPreview.classList.remove('hidden');
                        refPlaceholder.classList.add('hidden');
                        checkReadyToGenerate();
                    };
                    reader.readAsDataURL(processedFile);
                } catch (error) {
                    console.error('Error processing reference image:', error);
                    showError('Failed to process reference photo. Please try another file.');
                }
            });
        }

        // Strength selection
        strengthRadios.forEach(radio => {
            radio.addEventListener('change', (e) => {
                selectedStrength = e.target.value;
            });
        });

        // Aspect ratio selection
        ratioBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                ratioBtns.forEach(b => {
                    b.classList.remove('bg-pink-600', 'text-white', 'ring-2', 'ring-pink-400');
                    b.classList.add('bg-gray-200', 'text-gray-700');
                });
                btn.classList.remove('bg-gray-200', 'text-gray-700');
                btn.classList.add('bg-pink-600', 'text-white', 'ring-2', 'ring-pink-400');
                selectedRatio = btn.dataset.ratio;
            });
        });

        // Check if ready to generate
        function checkReadyToGenerate() {
            if (yourImageBase64 && refImageBase64) {
                generateBtn.disabled = false;
            }
        }

        // Generate button
        if (generateBtn) {
            generateBtn.addEventListener('click', async () => {
                if (!yourImageBase64 || !refImageBase64) {
                    showError('Please upload both your photo and reference photo.');
                    return;
                }

                // Reset state
                generatedImages = [];
                generateBtn.disabled = true;
                placeholder.classList.add('hidden');
                loading.classList.remove('hidden');
                resultsHeader.classList.add('hidden');
                resultsGrid.classList.add('hidden');
                resultsGrid.innerHTML = '';
                errorMessage.classList.add('hidden');
                progressBar.style.width = '0%';
                progressText.textContent = '0/6 completed';

                try {
                    const variations = strengthVariations[selectedStrength];
                    const totalVariations = variations.length;

                    for (let i = 0; i < totalVariations; i++) {
                        const variation = variations[i];
                        loadingText.textContent = `Generating ${variation.name} (${Math.round(variation.weight * 100)}% style)...`;

                        const imageUrl = await generateStyleMatch(variation);

                        if (imageUrl) {
                            const filename = `style-match-${selectedStrength}-${i + 1}.png`;
                            generatedImages.push({
                                url: imageUrl,
                                filename,
                                variationName: variation.name,
                                weight: variation.weight
                            });

                            // Update progress
                            const progress = Math.round(((i + 1) / totalVariations) * 100);
                            progressBar.style.width = `${progress}%`;
                            progressText.textContent = `${i + 1}/${totalVariations} completed`;
                        }
                    }

                    // Display results
                    displayResults();
                    loading.classList.add('hidden');
                    resultsHeader.classList.remove('hidden');
                    resultsGrid.classList.remove('hidden');

                } catch (error) {
                    console.error('Generation error:', error);
                    showError(error.message || 'Failed to match style. Please try again.');
                    loading.classList.add('hidden');
                    placeholder.classList.remove('hidden');
                } finally {
                    generateBtn.disabled = false;
                    checkReadyToGenerate();
                }
            });
        }

        // Generate style match
        async function generateStyleMatch(variation) {
            const apiKey = "";
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-image-preview:generateContent?key=${apiKey}`;

            const styleWeight = Math.round(variation.weight * 100);

            const prompt = `Transform the subject from image 1 to match the visual style, aesthetics, and mood of image 2.

STYLE TRANSFER INSTRUCTIONS:
- Image 1: The subject/person to be styled
- Image 2: The reference style to copy

APPLY THESE STYLE ELEMENTS FROM IMAGE 2:
1. **Color Grading**: Match the exact color tones, saturation, temperature, and color palette
2. **Lighting Style**: Copy the lighting direction, intensity, softness/hardness, and shadows
3. **Contrast & Exposure**: Match the overall brightness, contrast levels, and dynamic range
4. **Mood & Atmosphere**: Replicate the emotional feel and vibe
5. **Post-Processing**: Apply similar filters, grain, vignetting, or effects
6. **Composition Style**: Maintain similar framing and depth of field if applicable

IMPORTANT RULES:
- Keep the subject/person from Image 1 EXACTLY the same (face, body, pose)
- DO NOT change the subject's identity, just the photo style
- Apply ${styleWeight}% of the reference style intensity
- Maintain photo realism and natural look
- The result should look like Image 1's subject photographed in Image 2's style
- DO NOT merge or blend the two images
- Focus on color grading, lighting, and post-processing transfer

Generate a photo of the subject from Image 1 with the visual style of Image 2 applied.`;

            const payload = {
                contents: [{
                    parts: [
                        { text: prompt },
                        { inlineData: { mimeType: yourImageMimeType, data: yourImageBase64 } },
                        { inlineData: { mimeType: refImageMimeType, data: refImageBase64 } }
                    ]
                }],
                generationConfig: {
                    responseModalities: ['IMAGE'],
                    imageConfig: { aspectRatio: selectedRatio }
                }
            };

            const maxRetries = 3;
            let delay = 1000;

            for (let attempt = 0; attempt < maxRetries; attempt++) {
                try {
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (!response.ok) {
                        if (response.status === 429 && attempt < maxRetries - 1) {
                            await new Promise(resolve => setTimeout(resolve, delay));
                            delay *= 2;
                            continue;
                        }
                        throw new Error(`API Error: ${response.status}`);
                    }

                    const result = await response.json();
                    const base64Image = result?.candidates?.[0]?.content?.parts?.find(p => p.inlineData)?.inlineData?.data;

                    if (base64Image) {
                        return `data:image/png;base64,${base64Image}`;
                    } else {
                        throw new Error('No image data in response');
                    }
                } catch (error) {
                    if (attempt === maxRetries - 1) throw error;
                    await new Promise(resolve => setTimeout(resolve, delay));
                    delay *= 2;
                }
            }
        }

        // Display results
        function displayResults() {
            resultsGrid.innerHTML = '';

            generatedImages.forEach((img, index) => {
                const card = document.createElement('div');
                card.className = 'relative group rounded-xl overflow-hidden shadow-lg hover:shadow-2xl transition-all duration-300 transform hover:scale-105';
                card.innerHTML = `
                    <img src="${img.url}" alt="${img.variationName}" class="w-full h-auto object-cover">
                    <div class="absolute top-2 left-2 bg-gradient-to-r from-pink-500 to-purple-600 text-white text-xs px-3 py-1 rounded-full font-semibold shadow-lg">
                        ${img.variationName} (${Math.round(img.weight * 100)}%)
                    </div>
                    <div class="absolute inset-0 bg-gradient-to-t from-black/80 via-black/40 to-transparent opacity-0 group-hover:opacity-100 transition-all duration-300 flex items-end justify-center gap-2 p-4">
                        <button data-action="preview" data-index="${index}" class="action-btn flex items-center gap-2 bg-gradient-to-r from-cyan-500 to-blue-600 text-white px-4 py-2 rounded-full font-semibold shadow-lg hover:scale-105 transition-all">
                            <i class="fas fa-eye"></i>
                            <span class="hidden sm:inline">Preview</span>
                        </button>
                        <button data-action="compare" data-index="${index}" class="action-btn flex items-center gap-2 bg-gradient-to-r from-purple-500 to-indigo-600 text-white px-4 py-2 rounded-full font-semibold shadow-lg hover:scale-105 transition-all">
                            <i class="fas fa-columns"></i>
                            <span class="hidden sm:inline">Compare</span>
                        </button>
                        <button data-action="download" data-index="${index}" class="action-btn flex items-center gap-2 bg-gradient-to-r from-green-500 to-green-600 text-white px-4 py-2 rounded-full font-semibold shadow-lg hover:scale-105 transition-all">
                            <i class="fas fa-download"></i>
                            <span class="hidden sm:inline">Download</span>
                        </button>
                    </div>
                `;
                resultsGrid.appendChild(card);
            });
        }

        // Event delegation for action buttons
        if (resultsGrid) {
            resultsGrid.addEventListener('click', async (e) => {
                e.stopPropagation();

                const actionBtn = e.target.classList.contains('action-btn') ?
                    e.target : e.target.closest('.action-btn[data-action]');
                if (!actionBtn) return;

                const action = actionBtn.dataset.action;
                const index = parseInt(actionBtn.dataset.index, 10);
                const imageData = generatedImages[index];

                if (!imageData) return;

                if (action === 'preview') {
                    if (window.showPreviewModal) {
                        window.showPreviewModal(imageData.url);
                    }
                } else if (action === 'compare') {
                    showComparison(imageData);
                } else if (action === 'download') {
                    if (window.downloadDataURINew) {
                        await window.downloadDataURINew(imageData.url, imageData.filename);
                    } else if (window.downloadImage) {
                        await window.downloadImage(imageData.url, imageData.filename);
                    }
                }
            });
        }

        // Compare button (show first variation)
        if (compareBtn) {
            compareBtn.addEventListener('click', () => {
                if (generatedImages.length > 0) {
                    showComparison(generatedImages[0]);
                }
            });
        }

        // Show comparison modal
        function showComparison(imageData) {
            comparisonOriginal.src = yourPreview.src;
            comparisonStyled.src = imageData.url;
            comparisonModal.classList.remove('hidden');
        }

        // Close comparison
        if (closeComparison) {
            closeComparison.addEventListener('click', () => {
                comparisonModal.classList.add('hidden');
            });
        }

        if (comparisonModal) {
            comparisonModal.addEventListener('click', (e) => {
                if (e.target === comparisonModal) {
                    comparisonModal.classList.add('hidden');
                }
            });
        }

        // Download all button
        if (downloadAllBtn) {
            downloadAllBtn.addEventListener('click', async () => {
                if (generatedImages.length === 0) return;

                downloadAllBtn.disabled = true;
                downloadAllBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Downloading...';

                for (let i = 0; i < generatedImages.length; i++) {
                    const img = generatedImages[i];
                    if (window.downloadDataURINew) {
                        await window.downloadDataURINew(img.url, img.filename);
                    } else if (window.downloadImage) {
                        await window.downloadImage(img.url, img.filename);
                    }
                    if (i < generatedImages.length - 1) {
                        await new Promise(resolve => setTimeout(resolve, 500));
                    }
                }

                downloadAllBtn.disabled = false;
                downloadAllBtn.innerHTML = '<i class="fas fa-download mr-2"></i>Download All';
            });

            // Add mobile touch support
            if (window.addMobileTouchSupport) {
                window.addMobileTouchSupport(downloadAllBtn);
            }
        }

        // Show error function
        function showError(message) {
            errorText.textContent = message;
            errorMessage.classList.remove('hidden');
            setTimeout(() => {
                errorMessage.classList.add('hidden');
            }, 5000);
        }
    })();

    // --- THUMBNAIL GENERATOR PRO LOGIC ---
    (function() {
        // DOM Elements
        const modeReferenceBtn = document.getElementById('tg-mode-reference');
        const modeTextBtn = document.getElementById('tg-mode-text');
        const referencePanel = document.getElementById('tg-reference-panel');
        const textPanel = document.getElementById('tg-text-panel');

        const refUploadArea = document.getElementById('tg-ref-upload-area');
        const refPhoto = document.getElementById('tg-ref-photo');
        const refPreview = document.getElementById('tg-ref-preview');
        const refPlaceholder = document.getElementById('tg-ref-placeholder');
        const refCustomInstructions = document.getElementById('tg-ref-custom-instructions');

        const titleInput = document.getElementById('tg-title-input');
        const subtitleInput = document.getElementById('tg-subtitle-input');
        const styleSelect = document.getElementById('tg-style-select');
        const expressionSelect = document.getElementById('tg-expression-select');
        const categorySelect = document.getElementById('tg-category-select');
        const generateBtn = document.getElementById('tg-generate-btn');
        const countSelection = document.getElementById('tg-count-selection');
        const countText = document.getElementById('tg-count-text');
        const resultsCount = document.getElementById('tg-results-count');

        const placeholder = document.getElementById('tg-placeholder');
        const loading = document.getElementById('tg-loading');
        const loadingText = document.getElementById('tg-loading-text');
        const progressBar = document.getElementById('tg-progress-bar');
        const progressText = document.getElementById('tg-progress-text');

        const resultsHeader = document.getElementById('tg-results-header');
        const resultsGrid = document.getElementById('tg-results-grid');
        const downloadAllBtn = document.getElementById('tg-download-all-btn');

        const errorMessage = document.getElementById('tg-error-message');
        const errorText = document.getElementById('tg-error-text');

        let currentMode = 'reference';
        let refImageBase64 = null;
        let refImageMimeType = null;
        let selectedCount = 6;
        let generatedImages = [];

        // Category to aspect ratio mapping
        const categoryRatios = {
            youtube: '16:9',
            instagram: '1:1',
            story: '9:16',
            facebook: '16:9',
            twitter: '16:9'
        };

        // Expression/Vibe descriptions
        const expressionDescriptions = {
            shocked: 'dengan ekspresi shocked/surprised, mata terbuka lebar, mulut terbuka, gesture kaget',
            excited: 'dengan ekspresi excited/amazed, sangat antusias, energi tinggi, gesture bersemangat',
            serious: 'dengan ekspresi serious/professional, tatapan tajam, pose percaya diri',
            happy: 'dengan ekspresi happy/cheerful, senyum lebar, vibe positif dan ceria',
            dramatic: 'dengan ekspresi dramatic/intense, gesture dramatis, lighting dramatis',
            mysterious: 'dengan ekspresi mysterious/intriguing, pose misterius, vibe penasaran',
            energetic: 'dengan vibe energetic/dynamic, penuh energi, komposisi dinamis',
            calm: 'dengan ekspresi calm/peaceful, damai, relaxed, vibe tenang'
        };

        // Style templates for text-based mode
        const styleTemplates = {
            tech: {
                colors: ['neon blue', 'electric purple', 'cyber pink'],
                mood: 'futuristic, high-tech, gaming aesthetic',
                elements: 'glowing effects, digital elements, tech patterns'
            },
            business: {
                colors: ['professional blue', 'corporate gray', 'gold accents'],
                mood: 'professional, trustworthy, corporate',
                elements: 'clean lines, minimalist design, business icons'
            },
            vlog: {
                colors: ['vibrant colors', 'warm tones', 'pastel highlights'],
                mood: 'fun, energetic, lifestyle vibes',
                elements: 'dynamic composition, expressive elements'
            },
            tutorial: {
                colors: ['clear colors', 'educational blue', 'white space'],
                mood: 'educational, clear, informative',
                elements: 'arrows, steps, clean layout, readable text'
            },
            dramatic: {
                colors: ['bold red', 'dramatic yellow', 'high contrast black'],
                mood: 'attention-grabbing, clickbait, dramatic',
                elements: 'arrows, exclamation marks, intense expressions, bold shadows'
            },
            minimal: {
                colors: ['monochrome', 'elegant gray', 'subtle accents'],
                mood: 'modern, elegant, sophisticated',
                elements: 'clean space, minimalist typography, geometric shapes'
            }
        };

        // Mode switching
        if (modeReferenceBtn && modeTextBtn) {
            modeReferenceBtn.addEventListener('click', () => {
                currentMode = 'reference';
                modeReferenceBtn.classList.remove('bg-gray-200', 'text-gray-700');
                modeReferenceBtn.classList.add('bg-gradient-to-r', 'from-red-500', 'to-orange-500', 'text-white', 'shadow-lg');
                modeTextBtn.classList.remove('bg-gradient-to-r', 'from-red-500', 'to-orange-500', 'text-white', 'shadow-lg');
                modeTextBtn.classList.add('bg-gray-200', 'text-gray-700');
                referencePanel.classList.remove('hidden');
                textPanel.classList.add('hidden');
                checkReadyToGenerate();
            });

            modeTextBtn.addEventListener('click', () => {
                currentMode = 'text';
                modeTextBtn.classList.remove('bg-gray-200', 'text-gray-700');
                modeTextBtn.classList.add('bg-gradient-to-r', 'from-red-500', 'to-orange-500', 'text-white', 'shadow-lg');
                modeReferenceBtn.classList.remove('bg-gradient-to-r', 'from-red-500', 'to-orange-500', 'text-white', 'shadow-lg');
                modeReferenceBtn.classList.add('bg-gray-200', 'text-gray-700');
                referencePanel.classList.add('hidden');
                textPanel.classList.remove('hidden');
                checkReadyToGenerate();
            });
        }

        // Reference upload
        if (refUploadArea) {
            refUploadArea.addEventListener('click', () => refPhoto.click());
        }

        if (refPhoto) {
            refPhoto.addEventListener('change', async (event) => {
                const file = event.target.files[0];
                if (!file) return;

                try {
                    let processedFile = file;
                    if (file.type === 'image/heic' || file.name.toLowerCase().endsWith('.heic')) {
                        if (typeof heic2any !== 'undefined') {
                            const convertedBlob = await heic2any({ blob: file, toType: 'image/jpeg' });
                            processedFile = new File([convertedBlob], file.name.replace(/\.heic$/i, '.jpg'), { type: 'image/jpeg' });
                        }
                    }

                    const reader = new FileReader();
                    reader.onload = (e) => {
                        refImageBase64 = e.target.result.split(',')[1];
                        refImageMimeType = processedFile.type;
                        refPreview.src = e.target.result;
                        refPreview.classList.remove('hidden');
                        refPlaceholder.classList.add('hidden');
                        checkReadyToGenerate();
                    };
                    reader.readAsDataURL(processedFile);
                } catch (error) {
                    console.error('Error processing reference image:', error);
                    showError('Failed to process image. Please try another file.');
                }
            });
        }

        // Text inputs
        if (titleInput) {
            titleInput.addEventListener('input', checkReadyToGenerate);
        }

        // Handle count selection
        if (countSelection) {
            countSelection.addEventListener('click', (e) => {
                const button = e.target.closest('[data-count]');
                if (button) {
                    document.querySelectorAll('.tg-count-btn').forEach(btn => {
                        btn.classList.remove('tg-count-selected', 'bg-gradient-to-r', 'from-pink-500', 'to-rose-500', 'text-white', 'border-pink-500', 'font-bold', 'shadow-md');
                        btn.classList.add('bg-gray-50', 'hover:bg-gray-100', 'text-gray-700', 'border-gray-300', 'font-medium');
                    });
                    button.classList.remove('bg-gray-50', 'hover:bg-gray-100', 'text-gray-700', 'border-gray-300', 'font-medium');
                    button.classList.add('tg-count-selected', 'bg-gradient-to-r', 'from-pink-500', 'to-rose-500', 'text-white', 'border-pink-500', 'font-bold', 'shadow-md');
                    selectedCount = parseInt(button.dataset.count, 10);
                    if (countText) countText.textContent = selectedCount;
                }
            });
        }

        // Check if ready to generate
        function checkReadyToGenerate() {
            if (currentMode === 'reference') {
                generateBtn.disabled = !refImageBase64;
            } else {
                generateBtn.disabled = !titleInput.value.trim();
            }
        }

        // Generate button
        if (generateBtn) {
            generateBtn.addEventListener('click', async () => {
                if (currentMode === 'reference' && !refImageBase64) {
                    showError('Please upload a reference image.');
                    return;
                }

                if (currentMode === 'text' && !titleInput.value.trim()) {
                    showError('Please enter a thumbnail title.');
                    return;
                }

                // Reset state
                generatedImages = [];
                generateBtn.disabled = true;
                placeholder.classList.add('hidden');
                loading.classList.remove('hidden');
                resultsHeader.classList.add('hidden');
                resultsGrid.classList.add('hidden');
                resultsGrid.innerHTML = '';
                errorMessage.classList.add('hidden');
                progressBar.style.width = '0%';
                progressText.textContent = `0/${selectedCount} completed`;

                try {
                    for (let i = 0; i < selectedCount; i++) {
                        loadingText.textContent = `Generating thumbnail ${i + 1}/${selectedCount}...`;

                        const imageUrl = await generateThumbnail(i);

                        if (imageUrl) {
                            const filename = `thumbnail-${Date.now()}-${i + 1}.png`;
                            generatedImages.push({ url: imageUrl, filename, variation: i + 1 });

                            // Update progress
                            const progress = Math.round(((i + 1) / selectedCount) * 100);
                            progressBar.style.width = `${progress}%`;
                            progressText.textContent = `${i + 1}/${selectedCount} completed`;
                        }
                    }

                    // Display results
                    displayResults();
                    if (resultsCount) resultsCount.textContent = generatedImages.length;
                    loading.classList.add('hidden');
                    resultsHeader.classList.remove('hidden');
                    resultsGrid.classList.remove('hidden');

                } catch (error) {
                    console.error('Generation error:', error);
                    showError(error.message || 'Failed to generate thumbnails. Please try again.');
                    loading.classList.add('hidden');
                    placeholder.classList.remove('hidden');
                } finally {
                    generateBtn.disabled = false;
                    checkReadyToGenerate();
                }
            });
        }

        // Generate thumbnail
        async function generateThumbnail(variationIndex) {
            const apiKey = "";
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-image-preview:generateContent?key=${apiKey}`;

            const category = categorySelect.value;
            const aspectRatio = categoryRatios[category];

            let prompt;

            if (currentMode === 'reference') {
                // Reference-based mode
                const customInstructions = refCustomInstructions?.value.trim() || '';
                const selectedExpression = expressionSelect?.value || '';
                const expressionText = selectedExpression ? expressionDescriptions[selectedExpression] : '';

                prompt = `Buat thumbnail profesional yang eye-catching untuk platform ${category} (rasio ${aspectRatio}) berdasarkan gambar referensi ini.

PERSYARATAN THUMBNAIL:
- Buatlah sangat menarik perhatian dan clickable (CTR tinggi)
- Teks BESAR, BOLD, dan mudah dibaca bahkan di ukuran kecil
- Warna kontras tinggi untuk visibilitas maksimal
- Komposisi dinamis dengan hierarki visual yang kuat
- Kualitas profesional tapi dioptimalkan untuk platform ${category}
- Variasi ${variationIndex + 1}: Gunakan skema warna, layout teks, atau penekanan visual yang berbeda

${expressionText ? `EKSPRESI/VIBE:\n- ${expressionText}\n` : ''}

ELEMEN DESAIN YANG HARUS DISERTAKAN:
- Focal point yang jelas dan menarik mata
- Warna vibrant dan saturated (hindari warna yang kusam)
- Kontras kuat antara teks dan background
- Tipografi profesional dengan drop shadow atau outline untuk readability
- Komposisi bersih, tidak berantakan
- Desain mobile-friendly (teks terbaca di layar kecil)
- Gunakan efek visual modern (glow, shadows, gradients) untuk membuat lebih menarik

OPTIMASI PLATFORM ${category.toUpperCase()}:
${category === 'youtube' ? '- Style YouTube: Teks bold dramatis, ekspresi wajah ekspresif, 3-second rule (langsung paham dalam 3 detik)\n- Target CTR tinggi dengan komposisi yang powerful' : ''}
${category === 'instagram' ? '- Style Instagram: Estetik trendy, visually appealing, feed-friendly\n- Gunakan warna dan komposisi yang Instagram-worthy' : ''}
${category === 'story' ? '- Format Story: Orientasi vertikal, thumb-stopping content, cepat dipahami\n- Desain untuk mobile viewing experience' : ''}
${category === 'facebook' ? '- Style Facebook: Engaging, shareable, social media optimized\n- Fokus pada clarity dan immediate impact' : ''}
${category === 'twitter' ? '- Style Twitter Card: Compact, informative, eye-catching\n- Maksimalkan space dengan layout efisien' : ''}

${customInstructions ? `INSTRUKSI CUSTOM DARI USER:\n${customInstructions}\n` : ''}

PENTING: Pastikan hasil akhir adalah thumbnail yang akan membuat orang INGIN mengklik. Gunakan prinsip-prinsip clickability maksimal!`;

                const payload = {
                    contents: [{
                        parts: [
                            { text: prompt },
                            { inlineData: { mimeType: refImageMimeType, data: refImageBase64 } }
                        ]
                    }],
                    generationConfig: {
                        responseModalities: ['IMAGE'],
                        imageConfig: { aspectRatio: aspectRatio }
                    }
                };

                return await callGeminiAPI(apiUrl, payload);

            } else {
                // Text-based mode
                const title = titleInput.value.trim();
                const subtitle = subtitleInput.value.trim();
                const style = styleSelect.value;
                const styleTemplate = styleTemplates[style];
                const selectedExpression = expressionSelect?.value || '';
                const expressionText = selectedExpression ? expressionDescriptions[selectedExpression] : '';

                prompt = `Buat thumbnail profesional yang eye-catching untuk platform ${category} (rasio ${aspectRatio}) dengan spesifikasi berikut:

JUDUL UTAMA (HARUS MENONJOL): "${title}"
${subtitle ? `SUBJUDUL: "${subtitle}"` : ''}

STYLE: ${style.toUpperCase()}
- Skema Warna: ${styleTemplate.colors.join(', ')}
- Mood: ${styleTemplate.mood}
- Elemen Desain: ${styleTemplate.elements}

${expressionText ? `EKSPRESI/VIBE:\n- ${expressionText}\n` : ''}

PERSYARATAN DESAIN THUMBNAIL:
- Buat teks judul SANGAT BESAR, BOLD, dan MUDAH DIBACA
- Gunakan warna KONTRAS TINGGI (teks harus menonjol dari background)
- Aplikasikan drop shadow atau outline pada teks untuk readability maksimal
- Buat komposisi DINAMIS dan menarik perhatian
- Sertakan elemen visual relevan yang mendukung judul
- Tampilan PROFESIONAL dan CLICKABLE
- Optimasi untuk mobile viewing (teks terbaca di ukuran thumbnail)
- Variasi ${variationIndex + 1}: Gunakan layout, kombinasi warna, atau style visual yang berbeda

PENEMPATAN TEKS:
- Posisikan teks di area paling visible
- Gunakan background colors atau shapes yang komplementer di belakang teks
- Pastikan teks tidak bersaing dengan elemen background
- Buat hierarki visual yang jelas (judul > subjudul > elemen lain)

OPTIMASI PLATFORM ${category.toUpperCase()}:
${category === 'youtube' ? '- Style YouTube: Bold dramatis, clickbait-worthy tapi tetap profesional, expressive\n- Target CTR tinggi dengan komposisi powerful' : ''}
${category === 'instagram' ? '- Style Instagram: Estetik trendy, visually appealing, feed-friendly\n- Gunakan warna dan komposisi Instagram-worthy' : ''}
${category === 'story' ? '- Format Story: Vertikal, thumb-stopping, cepat dipahami\n- Desain untuk mobile viewing experience' : ''}
${category === 'facebook' ? '- Style Facebook: Engaging, shareable, social media optimized' : ''}
${category === 'twitter' ? '- Style Twitter Card: Compact, informative, eye-catching' : ''}

PENTING: Buat thumbnail yang akan memaksimalkan klik dan engagement. Teks "${title}" HARUS menjadi elemen paling menonjol!`;

                const payload = {
                    contents: [{
                        parts: [{ text: prompt }]
                    }],
                    generationConfig: {
                        responseModalities: ['IMAGE'],
                        imageConfig: { aspectRatio: aspectRatio }
                    }
                };

                return await callGeminiAPI(apiUrl, payload);
            }
        }

        // Call Gemini API with retry
        async function callGeminiAPI(apiUrl, payload) {
            const maxRetries = 3;
            let delay = 1000;

            for (let attempt = 0; attempt < maxRetries; attempt++) {
                try {
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (!response.ok) {
                        if (response.status === 429 && attempt < maxRetries - 1) {
                            await new Promise(resolve => setTimeout(resolve, delay));
                            delay *= 2;
                            continue;
                        }
                        throw new Error(`API Error: ${response.status}`);
                    }

                    const result = await response.json();
                    const base64Image = result?.candidates?.[0]?.content?.parts?.find(p => p.inlineData)?.inlineData?.data;

                    if (base64Image) {
                        return `data:image/png;base64,${base64Image}`;
                    } else {
                        throw new Error('No image data in response');
                    }
                } catch (error) {
                    if (attempt === maxRetries - 1) throw error;
                    await new Promise(resolve => setTimeout(resolve, delay));
                    delay *= 2;
                }
            }
        }

        // Display results
        function displayResults() {
            resultsGrid.innerHTML = '';

            generatedImages.forEach((img, index) => {
                const card = document.createElement('div');
                card.className = 'relative group rounded-xl overflow-hidden shadow-lg hover:shadow-2xl transition-all duration-300 transform hover:scale-105';
                card.innerHTML = `
                    <img src="${img.url}" alt="Thumbnail ${img.variation}" class="w-full h-auto object-cover">
                    <div class="absolute top-2 left-2 bg-gradient-to-r from-red-500 to-orange-500 text-white text-xs px-3 py-1 rounded-full font-semibold shadow-lg">
                        Variation ${img.variation}
                    </div>
                    <div class="absolute inset-0 bg-gradient-to-t from-black/80 via-black/40 to-transparent opacity-0 group-hover:opacity-100 transition-all duration-300 flex items-end justify-center gap-2 p-4">
                        <button data-action="preview" data-index="${index}" class="action-btn flex items-center gap-2 bg-gradient-to-r from-cyan-500 to-blue-600 text-white px-4 py-2 rounded-full font-semibold shadow-lg hover:scale-105 transition-all">
                            <i class="fas fa-eye"></i>
                            <span class="hidden sm:inline">Preview</span>
                        </button>
                        <button data-action="download" data-index="${index}" class="action-btn flex items-center gap-2 bg-gradient-to-r from-green-500 to-green-600 text-white px-4 py-2 rounded-full font-semibold shadow-lg hover:scale-105 transition-all">
                            <i class="fas fa-download"></i>
                            <span class="hidden sm:inline">Download</span>
                        </button>
                    </div>
                `;
                resultsGrid.appendChild(card);
            });
        }

        // Event delegation for action buttons
        if (resultsGrid) {
            resultsGrid.addEventListener('click', async (e) => {
                e.stopPropagation();

                const actionBtn = e.target.classList.contains('action-btn') ?
                    e.target : e.target.closest('.action-btn[data-action]');
                if (!actionBtn) return;

                const action = actionBtn.dataset.action;
                const index = parseInt(actionBtn.dataset.index, 10);
                const imageData = generatedImages[index];

                if (!imageData) return;

                if (action === 'preview') {
                    if (window.showPreviewModal) {
                        window.showPreviewModal(imageData.url);
                    }
                } else if (action === 'download') {
                    if (window.downloadDataURINew) {
                        await window.downloadDataURINew(imageData.url, imageData.filename);
                    } else if (window.downloadImage) {
                        await window.downloadImage(imageData.url, imageData.filename);
                    }
                }
            });
        }

        // Download all button
        if (downloadAllBtn) {
            downloadAllBtn.addEventListener('click', async () => {
                if (generatedImages.length === 0) return;

                downloadAllBtn.disabled = true;
                downloadAllBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Downloading...';

                for (let i = 0; i < generatedImages.length; i++) {
                    const img = generatedImages[i];
                    if (window.downloadDataURINew) {
                        await window.downloadDataURINew(img.url, img.filename);
                    } else if (window.downloadImage) {
                        await window.downloadImage(img.url, img.filename);
                    }
                    if (i < generatedImages.length - 1) {
                        await new Promise(resolve => setTimeout(resolve, 500));
                    }
                }

                downloadAllBtn.disabled = false;
                downloadAllBtn.innerHTML = '<i class="fas fa-download mr-2"></i>Download All';
            });

            // Add mobile touch support
            if (window.addMobileTouchSupport) {
                window.addMobileTouchSupport(downloadAllBtn);
            }
        }

        // Show error function
        function showError(message) {
            errorText.textContent = message;
            errorMessage.classList.remove('hidden');
            setTimeout(() => {
                errorMessage.classList.add('hidden');
            }, 5000);
        }
    })();

    // --- COVER PHOTO GENERATOR PRO LOGIC ---
    (function() {
        // DOM Elements
        const modePhotoBtn = document.getElementById('cpg-mode-photo');
        const modeFacelessBtn = document.getElementById('cpg-mode-faceless');
        const photoPanel = document.getElementById('cpg-photo-panel');

        const photoUploadArea = document.getElementById('cpg-photo-upload-area');
        const photoInput = document.getElementById('cpg-photo-input');
        const photoPreview = document.getElementById('cpg-photo-preview');
        const photoPlaceholder = document.getElementById('cpg-photo-placeholder');

        const brandNameInput = document.getElementById('cpg-brand-name');
        const taglineInput = document.getElementById('cpg-tagline');
        const textStyleSelect = document.getElementById('cpg-text-style');
        const themePresetSelect = document.getElementById('cpg-theme-preset');
        const customThemeInput = document.getElementById('cpg-custom-theme');
        const platformSelect = document.getElementById('cpg-platform');
        const generateBtn = document.getElementById('cpg-generate-btn');

        const placeholder = document.getElementById('cpg-placeholder');
        const loading = document.getElementById('cpg-loading');
        const loadingText = document.getElementById('cpg-loading-text');
        const progressBar = document.getElementById('cpg-progress-bar');
        const progressText = document.getElementById('cpg-progress-text');

        const resultsHeader = document.getElementById('cpg-results-header');
        const resultsGrid = document.getElementById('cpg-results-grid');
        const downloadAllBtn = document.getElementById('cpg-download-all-btn');

        const errorMessage = document.getElementById('cpg-error-message');
        const errorText = document.getElementById('cpg-error-text');

        let currentMode = 'photo';
        let photoBase64 = null;
        let photoMimeType = null;
        let generatedImages = [];

        // Text style definitions
        const textStyleDefinitions = {
            bold: {
                description: 'Bold, impactful, strong typography',
                font: 'Heavy sans-serif fonts, thick strokes',
                colors: 'High contrast, bold colors'
            },
            elegant: {
                description: 'Elegant, luxurious, sophisticated typography',
                font: 'Serif fonts, refined letterforms',
                colors: 'Gold, black, white, metallic accents'
            },
            modern: {
                description: 'Modern, clean, minimalist typography',
                font: 'Sans-serif, geometric fonts, clean lines',
                colors: 'Monochrome, subtle colors, white space'
            },
            creative: {
                description: 'Creative, artistic, unique typography',
                font: 'Custom fonts, decorative elements, hand-drawn',
                colors: 'Vibrant, artistic color combinations'
            },
            tech: {
                description: 'Tech, futuristic, digital typography',
                font: 'Digital fonts, neon effects, cyberpunk style',
                colors: 'Neon blue, electric purple, cyber colors'
            },
            casual: {
                description: 'Casual, friendly, approachable typography',
                font: 'Rounded fonts, handwritten style, playful',
                colors: 'Warm, friendly, pastel colors'
            }
        };

        // Theme preset definitions
        const themePresetDefinitions = {
            business: {
                description: 'Business professional theme',
                colors: 'Professional blue, corporate gray, navy, white',
                mood: 'Formal, trustworthy, corporate, professional',
                elements: 'Clean lines, geometric shapes, business icons, minimal design'
            },
            creative: {
                description: 'Creative and colorful theme',
                colors: 'Vibrant rainbow colors, bold color blocking, artistic palette',
                mood: 'Energetic, creative, expressive, artistic',
                elements: 'Abstract shapes, artistic patterns, creative compositions'
            },
            minimalist: {
                description: 'Minimalist clean theme',
                colors: 'White, black, single accent color, monochrome',
                mood: 'Simple, elegant, modern, uncluttered',
                elements: 'Lots of white space, minimal elements, clean typography'
            },
            dark: {
                description: 'Dark and moody theme',
                colors: 'Black, dark gray, deep colors, moody tones',
                mood: 'Dramatic, mysterious, elegant, cinematic',
                elements: 'Dark backgrounds, dramatic lighting, cinematic effects'
            },
            gradient: {
                description: 'Gradient modern theme',
                colors: 'Trendy gradients, color transitions, vibrant blends',
                mood: 'Modern, trendy, dynamic, eye-catching',
                elements: 'Smooth gradients, modern design, flowing colors'
            },
            nature: {
                description: 'Nature and fresh theme',
                colors: 'Green, earth tones, natural colors, organic palette',
                mood: 'Fresh, organic, natural, peaceful',
                elements: 'Natural textures, organic shapes, botanical elements'
            }
        };

        // Mode switching
        if (modePhotoBtn && modeFacelessBtn) {
            modePhotoBtn.addEventListener('click', () => {
                currentMode = 'photo';
                modePhotoBtn.classList.remove('bg-gray-200', 'text-gray-700');
                modePhotoBtn.classList.add('bg-gradient-to-r', 'from-purple-600', 'to-indigo-600', 'text-white', 'shadow-lg');
                modeFacelessBtn.classList.remove('bg-gradient-to-r', 'from-purple-600', 'to-indigo-600', 'text-white', 'shadow-lg');
                modeFacelessBtn.classList.add('bg-gray-200', 'text-gray-700');
                photoPanel.classList.remove('hidden');
                checkReadyToGenerate();
            });

            modeFacelessBtn.addEventListener('click', () => {
                currentMode = 'faceless';
                modeFacelessBtn.classList.remove('bg-gray-200', 'text-gray-700');
                modeFacelessBtn.classList.add('bg-gradient-to-r', 'from-purple-600', 'to-indigo-600', 'text-white', 'shadow-lg');
                modePhotoBtn.classList.remove('bg-gradient-to-r', 'from-purple-600', 'to-indigo-600', 'text-white', 'shadow-lg');
                modePhotoBtn.classList.add('bg-gray-200', 'text-gray-700');
                photoPanel.classList.add('hidden');
                checkReadyToGenerate();
            });
        }

        // Photo upload
        if (photoUploadArea) {
            photoUploadArea.addEventListener('click', () => photoInput.click());
        }

        if (photoInput) {
            photoInput.addEventListener('change', async (event) => {
                const file = event.target.files[0];
                if (!file) return;

                try {
                    let processedFile = file;
                    if (file.type === 'image/heic' || file.name.toLowerCase().endsWith('.heic')) {
                        if (typeof heic2any !== 'undefined') {
                            const convertedBlob = await heic2any({ blob: file, toType: 'image/jpeg' });
                            processedFile = new File([convertedBlob], file.name.replace(/\.heic$/i, '.jpg'), { type: 'image/jpeg' });
                        }
                    }

                    const reader = new FileReader();
                    reader.onload = (e) => {
                        photoBase64 = e.target.result.split(',')[1];
                        photoMimeType = processedFile.type;
                        photoPreview.src = e.target.result;
                        photoPreview.classList.remove('hidden');
                        photoPlaceholder.classList.add('hidden');
                        checkReadyToGenerate();
                    };
                    reader.readAsDataURL(processedFile);
                } catch (error) {
                    console.error('Error processing photo:', error);
                    showError('Failed to process image. Please try another file.');
                }
            });
        }

        // Brand name input
        if (brandNameInput) {
            brandNameInput.addEventListener('input', checkReadyToGenerate);
        }

        // Check if ready to generate
        function checkReadyToGenerate() {
            const brandName = brandNameInput.value.trim();

            if (currentMode === 'photo') {
                generateBtn.disabled = !brandName || !photoBase64;
            } else {
                generateBtn.disabled = !brandName;
            }
        }

        // Generate button
        if (generateBtn) {
            generateBtn.addEventListener('click', async () => {
                const brandName = brandNameInput.value.trim();

                if (!brandName) {
                    showError('Please enter your brand name.');
                    return;
                }

                if (currentMode === 'photo' && !photoBase64) {
                    showError('Please upload your photo.');
                    return;
                }

                // Reset state
                generatedImages = [];
                generateBtn.disabled = true;
                placeholder.classList.add('hidden');
                loading.classList.remove('hidden');
                resultsHeader.classList.add('hidden');
                resultsGrid.classList.add('hidden');
                resultsGrid.innerHTML = '';
                errorMessage.classList.add('hidden');
                progressBar.style.width = '0%';
                progressText.textContent = '0/6 completed';

                try {
                    for (let i = 0; i < 6; i++) {
                        loadingText.textContent = `Generating cover photo ${i + 1}/6...`;

                        const imageUrl = await generateCoverPhoto(i);

                        if (imageUrl) {
                            const filename = `cover-photo-${Date.now()}-${i + 1}.png`;
                            generatedImages.push({ url: imageUrl, filename, variation: i + 1 });

                            // Update progress
                            const progress = Math.round(((i + 1) / 6) * 100);
                            progressBar.style.width = `${progress}%`;
                            progressText.textContent = `${i + 1}/6 completed`;
                        }
                    }

                    // Display results
                    displayResults();
                    loading.classList.add('hidden');
                    resultsHeader.classList.remove('hidden');
                    resultsGrid.classList.remove('hidden');

                } catch (error) {
                    console.error('Generation error:', error);
                    showError(error.message || 'Failed to generate cover photos. Please try again.');
                    loading.classList.add('hidden');
                    placeholder.classList.remove('hidden');
                } finally {
                    generateBtn.disabled = false;
                    checkReadyToGenerate();
                }
            });
        }

        // Generate cover photo
        async function generateCoverPhoto(variationIndex) {
            const apiKey = "";
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-image-preview:generateContent?key=${apiKey}`;

            const brandName = brandNameInput.value.trim();
            const tagline = taglineInput.value.trim();
            const textStyle = textStyleSelect.value;
            const themePreset = themePresetSelect.value;
            const customTheme = customThemeInput.value.trim();
            const platform = platformSelect.value;

            const textStyleDef = textStyleDefinitions[textStyle];

            // Determine theme
            let themeDescription;
            if (customTheme) {
                themeDescription = `CUSTOM THEME: ${customTheme}`;
            } else if (themePreset) {
                const themeDef = themePresetDefinitions[themePreset];
                themeDescription = `THEME: ${themeDef.description.toUpperCase()}
- Colors: ${themeDef.colors}
- Mood: ${themeDef.mood}
- Elements: ${themeDef.elements}`;
            } else {
                themeDescription = 'THEME: Modern professional with clean design';
            }

            let prompt;

            if (currentMode === 'photo') {
                // With Photo Mode
                prompt = `Create a professional vertical cover photo for ${platform.toUpperCase()} personal branding (9:16 aspect ratio - portrait/vertical format).

BRAND INFORMATION:
- Brand Name: "${brandName}"
${tagline ? `- Tagline: "${tagline}"` : ''}
- This is the person/model in the photo

TEXT STYLE:
- Style: ${textStyleDef.description}
- Typography: ${textStyleDef.font}
- Color Treatment: ${textStyleDef.colors}

${themeDescription}

DESIGN REQUIREMENTS:
1. Use the person in the photo as the main visual element
2. Display the brand name "${brandName}" prominently on the cover
${tagline ? `3. Include the tagline "${tagline}" in smaller text` : ''}
3. Apply the ${textStyle} text style with appropriate typography
4. Create a professional, eye-catching personal brand cover photo
5. Ensure text is HIGHLY READABLE with proper contrast
6. Optimize for ${platform} vertical cover display (9:16 portrait ratio)
7. Make it look polished and professional for personal branding
8. VERTICAL COMPOSITION - portrait orientation (taller than wide)

COVER PHOTO COMPOSITION:
- VERTICAL/PORTRAIT layout (9:16 - height is greater than width)
- Position the person prominently (professional portrait style for vertical format)
- Add the brand name as overlay text or integrated design element
- Use professional lighting and color grading
- Apply appropriate background treatment (blur, gradient, solid color, or thematic)
- Ensure the person stands out while text remains readable
- Create depth with proper layering
- Optimize for mobile vertical viewing

VARIATION ${variationIndex + 1}:
Apply different composition, text placement, or color treatment for this variation.

PLATFORM OPTIMIZATION:
${platform === 'tiktok' ? '- TikTok Cover: Bold, eye-catching, youthful energy, optimized for TikTok profile vertical banner' : ''}
${platform === 'instagram' ? '- Instagram Story/Cover: Aesthetic, polished, Instagram-worthy style, vertical story format' : ''}

Create a professional personal branding VERTICAL cover photo (9:16) that will make a strong first impression.`;

                const payload = {
                    contents: [{
                        parts: [
                            { text: prompt },
                            { inlineData: { mimeType: photoMimeType, data: photoBase64 } }
                        ]
                    }],
                    generationConfig: {
                        responseModalities: ['IMAGE'],
                        imageConfig: { aspectRatio: '9:16' }
                    }
                };

                return await callGeminiAPI(apiUrl, payload);

            } else {
                // Faceless Mode
                prompt = `Create a professional faceless vertical cover photo for ${platform.toUpperCase()} personal branding (9:16 aspect ratio - portrait/vertical format).

BRAND INFORMATION:
- Brand Name: "${brandName}"
${tagline ? `- Tagline: "${tagline}"` : ''}
- FACELESS BRANDING (no human face, text and design focused)

TEXT STYLE:
- Style: ${textStyleDef.description}
- Typography: ${textStyleDef.font}
- Color Treatment: ${textStyleDef.colors}

${themeDescription}

DESIGN REQUIREMENTS:
1. Create a FACELESS personal brand cover (NO HUMAN FACES)
2. Display the brand name "${brandName}" as the PRIMARY FOCAL POINT
${tagline ? `3. Include the tagline "${tagline}" in complementary text` : ''}
3. Apply the ${textStyle} text style with exceptional typography
4. Create a professional, eye-catching design without using human faces
5. Text must be EXTREMELY READABLE with perfect contrast
6. Optimize for ${platform} vertical cover display (9:16 portrait ratio)
7. Make it professional and memorable for personal branding
8. VERTICAL COMPOSITION - portrait orientation (taller than wide)

FACELESS DESIGN ELEMENTS TO USE:
- Abstract shapes and patterns
- Geometric designs
- Gradients and color blocks
- Icons or symbols relevant to the brand
- Textural backgrounds
- Minimalist compositions
- Artistic illustrations (non-human)
- Professional color schemes

COVER PHOTO COMPOSITION:
- VERTICAL/PORTRAIT layout (9:16 - height is greater than width)
- Make the brand name the hero element
- Use strong visual hierarchy
- Create depth with layering and shadows
- Apply professional color grading
- Ensure clean, uncluttered design
- Balance text and visual elements perfectly
- Optimize for mobile vertical viewing

VARIATION ${variationIndex + 1}:
Apply different design style, composition, or color scheme for this variation.

PLATFORM OPTIMIZATION:
${platform === 'tiktok' ? '- TikTok Cover: Bold, modern, attention-grabbing, optimized for TikTok profile vertical banner' : ''}
${platform === 'instagram' ? '- Instagram Story/Cover: Aesthetic, trendy, feed-worthy, vertical story format' : ''}

Create a professional faceless personal branding VERTICAL cover photo (9:16) that communicates professionalism and uniqueness.`;

                const payload = {
                    contents: [{
                        parts: [{ text: prompt }]
                    }],
                    generationConfig: {
                        responseModalities: ['IMAGE'],
                        imageConfig: { aspectRatio: '9:16' }
                    }
                };

                return await callGeminiAPI(apiUrl, payload);
            }
        }

        // Call Gemini API with retry
        async function callGeminiAPI(apiUrl, payload) {
            const maxRetries = 3;
            let delay = 1000;

            for (let attempt = 0; attempt < maxRetries; attempt++) {
                try {
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (!response.ok) {
                        if (response.status === 429 && attempt < maxRetries - 1) {
                            await new Promise(resolve => setTimeout(resolve, delay));
                            delay *= 2;
                            continue;
                        }
                        throw new Error(`API Error: ${response.status}`);
                    }

                    const result = await response.json();
                    const base64Image = result?.candidates?.[0]?.content?.parts?.find(p => p.inlineData)?.inlineData?.data;

                    if (base64Image) {
                        return `data:image/png;base64,${base64Image}`;
                    } else {
                        throw new Error('No image data in response');
                    }
                } catch (error) {
                    if (attempt === maxRetries - 1) throw error;
                    await new Promise(resolve => setTimeout(resolve, delay));
                    delay *= 2;
                }
            }
        }

        // Display results
        function displayResults() {
            resultsGrid.innerHTML = '';

            generatedImages.forEach((img, index) => {
                const card = document.createElement('div');
                card.className = 'relative group rounded-xl overflow-hidden shadow-lg hover:shadow-2xl transition-all duration-300 transform hover:scale-105';
                card.innerHTML = `
                    <img src="${img.url}" alt="Cover Photo ${img.variation}" class="w-full h-auto object-cover">
                    <div class="absolute top-2 left-2 bg-gradient-to-r from-purple-600 to-indigo-600 text-white text-xs px-3 py-1 rounded-full font-semibold shadow-lg">
                        Variation ${img.variation}
                    </div>
                    <div class="absolute inset-0 bg-gradient-to-t from-black/80 via-black/40 to-transparent opacity-0 group-hover:opacity-100 transition-all duration-300 flex items-end justify-center gap-2 p-4">
                        <button data-action="preview" data-index="${index}" class="action-btn flex items-center gap-2 bg-gradient-to-r from-cyan-500 to-blue-600 text-white px-4 py-2 rounded-full font-semibold shadow-lg hover:scale-105 transition-all">
                            <i class="fas fa-eye"></i>
                            <span class="hidden sm:inline">Preview</span>
                        </button>
                        <button data-action="download" data-index="${index}" class="action-btn flex items-center gap-2 bg-gradient-to-r from-green-500 to-green-600 text-white px-4 py-2 rounded-full font-semibold shadow-lg hover:scale-105 transition-all">
                            <i class="fas fa-download"></i>
                            <span class="hidden sm:inline">Download</span>
                        </button>
                    </div>
                `;
                resultsGrid.appendChild(card);
            });
        }

        // Event delegation for action buttons
        if (resultsGrid) {
            resultsGrid.addEventListener('click', async (e) => {
                e.stopPropagation();

                const actionBtn = e.target.classList.contains('action-btn') ?
                    e.target : e.target.closest('.action-btn[data-action]');
                if (!actionBtn) return;

                const action = actionBtn.dataset.action;
                const index = parseInt(actionBtn.dataset.index, 10);
                const imageData = generatedImages[index];

                if (!imageData) return;

                if (action === 'preview') {
                    if (window.showPreviewModal) {
                        window.showPreviewModal(imageData.url);
                    }
                } else if (action === 'download') {
                    if (window.downloadDataURINew) {
                        await window.downloadDataURINew(imageData.url, imageData.filename);
                    } else if (window.downloadImage) {
                        await window.downloadImage(imageData.url, imageData.filename);
                    }
                }
            });
        }

        // Download all button
        if (downloadAllBtn) {
            downloadAllBtn.addEventListener('click', async () => {
                if (generatedImages.length === 0) return;

                downloadAllBtn.disabled = true;
                downloadAllBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Downloading...';

                for (let i = 0; i < generatedImages.length; i++) {
                    const img = generatedImages[i];
                    if (window.downloadDataURINew) {
                        await window.downloadDataURINew(img.url, img.filename);
                    } else if (window.downloadImage) {
                        await window.downloadImage(img.url, img.filename);
                    }
                    if (i < generatedImages.length - 1) {
                        await new Promise(resolve => setTimeout(resolve, 500));
                    }
                }

                downloadAllBtn.disabled = false;
                downloadAllBtn.innerHTML = '<i class="fas fa-download mr-2"></i>Download All';
            });

            // Add mobile touch support
            if (window.addMobileTouchSupport) {
                window.addMobileTouchSupport(downloadAllBtn);
            }
        }

        // Show error function
        function showError(message) {
            errorText.textContent = message;
            errorMessage.classList.remove('hidden');
            setTimeout(() => {
                errorMessage.classList.add('hidden');
            }, 5000);
        }
    })();

    // --- PHOTO RESTORATION GENERATOR LOGIC ---
    (function() {
        // DOM Elements
        const uploadArea = document.getElementById('pr-upload-area');
        const photoInput = document.getElementById('pr-photo-input');
        const photoPreview = document.getElementById('pr-photo-preview');
        const photoPlaceholder = document.getElementById('pr-photo-placeholder');

        const modeSelect = document.getElementById('pr-mode-select');
        const intensityBtns = document.querySelectorAll('.pr-intensity-btn');
        const ratioBtns = document.querySelectorAll('.pr-ratio-btn');
        const generateBtn = document.getElementById('pr-generate-btn');

        const placeholder = document.getElementById('pr-placeholder');
        const loading = document.getElementById('pr-loading');
        const loadingText = document.getElementById('pr-loading-text');
        const progressBar = document.getElementById('pr-progress-bar');
        const progressText = document.getElementById('pr-progress-text');

        const resultsHeader = document.getElementById('pr-results-header');
        const resultsGrid = document.getElementById('pr-results-grid');
        const downloadAllBtn = document.getElementById('pr-download-all-btn');
        const comparisonSection = document.getElementById('pr-comparison-section');
        const comparisonBefore = document.getElementById('pr-comparison-before');
        const comparisonAfter = document.getElementById('pr-comparison-after');

        const errorMessage = document.getElementById('pr-error-message');
        const errorText = document.getElementById('pr-error-text');

        let photoBase64 = null;
        let photoMimeType = null;
        let selectedIntensity = 'light';
        let selectedRatio = 'original';
        let generatedImages = [];
        let originalPhotoUrl = null;

        // Restoration mode definitions
        const restorationModes = {
            'old-photo': {
                name: 'Old Photo Restoration',
                description: 'Restore faded colors, fix yellowing, remove aging artifacts',
                prompt: 'restore this old/vintage photograph to its original quality'
            },
            'damaged': {
                name: 'Damaged Photo Repair',
                description: 'Fix scratches, tears, stains, and physical damage',
                prompt: 'repair all physical damage, scratches, tears, and imperfections in this photograph'
            },
            'colorize': {
                name: 'Colorize Black & White',
                description: 'Add realistic natural colors to B&W photos',
                prompt: 'colorize this black and white photograph with realistic, natural colors'
            },
            'enhance': {
                name: 'Quality Enhancement',
                description: 'Enhance resolution, clarity, and overall quality',
                prompt: 'enhance the overall quality, resolution, and clarity of this photograph'
            },
            'deblur': {
                name: 'Deblur & Sharpen',
                description: 'Remove blur and increase sharpness',
                prompt: 'remove blur and significantly sharpen this photograph'
            },
            'denoise': {
                name: 'Denoise',
                description: 'Remove grain and digital noise',
                prompt: 'remove all grain, noise, and artifacts from this photograph'
            }
        };

        // Intensity levels
        const intensityLevels = {
            light: { value: 30, desc: 'Subtle, natural-looking restoration' },
            medium: { value: 60, desc: 'Balanced restoration with noticeable improvement' },
            strong: { value: 90, desc: 'Aggressive restoration for heavily damaged photos' }
        };

        // Photo upload
        if (uploadArea) {
            uploadArea.addEventListener('click', () => photoInput.click());
        }

        if (photoInput) {
            photoInput.addEventListener('change', async (event) => {
                const file = event.target.files[0];
                if (!file) return;

                try {
                    let processedFile = file;
                    if (file.type === 'image/heic' || file.name.toLowerCase().endsWith('.heic')) {
                        if (typeof heic2any !== 'undefined') {
                            const convertedBlob = await heic2any({ blob: file, toType: 'image/jpeg' });
                            processedFile = new File([convertedBlob], file.name.replace(/\.heic$/i, '.jpg'), { type: 'image/jpeg' });
                        }
                    }

                    const reader = new FileReader();
                    reader.onload = (e) => {
                        photoBase64 = e.target.result.split(',')[1];
                        photoMimeType = processedFile.type;
                        originalPhotoUrl = e.target.result;
                        photoPreview.src = e.target.result;
                        photoPreview.classList.remove('hidden');
                        photoPlaceholder.classList.add('hidden');
                        checkReadyToGenerate();
                    };
                    reader.readAsDataURL(processedFile);
                } catch (error) {
                    console.error('Error processing photo:', error);
                    showError('Failed to process image. Please try another file.');
                }
            });
        }

        // Intensity buttons
        intensityBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                intensityBtns.forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                selectedIntensity = btn.dataset.intensity;
            });
        });

        // Ratio buttons
        ratioBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                ratioBtns.forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                selectedRatio = btn.dataset.ratio;
            });
        });

        // Check if ready to generate
        function checkReadyToGenerate() {
            generateBtn.disabled = !photoBase64;
        }

        // Generate button
        if (generateBtn) {
            generateBtn.addEventListener('click', async () => {
                if (!photoBase64) {
                    showError('Please upload a photo first.');
                    return;
                }

                // Reset state
                generatedImages = [];
                generateBtn.disabled = true;
                placeholder.classList.add('hidden');
                loading.classList.remove('hidden');
                resultsHeader.classList.add('hidden');
                resultsGrid.classList.add('hidden');
                comparisonSection.classList.add('hidden');
                resultsGrid.innerHTML = '';
                errorMessage.classList.add('hidden');
                progressBar.style.width = '0%';
                progressText.textContent = '0/2 completed';

                try {
                    for (let i = 0; i < 2; i++) {
                        loadingText.textContent = `Restoring photo ${i + 1}/2...`;

                        const imageUrl = await restorePhoto(i);

                        if (imageUrl) {
                            const filename = `restored-photo-${Date.now()}-${i + 1}.png`;
                            generatedImages.push({ url: imageUrl, filename, result: i + 1 });

                            // Update progress
                            const progress = Math.round(((i + 1) / 2) * 100);
                            progressBar.style.width = `${progress}%`;
                            progressText.textContent = `${i + 1}/2 completed`;
                        }
                    }

                    // Display results
                    displayResults();
                    loading.classList.add('hidden');
                    resultsHeader.classList.remove('hidden');
                    resultsGrid.classList.remove('hidden');

                    // Show comparison
                    if (generatedImages.length > 0) {
                        comparisonBefore.src = originalPhotoUrl;
                        comparisonAfter.src = generatedImages[0].url;
                        comparisonSection.classList.remove('hidden');
                    }

                } catch (error) {
                    console.error('Restoration error:', error);
                    showError(error.message || 'Failed to restore photo. Please try again.');
                    loading.classList.add('hidden');
                    placeholder.classList.remove('hidden');
                } finally {
                    generateBtn.disabled = false;
                    checkReadyToGenerate();
                }
            });
        }

        // Restore photo function
        async function restorePhoto(resultIndex) {
            const apiKey = "";
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-image-preview:generateContent?key=${apiKey}`;

            const mode = modeSelect.value;
            const modeDef = restorationModes[mode];
            const intensity = intensityLevels[selectedIntensity];

            // Build aspect ratio config
            let aspectRatioConfig = {};
            if (selectedRatio !== 'original') {
                aspectRatioConfig = { aspectRatio: selectedRatio };
            }

            const prompt = `PHOTO RESTORATION TASK:

Restore and enhance this photograph with the following specifications:

RESTORATION TYPE: ${modeDef.name}
Primary Goal: ${modeDef.prompt}

RESTORATION REQUIREMENTS:
1. ${modeDef.description}
2. Preserve the original subject and composition exactly
3. Maintain natural, realistic appearance - no over-processing
4. Fix any visible defects, artifacts, or quality issues
5. Enhance overall clarity and detail
6. Ensure proper color balance and exposure
7. Remove any dust, spots, or unwanted marks

INTENSITY LEVEL: ${selectedIntensity.toUpperCase()} (${intensity.value}% strength)
- Apply ${intensity.desc}
- Balance between improvement and naturalness
${selectedIntensity === 'strong' ? '- Aggressive restoration for heavily damaged areas' : ''}
${selectedIntensity === 'light' ? '- Subtle enhancement, preserve original character' : ''}

SPECIFIC RESTORATION TECHNIQUES TO APPLY:
${mode === 'old-photo' ? `
- Restore faded colors to vibrant natural tones
- Fix yellowing and color shifts from aging
- Remove age-related noise and grain
- Repair cracks and paper texture damage
- Enhance contrast while maintaining natural look` : ''}
${mode === 'damaged' ? `
- Fill in missing or torn areas seamlessly
- Remove scratches, stains, and physical damage
- Reconstruct damaged portions intelligently
- Blend repairs naturally with surrounding areas
- Fix any folding or crease marks` : ''}
${mode === 'colorize' ? `
- Add realistic, period-appropriate colors
- Ensure natural skin tones and clothing colors
- Match colors to the era and context of the photo
- Maintain proper shading and depth
- Create natural color transitions` : ''}
${mode === 'enhance' ? `
- Upscale resolution and add fine details
- Enhance sharpness and clarity significantly
- Improve dynamic range and tonal gradation
- Add texture details where appropriate
- Optimize overall image quality` : ''}
${mode === 'deblur' ? `
- Remove motion blur and camera shake effects
- Increase edge sharpness dramatically
- Enhance fine details and textures
- Improve focus across the entire image
- Add clarity to blurred areas` : ''}
${mode === 'denoise' ? `
- Remove digital noise and ISO grain
- Smooth out grainy textures
- Preserve important details while denoising
- Clean up compression artifacts
- Enhance overall smoothness` : ''}

QUALITY STANDARDS:
- Professional photo restoration quality
- Photorealistic and natural appearance
- High attention to detail
- Consistent throughout the image
- Museum-quality restoration standards

RESULT ${resultIndex + 1} VARIATION:
${resultIndex === 0 ? 'Apply standard restoration with balanced approach' : 'Apply slightly different technique emphasis or color grading for comparison'}

Create a beautifully restored version of this photograph that looks professional, natural, and significantly improved.`;

            const payload = {
                contents: [{
                    parts: [
                        { text: prompt },
                        { inlineData: { mimeType: photoMimeType, data: photoBase64 } }
                    ]
                }],
                generationConfig: {
                    responseModalities: ['IMAGE'],
                    ...(selectedRatio !== 'original' ? { imageConfig: aspectRatioConfig } : {})
                }
            };

            return await callGeminiAPI(apiUrl, payload);
        }

        // Call Gemini API with retry
        async function callGeminiAPI(apiUrl, payload) {
            const maxRetries = 3;
            let delay = 1000;

            for (let attempt = 0; attempt < maxRetries; attempt++) {
                try {
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (!response.ok) {
                        if (response.status === 429 && attempt < maxRetries - 1) {
                            await new Promise(resolve => setTimeout(resolve, delay));
                            delay *= 2;
                            continue;
                        }
                        throw new Error(`API Error: ${response.status}`);
                    }

                    const result = await response.json();
                    const base64Image = result?.candidates?.[0]?.content?.parts?.find(p => p.inlineData)?.inlineData?.data;

                    if (base64Image) {
                        return `data:image/png;base64,${base64Image}`;
                    } else {
                        throw new Error('No image data in response');
                    }
                } catch (error) {
                    if (attempt === maxRetries - 1) throw error;
                    await new Promise(resolve => setTimeout(resolve, delay));
                    delay *= 2;
                }
            }
        }

        // Display results
        function displayResults() {
            resultsGrid.innerHTML = '';

            generatedImages.forEach((img, index) => {
                const card = document.createElement('div');
                card.className = 'relative group rounded-xl overflow-hidden shadow-lg hover:shadow-2xl transition-all duration-300 transform hover:scale-105';
                card.innerHTML = `
                    <img src="${img.url}" alt="Restored Photo ${img.result}" class="w-full h-auto object-cover">
                    <div class="absolute top-2 left-2 bg-gradient-to-r from-amber-600 to-orange-600 text-white text-xs px-3 py-1 rounded-full font-semibold shadow-lg">
                        Result ${img.result}
                    </div>
                    <div class="absolute inset-0 bg-gradient-to-t from-black/80 via-black/40 to-transparent opacity-0 group-hover:opacity-100 transition-all duration-300 flex items-end justify-center gap-2 p-4">
                        <button data-action="preview" data-index="${index}" class="action-btn flex items-center gap-2 bg-gradient-to-r from-cyan-500 to-blue-600 text-white px-4 py-2 rounded-full font-semibold shadow-lg hover:scale-105 transition-all">
                            <i class="fas fa-eye"></i>
                            <span class="hidden sm:inline">Preview</span>
                        </button>
                        <button data-action="download" data-index="${index}" class="action-btn flex items-center gap-2 bg-gradient-to-r from-green-500 to-green-600 text-white px-4 py-2 rounded-full font-semibold shadow-lg hover:scale-105 transition-all">
                            <i class="fas fa-download"></i>
                            <span class="hidden sm:inline">Download</span>
                        </button>
                    </div>
                `;
                resultsGrid.appendChild(card);
            });
        }

        // Event delegation for action buttons
        if (resultsGrid) {
            resultsGrid.addEventListener('click', async (e) => {
                e.stopPropagation();

                const actionBtn = e.target.classList.contains('action-btn') ?
                    e.target : e.target.closest('.action-btn[data-action]');
                if (!actionBtn) return;

                const action = actionBtn.dataset.action;
                const index = parseInt(actionBtn.dataset.index, 10);
                const imageData = generatedImages[index];

                if (!imageData) return;

                if (action === 'preview') {
                    if (window.showPreviewModal) {
                        window.showPreviewModal(imageData.url);
                    }
                } else if (action === 'download') {
                    if (window.downloadDataURINew) {
                        await window.downloadDataURINew(imageData.url, imageData.filename);
                    } else if (window.downloadImage) {
                        await window.downloadImage(imageData.url, imageData.filename);
                    }
                }
            });
        }

        // Download all button
        if (downloadAllBtn) {
            downloadAllBtn.addEventListener('click', async () => {
                if (generatedImages.length === 0) return;

                downloadAllBtn.disabled = true;
                downloadAllBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Downloading...';

                for (let i = 0; i < generatedImages.length; i++) {
                    const img = generatedImages[i];
                    if (window.downloadDataURINew) {
                        await window.downloadDataURINew(img.url, img.filename);
                    } else if (window.downloadImage) {
                        await window.downloadImage(img.url, img.filename);
                    }
                    if (i < generatedImages.length - 1) {
                        await new Promise(resolve => setTimeout(resolve, 500));
                    }
                }

                downloadAllBtn.disabled = false;
                downloadAllBtn.innerHTML = '<i class="fas fa-download mr-2"></i>Download All';
            });
        }

        // Show error function
        function showError(message) {
            errorText.textContent = message;
            errorMessage.classList.remove('hidden');
            setTimeout(() => {
                errorMessage.classList.add('hidden');
            }, 5000);
        }
    })();

    // --- WEDDING PHOTO LOGIC ---
    (function() {
        // DOM Elements
        const maleUpload = document.getElementById('wedding-male-upload');
        const femaleUpload = document.getElementById('wedding-female-upload');
        const malePreview = document.getElementById('wedding-male-preview');
        const femalePreview = document.getElementById('wedding-female-preview');
        const themeInput = document.getElementById('wedding-theme-input');
        const generateBtn = document.getElementById('wedding-generate-btn');
        const loadingDiv = document.getElementById('wedding-loading');
        const imageGrid = document.getElementById('wedding-image-grid');
        const errorMessageDiv = document.getElementById('wedding-error-message');
        const heartsContainer = document.getElementById('wedding-hearts-container');
        const resultsHeader = document.getElementById('wedding-results-header');
        const downloadAllBtn = document.getElementById('wedding-download-all-btn');

        if (!maleUpload) return; // Exit if the elements for this tab aren't present

        let maleImageBase64 = null;
        let femaleImageBase64 = null;
        let generatedImages = []; // Store generated images

        const apiKey = ""; // API key will be injected here by the environment

        const defaultThemes = [
            "in a lush enchanted forest", "on a beach at sunset with dramatic clouds", "in a fairytale castle ballroom", 
            "in a rustic barn decorated with fairy lights", "on a modern city rooftop overlooking the skyline", "with a vintage 1920s Great Gatsby style",
            "in a vibrant flower garden during spring", "at a glamorous Hollywood red carpet event", "having a picnic in the lavender fields of Provence",
            "under the northern lights (aurora borealis)", "in a traditional Japanese garden with cherry blossoms", "on a gondola in Venice, Italy",
            "in a bohemian desert landscape with pampas grass", "in a grand library surrounded by old books", "at a snowy mountain peak during winter",
            "in a magical underwater scene with coral reefs", "in a sci-fi futuristic setting", "with a whimsical hot air balloon festival in the background",
            "in an elegant art deco hotel lobby", "celebrating during a vibrant Holi festival in India"
        ];

        // --- Image Handling ---
        function handleFileSelect(event, isMale) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = (e) => {
                const base64String = e.target.result.split(',')[1];
                const previewElement = isMale ? malePreview : femalePreview;
                
                if (isMale) {
                    maleImageBase64 = base64String;
                } else {
                    femaleImageBase64 = base64String;
                }
                
                previewElement.style.backgroundImage = `url('data:image/jpeg;base64,${base64String}')`;
                previewElement.innerHTML = '';
            };
            reader.readAsDataURL(file);
        }

        maleUpload.addEventListener('change', (e) => handleFileSelect(e, true));
        femaleUpload.addEventListener('change', (e) => handleFileSelect(e, false));
        
        // --- Heart Animation ---
        function createHeart() {
            const heart = document.createElement('div');
            heart.classList.add('heart');
            heart.style.left = Math.random() * 100 + 'vw';
            heart.style.animationName = 'wedding-floatUp';
            heart.style.animationDuration = Math.random() * 5 + 5 + 's'; // 5s to 10s
            heart.innerHTML = '‚ù§Ô∏è';
            heartsContainer.appendChild(heart);

            setTimeout(() => {
                heart.remove();
            }, 10000);
        }
        setInterval(createHeart, 500);

        // --- Client-Side Image Cropping Function ---
        function cropImageToBase64(base64Src, targetAspectRatioString) {
            return new Promise((resolve, reject) => {
                const img = new Image();
                img.src = base64Src;
                img.onload = () => {
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');

                    const targetRatio = targetAspectRatioString === 'horizontal' ? 16 / 9 : 9 / 16;
                    const sourceRatio = img.width / img.height;
                    
                    let sx = 0, sy = 0, sWidth = img.width, sHeight = img.height;

                    if (sourceRatio > targetRatio) {
                        // Source is wider than target, crop the sides
                        sWidth = img.height * targetRatio;
                        sx = (img.width - sWidth) / 2;
                    } else {
                        // Source is taller than target, crop the top/bottom
                        sHeight = img.width / targetRatio;
                        sy = (img.height - sHeight) / 2;
                    }
                    
                    // Set canvas size to the cropped dimensions
                    canvas.width = sWidth;
                    canvas.height = sHeight;

                    // Draw the cropped image onto the canvas
                    ctx.drawImage(img, sx, sy, sWidth, sHeight, 0, 0, sWidth, sHeight);

                    // Resolve with the new base64 string
                    resolve(canvas.toDataURL('image/png'));
                };
                img.onerror = (err) => {
                    reject(err);
                };
            });
        }


        // --- API Call and Image Generation ---
        async function callImageGenerationAPI(prompt, maleImg, femaleImg) {
            const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-image-preview:generateContent?key=${apiKey}`;
            const payload = {
                contents: [{
                    parts: [
                        { text: prompt },
                        { inlineData: { mimeType: "image/jpeg", data: maleImg } },
                        { inlineData: { mimeType: "image/jpeg", data: femaleImg } }
                    ]
                }],
                generationConfig: {
                    responseModalities: ["IMAGE"]
                },
            };

            // Retry logic with exponential backoff
            let response;
            for (let i = 0; i < 3; i++) {
                try {
                    response = await fetch(url, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });
                    if (response.ok) {
                        const result = await response.json();
                        const base64Data = result?.candidates?.[0]?.content?.parts?.find(p => p.inlineData)?.inlineData?.data;
                        if (base64Data) {
                            return base64Data;
                        } else {
                            throw new Error("No image data in response");
                        }
                    }
                } catch (error) {
                    console.error(`Attempt ${i + 1} failed:`, error);
                    if (i < 2) await new Promise(resolve => setTimeout(resolve, 1000 * Math.pow(2, i)));
                }
            }
            throw new Error("API call failed after multiple retries");
        }

        generateBtn.addEventListener('click', async () => {
            if (!maleImageBase64 || !femaleImageBase64) {
                errorMessageDiv.textContent = "Harap unggah foto pria dan wanita terlebih dahulu.";
                errorMessageDiv.classList.remove('hidden');
                return;
            }

            loadingDiv.classList.remove('hidden');
            loadingDiv.classList.add('flex');
            imageGrid.innerHTML = '';
            errorMessageDiv.classList.add('hidden');
            if (resultsHeader) resultsHeader.classList.add('hidden');
            generatedImages = []; // Reset array
            generateBtn.disabled = true;
            generateBtn.classList.add('opacity-50', 'cursor-not-allowed');

            try {
                const userTheme = themeInput.value.trim();
                const photoType = document.querySelector('input[name="wedding-photo-type"]:checked').value;
                const aspectRatio = document.querySelector('input[name="wedding-aspect-ratio"]:checked').value;
                const aspectRatioText = aspectRatio === 'horizontal' ? 'wide landscape format (16:9 aspect ratio)' : 'tall vertical portrait format (9:16 aspect ratio)';

                const attireDescription = photoType === 'wedding'
                    ? 'beautiful wedding attire (groom in a sharp tuxedo, bride in a stunning wedding gown)'
                    : 'stylish and romantic pre-wedding outfits that match the theme';

                const photoShootType = photoType === 'wedding' ? 'wedding photograph' : 'pre-wedding photograph';

                const generationPromises = [];
                for (let i = 0; i < 7; i++) {
                    const randomTheme = defaultThemes[Math.floor(Math.random() * defaultThemes.length)];
                    const chosenTheme = userTheme || randomTheme;
                    const prompt = `An ultra-realistic, professional ${photoShootType} of the man in the first image and the woman in the second image, capturing a romantic and loving moment. They are dressed in ${attireDescription}. The theme is: ${chosenTheme}. High detail, sharp focus, cinematic lighting. CRITICAL INSTRUCTION: The final image composition MUST BE a ${aspectRatioText}. Do not use the orientation of the input photos; strictly adhere to the requested format.`;

                    generationPromises.push(callImageGenerationAPI(prompt, maleImageBase64, femaleImageBase64));
                }

                const results = await Promise.all(generationPromises);

                // Now, crop each image to the correct aspect ratio
                const cropPromises = results.filter(r => r).map(base64Data => cropImageToBase64(`data:image/png;base64,${base64Data}`, aspectRatio));
                const croppedResults = await Promise.all(cropPromises);


                croppedResults.forEach((croppedBase64, index) => {
                    if (croppedBase64) {
                        const filename = `${photoType}-photo-${Date.now()}-${index + 1}.png`;
                        generatedImages.push({ url: croppedBase64, filename: filename }); // Store for download all

                        const container = document.createElement('div');
                        container.className = `generated-image-container ${aspectRatio} group relative`;

                        const img = document.createElement('img');
                        img.src = croppedBase64;
                        img.alt = `Generated ${photoType} photo`;
                        img.className = "w-full h-full object-cover";

                        // Create action buttons overlay
                        const overlay = document.createElement('div');
                        overlay.className = 'absolute inset-0 bg-gradient-to-t from-black/80 via-black/40 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300 flex flex-col justify-end p-4 gap-2';
                        overlay.innerHTML = `
                            <div class="flex gap-2">
                                <button data-action="wedding-preview" data-index="${index}" class="action-btn flex-1 bg-blue-500 hover:bg-blue-600 text-white px-3 py-2 rounded-full text-sm font-bold transition flex items-center justify-center gap-1 shadow-lg">
                                    <i class="fas fa-eye"></i>
                                    <span class="hidden sm:inline">Preview</span>
                                </button>
                                <button data-action="wedding-download" data-index="${index}" class="action-btn flex-1 bg-gradient-to-r from-rose-500 to-pink-500 hover:from-rose-600 hover:to-pink-600 text-white px-3 py-2 rounded-full text-sm font-bold transition flex items-center justify-center gap-1 shadow-lg">
                                    <i class="fas fa-download"></i>
                                    <span class="hidden sm:inline">Download</span>
                                </button>
                            </div>
                        `;

                        container.appendChild(img);
                        container.appendChild(overlay);
                        imageGrid.appendChild(container);
                    }
                });

                // Show results header
                if (generatedImages.length > 0 && resultsHeader) {
                    resultsHeader.classList.remove('hidden');
                }

            } catch (error) {
                console.error("Error generating or processing images:", error);
                errorMessageDiv.textContent = "Maaf, terjadi kesalahan saat membuat atau memproses gambar. Silakan coba lagi.";
                errorMessageDiv.classList.remove('hidden');
            } finally {
                loadingDiv.classList.add('hidden');
                loadingDiv.classList.remove('flex');
                generateBtn.disabled = false;
                generateBtn.classList.remove('opacity-50', 'cursor-not-allowed');
            }
        });

        // Event delegation for action buttons
        if (imageGrid) {
            imageGrid.addEventListener('click', async (e) => {
                e.stopPropagation();

                const actionBtn = e.target.closest('.action-btn[data-action]');
                if (!actionBtn) return;

                const action = actionBtn.dataset.action;
                const index = parseInt(actionBtn.dataset.index, 10);
                const imageData = generatedImages[index];

                if (!imageData) return;

                if (action === 'wedding-preview') {
                    if (window.showPreviewModal) {
                        window.showPreviewModal(imageData.url);
                    }
                } else if (action === 'wedding-download') {
                    if (window.downloadDataURINew) {
                        await window.downloadDataURINew(imageData.url, imageData.filename);
                    } else if (window.downloadImage) {
                        await window.downloadImage(imageData.url, imageData.filename);
                    }
                }
            });
        }

        // Download all functionality
        if (downloadAllBtn) {
            downloadAllBtn.addEventListener('click', async () => {
                if (generatedImages.length === 0) return;

                downloadAllBtn.disabled = true;
                downloadAllBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Downloading...';

                for (let i = 0; i < generatedImages.length; i++) {
                    const img = generatedImages[i];
                    if (window.downloadDataURINew) {
                        await window.downloadDataURINew(img.url, img.filename);
                        // Small delay between downloads for better UX
                        await new Promise(resolve => setTimeout(resolve, 500));
                    } else if (window.downloadImage) {
                        await window.downloadImage(img.url, img.filename);
                        // Small delay between downloads for better UX
                        await new Promise(resolve => setTimeout(resolve, 500));
                    }
                }

                downloadAllBtn.disabled = false;
                downloadAllBtn.innerHTML = '<i class="fas fa-download mr-2"></i>Download Semua';
            });

            // Add mobile touch support
            if (window.addMobileTouchSupport) {
                window.addMobileTouchSupport(downloadAllBtn);
            }
        }
    })();

    // --- VOICE OVER STUDIO PRO TAB LOGIC ---
    (function() {
        const voiceOverTabDesktop = document.querySelector('.main-tab-btn[data-tab="voice-over"]');
        const voiceOverTabMobile = document.querySelector('.mobile-tab-btn[data-tab="voice-over"]');

        console.log('Voice Over tabs found - Desktop:', !!voiceOverTabDesktop, 'Mobile:', !!voiceOverTabMobile);

        // Initialize when either desktop or mobile tab is clicked
        const initOnClick = () => {
            console.log('Voice Over tab clicked, initialized:', window.voiceOverInitialized);
            if (!window.voiceOverInitialized) {
                console.log('Initializing Voice Over Generator...');
                initVoiceOverGenerator();
                window.voiceOverInitialized = true;
            }
        };

        if (voiceOverTabDesktop) {
            voiceOverTabDesktop.addEventListener('click', initOnClick);
        }
        if (voiceOverTabMobile) {
            voiceOverTabMobile.addEventListener('click', initOnClick);
        }

        function initVoiceOverGenerator() {
            // DOM Elements
            const generateBtn = document.getElementById('vo-generate-btn');
            const clearTextBtn = document.getElementById('vo-clear-text-btn');
            const copyTextBtn = document.getElementById('vo-copy-text-btn');
            const textInput = document.getElementById('vo-text-input');
            const styleInput = document.getElementById('vo-style-input');
            const voiceList = document.getElementById('vo-voice-list');
            const resultContainer = document.getElementById('vo-result-container');
            const loaderContainer = document.getElementById('vo-loader-container');
            const audioContainer = document.getElementById('vo-audio-container');
            const audioPlayer = document.getElementById('vo-audio-player');
            const audioDuration = document.getElementById('vo-audio-duration');
            const downloadBtn = document.getElementById('vo-download-btn');
            const addToHistoryBtn = document.getElementById('vo-add-to-history-btn');
            const errorMessage = document.getElementById('vo-error-message');
            const charCounter = document.getElementById('vo-char-counter');
            const wordCounter = document.getElementById('vo-word-counter');
            const openGuidanceBtn = document.getElementById('vo-open-guidance-btn');
            const closeGuidanceBtn = document.getElementById('vo-close-guidance-btn');
            const understandBtn = document.getElementById('vo-understand-btn');
            const guidanceModal = document.getElementById('vo-guidance-modal');

            // Control Elements
            const pitchSlider = document.getElementById('vo-pitch-slider');
            const pitchValue = document.getElementById('vo-pitch-value');
            const resetPitchBtn = document.getElementById('vo-reset-pitch-btn');
            const volumeSlider = document.getElementById('vo-volume-slider');
            const volumeValue = document.getElementById('vo-volume-value');
            const resetVolumeBtn = document.getElementById('vo-reset-volume-btn');
            const speedSlider = document.getElementById('vo-speed-slider');
            const speedValue = document.getElementById('vo-speed-value');
            const resetSpeedBtn = document.getElementById('vo-reset-speed-btn');

            // Template & History
            const templateBtns = document.querySelectorAll('.vo-template-btn');
            const historyContainer = document.getElementById('vo-history-container');
            const historyList = document.getElementById('vo-history-list');
            const clearHistoryBtn = document.getElementById('vo-clear-history-btn');

            const CHAR_LIMIT = 5000;
            const previewText = "Halo, ini adalah contoh suara saya untuk pratinjau.";

            const textTemplates = {
                intro: "Halo semuanya! Selamat datang di channel kami. Hari ini kita akan membahas topik yang sangat menarik.",
                narasi: "Di sebuah tempat yang jauh, terdapat sebuah cerita yang belum pernah diceritakan. Cerita tentang keberanian dan pengorbanan.",
                iklan: "Dapatkan penawaran terbaik hari ini! Produk berkualitas tinggi dengan harga yang terjangkau. Jangan lewatkan kesempatan emas ini!",
                podcast: "Terima kasih sudah bergabung di episode kali ini. Mari kita mulai diskusi mendalam tentang topik yang sedang trending."
            };

            const voices = [
                { name: "Puck", gender: "Pria", id: "Puck" },
                { name: "Kore", gender: "Wanita", id: "Kore" },
                { name: "Zephyr", gender: "Wanita", id: "Zephyr" },
                { name: "Fenrir", gender: "Pria", id: "Fenrir" },
                { name: "Achird", gender: "Pria", id: "Achird"},
                { name: "Charon", gender: "Pria", id: "Charon" },
                { name: "Sadachbia", gender: "Pria", id: "Sadachbia" },
                { name: "Sulafat", gender: "Wanita", id: "Sulafat" },
                { name: "Aoede", gender: "Wanita", id: "Aoede" },
                { name: "Umbriel", gender: "Pria", id: "Umbriel" },
                { name: "Gacrux", gender: "Wanita", id: "Gacrux"},
                { name: "Leda", gender: "Wanita", id: "Leda" },
                { name: "Orus", gender: "Pria", id: "Orus" },
                { name: "Enceladus", gender: "Pria", id: "Enceladus" },
                { name: "Algenib", gender: "Pria", id: "Algenib" },
                { name: "Vindemiatrix", gender: "Wanita", id: "Vindemiatrix" },
                { name: "Sadaltager", gender: "Pria", id: "Sadaltager" },
                { name: "Schedar", gender: "Pria", id: "Schedar" },
                { name: "Iapetus", gender: "Pria", id: "Iapetus" },
            ];

            let selectedVoiceId = voices.length > 0 ? voices[0].id : null;
            let currentPreviewAudio = null;
            let audioHistory = JSON.parse(localStorage.getItem('voiceOverHistory') || '[]');
            let currentAudioUrl = null;
            let currentAudioText = '';

            // Text Templates
            templateBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    const template = btn.dataset.template;
                    textInput.value = textTemplates[template] || '';
                    textInput.dispatchEvent(new Event('input'));
                });
            });

            function populateVoiceList() {
                if (!voiceList) {
                    console.error('Voice list element not found!');
                    return;
                }
                console.log('Populating voice list with', voices.length, 'voices');
                voiceList.innerHTML = '';
                voices.forEach((voice, index) => {
                    const voiceItem = document.createElement('div');
                    voiceItem.className = 'voice-item flex items-center justify-between p-3 border border-gray-200 rounded-lg cursor-pointer transition-all hover:bg-blue-50';
                    voiceItem.dataset.voiceId = voice.id;
                    if (index === 0) { voiceItem.classList.add('selected'); }
                    const nameAndGender = document.createElement('div');
                    nameAndGender.innerHTML = `<span class="font-semibold text-gray-800">${voice.name}</span> <span class="text-xs text-gray-500 ml-2 px-2 py-1 bg-gray-200 rounded-full">${voice.gender}</span>`;
                    const previewButton = document.createElement('button');
                    previewButton.className = 'preview-btn text-gray-500 hover:text-blue-600 transition-colors p-1 rounded-full flex items-center justify-center';
                    previewButton.title = `Pratinjau Suara ${voice.name}`;
                    previewButton.dataset.voiceId = voice.id;
                    previewButton.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 pointer-events-none" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z" clip-rule="evenodd" /></svg>`;
                    voiceItem.append(nameAndGender, previewButton);
                    voiceList.appendChild(voiceItem);
                });
                console.log('Voice list populated successfully, items:', voiceList.children.length);
            }
            populateVoiceList();

            // Event delegation for voice selection and preview (works on desktop & mobile)
            voiceList.addEventListener('click', async (e) => {
                e.stopPropagation();

                const previewBtn = e.target.closest('.preview-btn');
                if (previewBtn) {
                    // Handle preview button click
                    if (currentPreviewAudio) { currentPreviewAudio.pause(); }
                    const voiceId = previewBtn.dataset.voiceId;
                    const voice = voices.find(v => v.id === voiceId);
                    if (!voice) return;

                    const originalIcon = previewBtn.innerHTML;
                    previewBtn.innerHTML = `<div class="preview-loader"></div>`;
                    previewBtn.disabled = true;
                    try {
                        const pitch = parseFloat(pitchSlider.value);
                        const volume = parseFloat(volumeSlider.value);
                        const audioUrl = await generateSpeech(previewText, voice.id, pitch, volume);
                        currentPreviewAudio = new Audio(audioUrl);
                        currentPreviewAudio.play();
                        currentPreviewAudio.onended = () => {
                            previewBtn.innerHTML = originalIcon;
                            previewBtn.disabled = false;
                        };
                    } catch (error) {
                        console.error("Preview failed:", error);
                        showError("Gagal membuat pratinjau.");
                        previewBtn.innerHTML = originalIcon;
                        previewBtn.disabled = false;
                    }
                    return;
                }

                // Handle voice item selection
                const voiceItem = e.target.closest('.voice-item');
                if (voiceItem) {
                    document.querySelectorAll('.voice-item').forEach(item => item.classList.remove('selected'));
                    voiceItem.classList.add('selected');
                    selectedVoiceId = voiceItem.dataset.voiceId;
                }
            });

            // Event Listeners for controls
            pitchSlider.addEventListener('input', () => { pitchValue.textContent = parseFloat(pitchSlider.value).toFixed(1); });
            resetPitchBtn.addEventListener('click', () => { pitchSlider.value = 0; pitchSlider.dispatchEvent(new Event('input')); });

            volumeSlider.addEventListener('input', () => {
                const value = parseFloat(volumeSlider.value);
                volumeValue.textContent = `${value.toFixed(1)} dB`;
            });
            resetVolumeBtn.addEventListener('click', () => { volumeSlider.value = 0; volumeSlider.dispatchEvent(new Event('input')); });

            // Speed control
            speedSlider.addEventListener('input', () => {
                const value = parseFloat(speedSlider.value);
                speedValue.textContent = `${value.toFixed(2)}x`;
                if (audioPlayer.src) {
                    audioPlayer.playbackRate = value;
                }
            });
            resetSpeedBtn.addEventListener('click', () => { speedSlider.value = 1; speedSlider.dispatchEvent(new Event('input')); });

            // Text input with word counter
            textInput.addEventListener('input', () => {
                const text = textInput.value;
                const count = text.length;
                const words = text.trim() ? text.trim().split(/\s+/).length : 0;
                charCounter.textContent = `${count} / ${CHAR_LIMIT} characters`;
                wordCounter.textContent = `${words} words`;
                charCounter.classList.toggle('text-red-500', count > CHAR_LIMIT);
            });

            clearTextBtn.addEventListener('click', () => {
                textInput.value = '';
                styleInput.value = '';
                textInput.dispatchEvent(new Event('input'));
                textInput.focus();
            });

            copyTextBtn.addEventListener('click', async () => {
                if (textInput.value) {
                    try {
                        await navigator.clipboard.writeText(textInput.value);
                        copyTextBtn.innerHTML = '<i class="fas fa-check text-green-500"></i>';
                        setTimeout(() => {
                            copyTextBtn.innerHTML = '<i class="fas fa-copy"></i>';
                        }, 2000);
                    } catch(e) {}
                }
            });

            // Modal handlers
            const closeModal = () => { guidanceModal.classList.add('hidden'); };
            if (openGuidanceBtn) openGuidanceBtn.addEventListener('click', () => { guidanceModal.classList.remove('hidden'); });
            if (closeGuidanceBtn) closeGuidanceBtn.addEventListener('click', closeModal);
            if (understandBtn) understandBtn.addEventListener('click', closeModal);
            if (guidanceModal) guidanceModal.addEventListener('click', (event) => { if (event.target === guidanceModal) { closeModal(); } });

            // Audio player listeners
            audioPlayer.addEventListener('play', () => {
                audioContainer.classList.add('playing');
                audioPlayer.playbackRate = parseFloat(speedSlider.value);
            });
            audioPlayer.addEventListener('pause', () => audioContainer.classList.remove('playing'));
            audioPlayer.addEventListener('ended', () => audioContainer.classList.remove('playing'));
            audioPlayer.addEventListener('loadedmetadata', () => {
                const duration = audioPlayer.duration;
                const mins = Math.floor(duration / 60);
                const secs = Math.floor(duration % 60);
                audioDuration.textContent = `${mins}:${secs.toString().padStart(2, '0')}`;
            });

            // Add to history button
            addToHistoryBtn.addEventListener('click', () => {
                if (currentAudioUrl && currentAudioText) {
                    const historyItem = {
                        id: Date.now(),
                        text: currentAudioText.substring(0, 100) + (currentAudioText.length > 100 ? '...' : ''),
                        voiceName: voices.find(v => v.id === selectedVoiceId)?.name || 'Unknown',
                        audioUrl: currentAudioUrl,
                        timestamp: new Date().toLocaleString()
                    };
                    audioHistory.unshift(historyItem);
                    if (audioHistory.length > 10) audioHistory = audioHistory.slice(0, 10);
                    localStorage.setItem('voiceOverHistory', JSON.stringify(audioHistory));
                    renderHistory();
                    // Show feedback
                    addToHistoryBtn.innerHTML = '<i class="fas fa-check mr-2"></i>Saved!';
                    setTimeout(() => {
                        addToHistoryBtn.innerHTML = '<i class="fas fa-save"></i><span>Save to History</span>';
                    }, 2000);
                }
            });

            // Clear history
            clearHistoryBtn.addEventListener('click', () => {
                if (confirm('Clear all audio history?')) {
                    audioHistory = [];
                    localStorage.removeItem('voiceOverHistory');
                    renderHistory();
                }
            });

            // Render history function
            function renderHistory() {
                if (audioHistory.length === 0) {
                    historyContainer.classList.add('hidden');
                    return;
                }

                historyContainer.classList.remove('hidden');
                historyList.innerHTML = '';

                audioHistory.forEach((item) => {
                    const historyItem = document.createElement('div');
                    historyItem.className = 'bg-gradient-to-r from-purple-50 to-pink-50 p-3 rounded-lg border border-purple-200 hover:shadow-md transition-all';
                    historyItem.innerHTML = `
                        <div class="flex items-center justify-between">
                            <div class="flex-1">
                                <p class="text-sm font-semibold text-gray-800 truncate">${item.text}</p>
                                <p class="text-xs text-gray-500 mt-1">
                                    <i class="fas fa-microphone mr-1"></i>${item.voiceName} ‚Ä¢ ${item.timestamp}
                                </p>
                            </div>
                            <div class="flex gap-2 ml-3">
                                <button data-id="${item.id}" data-action="play" class="history-btn text-purple-600 hover:text-purple-800 p-2">
                                    <i class="fas fa-play"></i>
                                </button>
                                <button data-id="${item.id}" data-action="download" class="history-btn text-green-600 hover:text-green-800 p-2">
                                    <i class="fas fa-download"></i>
                                </button>
                                <button data-id="${item.id}" data-action="delete" class="history-btn text-red-600 hover:text-red-800 p-2">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                    `;
                    historyList.appendChild(historyItem);
                });

                // History button event delegation (works on desktop & mobile)
                historyList.addEventListener('click', async (e) => {
                    e.stopPropagation();

                    const btn = e.target.closest('.history-btn');
                    if (!btn) return;

                    const id = parseInt(btn.dataset.id);
                    const action = btn.dataset.action;
                    const item = audioHistory.find(h => h.id === id);
                    if (!item) return;

                    if (action === 'play') {
                        audioPlayer.src = item.audioUrl;
                        audioPlayer.play();
                        resultContainer.classList.remove('hidden');
                        audioContainer.classList.remove('hidden');
                        loaderContainer.classList.add('hidden');
                        errorMessage.classList.add('hidden');
                    } else if (action === 'download') {
                        if (window.downloadDataURINew) {
                            await window.downloadDataURINew(item.audioUrl, `voice-over-${id}.wav`);
                        } else if (window.downloadImage) {
                            await window.downloadImage(item.audioUrl, `voice-over-${id}.wav`);
                        }
                    } else if (action === 'delete') {
                        audioHistory = audioHistory.filter(h => h.id !== id);
                        localStorage.setItem('voiceOverHistory', JSON.stringify(audioHistory));
                        renderHistory();
                    }
                });
            }

            // Initial render of history
            renderHistory();

            // Core Functions
            function base64ToArrayBuffer(base64) {
                const binaryString = window.atob(base64); const len = binaryString.length; const bytes = new Uint8Array(len);
                for (let i = 0; i < len; i++) { bytes[i] = binaryString.charCodeAt(i); } return bytes.buffer;
            }
            function pcmToWav(pcmData, sampleRate) {
                const numChannels = 1; const bitsPerSample = 16; const blockAlign = (numChannels * bitsPerSample) / 8;
                const byteRate = sampleRate * blockAlign; const dataSize = pcmData.byteLength; const buffer = new ArrayBuffer(44 + dataSize);
                const view = new DataView(buffer);
                function writeString(view, offset, string) { for (let i = 0; i < string.length; i++) { view.setUint8(offset + i, string.charCodeAt(i)); } }
                writeString(view, 0, 'RIFF'); view.setUint32(4, 36 + dataSize, true); writeString(view, 8, 'WAVE');
                writeString(view, 12, 'fmt '); view.setUint32(16, 16, true); view.setUint16(20, 1, true);
                view.setUint16(22, numChannels, true); view.setUint32(24, sampleRate, true); view.setUint32(28, byteRate, true);
                view.setUint16(32, blockAlign, true); view.setUint16(34, bitsPerSample, true); writeString(view, 36, 'data');
                view.setUint32(40, dataSize, true);
                const wavBytes = new Uint8Array(buffer); wavBytes.set(new Uint8Array(pcmData), 44);
                return new Blob([wavBytes], { type: 'audio/wav' });
            }
            async function generateSpeech(text, voiceId, pitch, volume, retries = 3, delay = 1000) {
                const apiKey = "";
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-tts:generateContent?key=${apiKey}`;
                const payload = {
                    model: "gemini-2.5-flash-preview-tts",
                    contents: [{ parts: [{ text: text }] }],
                    generationConfig: {
                        responseModalities: ["AUDIO"],
                        speechConfig: {
                            pitch: pitch,
                            volumeGainDb: volume,
                            voiceConfig: { prebuiltVoiceConfig: { voiceName: voiceId } }
                        }
                    },
                };
                try {
                    const response = await fetch(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
                    if (!response.ok) {
                        if (response.status === 429 && retries > 0) { await new Promise(r => setTimeout(r, delay)); return generateSpeech(text, voiceId, pitch, volume, retries - 1, delay * 2); }
                        const errorBody = await response.json(); throw new Error(`API Error: ${response.status} - ${errorBody.error.message}`);
                    }
                    const result = await response.json();
                    const part = result?.candidates?.[0]?.content?.parts?.[0];
                    if (part?.inlineData?.data) {
                        const sampleRate = parseInt(part.inlineData.mimeType.match(/rate=(\d+)/)[1], 10) || 24000;
                        const pcmData = base64ToArrayBuffer(part.inlineData.data);
                        return URL.createObjectURL(pcmToWav(pcmData, sampleRate));
                    } else { throw new Error("Tidak ada data audio yang diterima."); }
                } catch (error) { console.error("API call failed:", error); throw error; }
            }
            generateBtn.addEventListener('click', async () => {
                const mainText = textInput.value.trim();
                const styleText = styleInput.value.trim();

                if (!mainText) {
                    showError('Mohon masukkan teks terlebih dahulu.');
                    return;
                }
                if (mainText.length > CHAR_LIMIT) {
                    showError(`Teks melebihi batas ${CHAR_LIMIT} karakter.`);
                    return;
                }

                let finalText = mainText;
                if (styleText) {
                    finalText = `${styleText}: ${mainText}`;
                }

                setLoadingState(true);

                try {
                    const pitch = parseFloat(pitchSlider.value);
                    const volume = parseFloat(volumeSlider.value);
                    const audioUrl = await generateSpeech(finalText, selectedVoiceId, pitch, volume);

                    // Store for history
                    currentAudioUrl = audioUrl;
                    currentAudioText = mainText;

                    // Set audio player
                    audioPlayer.src = audioUrl;
                    audioPlayer.playbackRate = parseFloat(speedSlider.value);

                    // Set download button
                    downloadBtn.dataset.audioUrl = audioUrl;
                    downloadBtn.dataset.filename = `voice-over-${Date.now()}.wav`;

                    // Show audio container
                    audioContainer.classList.remove('hidden');

                } catch (error) {
                    showError(`Terjadi kesalahan: ${error.message}`);
                } finally {
                    setLoadingState(false);
                }
            });

            // Download button click handler
            downloadBtn.addEventListener('click', async (e) => {
                e.stopPropagation();
                const audioUrl = downloadBtn.dataset.audioUrl;
                const filename = downloadBtn.dataset.filename;
                if (audioUrl && filename) {
                    if (window.downloadDataURINew) {
                        await window.downloadDataURINew(audioUrl, filename);
                    } else if (window.downloadImage) {
                        await window.downloadImage(audioUrl, filename);
                    }
                }
            });

            function setLoadingState(isLoading) {
                generateBtn.disabled = isLoading;
                if (isLoading) {
                    resultContainer.classList.remove('hidden'); loaderContainer.classList.remove('hidden');
                    audioContainer.classList.add('hidden'); errorMessage.classList.add('hidden');
                    generateBtn.innerHTML = 'Membuat...';
                } else {
                    loaderContainer.classList.add('hidden');
                    generateBtn.innerHTML = 'Buat Voice Over';
                }
            }
            function showError(message) {
                resultContainer.classList.remove('hidden'); audioContainer.classList.add('hidden');
                loaderContainer.classList.add('hidden'); errorMessage.textContent = message;
                errorMessage.classList.remove('hidden');
            }
        }
    })();

    // --- STICKER TEMPEL TAB LOGIC ---
    (function() {
        const stickerTab = document.querySelector('[data-tab="sticker"]');
        if (!stickerTab) return;

        stickerTab.addEventListener('click', () => {
            if (!window.stickerInitialized) {
                initStickerTempel();
                window.stickerInitialized = true;
            }
        });

        function initStickerTempel() {
            // DOM Elements
            const imageInput = document.getElementById('sticker-image-input');
            const uploadButton = document.getElementById('sticker-upload-button');
            const generateButton = document.getElementById('sticker-generate-button');
            const imagePreview = document.getElementById('sticker-image-preview');
            const uploadPlaceholder = document.getElementById('sticker-upload-placeholder');

            const loadingSpinner = document.getElementById('sticker-loading-spinner');
            const outputPlaceholder = document.getElementById('sticker-output-placeholder');
            const errorMessage = document.getElementById('sticker-error-message');
            const resultContainer = document.getElementById('sticker-result-container');
            const originalOutputImage = document.getElementById('sticker-original-output-image');
            const stickerWrapper = document.getElementById('sticker-sticker-wrapper');
            const cartoonOutputImage = document.getElementById('sticker-cartoon-output-image');
            const resizeHandle = document.getElementById('sticker-resize-handle');
            const dragInstruction = document.getElementById('sticker-drag-instruction');

            const promptAdditionInput = document.getElementById('sticker-prompt-addition');
            const downloadButton = document.getElementById('sticker-download-button');
            const removeBgButton = document.getElementById('sticker-remove-bg-button');
            const toleranceSliderContainer = document.getElementById('sticker-tolerance-slider-container');
            const toleranceSlider = document.getElementById('sticker-tolerance-slider');
            const buttonContainer = document.getElementById('sticker-button-container');

            let base64ImageData = null;
            let fileMimeType = null;
            let stickerAspectRatio = 1;
            let originalCartoonSrc = null;

            // Event Listeners
            uploadButton.addEventListener('click', () => imageInput.click());
            imageInput.addEventListener('change', handleImageUpload);
            generateButton.addEventListener('click', handleGenerateClick);
            downloadButton.addEventListener('click', handleDownload);
            removeBgButton.addEventListener('click', handleRemoveBackground);
            toleranceSlider.addEventListener('input', (e) => applyChromaKey(e.target.value));

            // Add mobile touch support for download and remove bg buttons
            if (window.addMobileTouchSupport) {
                window.addMobileTouchSupport(downloadButton);
                window.addMobileTouchSupport(removeBgButton);
            }

            makeDraggable(stickerWrapper, resultContainer);
            makeResizable(stickerWrapper, resizeHandle, resultContainer);

            function handleImageUpload(event) {
                const file = event.target.files[0];
                if (!file) return;

                fileMimeType = file.type;

                const reader = new FileReader();
                reader.onload = e => {
                    const dataUrl = e.target.result;
                    imagePreview.src = dataUrl;
                    imagePreview.classList.remove('hidden');
                    uploadPlaceholder.classList.add('hidden');
                    generateButton.disabled = false;

                    base64ImageData = dataUrl.split(',')[1];
                };
                reader.readAsDataURL(file);
            }

            async function handleGenerateClick() {
                if (!base64ImageData || !fileMimeType) {
                    showError("Silakan unggah gambar terlebih dahulu.");
                    return;
                }

                setLoadingState(true);

                const additionalPrompt = promptAdditionInput.value.trim();
                let basePrompt;

                if (additionalPrompt) {
                    basePrompt = `CRITICAL INSTRUCTION: The final image MUST be in a "${additionalPrompt}" style. This is the most important rule. Generate a sticker of the subject from the user's image. The sticker MUST be placed on a solid, vibrant green screen background (color #00FF00). Do NOT use any other background. The subject must be clearly defined against the green background.`;
                } else {
                    basePrompt = "Generate a cartoon/anime style sticker of the main subject. The sticker MUST be placed on a solid, vibrant green screen background (color #00FF00). Do NOT use any other background. The subject must be clearly defined against the green background.";
                }

                try {
                    const generatedImage = await callImageGenerationAPI(basePrompt, base64ImageData, fileMimeType);
                    if (generatedImage) {
                        const imageUrl = `data:image/png;base64,${generatedImage}`;
                        originalCartoonSrc = imageUrl;
                        originalOutputImage.src = imagePreview.src;
                        cartoonOutputImage.src = imageUrl;

                        cartoonOutputImage.onload = () => {
                            stickerAspectRatio = cartoonOutputImage.naturalWidth / cartoonOutputImage.naturalHeight;
                            const newWidth = stickerWrapper.offsetWidth;
                            stickerWrapper.style.height = `${newWidth / stickerAspectRatio}px`;
                        }

                        resultContainer.classList.remove('hidden');
                        stickerWrapper.classList.remove('hidden');
                        dragInstruction.classList.remove('hidden');
                        outputPlaceholder.classList.add('hidden');

                        buttonContainer.classList.remove('grid-cols-1');
                        buttonContainer.classList.add('grid-cols-2');
                        removeBgButton.classList.remove('hidden');
                        downloadButton.classList.remove('hidden');
                        toleranceSliderContainer.classList.add('hidden');

                    } else {
                        showError("Gagal membuat stiker. API tidak memberikan hasil.");
                    }
                } catch (error) {
                    console.error('API call failed:', error);
                    showError(`Terjadi kesalahan: ${error.message}. Silakan coba lagi.`);
                } finally {
                    setLoadingState(false);
                }
            }

            async function callImageGenerationAPI(prompt, imageData, mimeType, retries = 3, delay = 1000) {
                const apiKey = "";
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-image-preview:generateContent?key=${apiKey}`;
                const payload = {
                    contents: [{ parts: [{ text: prompt }, { inlineData: { mimeType, data: imageData } }] }],
                    generationConfig: { responseModalities: ['TEXT', 'IMAGE'] }
                };
                for (let i = 0; i < retries; i++) {
                    try {
                        const response = await fetch(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
                        if (!response.ok) {
                            let errorText = `HTTP error! status: ${response.status} ${response.statusText}`;
                            try { const errorBody = await response.json(); errorText += `, message: ${errorBody?.error?.message || 'No error message'}`; } catch (e) { /* Ignore */ }
                            throw new Error(errorText);
                        }
                        const result = await response.json();
                        const base64Data = result?.candidates?.[0]?.content?.parts?.find(p => p.inlineData)?.inlineData?.data;
                        if (!base64Data) throw new Error("Tidak ada data gambar yang diterima dari API.");
                        return base64Data;
                    } catch (error) {
                        console.error(`Attempt ${i + 1} failed:`, error.message);
                        if (i === retries - 1) throw error;
                        await new Promise(res => setTimeout(res, delay * Math.pow(2, i)));
                    }
                }
            }

            function setLoadingState(isLoading) {
                generateButton.disabled = isLoading;
                generateButton.textContent = isLoading ? 'Membuat...' : 'Buat Stiker!';
                loadingSpinner.classList.toggle('hidden', !isLoading);
                if(isLoading) {
                    resultContainer.classList.add('hidden'); stickerWrapper.classList.add('hidden');
                    downloadButton.classList.add('hidden'); removeBgButton.classList.add('hidden');
                    dragInstruction.classList.add('hidden'); outputPlaceholder.classList.add('hidden');
                    errorMessage.classList.add('hidden'); toleranceSliderContainer.classList.add('hidden');
                }
            }

            function showError(message) {
                errorMessage.textContent = message;
                errorMessage.classList.remove('hidden');
                outputPlaceholder.classList.remove('hidden');
                resultContainer.classList.add('hidden'); stickerWrapper.classList.add('hidden');
                downloadButton.classList.add('hidden'); removeBgButton.classList.add('hidden');
                dragInstruction.classList.add('hidden');
            }

            function handleRemoveBackground() {
                toleranceSliderContainer.classList.remove('hidden');
                removeBgButton.classList.add('hidden');
                buttonContainer.classList.remove('grid-cols-2');
                buttonContainer.classList.add('grid-cols-1');
                applyChromaKey(toleranceSlider.value);
            }

            function applyChromaKey(tolerance) {
                if (!originalCartoonSrc) return;
                const tempImg = new Image();
                tempImg.crossOrigin = "anonymous";
                tempImg.onload = () => {
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');
                    canvas.width = tempImg.naturalWidth;
                    canvas.height = tempImg.naturalHeight;
                    ctx.drawImage(tempImg, 0, 0);

                    const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                    const data = imageData.data;
                    const keyR = 0, keyG = 255, keyB = 0;
                    const toleranceValue = parseInt(tolerance, 10);

                    for (let i = 0; i < data.length; i += 4) {
                        const r = data[i], g = data[i + 1], b = data[i + 2];
                        const distance = Math.sqrt(Math.pow(r - keyR, 2) + Math.pow(g - keyG, 2) + Math.pow(b - keyB, 2));
                        if (distance < toleranceValue) {
                            data[i + 3] = 0;
                        }
                    }
                    ctx.putImageData(imageData, 0, 0);
                    cartoonOutputImage.src = canvas.toDataURL('image/png');
                };
                tempImg.src = originalCartoonSrc;
            }

            function makeDraggable(element, container) {
                let isDragging = false, initialX, initialY;
                const dragStart = (e) => {
                    if (e.target.id === 'sticker-resize-handle') return;
                    isDragging = true;
                    initialX = (e.type === 'touchstart' ? e.touches[0].clientX : e.clientX) - element.offsetLeft;
                    initialY = (e.type === 'touchstart' ? e.touches[0].clientY : e.clientY) - element.offsetTop;
                };
                const dragEnd = () => isDragging = false;
                const drag = (e) => {
                    if (!isDragging) return;
                    e.preventDefault();
                    const currentX = (e.type === 'touchmove' ? e.touches[0].clientX : e.clientX) - initialX;
                    const currentY = (e.type === 'touchmove' ? e.touches[0].clientY : e.clientY) - initialY;
                    const xPos = Math.max(0, Math.min(currentX, container.offsetWidth - element.offsetWidth));
                    const yPos = Math.max(0, Math.min(currentY, container.offsetHeight - element.offsetHeight));
                    element.style.left = `${xPos}px`;
                    element.style.top = `${yPos}px`;
                };
                element.addEventListener("mousedown", dragStart);
                document.addEventListener("mouseup", dragEnd);
                document.addEventListener("mousemove", drag);
                element.addEventListener("touchstart", dragStart, { passive: true });
                document.addEventListener("touchend", dragEnd);
                document.addEventListener("touchmove", drag, { passive: false });
            }
            function makeResizable(element, handle, container) {
                let isResizing = false, initialMouseX, initialWidth;
                const resizeStart = (e) => {
                    e.preventDefault();
                    isResizing = true;
                    initialMouseX = e.type === 'touchstart' ? e.touches[0].clientX : e.clientX;
                    initialWidth = element.offsetWidth;
                    document.addEventListener("mousemove", resize);
                    document.addEventListener("mouseup", resizeEnd);
                    document.addEventListener("touchmove", resize, { passive: false });
                    document.addEventListener("touchend", resizeEnd);
                };
                const resize = (e) => {
                    if (!isResizing) return;
                    e.preventDefault();
                    const currentMouseX = e.type === 'touchmove' ? e.touches[0].clientX : e.clientX;
                    const dx = currentMouseX - initialMouseX;
                    let newWidth = initialWidth + dx;
                    const minWidth = 50;
                    const maxWidth = container.offsetWidth - element.offsetLeft;
                    newWidth = Math.max(minWidth, Math.min(newWidth, maxWidth));
                    element.style.width = `${newWidth}px`;
                    element.style.height = `${newWidth / stickerAspectRatio}px`;
                };
                const resizeEnd = () => {
                    isResizing = false;
                    document.removeEventListener("mousemove", resize);
                    document.removeEventListener("mouseup", resizeEnd);
                    document.removeEventListener("touchmove", resize);
                    document.removeEventListener("touchend", resizeEnd);
                };
                handle.addEventListener("mousedown", resizeStart);
                handle.addEventListener("touchstart", resizeStart, { passive: true });
            }

            function handleDownload() {
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                const originalImg = originalOutputImage;
                const cartoonImg = cartoonOutputImage;

                canvas.width = originalImg.naturalWidth;
                canvas.height = originalImg.naturalHeight;

                ctx.drawImage(originalImg, 0, 0, canvas.width, canvas.height);

                const container = resultContainer;
                const containerWidth = container.offsetWidth;
                const containerHeight = container.offsetHeight;
                const imgNaturalWidth = originalImg.naturalWidth;
                const imgNaturalHeight = originalImg.naturalHeight;

                const containerRatio = containerWidth / containerHeight;
                const imgRatio = imgNaturalWidth / imgNaturalHeight;

                let renderedWidth, renderedHeight, offsetX, offsetY, scale;

                if (imgRatio > containerRatio) {
                    renderedWidth = containerWidth;
                    scale = imgNaturalWidth / renderedWidth;
                    renderedHeight = imgNaturalHeight / scale;
                    offsetX = 0;
                    offsetY = (containerHeight - renderedHeight) / 2;
                } else {
                    renderedHeight = containerHeight;
                    scale = imgNaturalHeight / renderedHeight;
                    renderedWidth = imgNaturalWidth / scale;
                    offsetY = 0;
                    offsetX = (containerWidth - renderedWidth) / 2;
                }

                const adjustedStickerX = stickerWrapper.offsetLeft - offsetX;
                const adjustedStickerY = stickerWrapper.offsetTop - offsetY;

                const finalCanvasX = adjustedStickerX * scale;
                const finalCanvasY = adjustedStickerY * scale;
                const finalCanvasWidth = stickerWrapper.offsetWidth * scale;
                const finalCanvasHeight = stickerWrapper.offsetHeight * scale;

                ctx.drawImage(cartoonImg, finalCanvasX, finalCanvasY, finalCanvasWidth, finalCanvasHeight);

                const imageDataUrl = canvas.toDataURL('image/png');
                if (window.downloadDataURINew) {
                    window.downloadDataURINew(imageDataUrl, 'hasil-stiker.png');
                } else if (window.downloadImage) {
                    window.downloadImage(imageDataUrl, 'hasil-stiker.png');
                }
            }
        }
    })();

    // --- HAIR GENERATOR TAB LOGIC ---
    (function() {
        const hairTab = document.querySelector('.main-tab-btn[data-tab="hair-generator"]');
        const hairTabMobile = document.querySelector('.mobile-tab-btn[data-tab="hair-generator"]');

        const initOnClick = () => {
            if (!window.hairGeneratorInitialized) {
                initHairGenerator();
                window.hairGeneratorInitialized = true;
            }
        };

        if (hairTab) hairTab.addEventListener('click', initOnClick);
        if (hairTabMobile) hairTabMobile.addEventListener('click', initOnClick);

        function initHairGenerator() {
            // Data Pilihan Rambut
            const hairData = {
                wanita: {
                    styles: ["Pixie cut", "Bob cut", "Lob (long bob)", "Shag haircut", "Rambut panjang lurus", "Rambut panjang bergelombang", "Rambut ikal (curly)", "Rambut keriting (kinky)", "Poni (Bangs)", "Poni samping (Side-swept bangs)", "Sanggul (Bun)", "Kuncir kuda (Ponytail)", "Kepang (Braids)", "Gaya Asimetris", "Undercut wanita", "Mullet wanita", "Layered haircut", "Gaya rambut pernikahan", "Gaya rambut formal", "Rambut super pendek"],
                    colors: ["Hitam alami", "Cokelat tua", "Cokelat muda", "Cokelat karamel", "Merah burgundy", "Merah tembaga", "Pirang platinum", "Pirang ash blonde", "Pirang madu", "Rose gold", "Biru tua", "Biru muda", "Ungu lavender", "Ungu tua", "Hijau emerald", "Pink pastel", "Abu-abu (Granny hair)", "Ombre (gelap ke terang)", "Balayage", "Highlight pirang"]
                },
                pria: {
                    styles: ["Crew cut", "Buzz cut", "Undercut", "Fade (high fade)", "Fade (low fade)", "Pompadour", "Quiff", "Slick back", "Man bun", "Comma hair (gaya Korea)", "Two block haircut", "Mullet pria", "Rambut gondrong (panjang)", "Rambut ikal pria", "Caesar cut", "French crop", "Side part", "Spiky hair", "Rambut sedang berantakan", "Rambut super pendek"],
                    colors: ["Hitam alami", "Cokelat tua", "Cokelat muda", "Pirang platinum", "Pirang ash blonde", "Abu-abu", "Salt and pepper", "Biru tua", "Hijau tua", "Merah burgundy", "Highlight tipis", "Cokelat kemerahan", "Pria pirang", "Ungu gelap", "Silver", "Putih", "Cokelat espresso", "Pirang gelap", "Merah jahe", "Warna natural"]
                }
            };

            // DOM Elements
            const imageInput = document.getElementById('hair-image-input');
            const uploadText = document.getElementById('hair-upload-text');
            const previewContainer = document.getElementById('hair-preview-container');
            const imagePreview = document.getElementById('hair-image-preview');
            const removePreviewBtn = document.getElementById('hair-remove-preview');
            const genderWanita = document.getElementById('hair-gender-wanita');
            const genderPria = document.getElementById('hair-gender-pria');
            const styleSelect = document.getElementById('hair-style-select');
            const colorSelect = document.getElementById('hair-color-select');
            const generateBtn = document.getElementById('hair-generate-btn');
            const errorMessage = document.getElementById('hair-error-message');
            const errorText = document.getElementById('hair-error-text');

            const resultsPlaceholder = document.getElementById('hair-results-placeholder');
            const resultsContainer = document.getElementById('hair-results-container');
            const resultsGrid = document.getElementById('hair-results-grid');
            const downloadAllBtn = document.getElementById('hair-download-all-btn');
            const hairRatioBtns = document.querySelectorAll('.hair-ratio-btn');

            let currentGender = 'wanita';
            let originalImageData = null;
            let originalMimeType = '';
            let generatedImages = [];
            let selectedRatio = '3:4';

            // Initialize
            populateSelects(currentGender);

            // Event Listeners
            imageInput.addEventListener('change', handleImageUpload);
            genderWanita.addEventListener('click', () => handleGenderChange('wanita'));
            genderPria.addEventListener('click', () => handleGenderChange('pria'));
            generateBtn.addEventListener('click', generateImages);

            // Remove preview button
            if (removePreviewBtn) {
                removePreviewBtn.addEventListener('click', () => {
                    originalImageData = null;
                    originalMimeType = '';
                    imageInput.value = '';
                    uploadText.textContent = 'Unggah Foto';
                    if (previewContainer) previewContainer.classList.add('hidden');
                    if (imagePreview) imagePreview.src = '';
                    resetResults();
                });
            }

            // Aspect Ratio Selection
            hairRatioBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    hairRatioBtns.forEach(b => {
                        b.classList.remove('hair-ratio-selected', 'bg-blue-600', 'text-white', 'border-blue-500', 'font-medium');
                        b.classList.add('bg-gray-800', 'hover:bg-gray-700', 'text-gray-300', 'border-gray-700');
                    });
                    btn.classList.add('hair-ratio-selected', 'bg-blue-600', 'text-white', 'border-2', 'border-blue-500', 'font-medium');
                    btn.classList.remove('bg-gray-800', 'hover:bg-gray-700', 'text-gray-300', 'border-gray-700');
                    selectedRatio = btn.dataset.value;
                });
            });

            // Download All
            if (downloadAllBtn) {
                downloadAllBtn.addEventListener('click', async () => {
                    if (generatedImages.length === 0) return;
                    downloadAllBtn.disabled = true;
                    downloadAllBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Downloading...';

                    for (let i = 0; i < generatedImages.length; i++) {
                        const img = generatedImages[i];
                        if (window.downloadDataURINew) {
                            await window.downloadDataURINew(img.url, img.filename);
                        } else if (window.downloadImage) {
                            await window.downloadImage(img.url, img.filename);
                        }
                        await new Promise(resolve => setTimeout(resolve, 500));
                    }

                    downloadAllBtn.disabled = false;
                    downloadAllBtn.innerHTML = '<i class="fas fa-download"></i> Download Semua';
                });
            }

            // Event delegation for preview & download buttons
            resultsGrid.addEventListener('click', async (e) => {
                e.stopPropagation();

                const actionBtn = e.target.closest('[data-action]');
                if (!actionBtn) return;

                const action = actionBtn.dataset.action;
                const index = parseInt(actionBtn.dataset.index, 10);
                const imageData = generatedImages[index];

                if (action === 'preview') {
                    window.showPreviewModal(imageData.url);
                } else if (action === 'download') {
                    if (window.downloadDataURINew) {
                        await window.downloadDataURINew(imageData.url, imageData.filename);
                    } else if (window.downloadImage) {
                        await window.downloadImage(imageData.url, imageData.filename);
                    }
                }
            });

            function populateSelects(gender) {
                // Populate styles
                styleSelect.innerHTML = '';
                hairData[gender].styles.forEach(style => {
                    const option = document.createElement('option');
                    option.value = style;
                    option.textContent = style;
                    styleSelect.appendChild(option);
                });

                // Populate colors
                colorSelect.innerHTML = '';
                hairData[gender].colors.forEach(color => {
                    const option = document.createElement('option');
                    option.value = color;
                    option.textContent = color;
                    colorSelect.appendChild(option);
                });
            }

            async function handleImageUpload(e) {
                const file = e.target.files[0];
                if (!file) return;

                let processedFile = file;

                // Convert HEIC to JPEG if needed
                if (file.type === 'image/heic' || file.name.toLowerCase().endsWith('.heic')) {
                    try {
                        uploadText.textContent = 'Converting HEIC...';
                        const convertedBlob = await heic2any({
                            blob: file,
                            toType: 'image/jpeg',
                            quality: 0.9
                        });
                        processedFile = new File([convertedBlob], file.name.replace(/\.heic$/i, '.jpg'), {
                            type: 'image/jpeg'
                        });
                    } catch (err) {
                        console.error('HEIC conversion failed:', err);
                        showError('Gagal mengkonversi gambar HEIC');
                        return;
                    }
                }

                originalMimeType = processedFile.type;
                const reader = new FileReader();
                reader.onloadend = () => {
                    originalImageData = reader.result;
                    uploadText.textContent = 'Ganti Foto';

                    // Show preview image (mobile only)
                    if (imagePreview && previewContainer) {
                        imagePreview.src = reader.result;
                        previewContainer.classList.remove('hidden');
                    }

                    hideError();
                    resetResults();
                };
                reader.onerror = () => {
                    showError("Gagal membaca file gambar.");
                };
                reader.readAsDataURL(processedFile);
            }

            function handleGenderChange(gender) {
                currentGender = gender;
                if (gender === 'wanita') {
                    genderWanita.classList.add('active');
                    genderPria.classList.remove('active');
                } else {
                    genderPria.classList.add('active');
                    genderWanita.classList.remove('active');
                }
                populateSelects(gender);
            }

            async function generateImages() {
                if (!originalImageData) {
                    showError("Silakan unggah foto terlebih dahulu.");
                    return;
                }

                generateBtn.disabled = true;
                generateBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Generating...';
                hideError();
                resetResults();

                resultsPlaceholder.classList.add('hidden');

                const base64ImageData = originalImageData.split(',')[1];
                const apiKey = "";
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-image-preview:generateContent?key=${apiKey}`;

                const selectedStyle = styleSelect.value;
                const selectedColor = colorSelect.value;

                const systemPrompt = "Anda adalah AI ahli penata rambut. Tugas Anda adalah mengedit foto pengguna untuk mengubah gaya dan warna rambut mereka sesuai permintaan. Anda HARUS mempertahankan wajah, fitur wajah, dan latar belakang asli. HANYA ubah rambutnya.";

                generatedImages = [];
                resultsGrid.innerHTML = '';

                // Generate 4 images
                for (let i = 0; i < 4; i++) {
                    try {
                        const userPrompt = `Ubah rambut orang di foto ini menjadi gaya ${selectedStyle} dengan warna ${selectedColor}. Variasi ${i + 1}.`;

                        const payload = {
                            contents: [{
                                parts: [
                                    { text: userPrompt },
                                    { inlineData: { mimeType: originalMimeType, data: base64ImageData } }
                                ]
                            }],
                            systemInstruction: {
                                parts: [{ text: systemPrompt }]
                            },
                            generationConfig: {
                                responseModalities: ['IMAGE'],
                                imageConfig: { aspectRatio: selectedRatio }
                            }
                        };

                        const response = await retryWithBackoff(() =>
                            fetch(apiUrl, {
                                method: 'POST',
                                headers: { 'Content-Type': 'application/json' },
                                body: JSON.stringify(payload)
                            })
                        );

                        const result = await response.json();
                        const imagePart = result?.candidates?.[0]?.content?.parts?.find(p => p.inlineData);

                        if (imagePart && imagePart.inlineData?.data) {
                            const newBase64Data = imagePart.inlineData.data;
                            const imageUrl = `data:image/png;base64,${newBase64Data}`;
                            const filename = `hair-${selectedStyle.replace(/\s+/g, '-')}-${i + 1}.png`;

                            generatedImages.push({ url: imageUrl, filename: filename });

                            // Create image card
                            const card = document.createElement('div');
                            card.className = 'relative group rounded-xl overflow-hidden shadow-lg hover:shadow-2xl transition-all';
                            card.innerHTML = `
                                <img src="${imageUrl}" alt="Hair Result ${i + 1}" class="w-full h-auto object-cover"/>
                                <div class="absolute inset-0 bg-gradient-to-t from-black/80 via-black/40 to-transparent opacity-0 group-hover:opacity-100 transition-opacity flex items-end justify-center pb-4 gap-2">
                                    <button data-action="preview" data-index="${i}" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-semibold transition flex items-center gap-2">
                                        <i class="fas fa-eye"></i>
                                        <span class="hidden sm:inline">Preview</span>
                                    </button>
                                    <button data-action="download" data-index="${i}" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg font-semibold transition flex items-center gap-2">
                                        <i class="fas fa-download"></i>
                                        <span class="hidden sm:inline">Download</span>
                                    </button>
                                </div>
                            `;
                            resultsGrid.appendChild(card);
                        }
                    } catch (err) {
                        console.error(`Error generating image ${i + 1}:`, err);
                    }
                }

                if (generatedImages.length > 0) {
                    resultsContainer.classList.remove('hidden');
                } else {
                    showError("Gagal menghasilkan gambar. Silakan coba lagi.");
                    resultsPlaceholder.classList.remove('hidden');
                }

                generateBtn.disabled = false;
                generateBtn.innerHTML = '<i class="fas fa-magic mr-2"></i>ubah Rambutnya!';
            }

            async function retryWithBackoff(apiCall, maxRetries = 5) {
                let delay = 1000;
                for (let i = 0; i < maxRetries; i++) {
                    try {
                        const response = await apiCall();
                        if (response.ok) {
                            return response;
                        }
                        if (response.status >= 400 && response.status < 500) {
                            throw new Error(`Error klien: ${response.statusText}`);
                        }
                    } catch (error) {
                        if (i === maxRetries - 1) throw error;
                    }
                    await new Promise(resolve => setTimeout(resolve, delay));
                    delay *= 2;
                }
                throw new Error("Gagal memanggil API setelah beberapa kali percobaan.");
            }

            function resetResults() {
                generatedImages = [];
                resultsGrid.innerHTML = '';
                resultsContainer.classList.add('hidden');
                resultsPlaceholder.classList.remove('hidden');
            }

            function showError(message) {
                errorText.textContent = message;
                errorMessage.classList.remove('hidden');
            }

            function hideError() {
                errorMessage.classList.add('hidden');
            }
        }
    })();

    // --- POV TANGAN TAB LOGIC ---
    // Direct initialization like Try-On (no lazy loading)
    (function initPOVTangan() {
            // DOM Elements
            const imageInput = document.getElementById('pov-image-input');
            const uploadArea = document.getElementById('pov-upload-area');
            const uploadPlaceholder = document.getElementById('pov-upload-placeholder');
            const previewContainer = document.getElementById('pov-preview-container');
            const previewImage = document.getElementById('pov-preview-image');
            const productDescription = document.getElementById('pov-product-description');
            const generateBtn = document.getElementById('pov-generate-btn');
            const loadingSection = document.getElementById('pov-loading-section');
            const progressText = document.getElementById('pov-progress-text');
            const progressBar = document.getElementById('pov-progress-bar');
            const resultsSection = document.getElementById('pov-results-section');
            const resultCount = document.getElementById('pov-result-count');
            const resultsGrid = document.getElementById('pov-results-grid');
            const downloadAllBtn = document.getElementById('pov-download-all-btn');
            const errorSection = document.getElementById('pov-error-section');
            const errorMessage = document.getElementById('pov-error-message');
            const retryBtn = document.getElementById('pov-retry-btn');

            // Custom Background Elements (NEW)
            const bgInput = document.getElementById('pov-bg-input');
            const bgUploadArea = document.getElementById('pov-bg-upload-area');
            const bgPlaceholder = document.getElementById('pov-bg-placeholder');
            const bgPreviewContainer = document.getElementById('pov-bg-preview-container');
            const bgPreviewImage = document.getElementById('pov-bg-preview-image');
            const bgRemoveBtn = document.getElementById('pov-bg-remove-btn');

            let uploadedImageData = null;
            let uploadedBackgroundData = null;
            let backgroundStyleDescription = null;
            let generatedImages = [];
            let generatedImageParams = []; // Track parameters for each image
            let selectedPovRatio = '16:9';
            let selectedHandCount = '1'; // Default 1 tangan
            let currentThemesToUse = []; // Store current themes for regeneration

            // POV Themes - berbagai setting aesthetic untuk background
            const povThemes = [
                "POV from above showing a hand holding the product on a soft pink aesthetic study desk with white pegboard wall, cute stationery cups, heart-shaped mirror, soft yellow lamp, tidy layout, cozy lighting, realistic 4k photo, shallow depth of field",
                "Top-down angle at 40 degrees showing a hand holding the product on a pastel desk setup with tulip vase, soft desk mat, washi tapes, and white lamp, warm daylight, feminine cozy mood, ultra-detailed lifestyle photo",
                "POV showing a hand delicately holding the product above a pastel pink workspace with white pegboard full of stationery cups, washi tapes, mini photos, heart mirror, pink lamp, tulip vase, natural lighting, cozy feminine tone",
                "Slightly top-view of a hand holding the product over a mint green and white-themed desk filled with plants, pastel organizers, hanging notes, pen holders, bright daylight tone, fresh and cozy look",
                "Standing POV of a hand holding the product above a lavender and white aesthetic desk with pegboard full of washi tapes, small artworks, headphones, notebooks, vases with tulips, clean daylight photo",
                "Hand holding the product in POV angle above a white marble desk with gold accents, minimalist aesthetic, soft natural window light, elegant and clean composition",
                "POV of a hand holding the product over a wooden rustic desk with green plants, terracotta pots, natural fiber mat, warm earthy tones, bohemian aesthetic"
            ];

            // Event Listeners - Using Try-On pattern
            // Main product image upload
            if (uploadArea && imageInput) {
                uploadArea.addEventListener('click', () => imageInput.click());
                uploadArea.addEventListener('dragover', (e) => { e.preventDefault(); uploadArea.style.borderColor = '#764ba2'; });
                uploadArea.addEventListener('dragleave', () => uploadArea.style.borderColor = '');
                uploadArea.addEventListener('drop', (e) => {
                    e.preventDefault();
                    uploadArea.style.borderColor = '';
                    if (e.dataTransfer.files[0]) processImage(e.dataTransfer.files[0]);
                });
                imageInput.addEventListener('change', (e) => { if (e.target.files[0]) processImage(e.target.files[0]); });
            }

            // Background image upload
            if (bgUploadArea && bgInput) {
                bgUploadArea.addEventListener('click', () => bgInput.click());
                bgUploadArea.addEventListener('dragover', (e) => { e.preventDefault(); bgUploadArea.style.borderColor = '#764ba2'; });
                bgUploadArea.addEventListener('dragleave', () => bgUploadArea.style.borderColor = '');
                bgUploadArea.addEventListener('drop', (e) => {
                    e.preventDefault();
                    bgUploadArea.style.borderColor = '';
                    if (e.dataTransfer.files[0]) processBgImage(e.dataTransfer.files[0]);
                });
                bgInput.addEventListener('change', (e) => { if (e.target.files[0]) processBgImage(e.target.files[0]); });
            }

            bgRemoveBtn.addEventListener('click', removeBackgroundImage);
            generateBtn.addEventListener('click', startGeneration);
            retryBtn.addEventListener('click', resetForm);

            // Ratio selection event listener
            const ratioSelection = document.getElementById('pov-ratio-selection');
            if (ratioSelection) {
                ratioSelection.addEventListener('click', (e) => {
                    const button = e.target.closest('.ratio-btn-pov');
                    if (button) {
                        document.querySelectorAll('#pov-ratio-selection .ratio-btn-pov').forEach(btn => btn.classList.remove('selected'));
                        button.classList.add('selected');
                        selectedPovRatio = button.dataset.ratio;
                    }
                });
            }

            // Hand count selection event listener
            const handCountSelection = document.getElementById('pov-hand-count-selection');
            if (handCountSelection) {
                handCountSelection.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const button = e.target.closest('.hand-count-btn-pov');
                    if (button) {
                        document.querySelectorAll('#pov-hand-count-selection .hand-count-btn-pov').forEach(btn => btn.classList.remove('selected'));
                        button.classList.add('selected');
                        selectedHandCount = button.dataset.handCount;
                    }
                });
            }

            function processImage(file) {
                if (file.size > 10 * 1024 * 1024) {
                    showError('Ukuran file terlalu besar. Maksimal 10MB.');
                    return;
                }

                const reader = new FileReader();
                reader.onload = (e) => {
                    uploadedImageData = e.target.result;
                    previewImage.src = uploadedImageData;
                    uploadPlaceholder.classList.add('hidden');
                    previewContainer.classList.remove('hidden');
                    uploadArea.classList.add('has-image');
                    generateBtn.disabled = false;
                    hideError();
                };
                reader.readAsDataURL(file);
            }

            // Custom Background Handlers (NEW)
            async function processBgImage(file) {
                if (file.size > 10 * 1024 * 1024) {
                    showError('Ukuran file background terlalu besar. Maksimal 10MB.');
                    return;
                }

                const reader = new FileReader();
                reader.onload = (e) => {
                    uploadedBackgroundData = e.target.result;
                    bgPreviewImage.src = uploadedBackgroundData;
                    bgPlaceholder.classList.add('hidden');
                    bgPreviewContainer.classList.remove('hidden');
                    bgUploadArea.classList.add('has-image');

                    // No need to analyze, we'll use the image directly
                    backgroundStyleDescription = 'custom'; // Flag that custom bg is present
                };
                reader.readAsDataURL(file);
            }

            function removeBackgroundImage(e) {
                e.stopPropagation();
                uploadedBackgroundData = null;
                backgroundStyleDescription = null;
                bgPreviewImage.src = '';
                bgPlaceholder.classList.remove('hidden');
                bgPreviewContainer.classList.add('hidden');
                bgUploadArea.classList.remove('has-image');
                bgInput.value = '';
            }


            // Retry mechanism sama seperti Miniature Me
            async function generateImageWithRetry(payload, retries = 3, delay = 1000) {
                for (let i = 0; i < retries; i++) {
                    try {
                        const apiKey = "";
                        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-image-preview:generateContent?key=${apiKey}`;
                        const response = await fetch(apiUrl, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(payload)
                        });
                        const responseText = await response.text();

                        if (!response.ok) {
                            let errorMsg = response.statusText;
                            try {
                                errorMsg = JSON.parse(responseText).error?.message || errorMsg;
                            } catch(e) {
                                if(responseText) errorMsg = responseText;
                            }
                            throw new Error(`API Error: ${errorMsg}`);
                        }

                        try {
                            return JSON.parse(responseText);
                        } catch (e) {
                            throw new Error("Invalid JSON response.");
                        }
                    } catch (error) {
                        console.error(`Attempt ${i + 1} failed:`, error);
                        if (i === retries - 1) return null;
                        await new Promise(res => setTimeout(res, delay * Math.pow(2, i)));
                    }
                }
                return null;
            }

            async function startGeneration() {
                if (!uploadedImageData) {
                    showError('Silakan upload foto produk terlebih dahulu.');
                    return;
                }

                // Reset states
                generatedImages = [];
                generatedImageParams = [];
                currentThemesToUse = [];
                resultsGrid.innerHTML = '';
                hideError();
                resultsSection.classList.add('hidden');
                loadingSection.classList.remove('hidden');
                generateBtn.disabled = true;

                const productDesc = productDescription.value.trim();
                const base64Image = uploadedImageData.split(',')[1];

                // Determine themes to use
                let themesToUse;
                if (backgroundStyleDescription && uploadedBackgroundData) {
                    // If custom background, create 7 simple variations for compositing
                    const angles = [
                        'POV from above', 'top-down view at 45 degrees', 'elevated overhead angle',
                        'standing POV perspective', 'slightly raised view', 'bird eye perspective',
                        'high angle shot'
                    ];

                    themesToUse = angles;
                } else {
                    // Use default themes
                    themesToUse = povThemes;
                }

                // Store current themes for regeneration
                currentThemesToUse = [...themesToUse];

                // Generate 7 images sequentially in batches to avoid rate limits
                const batchSize = 3; // Generate 3 at a time
                const batches = [];
                for (let i = 0; i < themesToUse.length; i += batchSize) {
                    batches.push(themesToUse.slice(i, i + batchSize));
                }

                try {
                    const results = [];

                    for (const [batchIndex, batch] of batches.entries()) {
                        const batchPromises = batch.map((theme, themeIndex) => {
                            let prompt = '';
                            let payloadParts = [];

                            if (backgroundStyleDescription && uploadedBackgroundData) {
                                // With custom background - composite mode
                                const base64Background = uploadedBackgroundData.split(',')[1];
                                const handInstruction = selectedHandCount === '2' ? 'both hands (two hands)' : 'one hand';

                                prompt = `Create a composite product photography image by combining these elements:

IMAGE 1 (Background Environment): Use this as the base scene/location
IMAGE 2 (Product): The product to be placed in the scene

Task: Place the product from IMAGE 2 into the environment from IMAGE 1, with ${handInstruction} naturally holding it.

Requirements:
- Camera angle: ${theme}
- Use EXACTLY ${handInstruction} holding the product naturally${productDesc ? `, product is: ${productDesc}` : ''}
- ${selectedHandCount === '2' ? 'Show BOTH hands clearly visible holding/supporting the product from different sides' : 'Show ONE hand only holding the product'}
- The background/environment MUST be from IMAGE 1 (same location, same setting)
- The product MUST be from IMAGE 2
- Blend lighting and colors so product fits naturally in the environment
- Make it look like a real photo taken in that location
- Hand(s) should match the scene lighting
- Professional 4K quality, realistic composition

IMPORTANT: Use the EXACT environment/location from IMAGE 1 as the background. Do not create a different background.`;

                                payloadParts = [
                                    { text: prompt },
                                    { inlineData: { mimeType: "image/jpeg", data: base64Background } },
                                    { inlineData: { mimeType: "image/jpeg", data: base64Image } }
                                ];
                            } else {
                                // Without custom background - use AI generated background
                                const handInstruction = selectedHandCount === '2' ? 'both hands (two hands)' : 'one hand';
                                const handDescription = selectedHandCount === '2' ? 'BOTH hands clearly visible holding/supporting the product from different sides' : 'ONE hand only holding the product';

                                prompt = `POV product photography: ${handInstruction} holding product. `;

                                // If user provides background description, use it. Otherwise use theme
                                if (productDesc) {
                                    prompt += `Background setting: ${productDesc}. `;
                                } else {
                                    prompt += `${theme}. `;
                                }

                                prompt += `Use EXACTLY ${handInstruction}. ${handDescription}. Natural hand pose, product clearly visible, professional 4K quality, realistic lighting and composition.`;

                                payloadParts = [
                                    { text: prompt },
                                    { inlineData: { mimeType: "image/jpeg", data: base64Image } }
                                ];
                            }

                            const payload = {
                                contents: [{
                                    parts: payloadParts
                                }],
                                generationConfig: {
                                    responseModalities: ['IMAGE'],
                                    imageConfig: { aspectRatio: selectedPovRatio }
                                }
                            };

                            return generateImageWithRetry(payload);
                        });

                        const batchResults = await Promise.all(batchPromises);
                        results.push(...batchResults);

                        // Update progress for this batch
                        const totalProcessed = (batchIndex + 1) * batchSize;
                        const currentCount = Math.min(totalProcessed, themesToUse.length);
                        updateProgress(currentCount);

                        // Small delay between batches
                        if (batchIndex < batches.length - 1) {
                            await new Promise(resolve => setTimeout(resolve, 500));
                        }
                    }

                    results.forEach((result, index) => {
                        const base64Data = result?.candidates?.[0]?.content?.parts?.find(p => p.inlineData)?.inlineData?.data;

                        if (base64Data) {
                            const imageUrl = `data:image/png;base64,${base64Data}`;
                            generatedImages.push(imageUrl);

                            // Store generation parameters for this image
                            generatedImageParams.push({
                                theme: themesToUse[index],
                                productData: uploadedImageData,
                                backgroundData: uploadedBackgroundData,
                                backgroundDesc: backgroundStyleDescription,
                                productDesc: productDesc,
                                ratio: selectedPovRatio,
                                handCount: selectedHandCount
                            });

                            displayImage(imageUrl, index + 1, themesToUse[index]);
                        } else {
                            console.warn(`Image ${index + 1} generation failed`);
                        }
                    });

                    // Final progress update
                    updateProgress(generatedImages.length);

                    // Show results
                    loadingSection.classList.add('hidden');
                    resultsSection.classList.remove('hidden');
                    resultCount.textContent = generatedImages.length;
                    generateBtn.disabled = false;

                    if (generatedImages.length === 0) {
                        showError('Tidak ada gambar yang berhasil digenerate. Silakan coba lagi.');
                    }

                } catch (error) {
                    console.error('Generation error:', error);
                    loadingSection.classList.add('hidden');
                    showError('Terjadi kesalahan saat generate gambar: ' + error.message);
                    generateBtn.disabled = false;
                }
            }

            function updateProgress(current) {
                const percentage = (current / 7) * 100;
                progressText.textContent = `${current}/7`;
                progressBar.style.width = `${percentage}%`;
            }

            function displayImage(imageData, index, theme) {
                const card = document.createElement('div');
                card.className = 'result-card';
                card.setAttribute('data-index', index - 1);
                const safeTheme = theme ? theme.replace(/"/g, '&quot;') : '';
                card.innerHTML = `
                    <img src="${imageData}" alt="POV Tangan ${index}" />
                    <div class="result-card-actions">
                        <button class="btn-preview" data-action="preview" data-image-url="${imageData}">
                            <i class="fas fa-search-plus"></i>
                            Preview
                        </button>
                        <button class="btn-edit" data-action="edit" data-index="${index - 1}" data-theme="${safeTheme}">
                            <i class="fas fa-edit"></i>
                            Edit
                        </button>
                        <button class="btn-regenerate" data-action="regenerate" data-index="${index - 1}">
                            <i class="fas fa-sync-alt"></i>
                            Regenerate
                        </button>
                        <button class="btn-download" data-action="download" data-image-url="${imageData}" data-filename="pov-tangan-${index}.jpg">
                            <i class="fas fa-download"></i>
                            Download
                        </button>
                    </div>
                    <div class="image-counter">#${index}</div>
                `;

                resultsGrid.appendChild(card);
            }

            // Function to handle edit POV
            function handleEditPov(index, currentTheme) {
                const modal = document.createElement('div');
                modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4';
                modal.innerHTML = `
                    <div class="bg-white rounded-xl p-6 max-w-2xl w-full">
                        <h3 class="text-xl font-bold mb-4 text-gray-800">
                            <i class="fas fa-edit text-purple-500 mr-2"></i>Edit POV Theme/Angle
                        </h3>
                        <div class="mb-4">
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Theme/Camera Angle:</label>
                            <textarea id="edit-pov-input" rows="4" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-purple-500 focus:outline-none resize-none" placeholder="Contoh: POV from above on pink desk with stationery, top-down view on aesthetic workspace, etc...">${currentTheme}</textarea>
                            <p class="text-xs text-gray-500 mt-2">
                                <i class="fas fa-info-circle mr-1"></i>
                                Deskripsi angle/perspektif dan background yang diinginkan
                            </p>
                        </div>
                        <div class="flex gap-2">
                            <button onclick="this.closest('.fixed').remove()" class="flex-1 bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-lg transition-colors">
                                Batal
                            </button>
                            <button id="confirm-edit-pov-btn" class="flex-1 bg-purple-500 hover:bg-purple-600 text-white font-bold py-2 px-4 rounded-lg transition-colors">
                                <i class="fas fa-check mr-2"></i>Generate Ulang
                            </button>
                        </div>
                    </div>
                `;
                document.body.appendChild(modal);

                const confirmBtn = modal.querySelector('#confirm-edit-pov-btn');
                const themeInput = modal.querySelector('#edit-pov-input');

                confirmBtn.addEventListener('click', async () => {
                    const newTheme = themeInput.value.trim();
                    if (!newTheme) return;

                    modal.remove();

                    // Update the theme for this image
                    generatedImageParams[index].theme = newTheme;
                    currentThemesToUse[index] = newTheme;

                    await handleRegeneratePov(index);
                });
            }

            // Function to handle regenerate POV
            async function handleRegeneratePov(index) {
                const resultCards = resultsGrid.querySelectorAll('.result-card');
                const targetCard = resultCards[index];
                if (!targetCard) return;

                const params = generatedImageParams[index];
                if (!params) return;

                // Show loading state
                targetCard.innerHTML = `
                    <div class="flex flex-col items-center justify-center h-full min-h-[200px]">
                        <div class="loader !border-l-purple-500"></div>
                        <p class="mt-4 text-sm text-gray-600">Regenerating...</p>
                    </div>
                `;

                try {
                    const base64Product = params.productData.split(',')[1];
                    let prompt = '';
                    let payloadParts = [];

                    if (params.backgroundDesc && params.backgroundData) {
                        const base64Background = params.backgroundData.split(',')[1];
                        prompt = `Create a composite product photography image by combining these elements:

IMAGE 1 (Background Environment): Use this as the base scene/location
IMAGE 2 (Product): The product to be placed in the scene

Task: Place the product from IMAGE 2 into the environment from IMAGE 1, with a hand naturally holding it.

Requirements:
- Camera angle: ${params.theme}
- Hand holding the product naturally${params.productDesc ? `, product is: ${params.productDesc}` : ''}
- The background/environment MUST be from IMAGE 1 (same location, same setting)
- The product MUST be from IMAGE 2
- Blend lighting and colors so product fits naturally in the environment
- Make it look like a real photo taken in that location
- Hand should match the scene lighting
- Professional 4K quality, realistic composition

IMPORTANT: Use the EXACT environment/location from IMAGE 1 as the background. Do not create a different background.`;

                        payloadParts = [
                            { text: prompt },
                            { inlineData: { mimeType: "image/jpeg", data: base64Background } },
                            { inlineData: { mimeType: "image/jpeg", data: base64Product } }
                        ];
                    } else {
                        prompt = `POV product photography: hand holding product. `;

                        if (params.productDesc) {
                            prompt += `Background setting: ${params.productDesc}. `;
                        } else {
                            prompt += `${params.theme}. `;
                        }

                        prompt += `Natural hand pose, product clearly visible, professional 4K quality, realistic lighting and composition.`;

                        payloadParts = [
                            { text: prompt },
                            { inlineData: { mimeType: "image/jpeg", data: base64Product } }
                        ];
                    }

                    const payload = {
                        contents: [{ parts: payloadParts }],
                        generationConfig: {
                            responseModalities: ['IMAGE'],
                            imageConfig: { aspectRatio: params.ratio }
                        }
                    };

                    const result = await generateImageWithRetry(payload);
                    const base64Data = result?.candidates?.[0]?.content?.parts?.find(p => p.inlineData)?.inlineData?.data;

                    if (base64Data) {
                        const imageUrl = `data:image/png;base64,${base64Data}`;

                        // Update stored image
                        generatedImages[index] = imageUrl;

                        // Redisplay the card
                        const safeTheme = params.theme.replace(/"/g, '&quot;');
                        targetCard.innerHTML = `
                            <img src="${imageUrl}" alt="POV Tangan ${index + 1}" />
                            <div class="result-card-actions">
                                <button class="btn-preview" data-action="preview" data-image-url="${imageUrl}">
                                    <i class="fas fa-search-plus"></i>
                                    Preview
                                </button>
                                <button class="btn-edit" data-action="edit" data-index="${index}" data-theme="${safeTheme}">
                                    <i class="fas fa-edit"></i>
                                    Edit
                                </button>
                                <button class="btn-regenerate" data-action="regenerate" data-index="${index}">
                                    <i class="fas fa-sync-alt"></i>
                                    Regenerate
                                </button>
                                <button class="btn-download" data-action="download" data-image-url="${imageUrl}" data-filename="pov-tangan-${index + 1}.jpg">
                                    <i class="fas fa-download"></i>
                                    Download
                                </button>
                            </div>
                            <div class="image-counter">#${index + 1}</div>
                        `;
                    } else {
                        throw new Error('Failed to generate image');
                    }
                } catch (error) {
                    console.error('Regenerate error:', error);
                    targetCard.innerHTML = `
                        <div class="flex flex-col items-center justify-center h-full min-h-[200px] text-red-600">
                            <i class="fas fa-exclamation-triangle text-3xl mb-2"></i>
                            <p class="text-sm">Gagal regenerate</p>
                            <button onclick="location.reload()" class="mt-2 text-xs bg-red-500 text-white px-3 py-1 rounded-full hover:bg-red-600">
                                Refresh
                            </button>
                        </div>
                    `;
                }
            }

            // Event handling for action buttons (works on desktop & mobile)
            resultsGrid.addEventListener('click', async (e) => {
                e.stopPropagation();

                const actionIcon = e.target.closest('[data-action]');
                if (!actionIcon) return;

                const action = actionIcon.dataset.action;
                const imageUrl = actionIcon.dataset.imageUrl;
                const index = actionIcon.dataset.index;
                const theme = actionIcon.dataset.theme;

                if (action === 'preview') {
                    showPreviewModal(imageUrl);
                } else if (action === 'edit') {
                    handleEditPov(parseInt(index), theme);
                } else if (action === 'regenerate') {
                    await handleRegeneratePov(parseInt(index));
                } else if (action === 'download') {
                    const filename = actionIcon.dataset.filename;
                    if (window.downloadDataURINew) {
                        await window.downloadDataURINew(imageUrl, filename);
                    }
                }
            });

            // Download all button event handlers (works on desktop & mobile like Umrah)
            if (downloadAllBtn) {
                downloadAllBtn.addEventListener('click', async () => {
                    if (generatedImages.length === 0) return;

                    downloadAllBtn.disabled = true;
                    downloadAllBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Downloading...';

                    for (let i = 0; i < generatedImages.length; i++) {
                        if (window.downloadDataURINew) {
                            await window.downloadDataURINew(generatedImages[i], `pov-tangan-${i + 1}.jpg`);
                            // Small delay between downloads for better UX
                            await new Promise(resolve => setTimeout(resolve, 500));
                        }
                    }

                    downloadAllBtn.disabled = false;
                    downloadAllBtn.innerHTML = '<i class="fas fa-download mr-2"></i>Download Semua';
                });
            }

            function showPreviewModal(imageUrl) {
                const modal = document.createElement('div');
                modal.className = 'image-preview-modal';
                modal.innerHTML = `
                    <div class="preview-modal-overlay"></div>
                    <div class="preview-modal-content">
                        <button class="preview-close-btn" aria-label="Close">
                            <i class="fas fa-times"></i>
                        </button>
                        <img src="${imageUrl}" alt="Preview" class="preview-modal-image">
                    </div>
                `;
                document.body.appendChild(modal);

                // Close modal handlers
                const closeBtn = modal.querySelector('.preview-close-btn');
                const overlay = modal.querySelector('.preview-modal-overlay');

                const closeModal = () => {
                    modal.classList.add('closing');
                    setTimeout(() => modal.remove(), 300);
                };

                closeBtn.addEventListener('click', closeModal);
                overlay.addEventListener('click', closeModal);

                // ESC key to close
                const handleEsc = (e) => {
                    if (e.key === 'Escape') {
                        closeModal();
                        document.removeEventListener('keydown', handleEsc);
                    }
                };
                document.addEventListener('keydown', handleEsc);

                // Touch feedback for mobile
                closeBtn.addEventListener('touchstart', function() {
                    this.style.transform = 'scale(0.9)';
                }, { passive: true });
                closeBtn.addEventListener('touchend', function() {
                    this.style.transform = '';
                }, { passive: true });

                // Animate in
                setTimeout(() => modal.classList.add('show'), 10);
            }

            function showError(message) {
                errorMessage.textContent = message;
                errorSection.classList.remove('hidden');
            }

            function hideError() {
                errorSection.classList.add('hidden');
            }

            function resetForm() {
                uploadedImageData = null;
                uploadedBackgroundData = null;
                backgroundStyleDescription = null;
                generatedImages = [];
                uploadPlaceholder.classList.remove('hidden');
                previewContainer.classList.add('hidden');
                uploadArea.classList.remove('has-image');
                bgPlaceholder.classList.remove('hidden');
                bgPreviewContainer.classList.add('hidden');
                bgUploadArea.classList.remove('has-image');
                productDescription.value = '';
                generateBtn.disabled = true;
                resultsSection.classList.add('hidden');
                resultsGrid.innerHTML = '';
                hideError();
                progressBar.style.width = '0%';
                progressText.textContent = '0/7';
            }
        })();

        // === MOCKUP STUDIO INITIALIZATION ===
        // Direct initialization like Try-On (no lazy loading)
        (function initMockupStudio() {
            // DOM Elements
            const designInput = document.getElementById('mockup-design-input');
            const uploadArea = document.getElementById('mockup-upload-area');
            const uploadPlaceholder = document.getElementById('mockup-upload-placeholder');
            const previewContainer = document.getElementById('mockup-preview-container');
            const previewImage = document.getElementById('mockup-preview-image');

            const templateInput = document.getElementById('mockup-template-input');
            const templateUploadArea = document.getElementById('mockup-template-upload-area');
            const templatePlaceholder = document.getElementById('mockup-template-placeholder');
            const templatePreviewContainer = document.getElementById('mockup-template-preview-container');
            const templatePreviewImage = document.getElementById('mockup-template-preview-image');
            const templateRemoveBtn = document.getElementById('mockup-template-remove-btn');

            const themeInput = document.getElementById('mockup-theme-input');
            const generateBtn = document.getElementById('mockup-generate-btn');
            const loadingSection = document.getElementById('mockup-loading-section');
            const progressText = document.getElementById('mockup-progress-text');
            const progressBar = document.getElementById('mockup-progress-bar');
            const resultsSection = document.getElementById('mockup-results-section');
            const resultCount = document.getElementById('mockup-result-count');
            const resultsGrid = document.getElementById('mockup-results-grid');
            const downloadAllBtn = document.getElementById('mockup-download-all-btn');
            const errorSection = document.getElementById('mockup-error-section');
            const errorMessage = document.getElementById('mockup-error-message');
            const retryBtn = document.getElementById('mockup-retry-btn');

            let uploadedDesignData = null;
            let uploadedTemplateData = null;
            let generatedMockups = [];
            let generatedMockupParams = []; // Track parameters for each mockup
            let selectedMockupRatio = '16:9';
            let currentMockupThemes = []; // Store current themes for regeneration

            // Default mockup themes
            const defaultMockupThemes = [
                'white ceramic coffee mug on wooden desk',
                't-shirt mockup laid flat on white background',
                'smartphone screen mockup in hand',
                'poster frame mockup on white wall',
                'book cover mockup on wooden table',
                'tote bag mockup on solid background',
                'business card mockup on desk'
            ];

            // Event Listeners - Using Try-On pattern
            // Main design upload
            if (uploadArea && designInput) {
                uploadArea.addEventListener('click', () => designInput.click());
                uploadArea.addEventListener('dragover', (e) => { e.preventDefault(); uploadArea.style.borderColor = '#764ba2'; });
                uploadArea.addEventListener('dragleave', () => uploadArea.style.borderColor = '');
                uploadArea.addEventListener('drop', (e) => {
                    e.preventDefault();
                    uploadArea.style.borderColor = '';
                    if (e.dataTransfer.files[0]) processDesign(e.dataTransfer.files[0]);
                });
                designInput.addEventListener('change', (e) => { if (e.target.files[0]) processDesign(e.target.files[0]); });
            }

            // Template upload
            if (templateUploadArea && templateInput) {
                templateUploadArea.addEventListener('click', () => templateInput.click());
                templateUploadArea.addEventListener('dragover', (e) => { e.preventDefault(); templateUploadArea.style.borderColor = '#764ba2'; });
                templateUploadArea.addEventListener('dragleave', () => templateUploadArea.style.borderColor = '');
                templateUploadArea.addEventListener('drop', (e) => {
                    e.preventDefault();
                    templateUploadArea.style.borderColor = '';
                    if (e.dataTransfer.files[0]) processTemplate(e.dataTransfer.files[0]);
                });
                templateInput.addEventListener('change', (e) => { if (e.target.files[0]) processTemplate(e.target.files[0]); });
            }

            templateRemoveBtn.addEventListener('click', removeTemplate);

            generateBtn.addEventListener('click', startGeneration);
            retryBtn.addEventListener('click', resetForm);

            // Ratio selection event listener
            const ratioSelection = document.getElementById('mockup-ratio-selection');
            if (ratioSelection) {
                ratioSelection.addEventListener('click', (e) => {
                    const button = e.target.closest('.ratio-btn-mockup');
                    if (button) {
                        document.querySelectorAll('#mockup-ratio-selection .ratio-btn-mockup').forEach(btn => btn.classList.remove('selected'));
                        button.classList.add('selected');
                        selectedMockupRatio = button.dataset.ratio;
                    }
                });
            }

            function processDesign(file) {
                if (file.size > 10 * 1024 * 1024) {
                    showError('Ukuran file terlalu besar. Maksimal 10MB.');
                    return;
                }

                const reader = new FileReader();
                reader.onload = (e) => {
                    uploadedDesignData = e.target.result;
                    previewImage.src = uploadedDesignData;
                    uploadPlaceholder.classList.add('hidden');
                    previewContainer.classList.remove('hidden');
                    uploadArea.classList.add('has-image');
                    generateBtn.disabled = false;
                    hideError();
                };
                reader.readAsDataURL(file);
            }

            function processTemplate(file) {
                if (file.size > 10 * 1024 * 1024) {
                    showError('Ukuran file template terlalu besar. Maksimal 10MB.');
                    return;
                }

                const reader = new FileReader();
                reader.onload = (e) => {
                    uploadedTemplateData = e.target.result;
                    templatePreviewImage.src = uploadedTemplateData;
                    templatePlaceholder.classList.add('hidden');
                    templatePreviewContainer.classList.remove('hidden');
                    templateUploadArea.classList.add('has-image');
                };
                reader.readAsDataURL(file);
            }

            function removeTemplate(e) {
                e.stopPropagation();
                uploadedTemplateData = null;
                templatePreviewImage.src = '';
                templatePlaceholder.classList.remove('hidden');
                templatePreviewContainer.classList.add('hidden');
                templateUploadArea.classList.remove('has-image');
                templateInput.value = '';
            }

            async function startGeneration() {
                if (!uploadedDesignData) {
                    showError('Silakan upload design terlebih dahulu.');
                    return;
                }

                // Reset states
                generatedMockups = [];
                generatedMockupParams = [];
                currentMockupThemes = [];
                resultsGrid.innerHTML = '';
                hideError();
                resultsSection.classList.add('hidden');
                loadingSection.classList.remove('hidden');
                generateBtn.disabled = true;

                const base64Design = uploadedDesignData.split(',')[1];
                const manualTheme = themeInput.value.trim();

                // Determine mockup themes
                let mockupThemes;
                if (manualTheme) {
                    // Use manual theme for all 7 variations
                    mockupThemes = Array(7).fill(manualTheme + ' mockup');
                } else {
                    // Use default themes
                    mockupThemes = defaultMockupThemes;
                }

                // Store current themes for regeneration
                currentMockupThemes = [...mockupThemes];

                // Generate in batches
                const batchSize = 3;
                const batches = [];
                for (let i = 0; i < mockupThemes.length; i += batchSize) {
                    batches.push(mockupThemes.slice(i, i + batchSize));
                }

                try {
                    const results = [];

                    for (const [batchIndex, batch] of batches.entries()) {
                        const batchPromises = batch.map((theme) => {
                            let prompt = '';
                            let payloadParts = [];

                            if (uploadedTemplateData) {
                                // With template reference
                                const base64Template = uploadedTemplateData.split(',')[1];

                                prompt = `Create a professional product mockup by combining these elements:

IMAGE 1 (Template/Mockup Base): Use this as the mockup template
IMAGE 2 (Design/Artwork): The design to be applied to the mockup

Task: Apply the design from IMAGE 2 onto the mockup template from IMAGE 1 realistically.

Requirements:
- The base mockup/template MUST be from IMAGE 1
- Apply the design from IMAGE 2 onto the mockup surface
- Match perspective, lighting, and shadows naturally
- Make it look like a professional product mockup photo
- Ensure design fits naturally on the mockup surface
- Professional 4K quality, realistic rendering
- Mockup type: ${theme}

IMPORTANT: Use the template from IMAGE 1 as the base, and apply design from IMAGE 2 onto it.`;

                                payloadParts = [
                                    { text: prompt },
                                    { inlineData: { mimeType: "image/jpeg", data: base64Template } },
                                    { inlineData: { mimeType: "image/jpeg", data: base64Design } }
                                ];
                            } else {
                                // Without template - generate mockup from scratch
                                prompt = `Create a professional product mockup for this design/artwork.

Mockup type: ${theme}

Requirements:
- Apply this design/artwork onto a realistic mockup
- Professional product photography style
- Natural lighting and shadows
- High quality rendering, 4K resolution
- Make it look like a real product photograph
- Clean, professional presentation

The design should be clearly visible and properly placed on the mockup surface.`;

                                payloadParts = [
                                    { text: prompt },
                                    { inlineData: { mimeType: "image/jpeg", data: base64Design } }
                                ];
                            }

                            const payload = {
                                contents: [{
                                    parts: payloadParts
                                }],
                                generationConfig: {
                                    responseModalities: ['IMAGE'],
                                    imageConfig: { aspectRatio: selectedMockupRatio }
                                }
                            };

                            return generateImageWithRetry(payload);
                        });

                        const batchResults = await Promise.all(batchPromises);
                        results.push(...batchResults);

                        // Update progress
                        const totalProcessed = (batchIndex + 1) * batchSize;
                        const currentCount = Math.min(totalProcessed, mockupThemes.length);
                        updateProgress(currentCount);

                        // Delay between batches
                        if (batchIndex < batches.length - 1) {
                            await new Promise(resolve => setTimeout(resolve, 500));
                        }
                    }

                    results.forEach((result, index) => {
                        const base64Data = result?.candidates?.[0]?.content?.parts?.find(p => p.inlineData)?.inlineData?.data;

                        if (base64Data) {
                            const imageUrl = `data:image/png;base64,${base64Data}`;
                            generatedMockups.push(imageUrl);

                            // Store generation parameters for this mockup
                            generatedMockupParams.push({
                                theme: mockupThemes[index],
                                designData: uploadedDesignData,
                                templateData: uploadedTemplateData,
                                ratio: selectedMockupRatio
                            });

                            displayMockup(imageUrl, index + 1, mockupThemes[index]);
                        } else {
                            console.warn(`Mockup ${index + 1} generation failed`);
                        }
                    });

                    // Final progress update
                    updateProgress(generatedMockups.length);

                    // Show results
                    loadingSection.classList.add('hidden');
                    resultsSection.classList.remove('hidden');
                    resultCount.textContent = generatedMockups.length;
                    generateBtn.disabled = false;

                    if (generatedMockups.length === 0) {
                        showError('Tidak ada mockup yang berhasil digenerate. Silakan coba lagi.');
                    }

                } catch (error) {
                    console.error('Generation error:', error);
                    loadingSection.classList.add('hidden');
                    showError('Terjadi kesalahan saat generate mockup: ' + error.message);
                    generateBtn.disabled = false;
                }
            }

            async function generateImageWithRetry(payload, retries = 3, delay = 1000) {
                for (let i = 0; i < retries; i++) {
                    try {
                        const apiKey = "";
                        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-image-preview:generateContent?key=${apiKey}`;
                        const response = await fetch(apiUrl, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(payload)
                        });
                        const responseText = await response.text();

                        if (!response.ok) {
                            let errorMsg = response.statusText;
                            try {
                                errorMsg = JSON.parse(responseText).error?.message || errorMsg;
                            } catch(e) {
                                if(responseText) errorMsg = responseText;
                            }
                            throw new Error(`API Error: ${errorMsg}`);
                        }

                        try {
                            return JSON.parse(responseText);
                        } catch (e) {
                            throw new Error("Invalid JSON response.");
                        }
                    } catch (error) {
                        console.error(`Attempt ${i + 1} failed:`, error);
                        if (i === retries - 1) return null;
                        await new Promise(res => setTimeout(res, delay * Math.pow(2, i)));
                    }
                }
                return null;
            }

            function updateProgress(current) {
                const percentage = (current / 7) * 100;
                progressBar.style.width = `${percentage}%`;
                progressText.textContent = `${current}/7`;
            }

            function displayMockup(imageUrl, index, theme) {
                const resultCard = document.createElement('div');
                resultCard.className = 'result-card';
                resultCard.setAttribute('data-index', index - 1);
                const safeTheme = theme.replace(/"/g, '&quot;');
                resultCard.innerHTML = `
                    <img src="${imageUrl}" alt="Mockup ${index}" />
                    <div class="result-card-actions">
                        <button class="btn-preview" data-action="preview" data-image-url="${imageUrl}">
                            <i class="fas fa-search-plus"></i>
                            Preview
                        </button>
                        <button class="btn-edit" data-action="edit" data-index="${index - 1}" data-theme="${safeTheme}">
                            <i class="fas fa-edit"></i>
                            Edit
                        </button>
                        <button class="btn-regenerate" data-action="regenerate" data-index="${index - 1}">
                            <i class="fas fa-sync-alt"></i>
                            Regenerate
                        </button>
                        <button class="btn-download" data-action="download" data-image-url="${imageUrl}" data-filename="mockup-${index}.jpg">
                            <i class="fas fa-download"></i>
                            Download
                        </button>
                    </div>
                    <div class="image-counter">#${index}</div>
                `;
                resultsGrid.appendChild(resultCard);
            }

            // Event handling for action buttons (works on desktop & mobile)
            resultsGrid.addEventListener('click', async (e) => {
                e.stopPropagation();

                const actionBtn = e.target.closest('[data-action]');
                if (!actionBtn) return;

                const action = actionBtn.dataset.action;
                const imageUrl = actionBtn.dataset.imageUrl;
                const index = actionBtn.dataset.index;
                const theme = actionBtn.dataset.theme;

                if (action === 'preview') {
                    showPreviewModal(imageUrl);
                } else if (action === 'edit') {
                    handleEditMockup(parseInt(index), theme);
                } else if (action === 'regenerate') {
                    await handleRegenerateMockup(parseInt(index));
                } else if (action === 'download') {
                    const filename = actionBtn.dataset.filename;
                    if (window.downloadDataURINew) {
                        await window.downloadDataURINew(imageUrl, filename);
                    }
                }
            });

            // Function to handle edit mockup
            function handleEditMockup(index, currentTheme) {
                const modal = document.createElement('div');
                modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4';
                modal.innerHTML = `
                    <div class="bg-white rounded-xl p-6 max-w-2xl w-full">
                        <h3 class="text-xl font-bold mb-4 text-gray-800">
                            <i class="fas fa-edit text-purple-500 mr-2"></i>Edit Mockup Theme
                        </h3>
                        <div class="mb-4">
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Mockup Theme/Style:</label>
                            <textarea id="edit-mockup-input" rows="4" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-purple-500 focus:outline-none resize-none" placeholder="Contoh: white ceramic coffee mug on wooden desk, t-shirt mockup on white background, poster frame on wall, etc...">${currentTheme}</textarea>
                            <p class="text-xs text-gray-500 mt-2">
                                <i class="fas fa-info-circle mr-1"></i>
                                Deskripsi mockup yang diinginkan
                            </p>
                        </div>
                        <div class="flex gap-2">
                            <button onclick="this.closest('.fixed').remove()" class="flex-1 bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-lg transition-colors">
                                Batal
                            </button>
                            <button id="confirm-edit-mockup-btn" class="flex-1 bg-purple-500 hover:bg-purple-600 text-white font-bold py-2 px-4 rounded-lg transition-colors">
                                <i class="fas fa-check mr-2"></i>Generate Ulang
                            </button>
                        </div>
                    </div>
                `;
                document.body.appendChild(modal);

                const confirmBtn = modal.querySelector('#confirm-edit-mockup-btn');
                const themeInput = modal.querySelector('#edit-mockup-input');

                confirmBtn.addEventListener('click', async () => {
                    const newTheme = themeInput.value.trim();
                    if (!newTheme) return;

                    modal.remove();

                    // Update the theme for this mockup
                    generatedMockupParams[index].theme = newTheme;
                    currentMockupThemes[index] = newTheme;

                    await handleRegenerateMockup(index);
                });
            }

            // Function to handle regenerate mockup
            async function handleRegenerateMockup(index) {
                const resultCards = resultsGrid.querySelectorAll('.result-card');
                const targetCard = resultCards[index];
                if (!targetCard) return;

                const params = generatedMockupParams[index];
                if (!params) return;

                // Show loading state
                targetCard.innerHTML = `
                    <div class="flex flex-col items-center justify-center h-full min-h-[200px]">
                        <div class="loader !border-l-purple-500"></div>
                        <p class="mt-4 text-sm text-gray-600">Regenerating...</p>
                    </div>
                `;

                try {
                    const base64Design = params.designData.split(',')[1];
                    let prompt = '';
                    let payloadParts = [];

                    if (params.templateData) {
                        const base64Template = params.templateData.split(',')[1];
                        prompt = `Create a professional product mockup by combining these elements:

IMAGE 1 (Template/Mockup Base): Use this as the mockup template
IMAGE 2 (Design/Artwork): The design to be applied to the mockup

Task: Apply the design from IMAGE 2 onto the mockup template from IMAGE 1 realistically.
The final output should look like a professional product photograph.

Requirements:
- Apply artwork properly on mockup surface
- Realistic shadows and lighting
- High-quality professional result
- Natural integration of design into template`;

                        payloadParts = [
                            { text: prompt },
                            { inlineData: { mimeType: "image/jpeg", data: base64Template } },
                            { inlineData: { mimeType: "image/jpeg", data: base64Design } }
                        ];
                    } else {
                        prompt = `Create a professional product mockup with the following design.

Mockup type: ${params.theme}

Requirements:
- Apply this design/artwork onto a realistic mockup
- Professional product photography style
- Natural lighting and shadows
- High quality rendering, 4K resolution
- Make it look like a real product photograph
- Clean, professional presentation

The design should be clearly visible and properly placed on the mockup surface.`;

                        payloadParts = [
                            { text: prompt },
                            { inlineData: { mimeType: "image/jpeg", data: base64Design } }
                        ];
                    }

                    const payload = {
                        contents: [{ parts: payloadParts }],
                        generationConfig: {
                            responseModalities: ['IMAGE'],
                            imageConfig: { aspectRatio: params.ratio }
                        }
                    };

                    const result = await generateImageWithRetry(payload);
                    const base64Data = result?.candidates?.[0]?.content?.parts?.find(p => p.inlineData)?.inlineData?.data;

                    if (base64Data) {
                        const imageUrl = `data:image/png;base64,${base64Data}`;

                        // Update stored mockup
                        generatedMockups[index] = imageUrl;

                        // Redisplay the card
                        const safeTheme = params.theme.replace(/"/g, '&quot;');
                        targetCard.innerHTML = `
                            <img src="${imageUrl}" alt="Mockup ${index + 1}" />
                            <div class="result-card-actions">
                                <button class="btn-preview" data-action="preview" data-image-url="${imageUrl}">
                                    <i class="fas fa-search-plus"></i>
                                    Preview
                                </button>
                                <button class="btn-edit" data-action="edit" data-index="${index}" data-theme="${safeTheme}">
                                    <i class="fas fa-edit"></i>
                                    Edit
                                </button>
                                <button class="btn-regenerate" data-action="regenerate" data-index="${index}">
                                    <i class="fas fa-sync-alt"></i>
                                    Regenerate
                                </button>
                                <button class="btn-download" data-action="download" data-image-url="${imageUrl}" data-filename="mockup-${index + 1}.jpg">
                                    <i class="fas fa-download"></i>
                                    Download
                                </button>
                            </div>
                            <div class="image-counter">#${index + 1}</div>
                        `;
                    } else {
                        throw new Error('Failed to generate mockup');
                    }
                } catch (error) {
                    console.error('Regenerate error:', error);
                    targetCard.innerHTML = `
                        <div class="flex flex-col items-center justify-center h-full min-h-[200px] text-red-600">
                            <i class="fas fa-exclamation-triangle text-3xl mb-2"></i>
                            <p class="text-sm">Gagal regenerate</p>
                            <button onclick="location.reload()" class="mt-2 text-xs bg-red-500 text-white px-3 py-1 rounded-full hover:bg-red-600">
                                Refresh
                            </button>
                        </div>
                    `;
                }
            }

            // Download all button event handlers (works on desktop & mobile like Umrah)
            if (downloadAllBtn) {
                downloadAllBtn.addEventListener('click', async () => {
                    if (generatedMockups.length === 0) return;

                    downloadAllBtn.disabled = true;
                    downloadAllBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Downloading...';

                    for (let i = 0; i < generatedMockups.length; i++) {
                        if (window.downloadDataURINew) {
                            await window.downloadDataURINew(generatedMockups[i], `mockup-${i + 1}.jpg`);
                            // Small delay between downloads for better UX
                            await new Promise(resolve => setTimeout(resolve, 500));
                        }
                    }

                    downloadAllBtn.disabled = false;
                    downloadAllBtn.innerHTML = '<i class="fas fa-download mr-2"></i>Download Semua';
                });
            }

            function showPreviewModal(imageUrl) {
                const modal = document.createElement('div');
                modal.className = 'image-preview-modal';
                modal.innerHTML = `
                    <div class="preview-modal-overlay"></div>
                    <div class="preview-modal-content">
                        <button class="preview-close-btn" aria-label="Close">
                            <i class="fas fa-times"></i>
                        </button>
                        <img src="${imageUrl}" alt="Preview" class="preview-modal-image">
                    </div>
                `;
                document.body.appendChild(modal);

                // Close modal handlers
                const closeBtn = modal.querySelector('.preview-close-btn');
                const overlay = modal.querySelector('.preview-modal-overlay');

                const closeModal = () => {
                    modal.classList.add('closing');
                    setTimeout(() => modal.remove(), 300);
                };

                closeBtn.addEventListener('click', closeModal);
                overlay.addEventListener('click', closeModal);

                // ESC key to close
                const handleEsc = (e) => {
                    if (e.key === 'Escape') {
                        closeModal();
                        document.removeEventListener('keydown', handleEsc);
                    }
                };
                document.addEventListener('keydown', handleEsc);

                // Touch feedback for mobile
                closeBtn.addEventListener('touchstart', function() {
                    this.style.transform = 'scale(0.9)';
                }, { passive: true });
                closeBtn.addEventListener('touchend', function() {
                    this.style.transform = '';
                }, { passive: true });

                // Animate in
                setTimeout(() => modal.classList.add('show'), 10);
            }

            function showError(message) {
                errorMessage.textContent = message;
                errorSection.classList.remove('hidden');
            }

            function hideError() {
                errorSection.classList.add('hidden');
            }

            function resetForm() {
                uploadedDesignData = null;
                uploadedTemplateData = null;
                generatedMockups = [];
                uploadPlaceholder.classList.remove('hidden');
                previewContainer.classList.add('hidden');
                uploadArea.classList.remove('has-image');
                templatePlaceholder.classList.remove('hidden');
                templatePreviewContainer.classList.add('hidden');
                templateUploadArea.classList.remove('has-image');
                themeInput.value = '';
                generateBtn.disabled = true;
                resultsSection.classList.add('hidden');
                resultsGrid.innerHTML = '';
                hideError();
                progressBar.style.width = '0%';
                progressText.textContent = '0/21';
            }
        })();

    // ========================================
    // VIDEO ANALYZER PRO FUNCTIONALITY
    // ========================================
    (function() {
        // DOM Elements
        const videoUpload = document.getElementById('va-video-upload');
        const fileNameDisplay = document.getElementById('va-file-name');
        const videoContainer = document.getElementById('va-video-container');
        const videoPreview = document.getElementById('video-preview');
        const videoInfo = document.getElementById('va-video-info');
        const duration = document.getElementById('va-duration');
        const resolution = document.getElementById('va-resolution');
        const filesize = document.getElementById('va-filesize');
        const format = document.getElementById('va-format');
        const frameSelector = document.getElementById('va-frame-selector');
        const frameBtns = document.querySelectorAll('.va-frame-btn');
        const analyzeBtn = document.getElementById('va-analyze-btn');
        const outputSection = document.getElementById('va-output-section');
        const loadingIndicator = document.getElementById('va-loading-indicator');
        const loadingText = document.getElementById('va-loading-text');
        const progressBar = document.getElementById('va-progress-bar');
        const progressText = document.getElementById('va-progress-text');
        const framesGallery = document.getElementById('va-frames-gallery');
        const framesGrid = document.getElementById('va-frames-grid');
        const promptContainer = document.getElementById('va-prompt-container');
        const promptOutput = document.getElementById('va-prompt-output');
        const charCount = document.getElementById('va-char-count');
        const copyBtn = document.getElementById('va-copy-btn');
        const copyText = document.getElementById('va-copy-text');
        const downloadPromptBtn = document.getElementById('va-download-prompt-btn');
        const canvas = document.getElementById('va-canvas');
        const errorMessage = document.getElementById('va-error-message');

        let videoFile = null;
        let selectedFrameCount = 5;
        let extractedFramesData = [];

        // Frame count selector
        frameBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                frameBtns.forEach(b => {
                    b.classList.remove('bg-purple-600', 'ring-2', 'ring-purple-400');
                    b.classList.add('bg-gray-700');
                });
                btn.classList.remove('bg-gray-700');
                btn.classList.add('bg-purple-600', 'ring-2', 'ring-purple-400');
                selectedFrameCount = parseInt(btn.dataset.frames);
            });
        });

        // Video upload handler
        videoUpload.addEventListener('change', async (event) => {
            videoFile = event.target.files[0];
            if (videoFile) {
                fileNameDisplay.textContent = videoFile.name;
                fileNameDisplay.classList.add('text-purple-400', 'font-semibold');

                const videoURL = URL.createObjectURL(videoFile);
                videoPreview.src = videoURL;
                videoContainer.classList.remove('hidden');
                frameSelector.classList.remove('hidden');

                // Load video metadata
                videoPreview.onloadedmetadata = () => {
                    const dur = videoPreview.duration;
                    const mins = Math.floor(dur / 60);
                    const secs = Math.floor(dur % 60);
                    duration.textContent = `${mins}:${secs.toString().padStart(2, '0')}`;
                    resolution.textContent = `${videoPreview.videoWidth}x${videoPreview.videoHeight}`;
                    filesize.textContent = formatFileSize(videoFile.size);
                    format.textContent = videoFile.type.split('/')[1].toUpperCase();
                    videoInfo.classList.remove('hidden');
                    analyzeBtn.disabled = false;
                };
            } else {
                resetUI();
            }
        });

        // Analyze button
        analyzeBtn.addEventListener('click', async () => {
            if (!videoFile) return;

            // Reset UI
            analyzeBtn.disabled = true;
            analyzeBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Processing...';
            outputSection.classList.remove('hidden');
            loadingIndicator.classList.remove('hidden');
            promptContainer.classList.add('hidden');
            framesGallery.classList.add('hidden');
            framesGrid.innerHTML = '';
            promptOutput.value = '';
            errorMessage.classList.add('hidden');
            extractedFramesData = [];

            try {
                // Step 1: Extract frames
                loadingText.textContent = `Extracting ${selectedFrameCount} frames...`;
                const frames = await extractFramesWithProgress(videoFile, selectedFrameCount);
                extractedFramesData = frames;

                // Step 2: Display frames gallery
                displayFramesGallery(frames);
                framesGallery.classList.remove('hidden');

                // Step 3: Generate prompt
                loadingText.textContent = 'Generating AI prompt...';
                progressBar.style.width = '100%';
                progressText.textContent = '100%';

                const generatedPrompt = await generatePromptWithGemini(frames.map(f => f.base64));

                // Step 4: Display result
                promptOutput.value = generatedPrompt;
                charCount.textContent = `${generatedPrompt.length} characters`;
                promptContainer.classList.remove('hidden');

            } catch (error) {
                console.error("Error during analysis:", error);
                showError(`Error: ${error.message || 'Terjadi kesalahan saat menganalisis video.'}`);
            } finally {
                loadingIndicator.classList.add('hidden');
                analyzeBtn.disabled = false;
                analyzeBtn.innerHTML = '<i class="fas fa-magic"></i><span>Mulai Analisis</span>';
            }
        });

        // Copy button
        copyBtn.addEventListener('click', async () => {
            try {
                await navigator.clipboard.writeText(promptOutput.value);
                const originalHTML = copyText.innerHTML;
                copyText.innerHTML = '<i class="fas fa-check mr-2"></i>Copied!';
                copyBtn.classList.add('bg-green-600');
                setTimeout(() => {
                    copyText.textContent = 'Copy Prompt';
                    copyBtn.classList.remove('bg-green-600');
                }, 2000);
            } catch (err) {
                promptOutput.select();
                document.execCommand('copy');
            }
        });

        // Download prompt button
        downloadPromptBtn.addEventListener('click', () => {
            const text = promptOutput.value;
            if (!text) return;

            const blob = new Blob([text], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `video-prompt-${Date.now()}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        });

        // Helper functions
        function formatFileSize(bytes) {
            if (bytes < 1024) return bytes + ' B';
            else if (bytes < 1048576) return (bytes / 1024).toFixed(1) + ' KB';
            else if (bytes < 1073741824) return (bytes / 1048576).toFixed(1) + ' MB';
            else return (bytes / 1073741824).toFixed(1) + ' GB';
        }

        function resetUI() {
            fileNameDisplay.textContent = 'Belum ada video dipilih';
            fileNameDisplay.classList.remove('text-purple-400', 'font-semibold');
            videoContainer.classList.add('hidden');
            videoInfo.classList.add('hidden');
            frameSelector.classList.add('hidden');
            videoPreview.src = '';
            analyzeBtn.disabled = true;
            videoFile = null;
        }

        function displayFramesGallery(frames) {
            framesGrid.innerHTML = '';
            frames.forEach((frame, index) => {
                const frameCard = document.createElement('div');
                frameCard.className = 'relative group cursor-pointer transform hover:scale-105 transition-all duration-300';
                frameCard.innerHTML = `
                    <img src="data:image/jpeg;base64,${frame.base64}"
                         alt="Frame ${index + 1}"
                         class="w-full h-auto rounded-lg border-2 border-gray-700 hover:border-purple-500 shadow-lg">
                    <div class="absolute top-2 left-2 bg-black/70 text-white text-xs px-2 py-1 rounded-full font-semibold">
                        Frame ${index + 1}
                    </div>
                `;
                frameCard.addEventListener('click', () => {
                    if (window.showPreviewModal) {
                        window.showPreviewModal(`data:image/jpeg;base64,${frame.base64}`);
                    }
                });
                framesGrid.appendChild(frameCard);
            });
        }

        function showError(message) {
            errorMessage.innerHTML = `<i class="fas fa-exclamation-circle mr-2"></i>${message}`;
            errorMessage.classList.remove('hidden');
        }

        /**
         * Extracts frames with progress tracking
         */
        function extractFramesWithProgress(file, numFrames) {
            return new Promise((resolve, reject) => {
                const video = document.createElement('video');
                video.preload = 'metadata';
                video.src = URL.createObjectURL(file);
                const ctx = canvas.getContext('2d');
                const frames = [];

                video.onloadedmetadata = () => {
                    const duration = video.duration;
                    if (duration === 0) {
                       reject(new Error("Video duration is zero or could not be determined."));
                       return;
                    }
                    const interval = duration / (numFrames + 1);
                    let framesExtracted = 0;

                    const captureFrame = (time) => {
                        video.currentTime = time;
                    };

                    video.onseeked = () => {
                        canvas.width = video.videoWidth;
                        canvas.height = video.videoHeight;
                        ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
                        const base64Data = canvas.toDataURL('image/jpeg').split(',')[1];
                        frames.push({ base64: base64Data, timestamp: video.currentTime });
                        framesExtracted++;

                        // Update progress
                        const progress = Math.round((framesExtracted / numFrames) * 100);
                        progressBar.style.width = `${progress}%`;
                        progressText.textContent = `${progress}% (${framesExtracted}/${numFrames} frames)`;

                        if (framesExtracted < numFrames) {
                            captureFrame((framesExtracted + 1) * interval);
                        } else {
                            URL.revokeObjectURL(video.src);
                            resolve(frames);
                        }
                    };

                    video.onerror = (e) => {
                        reject(new Error("Error loading video for frame extraction."));
                    };

                    // Start extraction
                    captureFrame(interval);
                    progressBar.style.width = '0%';
                    progressText.textContent = '0%';
                };

                video.onerror = (e) => {
                     reject(new Error("Could not load video metadata. The file might be corrupted or in an unsupported format."));
                };
            });
        }

        /**
         * Generates a descriptive prompt by sending video frames to the Gemini API.
         * @param {string[]} base64Frames - An array of base64-encoded frame data (without the data URL prefix).
         * @returns {Promise<string>} A promise that resolves to the generated text prompt.
         */
        async function generatePromptWithGemini(base64Frames) {
            const apiKey = ""; // API key
            const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

            const systemInstruction = `You are an expert video analyst and prompt engineer for generative AI. Your task is to analyze a sequence of frames from a video and create a single, highly detailed, and coherent prompt that could be used by a text-to-video AI model to recreate a similar video.

            Combine the information from all frames into one unified description. Describe the scene, subjects, actions, and atmosphere with vivid language.

            Structure your prompt to cover these aspects in order:
            1.  **Core Subject & Action:** What is the main subject and what are they doing?
            2.  **Setting & Environment:** Where does the scene take place? Describe the background and key objects.
            3.  **Visual Style:** What is the overall aesthetic? (e.g., cinematic, realistic, hyperrealistic, anime, vaporwave, grainy vintage footage).
            4.  **Cinematography:** Describe the camera work (e.g., wide shot, close-up, panning shot, drone footage, shaky cam).
            5.  **Lighting:** Describe the lighting (e.g., golden hour, soft studio lighting, neon glow, moody and dark).
            6.  **Color Palette:** What are the dominant colors? (e.g., vibrant and saturated, muted earth tones, monochrome).
            7.  **Mood/Feeling:** What is the overall feeling or emotion of the scene? (e.g., peaceful, energetic, suspenseful, nostalgic).

            Synthesize all observations into a single, compelling paragraph.`;

            const userQuery = "Analyze these video frames and generate a detailed prompt based on your instructions.";

            const imageParts = base64Frames.map(frame => ({
                inlineData: {
                    mimeType: 'image/jpeg',
                    data: frame
                }
            }));

            const payload = {
                systemInstruction: {
                    parts: [{ text: systemInstruction }]
                },
                contents: [{
                    parts: [{ text: userQuery }, ...imageParts]
                }],
            };

            let response;
            let attempts = 0;
            const maxAttempts = 3;
            const initialDelay = 1000;

            while (attempts < maxAttempts) {
                try {
                    response = await fetch(url, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(payload),
                    });

                    if (response.ok) {
                        const result = await response.json();
                        if (result.candidates && result.candidates[0].content.parts[0].text) {
                             return result.candidates[0].content.parts[0].text;
                        } else {
                            throw new Error('Invalid response structure from API.');
                        }
                    } else {
                        // Handle non-OK HTTP responses
                        const errorBody = await response.json();
                        console.error('API Error:', errorBody);
                        throw new Error(`API request failed with status ${response.status}: ${errorBody.error?.message || 'Unknown error'}`);
                    }
                } catch (error) {
                    attempts++;
                    if (attempts >= maxAttempts) {
                        throw error;
                    }
                    // Exponential backoff
                    await new Promise(res => setTimeout(res, initialDelay * Math.pow(2, attempts)));
                }
            }
        }
    })();

    // ========================================
    // TAB: PRODUCT REVIEW GENERATOR
    // ========================================
    (() => {
        const reviewImageInput = document.getElementById('review-image-input');
        const reviewImageUploadArea = document.getElementById('review-image-upload-area');
        const reviewImagePreviewContainer = document.getElementById('review-image-preview-container');

        const reviewModelImageInput = document.getElementById('review-model-image-input');
        const reviewModelImageUploadArea = document.getElementById('review-model-image-upload-area');
        const reviewModelImagePreviewContainer = document.getElementById('review-model-image-preview-container');
        const reviewModelImagePreview = document.getElementById('review-model-image-preview');
        const reviewRemoveModelImageBtn = document.getElementById('review-remove-model-image-btn');

        const reviewProductDescInput = document.getElementById('review-product-desc-input');
        const reviewGenerateBtn = document.getElementById('review-generate-btn');
        const reviewGrid = document.getElementById('review-b-roll-grid');
        const reviewGenerateDescBtn = document.getElementById('review-generate-desc-btn');

        let reviewProductImages = [];
        let reviewModelImageBase64 = null;
        let reviewModelImageMimeType = null;

        function updateReviewButtonState() {
            reviewGenerateBtn.disabled = reviewProductImages.length === 0 || !reviewProductDescInput.value.trim();
            reviewGenerateDescBtn.disabled = reviewProductImages.length === 0;
        }

        reviewImageInput.addEventListener('change', (event) => {
            handleReviewProductFiles(event.target.files);
            event.target.value = null;
        });

        function manageAddMoreButton() {
            const existingButton = document.getElementById('review-add-more-button');
            if (existingButton) {
                existingButton.remove();
            }

            const addButtonWrapper = document.createElement('div');
            addButtonWrapper.id = 'review-add-more-button';
            addButtonWrapper.innerHTML = `
                <label for="review-image-input" class="w-full h-24 flex flex-col items-center justify-center rounded-lg border-2 border-dashed border-gray-300 cursor-pointer text-gray-400 hover:bg-gray-100 hover:border-gray-400 transition-colors">
                     <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg>
                </label>
            `;
            reviewImagePreviewContainer.appendChild(addButtonWrapper);
        }

        function handleReviewProductFiles(files) {
            if (files.length === 0) return;

            reviewImageUploadArea.classList.add('hidden');
            reviewImagePreviewContainer.classList.remove('hidden');

            let filesToProcess = files.length;

            Array.from(files).forEach(file => {
                const reader = new FileReader();
                reader.onload = (e) => {
                    const parts = e.target.result.split(',');
                    const mimeType = parts[0].match(/:(.*?);/)[1];
                    const base64 = parts[1];
                    const imageData = { base64, mimeType, id: Date.now() + Math.random() };
                    reviewProductImages.push(imageData);

                    const previewWrapper = document.createElement('div');
                    previewWrapper.className = 'relative group';
                    previewWrapper.innerHTML = `
                        <img src="${e.target.result}" alt="Pratinjau Produk" class="rounded-lg w-full h-24 object-cover">
                        <button data-id="${imageData.id}" class="absolute top-1 right-1 bg-red-500 text-white rounded-full p-1 opacity-0 group-hover:opacity-100 transition-opacity focus:opacity-100">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                        </button>
                    `;

                    reviewImagePreviewContainer.appendChild(previewWrapper);

                    previewWrapper.querySelector('button').addEventListener('click', (btnEvent) => {
                        const idToRemove = parseFloat(btnEvent.currentTarget.getAttribute('data-id'));
                        reviewProductImages = reviewProductImages.filter(img => img.id !== idToRemove);
                        previewWrapper.remove();
                        if (reviewProductImages.length === 0) {
                            reviewImageUploadArea.classList.remove('hidden');
                            reviewImagePreviewContainer.classList.add('hidden');
                            const addButton = document.getElementById('review-add-more-button');
                            if (addButton) addButton.remove();
                        }
                        updateReviewButtonState();
                    });

                    updateReviewButtonState();

                    filesToProcess--;
                    if (filesToProcess === 0) {
                        manageAddMoreButton();
                    }
                };
                reader.readAsDataURL(file);
            });
        }

        function setupReviewSingleImageUpload(input, uploadArea, previewContainer, previewImg, removeBtn, onUpload) {
            input.addEventListener('change', (event) => {
                const file = event.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        previewImg.src = e.target.result;
                        const parts = e.target.result.split(',');
                        const mimeType = parts[0].match(/:(.*?);/)[1];
                        const base64 = parts[1];
                        onUpload(base64, mimeType);

                        uploadArea.classList.add('hidden');
                        previewContainer.classList.remove('hidden');
                    };
                    reader.readAsDataURL(file);
                }
            });

            removeBtn.addEventListener('click', () => {
                onUpload(null, null);
                input.value = '';
                uploadArea.classList.remove('hidden');
                previewContainer.classList.add('hidden');
            });
        }

        setupReviewSingleImageUpload(reviewModelImageInput, reviewModelImageUploadArea, reviewModelImagePreviewContainer, reviewModelImagePreview, reviewRemoveModelImageBtn, (base64, mime) => {
            reviewModelImageBase64 = base64;
            reviewModelImageMimeType = mime;
        });

        reviewProductDescInput.addEventListener('input', updateReviewButtonState);

        const createInitialReviewPlaceholders = () => {
            reviewGrid.innerHTML = '';
            const selectedRatio = document.querySelector('.ratio-btn-review.selected')?.dataset.ratio || '16:9';
            let aspectRatioClass = 'aspect-video'; // default 16:9
            if (selectedRatio === '1:1') aspectRatioClass = 'aspect-square';
            else if (selectedRatio === '3:4') aspectRatioClass = 'aspect-[3/4]';
            else if (selectedRatio === '9:16') aspectRatioClass = 'aspect-[9/16]';

            for(let i = 1; i <= 10; i++) {
                const card = document.createElement('div');
                card.className = 'result-card card p-4 flex flex-col justify-between animate-pulse';
                card.innerHTML = `
                    <div><div class="h-6 bg-gray-200 rounded w-3/4 mb-4"></div></div>
                    <div class="mt-4 ${aspectRatioClass} bg-gray-300 rounded-md flex items-center justify-center"></div>
                `;
                reviewGrid.appendChild(card);
            }
        };

        // Call on DOMContentLoaded instead of window load to avoid conflicts
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', createInitialReviewPlaceholders);
        } else {
            createInitialReviewPlaceholders();
        }

        // Ratio button selection handler
        document.querySelectorAll('.ratio-btn-review').forEach(btn => {
            btn.addEventListener('click', function() {
                // Remove selected class from all buttons
                document.querySelectorAll('.ratio-btn-review').forEach(b => {
                    b.classList.remove('selected');
                    b.style.borderColor = '';
                    b.style.background = '';
                    b.style.color = '';
                    b.style.boxShadow = '';
                });
                // Add selected class to clicked button
                this.classList.add('selected');
                this.style.borderColor = '#6366f1';
                this.style.background = 'linear-gradient(135deg, #6366f1, #8b5cf6)';
                this.style.color = 'white';
                this.style.boxShadow = '0 4px 12px rgba(99, 102, 241, 0.3)';

                // Update placeholders
                createInitialReviewPlaceholders();
            });
        });

        reviewGenerateBtn.addEventListener('click', async () => {
            if (reviewProductImages.length === 0) return;
            reviewGenerateBtn.disabled = true;
            reviewGenerateBtn.innerHTML = `<div class="loader"></div><span class="ml-2">Menganalisa...</span>`;
            reviewGrid.innerHTML = `<div class="col-span-1 sm:col-span-2 xl:col-span-3 text-center py-10">
                <div class="loader inline-block"></div>
                <p class="mt-4 text-gray-500">AI sedang menganalisis produk dan membuat ide review...</p>
            </div>`;

            try {
                const reviewIdeas = await analyzeAndGetPrompts();
                reviewGenerateBtn.innerHTML = `<div class="loader"></div><span class="ml-2">Membuat Visual...</span>`;
                createReviewDynamicCards(reviewIdeas);

                const generationPromises = reviewIdeas.map((idea, index) =>
                    generateSingleReview(index + 1, idea.title, idea.prompt)
                );
                await Promise.allSettled(generationPromises);
            } catch (error) {
                console.error("Error during generation process:", error);
                reviewGrid.innerHTML = `<div class="col-span-1 sm:col-span-2 xl:col-span-3 text-center py-10 text-red-500">
                    <p>Terjadi kesalahan saat menganalisis produk: ${error.message}</p>
                </div>`;
            } finally {
                reviewGenerateBtn.disabled = false;
                reviewGenerateBtn.innerHTML = `<span>Buat 10 Scene Review</span>`;
            }
        });

        async function analyzeAndGetPrompts() {
            const apiKey = "";
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
            const selectedRatio = document.querySelector('.ratio-btn-review.selected')?.dataset.ratio || '16:9';

            let systemPrompt = '';
            if (reviewModelImageBase64) {
                 systemPrompt = `You are an expert product reviewer and affiliate marketer. Your task is to analyze the product, description, and model to create a **10-part visual review story** (storyboard) for the aspect ratio ${selectedRatio}. The story should feel authentic, like a real user's experience.
**CRITICAL VISUAL RULES:**
1.  **Studio Only:** The entire review MUST take place in a single, professional studio setting (e.g., on a clean tabletop, in front of a solid color backdrop). This is a critical rule for ALL 10 scenes. Every single scene, from 1 to 10, must share the same consistent studio background.
2.  **Model + Product Together:** For ALL 10 scenes, the human model and the product MUST be visible together in the same frame. The model should be actively holding, using, or presenting the product. Do NOT generate close-ups of *only* the product or shots of *only* the model.
3.  **Model Consistency:** The model must be the **exact same person** in **all 10 scenes**, directly based on the uploaded model image. Their **clothing and hairstyle must remain identical** throughout all scenes, as if filmed in one continuous session. This is essential.

You MUST ensure the 10 scenes form a coherent, sequential narrative (Scene 1: Unboxing, Scene 2: First Impression... Scene 10: Final Verdict) for a product review video.
For each scene, provide a short title (in Indonesian, e.g., 'Scene 1: Model Unboxing Produk') and a CONCISE English prompt for an AI image generator.
Respond ONLY with a valid JSON array of 10 objects, in sequential story order.`;
            } else {
                 systemPrompt = `You are an expert product reviewer. Your primary goal is to generate a **10-part visual review story** (storyboard) for the product for the aspect ratio ${selectedRatio}. **Absolutely no people, models, or human parts.** The review should focus on the product itself. **The entire review MUST take place in a single, professional studio setting (e.g., on a clean tabletop, against a seamless backdrop). Do not generate scenes in outdoor or other locations. This is a critical rule for ALL 10 scenes. Every single scene, from 1 to 10, must share the same consistent studio background.**
You MUST ensure the 10 scenes form a coherent, sequential narrative (Scene 1: Product Showcase, Scene 2: Detail Shot... Scene 10: Call to Action) that showcases the product's features and benefits sequentially for a product review video.
For each concept, provide a short, elegant title in Indonesian (e.g., 'Bagian 1: Detail Produk') and a CONCISE English prompt for the AI image generator.
Respond ONLY with a valid JSON array of 10 objects, in sequential story order.`;
            }

            const theme = document.getElementById('review-photo-theme-input').value.trim();
            let userQuery = `Analyze this product. Product Description: "${reviewProductDescInput.value.trim()}". Desired aspect ratio is ${selectedRatio}.`;
            if (theme) {
                userQuery += `\nPhoto Theme: "${theme}"`;
            }
            const parts = [{ text: userQuery }];
            reviewProductImages.forEach(img => {
                parts.push({ inlineData: { mimeType: img.mimeType, data: img.base64 } });
            });
            if (reviewModelImageBase64) {
                parts.push({ inlineData: { mimeType: reviewModelImageMimeType, data: reviewModelImageBase64 } });
            }
            const payload = { contents: [{ parts: parts }], systemInstruction: { parts: [{ text: systemPrompt }] }, generationConfig: { responseMimeType: "application/json", responseSchema: { type: "ARRAY", items: { type: "OBJECT", properties: { "title": { "type": "STRING" }, "prompt": { "type": "STRING" } }, required: ["title", "prompt"] } } } };
            const response = await fetch(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
            if (!response.ok) { const errorData = await response.json(); throw new Error(errorData.error?.message || `HTTP error! status: ${response.status}`); }
            const result = await response.json();

            if (!result.candidates || !result.candidates[0].content || !result.candidates[0].content.parts || !result.candidates[0].content.parts[0].text) {
                throw new Error("Invalid response structure from API.");
            }

            let rawText = result.candidates[0].content.parts[0].text;
            rawText = rawText.replace(/```json/g, '').replace(/```/g, '').trim();
            const startIndex = rawText.indexOf('[');
            const endIndex = rawText.lastIndexOf(']');

            if (startIndex === -1 || endIndex === -1 || startIndex > endIndex) {
                throw new Error("Could not find a valid JSON array in the API response.");
            }

            const jsonText = rawText.substring(startIndex, endIndex + 1);

            try {
                return JSON.parse(jsonText);
            } catch (e) {
                console.error("Failed to parse JSON:", jsonText, e);
                throw new Error("API returned malformed JSON after cleaning.");
            }
        }

        async function generateSingleReview(id, title, prompt) {
            const card = document.getElementById(`review-card-${id}`);
            if (!card) return;
            const outputContainer = card.querySelector('.review-output-container');

            const retries = 3;
            let lastError = null;

            for (let i = 0; i < retries; i++) {
                try {
                    const apiKey = "";
                    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-image-preview:generateContent?key=${apiKey}`;
                    const selectedRatio = document.querySelector('.ratio-btn-review.selected')?.dataset.ratio || '16:9';

                    let finalPrompt = '';
                    if (reviewModelImageBase64) {
                        finalPrompt = `${prompt}, elegant, cinematic, professional product photography, dramatic lighting, 8k, photorealistic`;
                    } else {
                        finalPrompt = `${prompt}, professional commercial product photography, hyper-detailed, epic composition, cinematic lighting, no people, 8k, photorealistic`;
                    }

                    const parts = [{ text: finalPrompt }];

                    reviewProductImages.forEach(img => {
                        parts.push({ inlineData: { mimeType: img.mimeType, data: img.base64 } });
                    });

                    if (reviewModelImageBase64) { parts.push({ inlineData: { mimeType: reviewModelImageMimeType, data: reviewModelImageBase64 } }); }

                    const payload = {
                        contents: [{ parts: parts }],
                        generationConfig: {
                            responseModalities: ['IMAGE'],
                            imageConfig: { aspectRatio: selectedRatio }
                        },
                        safetySettings: [
                            { "category": "HARM_CATEGORY_HARASSMENT", "threshold": "BLOCK_NONE" },
                            { "category": "HARM_CATEGORY_HATE_SPEECH", "threshold": "BLOCK_NONE" },
                            { "category": "HARM_CATEGORY_SEXUALLY_EXPLICIT", "threshold": "BLOCK_NONE" },
                            { "category": "HARM_CATEGORY_DANGEROUS_CONTENT", "threshold": "BLOCK_NONE" }
                        ]
                    };

                    const response = await fetch(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });

                    const responseText = await response.text();
                    if (!responseText || responseText.trim() === '') {
                        throw new Error("API memberikan respons kosong, kemungkinan karena filter keamanan.");
                    }

                    let result;
                    try { result = JSON.parse(responseText); } catch (e) { throw new Error(`Gagal mem-parsing respons API. Konten: ${responseText.substring(0, 200)}`); }

                    if (!response.ok) { const errorMessage = result.error?.message || `API error: ${response.statusText}`; throw new Error(errorMessage); }

                    const base64Data = result?.candidates?.[0]?.content?.parts?.find(p => p.inlineData)?.inlineData?.data;

                    if (base64Data) {
                        const imageUrl = `data:image/png;base64,${base64Data}`;
                        const safeTitle = title.replace(/[^a-z0-9]/gi, '_').toLowerCase();
                        outputContainer.innerHTML = `
                            <div class="relative w-full h-full group">
                                <img src="${imageUrl}" class="w-full h-full object-cover rounded-md" alt="Review Scene">
                                <div class="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/70 via-black/50 to-transparent p-4 opacity-0 group-hover:opacity-100 transition-all duration-300 ease-in-out rounded-b-md">
                                    <div class="flex flex-wrap gap-2 justify-end">
                                        <button data-action="review-preview" data-scene-id="${id}" class="action-btn bg-blue-500 text-white px-3 py-2 rounded-lg hover:bg-blue-600 active:scale-95 transition-all duration-200 shadow-lg hover:shadow-xl flex items-center gap-2 text-sm font-medium" title="Preview">
                                            <i class="fas fa-search-plus"></i>
                                            <span class="hidden sm:inline">Preview</span>
                                        </button>
                                        <button data-action="review-edit-prompt" data-scene-id="${id}" class="action-btn bg-purple-500 text-white px-3 py-2 rounded-lg hover:bg-purple-600 active:scale-95 transition-all duration-200 shadow-lg hover:shadow-xl flex items-center gap-2 text-sm font-medium" title="Edit Prompt">
                                            <i class="fas fa-edit"></i>
                                            <span class="hidden sm:inline">Edit</span>
                                        </button>
                                        <button data-action="review-regenerate" data-scene-id="${id}" class="action-btn bg-green-500 text-white px-3 py-2 rounded-lg hover:bg-green-600 active:scale-95 transition-all duration-200 shadow-lg hover:shadow-xl flex items-center gap-2 text-sm font-medium" title="Regenerate">
                                            <i class="fas fa-sync-alt"></i>
                                            <span class="hidden sm:inline">Regenerate</span>
                                        </button>
                                        <button data-action="review-video-prompt" data-scene-id="${id}" class="action-btn bg-fuchsia-500 text-white px-3 py-2 rounded-lg hover:bg-fuchsia-600 active:scale-95 transition-all duration-200 shadow-lg hover:shadow-xl flex items-center gap-2 text-sm font-medium" title="Buat Prompt Video">
                                            <i class="fas fa-film"></i>
                                            <span class="hidden sm:inline">Video</span>
                                        </button>
                                        <button data-action="review-caption" data-scene-id="${id}" class="action-btn bg-rose-500 text-white px-3 py-2 rounded-lg hover:bg-rose-600 active:scale-95 transition-all duration-200 shadow-lg hover:shadow-xl flex items-center gap-2 text-sm font-medium" title="Buat Caption">
                                            <i class="fas fa-pencil-alt"></i>
                                            <span class="hidden sm:inline">Caption</span>
                                        </button>
                                        <button data-action="review-download" data-scene-id="${id}" data-filename="review_${id}_${safeTitle}.png" class="action-btn bg-cyan-600 text-white px-3 py-2 rounded-lg hover:bg-cyan-700 active:scale-95 transition-all duration-200 shadow-lg hover:shadow-xl flex items-center gap-2 text-sm font-medium" title="Unduh Gambar">
                                            <i class="fas fa-download"></i>
                                            <span class="hidden sm:inline">Unduh</span>
                                        </button>
                                    </div>
                                </div>
                            </div>`;

                        // Update card's stored prompt
                        if (card) {
                            card.dataset.prompt = prompt;
                        }
                        return;
                    } else {
                         let reason = "Respon tidak valid dari API.";
                        if (result.promptFeedback && result.promptFeedback.blockReason) {
                            reason = `Diblokir: ${result.promptFeedback.blockReason}`;
                        } else if (result?.candidates?.[0]?.finishReason) {
                            reason = `Selesai dengan alasan: ${result.candidates[0].finishReason}`;
                        }
                        throw new Error(reason);
                    }
                } catch (error) {
                    lastError = error;
                    console.error(`Attempt ${i + 1} for card ${id} failed:`, error);
                    if (i < retries - 1) {
                        const delay = 1000 * Math.pow(2, i);
                        await new Promise(res => setTimeout(res, delay));
                    }
                }
            }

            if (lastError) {
                console.error(`All retries failed for card ${id}:`, lastError);
                outputContainer.innerHTML = `<div class="text-xs text-red-500 p-2 text-center" title="${lastError.message}">Gagal: ${lastError.message.substring(0, 50)}${lastError.message.length > 50 ? '...' : ''}</div>`;
            }
        }

        const createReviewDynamicCards = (prompts) => {
            reviewGrid.innerHTML = '';
            const selectedRatio = document.querySelector('.ratio-btn-review.selected')?.dataset.ratio || '16:9';
            let aspectRatioClass = 'aspect-video'; // default 16:9
            if (selectedRatio === '1:1') aspectRatioClass = 'aspect-square';
            else if (selectedRatio === '3:4') aspectRatioClass = 'aspect-[3/4]';
            else if (selectedRatio === '9:16') aspectRatioClass = 'aspect-[9/16]';

            prompts.forEach((p, index) => {
                const card = document.createElement('div');
                card.id = `review-card-${index + 1}`;
                card.className = 'result-card card p-4 flex flex-col justify-between';

                card.dataset.title = p.title;
                card.dataset.prompt = p.prompt;

                card.innerHTML = `
                    <div class="mb-4">
                        <h3 class="text-lg font-semibold text-gray-800">${p.title}</h3>
                    </div>
                    <div class="review-output-container ${aspectRatioClass} bg-gray-100 rounded-md flex items-center justify-center">
                        <div class="loader"></div>
                    </div>
                `;
                reviewGrid.appendChild(card);
            });
        };

        reviewGenerateDescBtn.addEventListener('click', async () => {
            const originalButtonText = reviewGenerateDescBtn.innerHTML;
            reviewGenerateDescBtn.innerHTML = `<div class="loader !w-4 !h-4 !border-2"></div>`;
            reviewGenerateDescBtn.disabled = true;
            try {
                const apiKey = "";
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
                const systemPrompt = `You are a professional affiliate reviewer. Analyze the product in the image and write a concise, authentic-sounding review intro in Indonesian. Highlight its key features from a user's perspective. Keep it under 500 characters.`;
                const parts = [ { text: "Buatkan deskripsi produk untuk gambar ini." }];
                if (reviewProductImages.length > 0) {
                     parts.push({ inlineData: { mimeType: reviewProductImages[0].mimeType, data: reviewProductImages[0].base64 } });
                }
                const payload = {
                    contents: [{ parts: parts }],
                    systemInstruction: { parts: [{ text: systemPrompt }] }
                };
                const response = await fetch(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
                if (!response.ok) { const errorData = await response.json(); throw new Error(errorData.error?.message || `HTTP error! status: ${response.status}`); }
                const result = await response.json();
                const description = result.candidates[0].content.parts[0].text;
                reviewProductDescInput.value = description.trim();
                updateReviewButtonState();
            } catch(error) {
                console.error("Error generating description:", error);
                reviewProductDescInput.value = "Gagal membuat deskripsi. Coba lagi.";
            } finally {
                reviewGenerateDescBtn.innerHTML = originalButtonText;
                reviewGenerateDescBtn.disabled = false;
            }
        });

        window.handleReviewCaptionClick = async function(imageUrl, title) {
            try {
                // Tampilkan loading modal
                const modal = document.createElement('div');
                modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4 overflow-y-auto';
                modal.style.WebkitOverflowScrolling = 'touch';
                modal.innerHTML = `
                    <div class="bg-white rounded-xl p-6 max-w-2xl w-full my-8" onclick="event.stopPropagation()">
                        <h3 class="text-xl font-bold mb-4 text-gray-800">
                            <i class="fas fa-pencil-alt text-rose-500 mr-2"></i>Membuat Caption...
                        </h3>
                        <div class="flex items-center justify-center py-8">
                            <div class="loader !border-l-rose-500"></div>
                        </div>
                    </div>
                `;
                document.body.appendChild(modal);

                // Close modal on backdrop click
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) {
                        modal.remove();
                    }
                });

                const parts = imageUrl.split(',');
                const mimeType = parts[0].match(/:(.*?);/)[1];
                const base64Data = parts[1];
                const apiKey = "";
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
                const systemPrompt = `You are a creative social media manager for an affiliate marketer. Based on the product photo, description, and theme, write an engaging review-style Instagram caption in Indonesian. It must sound authentic (like a real user's experience), be appealing, and end with 3-5 relevant hashtags and a subtle call-to-action (e.g., 'cek link di bio!').`;
                const userQuery = `Product Description: "${reviewProductDescInput.value.trim()}"\nPhoto Theme: "${title}"`;
                const payload = {
                    contents: [{ parts: [ { text: userQuery }, { inlineData: { mimeType: mimeType, data: base64Data } } ] }],
                    systemInstruction: { parts: [{ text: systemPrompt }] }
                };
                const response = await fetch(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
                if (!response.ok) { const errorData = await response.json(); throw new Error(errorData.error?.message || `HTTP error! status: ${response.status}`); }
                const result = await response.json();
                const caption = result.candidates[0].content.parts[0].text;

                // Update modal dengan hasil caption
                const modalContent = modal.querySelector('.bg-white');
                modalContent.innerHTML = `
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-xl font-bold text-gray-800">
                            <i class="fas fa-pencil-alt text-rose-500 mr-2"></i>Caption Instagram
                        </h3>
                        <button data-action="close-modal" class="text-gray-500 hover:text-gray-700 text-2xl leading-none" title="Tutup">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>

                    <div class="max-h-[60vh] overflow-y-auto mb-4" style="-webkit-overflow-scrolling: touch;">
                        <div class="whitespace-pre-wrap bg-gray-100 p-4 rounded-lg text-gray-800 leading-relaxed">${caption.trim()}</div>
                    </div>

                    <div class="flex gap-2">
                        <button data-action="copy-caption" data-caption="${caption.trim().replace(/"/g, '&quot;')}"
                            class="flex-1 bg-rose-500 hover:bg-rose-600 text-white font-bold py-3 px-4 rounded-lg transition-colors">
                            <i class="fas fa-copy mr-2"></i>Salin Caption
                        </button>
                        <button data-action="close-modal"
                            class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-3 px-4 rounded-lg transition-colors">
                            Tutup
                        </button>
                    </div>
                `;

                // Add event delegation for copy and close buttons (works on desktop & mobile)
                modalContent.addEventListener('click', async (e) => {
                    e.stopPropagation();

                    const copyBtn = e.target.closest('[data-action="copy-caption"]');
                    const closeBtn = e.target.closest('[data-action="close-modal"]');

                    if (copyBtn) {
                        const captionText = copyBtn.dataset.caption;
                        try {
                            await navigator.clipboard.writeText(captionText);
                            const originalHTML = copyBtn.innerHTML;
                            copyBtn.innerHTML = '<i class="fas fa-check mr-2"></i>Tersalin!';
                            copyBtn.classList.remove('bg-rose-500');
                            copyBtn.classList.add('bg-green-500');
                            setTimeout(() => {
                                copyBtn.innerHTML = originalHTML;
                                copyBtn.classList.remove('bg-green-500');
                                copyBtn.classList.add('bg-rose-500');
                            }, 2000);
                        } catch (err) {
                            console.error('Failed to copy:', err);
                            alert('Caption berhasil dipilih. Salin dengan Ctrl+C atau Command+C');
                        }
                    } else if (closeBtn) {
                        modal.remove();
                    }
                });
            } catch (error) {
                console.error("Error generating caption:", error);
                showModal('Error', `<p class="text-red-500">Gagal membuat caption. Silakan coba lagi.</p>`);
            }
        }

        window.handleReviewVideoPromptClick = async function(imageUrl, title, sceneIndex) {
            showModal('‚ú® Prompt Image-to-Video', `<div class="flex flex-col items-center gap-4"><div class="loader"></div> <p class="text-gray-500">AI sedang menganalisa gerakan...</p></div>`);
            try {
                const parts = imageUrl.split(',');
                const mimeType = parts[0].match(/:(.*?);/)[1];
                const base64Data = parts[1];
                const apiKey = "";
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

                const productDesc = document.getElementById('review-product-desc-input').value.trim();
                const photoTheme = document.getElementById('review-photo-theme-input').value.trim();

                const systemPrompt = `You are an AI video generation expert. A user has a 10-part product review storyboard. You are being given *one scene* from that story. Your task is to generate a concise, effective image-to-video prompt in English that animates this specific scene, *keeping in mind its place in the overall review narrative*. The prompt must strictly follow the formula: "subject + what it's doing (action) + background + camera movement". Infer the most logical and visually appealing motion from the static image for the 'action' part (e.g., 'unboxing the product', 'showing the texture'), and add a suitable 'camera movement' to make the shot more cinematic (e.g., 'slow zoom in', 'handheld close-up shot').`;

                let userQuery = `
                --- Context ---
                Product Description: "${productDesc}"
                Photo Theme: "${photoTheme || 'Tidak ada'}"
                This Scene's Title: "${title}"
                This is Scene: ${sceneIndex} of 10 in a product review video.
                --- Task ---
                Based on all this context, write a short, cinematic video prompt (in English) to bring this specific review scene to life.
                `;

                const payload = {
                    contents: [{ parts: [ { text: userQuery }, { inlineData: { mimeType: mimeType, data: base64Data } } ] }],
                    systemInstruction: { parts: [{ text: systemPrompt }] }
                };
                const response = await fetch(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
                if (!response.ok) { const errorData = await response.json(); throw new Error(errorData.error?.message || `HTTP error! status: ${response.status}`); }
                const result = await response.json();
                const prompt = result.candidates[0].content.parts[0].text;
                const content = `
                    <div class="text-sm text-gray-500 mb-2">Prompt ini dibuat berdasarkan konteks Scene ${sceneIndex}/10:</div>
                    <div id="modal-text-content" class="whitespace-pre-wrap bg-gray-100 p-4 rounded-lg text-gray-600 mb-4 font-mono">${prompt.trim()}</div>
                    <button id="copy-modal-btn" class="w-full btn-primary font-bold py-2 px-4 rounded-lg flex items-center justify-center">Salin Prompt</button>
                `;
                showModal('‚ú® Prompt Image-to-Video', content);
                const copyBtn = document.getElementById('copy-modal-btn');
                const handleCopy = (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    const text = document.getElementById('modal-text-content').innerText;
                    copyToClipboard(text, e.currentTarget);
                };
                copyBtn.addEventListener('click', handleCopy);
                copyBtn.addEventListener('touchend', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    handleCopy(e);
                });
            } catch (error) {
                console.error("Error generating video prompt:", error);
                showModal('Error', `<p class="text-red-500">Gagal membuat prompt video. Silakan coba lagi.</p>`);
            }
        }

        window.handleReviewEditPromptClick = function(id, title, originalPrompt) {
            const content = `
                <p class="text-sm text-gray-500 mb-2">Edit prompt untuk scene review:</p>
                <h4 class="text-lg font-semibold text-gray-800 mb-3">${title}</h4>
                <textarea id="modal-edit-prompt-textarea" class="w-full h-32 p-3 bg-gray-100 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition" rows="5">${originalPrompt}</textarea>
                <button id="modal-regenerate-btn" class="w-full btn-primary font-bold py-2 px-4 rounded-lg flex items-center justify-center mt-4">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9M4 12v5h.582m15.356 2A8.001 8.001 0 004.582 17M20 12h-5" /></svg>
                    Regenerate
                </button>
            `;
            showModal('‚úèÔ∏è Edit & Regenerate Prompt', content);

            document.getElementById('modal-regenerate-btn').addEventListener('click', () => {
                const newPrompt = document.getElementById('modal-edit-prompt-textarea').value;
                universalModal.classList.remove('visible');
                generateSingleReview(id, title, newPrompt);
            });
        }

        // Event delegation for action buttons in review results (works on desktop & mobile)
        reviewGrid.addEventListener('click', (e) => {
            e.stopPropagation();

            // Try to find the button - either clicked directly or child element
            const actionBtn = e.target.classList.contains('action-btn') ? e.target : e.target.closest('.action-btn[data-action]');
            if (!actionBtn) return;

            const action = actionBtn.dataset.action;
            const sceneId = actionBtn.dataset.sceneId;
            const card = document.getElementById(`review-card-${sceneId}`);

            if (!card) {
                console.error('Card not found for scene ID:', sceneId);
                return;
            }

            const img = card.querySelector('.review-output-container img');
            const imageUrl = img ? img.src : '';
            const title = card.dataset.title || '';
            const originalPrompt = card.dataset.prompt || '';

            console.log('Action clicked:', action, 'Scene:', sceneId);

            if (action === 'review-preview') {
                if (!img) return;
                if (window.showPreviewModal) {
                    window.showPreviewModal(imageUrl);
                }
            } else if (action === 'review-edit-prompt') {
                window.handleReviewEditPromptClick(parseInt(sceneId), title, originalPrompt);
            } else if (action === 'review-regenerate') {
                // Regenerate with same prompt
                generateSingleReview(parseInt(sceneId), title, originalPrompt);
            } else if (action === 'review-video-prompt') {
                if (!img) return;
                window.handleReviewVideoPromptClick(imageUrl, title, parseInt(sceneId));
            } else if (action === 'review-caption') {
                if (!img) return;
                window.handleReviewCaptionClick(imageUrl, title);
            } else if (action === 'review-download') {
                if (!img) {
                    console.error('Image not found for download');
                    return;
                }
                const filename = actionBtn.dataset.filename || `review_${sceneId}.png`;
                console.log('Downloading:', filename, imageUrl.substring(0, 50));
                if (window.downloadDataURINew) {
                    window.downloadDataURINew(imageUrl, filename);
                }
            }
        });
    })();

    // ========================================
    // TAB: PRODUCT ADS GENERATOR
    // ========================================
    (() => {
        const adsImageInput = document.getElementById('ads-image-input');
        const adsImageUploadArea = document.getElementById('ads-image-upload-area');
        const adsImagePreviewContainer = document.getElementById('ads-image-preview-container');

        const adsModelImageInput = document.getElementById('ads-model-image-input');
        const adsModelImageUploadArea = document.getElementById('ads-model-image-upload-area');
        const adsModelImagePreviewContainer = document.getElementById('ads-model-image-preview-container');
        const adsModelImagePreview = document.getElementById('ads-model-image-preview');
        const adsRemoveModelImageBtn = document.getElementById('ads-remove-model-image-btn');

        const adsProductDescInput = document.getElementById('ads-product-desc-input');
        const adsGenerateBtn = document.getElementById('ads-generate-btn');
        const adsGrid = document.getElementById('ads-grid');
        const adsGenerateDescBtn = document.getElementById('ads-generate-desc-btn');

        let adsProductImages = [];
        let adsModelImageBase64 = null;
        let adsModelImageMimeType = null;

        function updateAdsButtonState() {
            adsGenerateBtn.disabled = adsProductImages.length === 0 || !adsProductDescInput.value.trim();
            adsGenerateDescBtn.disabled = adsProductImages.length === 0;
        }

        adsImageInput.addEventListener('change', (event) => {
            handleAdsProductFiles(event.target.files);
            event.target.value = null;
        });

        function manageAdsAddMoreButton() {
            const existingButton = document.getElementById('ads-add-more-button');
            if (existingButton) {
                existingButton.remove();
            }

            const addButtonWrapper = document.createElement('div');
            addButtonWrapper.id = 'ads-add-more-button';
            addButtonWrapper.innerHTML = `
                <label for="ads-image-input" class="w-full h-24 flex flex-col items-center justify-center rounded-lg border-2 border-dashed border-gray-300 cursor-pointer text-gray-400 hover:bg-gray-100 hover:border-gray-400 transition-colors">
                     <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg>
                </label>
            `;
            adsImagePreviewContainer.appendChild(addButtonWrapper);
        }

        function handleAdsProductFiles(files) {
            if (files.length === 0) return;

            adsImageUploadArea.classList.add('hidden');
            adsImagePreviewContainer.classList.remove('hidden');

            let filesToProcess = files.length;

            Array.from(files).forEach(file => {
                const reader = new FileReader();
                reader.onload = (e) => {
                    const parts = e.target.result.split(',');
                    const mimeType = parts[0].match(/:(.*?);/)[1];
                    const base64 = parts[1];
                    const imageData = { base64, mimeType, id: Date.now() + Math.random() };
                    adsProductImages.push(imageData);

                    const previewWrapper = document.createElement('div');
                    previewWrapper.className = 'relative group';
                    previewWrapper.innerHTML = `
                        <img src="${e.target.result}" alt="Pratinjau Produk" class="rounded-lg w-full h-24 object-cover">
                        <button data-id="${imageData.id}" class="absolute top-1 right-1 bg-red-500 text-white rounded-full p-1 opacity-0 group-hover:opacity-100 transition-opacity focus:opacity-100">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                        </button>
                    `;

                    adsImagePreviewContainer.appendChild(previewWrapper);

                    previewWrapper.querySelector('button').addEventListener('click', (btnEvent) => {
                        const idToRemove = parseFloat(btnEvent.currentTarget.getAttribute('data-id'));
                        adsProductImages = adsProductImages.filter(img => img.id !== idToRemove);
                        previewWrapper.remove();
                        if (adsProductImages.length === 0) {
                            adsImageUploadArea.classList.remove('hidden');
                            adsImagePreviewContainer.classList.add('hidden');
                            const addButton = document.getElementById('ads-add-more-button');
                            if (addButton) addButton.remove();
                        }
                        updateAdsButtonState();
                    });

                    updateAdsButtonState();

                    filesToProcess--;
                    if (filesToProcess === 0) {
                        manageAdsAddMoreButton();
                    }
                };
                reader.readAsDataURL(file);
            });
        }

        function setupAdsSingleImageUpload(input, uploadArea, previewContainer, previewImg, removeBtn, onUpload) {
            input.addEventListener('change', (event) => {
                const file = event.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        previewImg.src = e.target.result;
                        const parts = e.target.result.split(',');
                        const mimeType = parts[0].match(/:(.*?);/)[1];
                        const base64 = parts[1];
                        onUpload(base64, mimeType);

                        uploadArea.classList.add('hidden');
                        previewContainer.classList.remove('hidden');
                    };
                    reader.readAsDataURL(file);
                }
            });

            removeBtn.addEventListener('click', () => {
                onUpload(null, null);
                input.value = '';
                uploadArea.classList.remove('hidden');
                previewContainer.classList.add('hidden');
            });
        }

        setupAdsSingleImageUpload(adsModelImageInput, adsModelImageUploadArea, adsModelImagePreviewContainer, adsModelImagePreview, adsRemoveModelImageBtn, (base64, mime) => {
            adsModelImageBase64 = base64;
            adsModelImageMimeType = mime;
        });

        adsProductDescInput.addEventListener('input', updateAdsButtonState);

        const createInitialAdsPlaceholders = () => {
            adsGrid.innerHTML = '';
            const selectedRatio = document.querySelector('.ratio-btn-ads.selected')?.dataset.ratio || '16:9';
            let aspectRatioClass = 'aspect-video'; // default 16:9
            if (selectedRatio === '1:1') aspectRatioClass = 'aspect-square';
            else if (selectedRatio === '3:4') aspectRatioClass = 'aspect-[3/4]';
            else if (selectedRatio === '9:16') aspectRatioClass = 'aspect-[9/16]';

            for(let i = 1; i <= 10; i++) {
                const card = document.createElement('div');
                card.className = 'result-card card p-4 flex flex-col justify-between animate-pulse';
                card.innerHTML = `
                    <div><div class="h-6 bg-gray-200 rounded w-3/4 mb-4"></div></div>
                    <div class="mt-4 ${aspectRatioClass} bg-gray-300 rounded-md flex items-center justify-center"></div>
                `;
                adsGrid.appendChild(card);
            }
        };
        window.addEventListener('load', createInitialAdsPlaceholders);

        // Ratio button selection handler
        document.querySelectorAll('.ratio-btn-ads').forEach(btn => {
            btn.addEventListener('click', function() {
                // Remove selected class from all buttons
                document.querySelectorAll('.ratio-btn-ads').forEach(b => {
                    b.classList.remove('selected');
                    b.style.borderColor = '';
                    b.style.background = '';
                    b.style.color = '';
                    b.style.boxShadow = '';
                });
                // Add selected class to clicked button
                this.classList.add('selected');
                this.style.borderColor = '#ec4899';
                this.style.background = 'linear-gradient(135deg, #ec4899, #8b5cf6)';
                this.style.color = 'white';
                this.style.boxShadow = '0 4px 12px rgba(236, 72, 153, 0.3)';

                // Update placeholders
                createInitialAdsPlaceholders();
            });
        });

        adsGenerateBtn.addEventListener('click', async () => {
            if (adsProductImages.length === 0) return;
            adsGenerateBtn.disabled = true;
            adsGenerateBtn.innerHTML = `<div class="loader"></div><span class="ml-2">Menganalisa...</span>`;
            adsGrid.innerHTML = `<div class="col-span-1 sm:col-span-2 xl:col-span-3 text-center py-10">
                <div class="loader inline-block"></div>
                <p class="mt-4 text-gray-500">AI sedang menganalisis produk dan membuat ide scene iklan...</p>
            </div>`;

            try {
                const adsIdeas = await analyzeAndGetAdsPrompts();
                adsGenerateBtn.innerHTML = `<div class="loader"></div><span class="ml-2">Membuat Visual...</span>`;
                createAdsDynamicCards(adsIdeas);

                const generationPromises = adsIdeas.map((idea, index) =>
                    generateSingleAd(index + 1, idea.title, idea.prompt)
                );
                await Promise.allSettled(generationPromises);
            } catch (error) {
                console.error("Error during generation process:", error);
                adsGrid.innerHTML = `<div class="col-span-1 sm:col-span-2 xl:col-span-3 text-center py-10 text-red-500">
                    <p>Terjadi kesalahan saat menganalisis produk: ${error.message}</p>
                </div>`;
            } finally {
                adsGenerateBtn.disabled = false;
                adsGenerateBtn.innerHTML = `<span>Buat 10 Scene Iklan</span>`;
            }
        });

        async function analyzeAndGetAdsPrompts() {
            const apiKey = "";
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
            const selectedRatio = document.querySelector('.ratio-btn-ads.selected')?.dataset.ratio || '16:9';

            const voiceSelect = document.getElementById('ads-narrator-voice');
            const selectedVoiceName = voiceSelect.value;
            const selectedVoiceDesc = voiceSelect.options[voiceSelect.selectedIndex].dataset.desc;

            let systemPrompt = '';
            if (adsModelImageBase64) {
                 systemPrompt = `You are an expert AI storyboard artist and creative director. Your task is to analyze the product, description, and optional model/theme to create a **10-part visual advertising story** for the aspect ratio ${selectedRatio}.
The story will be narrated by a voice named **${selectedVoiceName}**, who has a **'${selectedVoiceDesc}'** tone.
You MUST ensure the 10 scenes form a coherent, sequential narrative (Scene 1, Scene 2... Scene 10) that perfectly matches the narrator's tone.
For each scene, provide a short title (in Indonesian, e.g., 'Scene 1: Awal Mula') and a CONCISE English prompt for an AI image generator.
Respond ONLY with a valid JSON array of 10 objects, in sequential story order.`;
            } else {
                 systemPrompt = `You are an elite-level creative director. Your primary goal is to generate a **10-part visual advertising story** (storyboard) for the product for the aspect ratio ${selectedRatio}. **Absolutely no people, models, or human parts.**
The story will be narrated by a voice named **${selectedVoiceName}**, who has a **'${selectedVoiceDesc}'** tone.
You MUST ensure the 10 scenes form a coherent, sequential narrative (Scene 1, Scene 2... Scene 10) that showcases the product's journey or benefits sequentially, matching the narrator's tone.
For each concept, provide a short, elegant title in Indonesian (e.g., 'Bagian 1: Pengenalan') and a CONCISE English prompt for the AI image generator.
Respond ONLY with a valid JSON array of 10 objects, in sequential story order.`;
            }

            const theme = document.getElementById('ads-photo-theme-input').value.trim();
            let userQuery = `Analyze this product. Product Description: "${adsProductDescInput.value.trim()}". Desired aspect ratio is ${selectedRatio}.`;
            if (theme) {
                userQuery += `\nPhoto Theme: "${theme}"`;
            }
            const parts = [{ text: userQuery }];
            adsProductImages.forEach(img => {
                parts.push({ inlineData: { mimeType: img.mimeType, data: img.base64 } });
            });
            if (adsModelImageBase64) {
                parts.push({ inlineData: { mimeType: adsModelImageMimeType, data: adsModelImageBase64 } });
            }
            const payload = { contents: [{ parts: parts }], systemInstruction: { parts: [{ text: systemPrompt }] }, generationConfig: { responseMimeType: "application/json", responseSchema: { type: "ARRAY", items: { type: "OBJECT", properties: { "title": { "type": "STRING" }, "prompt": { "type": "STRING" } }, required: ["title", "prompt"] } } } };
            const response = await fetch(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
            if (!response.ok) { const errorData = await response.json(); throw new Error(errorData.error?.message || `HTTP error! status: ${response.status}`); }
            const result = await response.json();

            if (!result.candidates || !result.candidates[0].content || !result.candidates[0].content.parts || !result.candidates[0].content.parts[0].text) {
                throw new Error("Invalid response structure from API.");
            }

            let rawText = result.candidates[0].content.parts[0].text;
            rawText = rawText.replace(/```json/g, '').replace(/```/g, '').trim();
            const startIndex = rawText.indexOf('[');
            const endIndex = rawText.lastIndexOf(']');

            if (startIndex === -1 || endIndex === -1 || startIndex > endIndex) {
                throw new Error("Could not find a valid JSON array in the API response.");
            }

            const jsonText = rawText.substring(startIndex, endIndex + 1);

            try {
                return JSON.parse(jsonText);
            } catch (e) {
                console.error("Failed to parse JSON:", jsonText, e);
                throw new Error("API returned malformed JSON after cleaning.");
            }
        }

        async function generateSingleAd(id, title, prompt) {
            const card = document.getElementById(`ads-card-${id}`);
            if (!card) return;
            const outputContainer = card.querySelector('.ads-output-container');

            const selectedRatio = document.querySelector('.ratio-btn-ads.selected')?.dataset.ratio || '16:9';
            let aspectRatioClass = 'aspect-video'; // default 16:9
            if (selectedRatio === '1:1') aspectRatioClass = 'aspect-square';
            else if (selectedRatio === '3:4') aspectRatioClass = 'aspect-[3/4]';
            else if (selectedRatio === '9:16') aspectRatioClass = 'aspect-[9/16]';

            outputContainer.innerHTML = `<div class="${aspectRatioClass} bg-gray-100 rounded-md flex items-center justify-center"><div class="loader"></div></div>`;

            const retries = 3;
            let lastError = null;

            for (let i = 0; i < retries; i++) {
                try {
                    const apiKey = "";
                    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-image-preview:generateContent?key=${apiKey}`;
                    const selectedRatio = document.querySelector('.ratio-btn-ads.selected')?.dataset.ratio || '16:9';

                    let finalPrompt = '';
                    if (adsModelImageBase64) {
                        finalPrompt = `${prompt}, elegant, cinematic, professional product photography, dramatic lighting, 8k, photorealistic`;
                    } else {
                        finalPrompt = `${prompt}, professional commercial product photography, hyper-detailed, epic composition, cinematic lighting, no people, 8k, photorealistic`;
                    }

                    const parts = [{ text: finalPrompt }];

                    adsProductImages.forEach(img => {
                        parts.push({ inlineData: { mimeType: img.mimeType, data: img.base64 } });
                    });

                    if (adsModelImageBase64) { parts.push({ inlineData: { mimeType: adsModelImageMimeType, data: adsModelImageBase64 } }); }

                    const payload = {
                        contents: [{ parts: parts }],
                        generationConfig: {
                            responseModalities: ['IMAGE'],
                            imageConfig: { aspectRatio: selectedRatio }
                        },
                        safetySettings: [
                            { "category": "HARM_CATEGORY_HARASSMENT", "threshold": "BLOCK_NONE" },
                            { "category": "HARM_CATEGORY_HATE_SPEECH", "threshold": "BLOCK_NONE" },
                            { "category": "HARM_CATEGORY_SEXUALLY_EXPLICIT", "threshold": "BLOCK_NONE" },
                            { "category": "HARM_CATEGORY_DANGEROUS_CONTENT", "threshold": "BLOCK_NONE" }
                        ]
                    };

                    const response = await fetch(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });

                    const responseText = await response.text();
                    if (!responseText || responseText.trim() === '') {
                        throw new Error("API memberikan respons kosong, kemungkinan karena filter keamanan.");
                    }

                    let result;
                    try { result = JSON.parse(responseText); } catch (e) { throw new Error(`Gagal mem-parsing respons API. Konten: ${responseText.substring(0, 200)}`); }

                    if (!response.ok) { const errorMessage = result.error?.message || `API error: ${response.statusText}`; throw new Error(errorMessage); }

                    const base64Data = result?.candidates?.[0]?.content?.parts?.find(p => p.inlineData)?.inlineData?.data;

                    if (base64Data) {
                        const imageUrl = `data:image/png;base64,${base64Data}`;
                        const safeTitle = title.replace(/[^a-z0-9]/gi, '_').toLowerCase();

                        // Store prompt in card's dataset for edit functionality
                        const card = document.getElementById(`ads-card-${id}`);
                        if (card) {
                            card.dataset.prompt = prompt;
                        }

                        outputContainer.innerHTML = `
                            <div class="relative w-full h-full group">
                                <img src="${imageUrl}" class="w-full h-full object-cover rounded-md" alt="Ad Scene">
                                <div class="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/70 via-black/50 to-transparent p-4 opacity-0 group-hover:opacity-100 transition-all duration-300 ease-in-out rounded-b-md">
                                    <div class="flex flex-wrap gap-2 justify-end">
                                        <button data-action="ads-preview" data-scene-id="${id}" class="action-btn bg-blue-500 text-white px-3 py-2 rounded-lg hover:bg-blue-600 active:scale-95 transition-all duration-200 shadow-lg hover:shadow-xl flex items-center gap-2 text-sm font-medium" title="Preview">
                                            <i class="fas fa-search-plus"></i>
                                            <span class="hidden sm:inline">Preview</span>
                                        </button>
                                        <button data-action="ads-edit-prompt" data-scene-id="${id}" class="action-btn bg-purple-500 text-white px-3 py-2 rounded-lg hover:bg-purple-600 active:scale-95 transition-all duration-200 shadow-lg hover:shadow-xl flex items-center gap-2 text-sm font-medium" title="Edit Prompt">
                                            <i class="fas fa-edit"></i>
                                            <span class="hidden sm:inline">Edit</span>
                                        </button>
                                        <button data-action="ads-regenerate" data-scene-id="${id}" class="action-btn bg-green-500 text-white px-3 py-2 rounded-lg hover:bg-green-600 active:scale-95 transition-all duration-200 shadow-lg hover:shadow-xl flex items-center gap-2 text-sm font-medium" title="Regenerate">
                                            <i class="fas fa-sync-alt"></i>
                                            <span class="hidden sm:inline">Regenerate</span>
                                        </button>
                                        <button data-action="ads-video-prompt" data-scene-id="${id}" class="action-btn bg-fuchsia-500 text-white px-3 py-2 rounded-lg hover:bg-fuchsia-600 active:scale-95 transition-all duration-200 shadow-lg hover:shadow-xl flex items-center gap-2 text-sm font-medium" title="Buat Prompt Video">
                                            <i class="fas fa-film"></i>
                                            <span class="hidden sm:inline">Video</span>
                                        </button>
                                        <button data-action="ads-caption" data-scene-id="${id}" class="action-btn bg-rose-500 text-white px-3 py-2 rounded-lg hover:bg-rose-600 active:scale-95 transition-all duration-200 shadow-lg hover:shadow-xl flex items-center gap-2 text-sm font-medium" title="Buat Caption">
                                            <i class="fas fa-pencil-alt"></i>
                                            <span class="hidden sm:inline">Caption</span>
                                        </button>
                                        <button data-action="ads-download" data-scene-id="${id}" data-filename="iklan_${id}_${safeTitle}.png" class="action-btn bg-cyan-600 text-white px-3 py-2 rounded-lg hover:bg-cyan-700 active:scale-95 transition-all duration-200 shadow-lg hover:shadow-xl flex items-center gap-2 text-sm font-medium" title="Unduh Gambar">
                                            <i class="fas fa-download"></i>
                                            <span class="hidden sm:inline">Unduh</span>
                                        </button>
                                    </div>
                                </div>
                            </div>`;
                        return;
                    } else {
                         let reason = "Respon tidak valid dari API.";
                        if (result.promptFeedback && result.promptFeedback.blockReason) {
                            reason = `Diblokir: ${result.promptFeedback.blockReason}`;
                        } else if (result?.candidates?.[0]?.finishReason) {
                            reason = `Selesai dengan alasan: ${result.candidates[0].finishReason}`;
                        }
                        throw new Error(reason);
                    }
                } catch (error) {
                    lastError = error;
                    console.error(`Attempt ${i + 1} for card ${id} failed:`, error);
                    if (i < retries - 1) {
                        const delay = 1000 * Math.pow(2, i);
                        await new Promise(res => setTimeout(res, delay));
                    }
                }
            }

            if (lastError) {
                console.error(`All retries failed for card ${id}:`, lastError);
                outputContainer.innerHTML = `<div class="text-xs text-red-500 p-2 text-center" title="${lastError.message}">Gagal: ${lastError.message.substring(0, 50)}${lastError.message.length > 50 ? '...' : ''}</div>`;
            }
        }

        const createAdsDynamicCards = (prompts) => {
            adsGrid.innerHTML = '';
            const selectedRatio = document.querySelector('.ratio-btn-ads.selected')?.dataset.ratio || '16:9';
            let aspectRatioClass = 'aspect-video'; // default 16:9
            if (selectedRatio === '1:1') aspectRatioClass = 'aspect-square';
            else if (selectedRatio === '3:4') aspectRatioClass = 'aspect-[3/4]';
            else if (selectedRatio === '9:16') aspectRatioClass = 'aspect-[9/16]';

            prompts.forEach((p, index) => {
                const card = document.createElement('div');
                card.id = `ads-card-${index + 1}`;
                card.className = 'result-card card p-4 flex flex-col justify-between';
                card.innerHTML = `<div><h3 class="text-lg font-semibold text-gray-800 mb-4">${p.title}</h3></div> <div class="ads-output-container ${aspectRatioClass} bg-gray-100 rounded-md flex items-center justify-center"><div class="loader"></div></div>`;
                adsGrid.appendChild(card);
            });
        };

        adsGenerateDescBtn.addEventListener('click', async () => {
            const originalButtonText = adsGenerateDescBtn.innerHTML;
            adsGenerateDescBtn.innerHTML = `<div class="loader !w-4 !h-4 !border-2"></div>`;
            adsGenerateDescBtn.disabled = true;
            try {
                const apiKey = "";
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
                const systemPrompt = `You are a professional copywriter. Analyze the product in the image and write a concise, compelling, and SEO-friendly product description in Indonesian. Highlight its key features and potential benefits for customers. Keep it under 500 characters.`;
                const parts = [ { text: "Buatkan deskripsi produk untuk gambar ini." }];
                if (adsProductImages.length > 0) {
                     parts.push({ inlineData: { mimeType: adsProductImages[0].mimeType, data: adsProductImages[0].base64 } });
                }
                const payload = {
                    contents: [{ parts: parts }],
                    systemInstruction: { parts: [{ text: systemPrompt }] }
                };
                const response = await fetch(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
                if (!response.ok) { const errorData = await response.json(); throw new Error(errorData.error?.message || `HTTP error! status: ${response.status}`); }
                const result = await response.json();
                const description = result.candidates[0].content.parts[0].text;
                adsProductDescInput.value = description.trim();
                updateAdsButtonState();
            } catch(error) {
                console.error("Error generating description:", error);
                adsProductDescInput.value = "Gagal membuat deskripsi. Coba lagi.";
            } finally {
                adsGenerateDescBtn.innerHTML = originalButtonText;
                adsGenerateDescBtn.disabled = false;
            }
        });

        window.handleAdsCaptionClick = async function(imageUrl, title) {
            try {
                // Tampilkan loading modal
                const modal = document.createElement('div');
                modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4 overflow-y-auto';
                modal.style.WebkitOverflowScrolling = 'touch';
                modal.innerHTML = `
                    <div class="bg-white rounded-xl p-6 max-w-2xl w-full my-8" onclick="event.stopPropagation()">
                        <h3 class="text-xl font-bold mb-4 text-gray-800">
                            <i class="fas fa-pencil-alt text-rose-500 mr-2"></i>Membuat Caption...
                        </h3>
                        <div class="flex items-center justify-center py-8">
                            <div class="loader !border-l-rose-500"></div>
                        </div>
                    </div>
                `;
                document.body.appendChild(modal);

                // Close modal on backdrop click
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) {
                        modal.remove();
                    }
                });

                const parts = imageUrl.split(',');
                const mimeType = parts[0].match(/:(.*?);/)[1];
                const base64Data = parts[1];
                const apiKey = "";
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
                const systemPrompt = `You are a creative social media manager. Based on the product photo, description, and theme, write an engaging Instagram caption in Indonesian. It should be appealing, concise, and end with 3-5 relevant hashtags.`;
                const userQuery = `Product Description: "${adsProductDescInput.value.trim()}"\nPhoto Theme: "${title}"`;
                const payload = {
                    contents: [{ parts: [ { text: userQuery }, { inlineData: { mimeType: mimeType, data: base64Data } } ] }],
                    systemInstruction: { parts: [{ text: systemPrompt }] }
                };
                const response = await fetch(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
                if (!response.ok) { const errorData = await response.json(); throw new Error(errorData.error?.message || `HTTP error! status: ${response.status}`); }
                const result = await response.json();
                const caption = result.candidates[0].content.parts[0].text;

                // Update modal dengan hasil caption
                const modalContent = modal.querySelector('.bg-white');
                modalContent.innerHTML = `
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-xl font-bold text-gray-800">
                            <i class="fas fa-pencil-alt text-rose-500 mr-2"></i>Caption Instagram
                        </h3>
                        <button data-action="close-modal" class="text-gray-500 hover:text-gray-700 text-2xl leading-none" title="Tutup">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>

                    <div class="max-h-[60vh] overflow-y-auto mb-4" style="-webkit-overflow-scrolling: touch;">
                        <div class="whitespace-pre-wrap bg-gray-100 p-4 rounded-lg text-gray-800 leading-relaxed">${caption.trim()}</div>
                    </div>

                    <div class="flex gap-2">
                        <button data-action="copy-caption" data-caption="${caption.trim().replace(/"/g, '&quot;')}"
                            class="flex-1 bg-rose-500 hover:bg-rose-600 text-white font-bold py-3 px-4 rounded-lg transition-colors">
                            <i class="fas fa-copy mr-2"></i>Salin Caption
                        </button>
                        <button data-action="close-modal"
                            class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-3 px-4 rounded-lg transition-colors">
                            Tutup
                        </button>
                    </div>
                `;

                // Add event delegation for copy and close buttons (works on desktop & mobile)
                modalContent.addEventListener('click', async (e) => {
                    e.stopPropagation();

                    const copyBtn = e.target.closest('[data-action="copy-caption"]');
                    const closeBtn = e.target.closest('[data-action="close-modal"]');

                    if (copyBtn) {
                        const captionText = copyBtn.dataset.caption;
                        try {
                            await navigator.clipboard.writeText(captionText);
                            const originalHTML = copyBtn.innerHTML;
                            copyBtn.innerHTML = '<i class="fas fa-check mr-2"></i>Tersalin!';
                            copyBtn.classList.remove('bg-rose-500');
                            copyBtn.classList.add('bg-green-500');
                            setTimeout(() => {
                                copyBtn.innerHTML = originalHTML;
                                copyBtn.classList.remove('bg-green-500');
                                copyBtn.classList.add('bg-rose-500');
                            }, 2000);
                        } catch (err) {
                            console.error('Failed to copy:', err);
                            alert('Caption berhasil dipilih. Salin dengan Ctrl+C atau Command+C');
                        }
                    } else if (closeBtn) {
                        modal.remove();
                    }
                });
            } catch (error) {
                console.error("Error generating caption:", error);
                showModal('Error', `<p class="text-red-500">Gagal membuat caption. Silakan coba lagi.</p>`);
            }
        }

        window.handleAdsEditPromptClick = function(id, title, originalPrompt) {
            const content = `
                <p class="text-sm text-gray-500 mb-2">Edit prompt untuk scene:</p>
                <h4 class="text-lg font-semibold text-gray-800 mb-3">${title}</h4>
                <textarea id="modal-edit-prompt-textarea" class="w-full h-32 p-3 bg-gray-100 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition" rows="5">${originalPrompt}</textarea>
                <button id="modal-regenerate-btn" class="w-full btn-primary font-bold py-2 px-4 rounded-lg flex items-center justify-center mt-4">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9M4 12v5h.582m15.356 2A8.001 8.001 0 004.582 17M20 12h-5" /></svg>
                    Regenerate
                </button>
            `;
            showModal('‚úèÔ∏è Edit & Regenerate Prompt', content);

            document.getElementById('modal-regenerate-btn').addEventListener('click', () => {
                const newPrompt = document.getElementById('modal-edit-prompt-textarea').value;
                universalModal.classList.remove('visible');
                generateSingleAd(id, title, newPrompt);
            });
        }

        window.handleAdsVideoPromptClick = async function(imageUrl, title, sceneIndex) {
            showModal('‚ú® Prompt Image-to-Video', `<div class="flex flex-col items-center gap-4"><div class="loader"></div> <p class="text-gray-500">AI sedang menganalisa gerakan...</p></div>`);
            try {
                const parts = imageUrl.split(',');
                const mimeType = parts[0].match(/:(.*?);/)[1];
                const base64Data = parts[1];
                const apiKey = "";
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

                const voiceSelect = document.getElementById('ads-narrator-voice');
                const selectedVoiceName = voiceSelect.options[voiceSelect.selectedIndex].text;
                const productDesc = document.getElementById('ads-product-desc-input').value.trim();
                const photoTheme = document.getElementById('ads-photo-theme-input').value.trim();

                const systemPrompt = `You are an AI video generation expert. A user has a 10-part image storyboard for a product advertising. You are being given *one scene* from that story. Your task is to generate a concise, effective image-to-video prompt in English that animates this specific scene, *keeping in mind its place in the overall narrative*. The prompt must strictly follow the formula: "subject + what it's doing (action) + background + camera movement". Infer the most logical and visually appealing motion from the static image for the 'action' part, and add a suitable 'camera movement' to make the shot more cinematic (e.g., 'slow zoom in', 'panning from left to right').`;

                let userQuery = `
                --- Context ---
                Product Description: "${productDesc}"
                Photo Theme: "${photoTheme || 'Tidak ada'}"
                Selected Narrator: "${selectedVoiceName}"
                This Scene's Title: "${title}"
                This is Scene: ${sceneIndex} of 10.
                --- Task ---
                Based on all this context, write a short, cinematic video prompt (in English) to bring this specific advertising scene to life.
                `;

                const payload = {
                    contents: [{ parts: [ { text: userQuery }, { inlineData: { mimeType: mimeType, data: base64Data } } ] }],
                    systemInstruction: { parts: [{ text: systemPrompt }] }
                };
                const response = await fetch(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
                if (!response.ok) { const errorData = await response.json(); throw new Error(errorData.error?.message || `HTTP error! status: ${response.status}`); }
                const result = await response.json();
                const prompt = result.candidates[0].content.parts[0].text;
                const content = `
                    <div class="text-sm text-gray-500 mb-2">Prompt ini dibuat berdasarkan konteks Scene ${sceneIndex}/10:</div>
                    <div id="modal-text-content" class="whitespace-pre-wrap bg-gray-100 p-4 rounded-lg text-gray-600 mb-4 font-mono">${prompt.trim()}</div>
                    <button id="copy-modal-btn" class="w-full btn-primary font-bold py-2 px-4 rounded-lg flex items-center justify-center">Salin Prompt</button>
                `;
                showModal('‚ú® Prompt Image-to-Video', content);
                const copyBtn = document.getElementById('copy-modal-btn');
                const handleCopy = (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    const text = document.getElementById('modal-text-content').innerText;
                    copyToClipboard(text, e.currentTarget);
                };
                copyBtn.addEventListener('click', handleCopy);
                copyBtn.addEventListener('touchend', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    handleCopy(e);
                });
            } catch (error) {
                console.error("Error generating video prompt:", error);
                showModal('Error', `<p class="text-red-500">Gagal membuat prompt video. Silakan coba lagi.</p>`);
            }
        }

        // Event delegation for action buttons in ads results
        adsGrid.addEventListener('click', (e) => {
            e.stopPropagation();

            // Try to find the button - either clicked directly or child element
            const actionBtn = e.target.classList.contains('action-btn') ? e.target : e.target.closest('.action-btn[data-action]');
            if (!actionBtn) return;

            const action = actionBtn.dataset.action;
            const sceneId = actionBtn.dataset.sceneId;
            const card = document.getElementById(`ads-card-${sceneId}`);

            if (!card) {
                console.error('Card not found for scene ID:', sceneId);
                return;
            }

            const img = card.querySelector('.ads-output-container img');
            const imageUrl = img ? img.src : '';
            const title = card.querySelector('h3')?.textContent || '';
            const originalPrompt = card.dataset.prompt || '';

            console.log('Action clicked:', action, 'Scene:', sceneId);

            if (action === 'ads-preview') {
                if (!img) return;
                if (window.showPreviewModal) {
                    window.showPreviewModal(imageUrl);
                }
            } else if (action === 'ads-edit-prompt') {
                window.handleAdsEditPromptClick(parseInt(sceneId), title, originalPrompt);
            } else if (action === 'ads-regenerate') {
                // Regenerate with same prompt
                generateSingleAd(parseInt(sceneId), title, originalPrompt);
            } else if (action === 'ads-video-prompt') {
                if (!img) return;
                window.handleAdsVideoPromptClick(imageUrl, title, parseInt(sceneId));
            } else if (action === 'ads-caption') {
                if (!img) return;
                window.handleAdsCaptionClick(imageUrl, title);
            } else if (action === 'ads-download') {
                if (!img) {
                    console.error('Image not found for download');
                    return;
                }
                const filename = actionBtn.dataset.filename || `iklan_${sceneId}.png`;
                console.log('Downloading:', filename, imageUrl.substring(0, 50));
                if (window.downloadDataURINew) {
                    window.downloadDataURINew(imageUrl, filename);
                }
            }
        });
    })();

    // ==================== FOTO UMRAH/HAJI & PAS FOTO WARNA ====================

    const apiKey = ""; // API key will be injected here by the environment

    // Fungsi Utilitas
    async function convertHeicToJpg(file) {
        const isHeic = file.name.toLowerCase().endsWith('.heic') ||
                      file.type.toLowerCase() === 'image/heic' ||
                      file.type.toLowerCase() === 'image/heif';

        if (isHeic && typeof heic2any !== 'undefined') {
            console.log("HEIC file detected, converting...");
            try {
                const conversionResult = await heic2any({
                    blob: file,
                    toType: "image/jpeg",
                    quality: 0.9,
                });
                const convertedBlob = Array.isArray(conversionResult) ? conversionResult[0] : conversionResult;
                return new File([convertedBlob], file.name.replace(/\.heic$/i, ".jpg"), { type: "image/jpeg" });
            } catch (error) {
                console.error("HEIC conversion failed:", error);
                throw new Error("Gagal mengonversi file HEIC. Coba unggah file JPEG/PNG.");
            }
        }
        return file;
    }

    function setupImageUploadNew(input, uploadArea, onFile) {
        async function handleFile(file) {
            if (file) {
                try {
                    const processedFile = await convertHeicToJpg(file);
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        const parts = e.target.result.split(',');
                        const mimeType = parts[0].match(/:([\w\/]+);/)[1];
                        const base64 = parts[1];
                        onFile({ base64, mimeType, dataUrl: e.target.result });
                    };
                    reader.readAsDataURL(processedFile);
                } catch (error) {
                    console.error("Error processing file:", error);
                }
            }
        }

        input.addEventListener('change', (event) => {
            setTimeout(() => {
                if (event.target.files && event.target.files.length > 0) {
                    handleFile(event.target.files[0]);
                }
            }, 100);
        });

        if (uploadArea) {
            ['dragover', 'drop', 'dragleave'].forEach(eventName => {
                uploadArea.addEventListener(eventName, e => { e.preventDefault(); e.stopPropagation(); });
            });
            uploadArea.addEventListener('dragover', () => uploadArea.style.borderColor = '#F59E0B');
            uploadArea.addEventListener('dragleave', () => uploadArea.style.borderColor = '');
            uploadArea.addEventListener('drop', (e) => {
                uploadArea.style.borderColor = '';
                handleFile(e.dataTransfer.files[0]);
            });
        }
    }

    function setupOptionButtonsNew(container, isCheckbox = false) {
        if (!container) return;
        container.addEventListener('click', (e) => {
            const clickedButton = e.target.closest('button');
            if (clickedButton && container.contains(clickedButton)) {
                if (isCheckbox) {
                    clickedButton.classList.toggle('selected');
                } else {
                    Array.from(container.children).forEach(btn => btn.classList.remove('selected'));
                    clickedButton.classList.add('selected');
                }
            }
        });
    }

    function getAspectRatioClassNew(ratio) {
        const mapping = {
            '1:1': 'aspect-square',
            '16:9': 'aspect-video',
            '9:16': 'aspect-[9/16]',
            '4:3': 'aspect-[4/3]',
            '3:4': 'aspect-[3/4]',
            '2:3': 'aspect-[2/3]',
            '4:6': 'aspect-[4/6]'
        };
        return mapping[ratio] || 'aspect-square';
    }

    window.downloadDataURINew = async function(dataURI, filename) {
        try {
            const response = await fetch(dataURI);
            const blob = await response.blob();
            if (typeof saveAs !== 'undefined') {
                saveAs(blob, filename);
            } else {
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = filename;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                window.URL.revokeObjectURL(url);
            }
        } catch (error) {
            console.error("Gagal mengunduh file:", error);
            window.open(dataURI, '_blank');
        }
    };

    async function validateImageContentNew(imageData, contentType, validationElement) {
        if (!imageData) {
            validationElement.textContent = '';
            return false;
        }
        validationElement.innerHTML = '<div class="loader-icon-umrah mx-auto"></div>';
        try {
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
            const systemPrompt = `Analyze the image. Determine if the main subject is ${contentType}. Respond ONLY with "yes" or "no".`;
            const payload = {
                contents: [{ parts: [{ text: `Is this a photo of ${contentType}?` }, { inlineData: { mimeType: imageData.mimeType, data: imageData.base64 } }] }],
                systemInstruction: { parts: [{ text: systemPrompt }] }
            };
            const response = await fetch(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
            if (!response.ok) throw new Error(`Error ${response.status}`);
            const result = await response.json();
            const answer = result.candidates[0].content.parts[0].text.trim().toLowerCase();

            if (answer.includes('yes')) {
                validationElement.textContent = '‚úì Foto valid';
                validationElement.className = 'text-center text-sm mt-2 text-orange-600';
                return true;
            } else {
                validationElement.textContent = `‚úó Harap unggah foto ${contentType.replace('a ', '')}`;
                validationElement.className = 'text-center text-sm mt-2 text-red-600';
                return false;
            }
        } catch (error) {
            console.error("Validation error:", error);
            validationElement.textContent = `Gagal validasi: ${error.message}`;
            validationElement.className = 'text-center text-sm mt-2 text-red-600';
            return false;
        }
    }

    // ==================== FOTO UMRAH/HAJI ====================
    (function() {
        const umrahInput = document.getElementById('umrah-input');
        const umrahUploadBox = document.getElementById('umrah-upload-box');
        const umrahPreview = document.getElementById('umrah-preview');
        const umrahPlaceholder = document.getElementById('umrah-placeholder');
        const umrahRemoveBtn = document.getElementById('umrah-remove-btn');
        const umrahValidation = document.getElementById('umrah-validation');
        const umrahGenerateBtn = document.getElementById('umrah-generate-btn');
        const umrahDownloadAllBtn = document.getElementById('umrah-download-all-btn');

        if (!umrahInput) return;

        let umrahData = { data: null, isValid: false };
        let generatedImages = []; // Store generated images

        function updateUmrahBtn() {
            umrahGenerateBtn.disabled = !umrahData.isValid;
        }

        setupImageUploadNew(umrahInput, umrahUploadBox, async (data) => {
            umrahData.data = data;
            umrahPreview.src = data.dataUrl;
            umrahPlaceholder.classList.add('hidden');
            umrahPreview.classList.remove('hidden');
            umrahRemoveBtn.classList.remove('hidden');
            umrahData.isValid = true;
            umrahValidation.textContent = '‚úì Foto siap digunakan';
            umrahValidation.className = 'text-center text-sm mt-2 text-orange-600';
            updateUmrahBtn();
        });

        umrahRemoveBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            umrahData = { data: null, isValid: false };
            umrahInput.value = '';
            umrahPreview.src = '#';
            umrahPreview.classList.add('hidden');
            umrahPlaceholder.classList.remove('hidden');
            umrahRemoveBtn.classList.add('hidden');
            umrahValidation.textContent = '';
            updateUmrahBtn();

            document.getElementById('umrah-results-placeholder').classList.remove('hidden');
            document.getElementById('umrah-results-container').classList.add('hidden');
            document.getElementById('umrah-results-grid').innerHTML = '';
        });

        setupOptionButtonsNew(document.getElementById('umrah-gender-options'));
        setupOptionButtonsNew(document.getElementById('umrah-attire-options'));
        setupOptionButtonsNew(document.getElementById('umrah-ratio-options'));
        setupOptionButtonsNew(document.getElementById('umrah-theme-options'));

        umrahGenerateBtn.addEventListener('click', async () => {
            document.getElementById('umrah-results-placeholder').classList.add('hidden');
            const gender = document.querySelector('#umrah-gender-options .selected').dataset.value;
            const attire = document.querySelector('#umrah-attire-options .selected').dataset.value;
            const aspectRatio = document.querySelector('#umrah-ratio-options .selected').dataset.value;
            const theme = document.querySelector('#umrah-theme-options .selected').dataset.value;
            let prompt = `Create a professional photo of the person from the image, placed into an Umrah/Hajj setting. CRITICAL: Preserve the person's exact face and features. The person is a ${gender} and should be wearing ${attire}. Scene: ${theme}. The final photo should be high-quality, realistic, and respectful.`;

            await generatePhotoSet('umrah', prompt, umrahData.data, aspectRatio);
        });

        async function generatePhotoSet(type, prompt, imageData, aspectRatio, refImageData = null) {
            const resultsContainer = document.getElementById(`${type}-results-container`);
            const resultsGrid = document.getElementById(`${type}-results-grid`);
            const generateBtn = document.getElementById(`${type}-generate-btn`);

            const originalBtnHTML = generateBtn.innerHTML;
            generateBtn.disabled = true;
            generateBtn.innerHTML = `<div class="loader-icon-umrah !border-l-white w-5 h-5"></div><span class="ml-2">Membuat Foto...</span>`;

            const aspectClass = getAspectRatioClassNew(aspectRatio);
            resultsContainer.classList.remove('hidden');
            resultsGrid.innerHTML = '';
            generatedImages = []; // Reset array

            const numVariations = 4;

            for (let i = 1; i <= numVariations; i++) {
                const card = document.createElement('div');
                card.id = `${type}-card-${i}`;
                card.className = `card overflow-hidden transition-all ${aspectClass} bg-gray-100 flex items-center justify-center`;
                card.innerHTML = `<div class="loader-icon-umrah" style="width: 2.5rem; height: 2.5rem;"></div>`;
                resultsGrid.appendChild(card);
            }

            const generationPromises = Array.from({ length: numVariations }, (_, i) =>
                generateSinglePhoto(i + 1, type, prompt, imageData, aspectRatio, refImageData)
            );
            await Promise.allSettled(generationPromises);

            generateBtn.disabled = false;
            generateBtn.innerHTML = originalBtnHTML;
        }

        async function generateSinglePhoto(id, type, prompt, imageData, aspectRatio, refImageData = null) {
            const card = document.getElementById(`${type}-card-${id}`);
            try {
                const apiKey = "";
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-image-preview:generateContent?key=${apiKey}`;
                const finalPrompt = `${prompt} This is variation number ${id}.`;

                const parts = [{ text: finalPrompt }, { inlineData: { mimeType: imageData.mimeType, data: imageData.base64 } }];
                if (refImageData) {
                    parts.push({ inlineData: { mimeType: refImageData.mimeType, data: refImageData.base64 } });
                }

                const payload = {
                    contents: [{ parts: parts }],
                    generationConfig: {
                        responseModalities: ['IMAGE'],
                        imageConfig: { aspectRatio: aspectRatio }
                    }
                };
                const response = await fetch(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
                if (!response.ok) {
                    const errorData = await response.json();
                    console.error('API Error:', errorData);
                    throw new Error(`Error ${response.status}: ${errorData.error?.message || 'Unknown error'}`);
                }

                const result = await response.json();
                const base64Data = result?.candidates?.[0]?.content?.parts?.find(p => p.inlineData)?.inlineData?.data;
                if (base64Data) {
                    const imageUrl = `data:image/png;base64,${base64Data}`;
                    const filename = `${type}_foto_${id}.png`;

                    // Store in generatedImages array
                    generatedImages.push({ url: imageUrl, filename: filename });

                    card.innerHTML = `
                        <img src="${imageUrl}" class="w-full h-full object-cover">
                        <div class="absolute bottom-2 right-2 flex gap-1">
                            <button class="btn-view-image bg-white hover:bg-gray-100 text-gray-800 p-2 rounded-full shadow-md" title="Lihat Gambar">
                                <i class="fas fa-eye w-4 h-4"></i>
                            </button>
                            <button class="btn-download-image text-white p-2 rounded-full shadow-md" style="background-color: #F59E0B;" title="Unduh Gambar">
                                <i class="fas fa-download w-4 h-4"></i>
                            </button>
                        </div>`;
                    card.classList.remove('bg-gray-100', 'flex', 'items-center', 'justify-center');
                    card.classList.add('relative');

                    // Add event listeners untuk desktop & mobile
                    const viewBtn = card.querySelector('.btn-view-image');
                    const downloadBtn = card.querySelector('.btn-download-image');

                    viewBtn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        if (window.showPreviewModal) {
                            window.showPreviewModal(imageUrl);
                        }
                    });

                    downloadBtn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        if (window.downloadDataURINew) {
                            window.downloadDataURINew(imageUrl, filename);
                        }
                    });
                } else {
                    throw new Error("Respon tidak valid dari API.");
                }
            } catch (error) {
                console.error(`Error for card ${type}-${id}:`, error);
                card.innerHTML = `<div class="text-xs text-red-500 p-2 text-center break-all">Gagal: ${error.message}</div>`;
            }
        }

        // Download all functionality for Umrah
        if (umrahDownloadAllBtn) {
            umrahDownloadAllBtn.addEventListener('click', async () => {
                if (generatedImages.length === 0) return;

                umrahDownloadAllBtn.disabled = true;
                umrahDownloadAllBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Downloading...';

                for (let i = 0; i < generatedImages.length; i++) {
                    const img = generatedImages[i];
                    if (window.downloadDataURINew) {
                        await window.downloadDataURINew(img.url, img.filename);
                        // Small delay between downloads for better UX
                        await new Promise(resolve => setTimeout(resolve, 500));
                    }
                }

                umrahDownloadAllBtn.disabled = false;
                umrahDownloadAllBtn.innerHTML = '<i class="fas fa-download mr-2"></i>Download Semua';
            });
        }
    })();

    // ==================== PAS FOTO WARNA ====================
    (function() {
        const passportInput = document.getElementById('passport-input');
        const passportUploadBox = document.getElementById('passport-upload-box');
        const passportPreview = document.getElementById('passport-preview');
        const passportPlaceholder = document.getElementById('passport-placeholder');
        const passportRemoveBtn = document.getElementById('passport-remove-btn');
        const passportValidation = document.getElementById('passport-validation');
        const passportGenerateBtn = document.getElementById('passport-generate-btn');
        const passportCustomAttireContainer = document.getElementById('passport-custom-attire-container');
        const passportCustomAttireRefInput = document.getElementById('passport-custom-attire-ref-input');
        const passportCustomAttireRefUploadBox = document.getElementById('passport-custom-attire-ref-upload-box');
        const passportCustomAttireRefPreview = document.getElementById('passport-custom-attire-ref-preview');
        const passportCustomAttireRefPlaceholder = document.getElementById('passport-custom-attire-ref-placeholder');
        const passportCustomAttireRefRemoveBtn = document.getElementById('passport-custom-attire-ref-remove-btn');
        const passportAttireOptions = document.getElementById('passport-attire-options');
        const passportSchoolContainer = document.getElementById('passport-school-options-container');
        const passportSchoolOptions = document.getElementById('passport-school-options');
        const passportDownloadAllBtn = document.getElementById('passport-download-all-btn');

        if (!passportInput) return;

        let passportData = { data: null, isValid: false };
        let passportCustomRefData = null;
        let generatedImages = []; // Store generated images

        function updatePassportBtn() {
            passportGenerateBtn.disabled = !passportData.isValid;
        }

        setupImageUploadNew(passportInput, passportUploadBox, async (data) => {
            passportData.data = data;
            passportPreview.src = data.dataUrl;
            passportPlaceholder.classList.add('hidden');
            passportPreview.classList.remove('hidden');
            passportRemoveBtn.classList.remove('hidden');
            passportData.isValid = await validateImageContentNew(data, 'a clear, front-facing portrait of a person', passportValidation);
            updatePassportBtn();
        });

        passportRemoveBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            passportData = { data: null, isValid: false };
            passportInput.value = '';
            passportPreview.src = '#';
            passportPreview.classList.add('hidden');
            passportPlaceholder.classList.remove('hidden');
            passportRemoveBtn.classList.add('hidden');
            passportValidation.textContent = '';
            updatePassportBtn();
            document.getElementById('passport-results-placeholder').classList.remove('hidden');
            document.getElementById('passport-results-container').classList.add('hidden');
            document.getElementById('passport-results-grid').innerHTML = '';
        });

        setupOptionButtonsNew(document.getElementById('passport-bg-options'));
        setupOptionButtonsNew(passportAttireOptions);
        setupOptionButtonsNew(passportSchoolOptions);
        setupOptionButtonsNew(document.getElementById('passport-size-options'));

        passportAttireOptions.addEventListener('click', (e) => {
            const button = e.target.closest('button');
            if (!button) return;

            if (button.dataset.value === 'Sekolah') {
                passportSchoolContainer.classList.remove('hidden');
            } else {
                passportSchoolContainer.classList.add('hidden');
            }

            if (button.dataset.value === 'Kustom') {
                passportCustomAttireContainer.classList.remove('hidden');
            } else {
                passportCustomAttireContainer.classList.add('hidden');
            }
        });

        setupImageUploadNew(passportCustomAttireRefInput, passportCustomAttireRefUploadBox, (data) => {
            passportCustomRefData = data;
            passportCustomAttireRefPreview.src = data.dataUrl;
            passportCustomAttireRefPlaceholder.classList.add('hidden');
            passportCustomAttireRefPreview.classList.remove('hidden');
            passportCustomAttireRefRemoveBtn.classList.remove('hidden');
        });

        passportCustomAttireRefRemoveBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            passportCustomRefData = null;
            passportCustomAttireRefInput.value = '';
            passportCustomAttireRefPreview.src = '#';
            passportCustomAttireRefPreview.classList.add('hidden');
            passportCustomAttireRefPlaceholder.classList.remove('hidden');
            passportCustomAttireRefRemoveBtn.classList.add('hidden');
        });

        passportGenerateBtn.addEventListener('click', async () => {
            document.getElementById('passport-results-placeholder').classList.add('hidden');
            const background = document.querySelector('#passport-bg-options .selected').dataset.value;
            let attire = document.querySelector('#passport-attire-options .selected').dataset.value;

            let size = document.querySelector('#passport-size-options .selected').dataset.value;
            const aspectRatioForApi = (size === '2:3' || size === '4:6') ? '3:4' : size;

            let customRefDataForApi = null;

            if (attire === 'Sekolah') {
                const schoolLevel = document.querySelector('#passport-school-options .selected').dataset.value;
                attire = `Ganti dengan seragam sekolah ${schoolLevel} khas Indonesia`;
            } else if (attire === 'Kustom') {
                const customText = document.getElementById('passport-custom-attire-input').value.trim();
                if (passportCustomRefData) {
                    attire = `Ganti dengan pakaian yang sangat mirip dengan gambar referensi pakaian (gambar ketiga).`;
                    if (customText) {
                        attire += ` Deskripsi tambahan: ${customText}.`;
                    }
                    customRefDataForApi = passportCustomRefData;
                } else if (customText) {
                    attire = `Ganti dengan pakaian berikut: ${customText}.`;
                } else {
                    attire = 'Ganti dengan pakaian formal standar (kemeja putih).';
                }
            } else {
                attire = `Ganti dengan ${attire}`;
            }

            let prompt = `Create a formal passport photo using the person from the image. CRITICAL: Do not alter the person's face.
            Background: Replace the background with a solid ${background} color.
            Clothing: ${attire}.
            The final image must be a clear, front-facing headshot with professional lighting.`;

            await generatePassportPhotoSet('passport', prompt, passportData.data, aspectRatioForApi, customRefDataForApi);
        });

        async function generatePassportPhotoSet(type, prompt, imageData, aspectRatio, refImageData = null) {
            const resultsContainer = document.getElementById(`${type}-results-container`);
            const resultsGrid = document.getElementById(`${type}-results-grid`);
            const generateBtn = document.getElementById(`${type}-generate-btn`);

            const originalBtnHTML = generateBtn.innerHTML;
            generateBtn.disabled = true;
            generateBtn.innerHTML = `<div class="loader-icon-passport !border-l-white w-5 h-5"></div><span class="ml-2">Membuat Foto...</span>`;

            const aspectClass = getAspectRatioClassNew(aspectRatio);
            resultsContainer.classList.remove('hidden');
            resultsGrid.innerHTML = '';
            generatedImages = []; // Reset array

            const numVariations = 4;

            for (let i = 1; i <= numVariations; i++) {
                const card = document.createElement('div');
                card.id = `${type}-card-${i}`;
                card.className = `card overflow-hidden transition-all ${aspectClass} bg-gray-100 flex items-center justify-center`;
                card.innerHTML = `<div class="loader-icon-passport" style="width: 2.5rem; height: 2.5rem;"></div>`;
                resultsGrid.appendChild(card);
            }

            const generationPromises = Array.from({ length: numVariations }, (_, i) =>
                generateSinglePassportPhoto(i + 1, type, prompt, imageData, aspectRatio, refImageData)
            );
            await Promise.allSettled(generationPromises);

            generateBtn.disabled = false;
            generateBtn.innerHTML = originalBtnHTML;
        }

        async function generateSinglePassportPhoto(id, type, prompt, imageData, aspectRatio, refImageData = null) {
            const card = document.getElementById(`${type}-card-${id}`);
            try {
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-image-preview:generateContent?key=${apiKey}`;
                const finalPrompt = `${prompt} This is variation number ${id}.`;

                const parts = [{ text: finalPrompt }, { inlineData: { mimeType: imageData.mimeType, data: imageData.base64 } }];
                if (refImageData) {
                    parts.push({ inlineData: { mimeType: refImageData.mimeType, data: refImageData.base64 } });
                }

                const payload = {
                    contents: [{ parts: parts }],
                    generationConfig: {
                        responseModalities: ['IMAGE'],
                        imageConfig: { aspectRatio: aspectRatio }
                    }
                };
                const response = await fetch(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
                if (!response.ok) throw new Error(`Error ${response.status}`);

                const result = await response.json();
                const base64Data = result?.candidates?.[0]?.content?.parts?.find(p => p.inlineData)?.inlineData?.data;
                if (base64Data) {
                    const imageUrl = `data:image/png;base64,${base64Data}`;
                    const filename = `${type}_foto_${id}.png`;

                    // Store in generatedImages array
                    generatedImages.push({ url: imageUrl, filename: filename });

                    card.innerHTML = `
                        <img src="${imageUrl}" class="w-full h-full object-cover">
                        <div class="absolute bottom-2 right-2 flex gap-1">
                            <button class="btn-view-passport bg-white hover:bg-gray-100 text-gray-800 p-2 rounded-full shadow-md" title="Lihat Gambar">
                                <i class="fas fa-eye w-4 h-4"></i>
                            </button>
                            <button class="btn-download-passport text-white p-2 rounded-full shadow-md" style="background-color: #7DDCDD;" title="Unduh Gambar">
                                <i class="fas fa-download w-4 h-4"></i>
                            </button>
                        </div>`;
                    card.classList.remove('bg-gray-100', 'flex', 'items-center', 'justify-center');
                    card.classList.add('relative');

                    // Add event listeners untuk desktop & mobile
                    const viewBtn = card.querySelector('.btn-view-passport');
                    const downloadBtn = card.querySelector('.btn-download-passport');

                    viewBtn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        if (window.showPreviewModal) {
                            window.showPreviewModal(imageUrl);
                        }
                    });

                    downloadBtn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        if (window.downloadDataURINew) {
                            window.downloadDataURINew(imageUrl, filename);
                        }
                    });
                } else {
                    throw new Error("Respon tidak valid dari API.");
                }
            } catch (error) {
                console.error(`Error for card ${type}-${id}:`, error);
                card.innerHTML = `<div class="text-xs text-red-500 p-2 text-center break-all">Gagal: ${error.message}</div>`;
            }
        }

        // Download all functionality for Passport
        if (passportDownloadAllBtn) {
            passportDownloadAllBtn.addEventListener('click', async () => {
                if (generatedImages.length === 0) return;

                passportDownloadAllBtn.disabled = true;
                passportDownloadAllBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Downloading...';

                for (let i = 0; i < generatedImages.length; i++) {
                    const img = generatedImages[i];
                    if (window.downloadDataURINew) {
                        await window.downloadDataURINew(img.url, img.filename);
                        // Small delay between downloads for better UX
                        await new Promise(resolve => setTimeout(resolve, 500));
                    }
                }

                passportDownloadAllBtn.disabled = false;
                passportDownloadAllBtn.innerHTML = '<i class="fas fa-download mr-2"></i>Download Semua';
            });
        }
    })();

    // ==================== PHOTO BOOTH ====================
    (function() {
        const apiKey = "";

        // Element references
        const photoBoothInput = document.getElementById('photo-booth-input');
        const photoBoothUploadBox = document.getElementById('photo-booth-upload-box');
        const photoBoothPreview = document.getElementById('photo-booth-preview');
        const photoBoothPlaceholder = document.getElementById('photo-booth-placeholder');
        const photoBoothRemoveBtn = document.getElementById('photo-booth-remove-btn');
        const photoBoothGenerateBtn = document.getElementById('photo-booth-generate-btn');
        const photoBoothFrameOptions = document.getElementById('photo-booth-frame-options');
        const photoBoothCustomThemeContainer = document.getElementById('photo-booth-custom-theme-container');
        const photoBoothCustomThemeInput = document.getElementById('photo-booth-custom-theme-input');
        const photoBoothRatioOptions = document.getElementById('photo-booth-ratio-options');
        const photoBoothCountOptions = document.getElementById('photo-booth-count-options');
        const photoBoothResultsPlaceholder = document.getElementById('photo-booth-results-placeholder');
        const photoBoothResultsContainer = document.getElementById('photo-booth-results-container');
        const photoBoothResultsGrid = document.getElementById('photo-booth-results-grid');
        const photoBoothDownloadAllBtn = document.getElementById('photo-booth-download-all-btn');

        if (!photoBoothInput) return;

        let uploadedImageData = null;
        let generatedImages = [];
        let selectedFrame = 'Classic Strip';
        let selectedRatio = '3:4';
        let selectedCount = 8;

        // Setup image upload with HEIC support
        photoBoothInput.addEventListener('change', async (e) => {
            const file = e.target.files[0];
            if (!file) return;

            try {
                let processedFile = file;

                // Convert HEIC to JPEG if necessary
                if (file.type === 'image/heic' || file.name.toLowerCase().endsWith('.heic')) {
                    const heic2any = window.heic2any;
                    if (heic2any) {
                        const convertedBlob = await heic2any({ blob: file, toType: 'image/jpeg', quality: 0.9 });
                        processedFile = new File([convertedBlob], file.name.replace(/\.heic$/i, '.jpg'), { type: 'image/jpeg' });
                    }
                }

                const reader = new FileReader();
                reader.onload = (event) => {
                    const dataUrl = event.target.result;
                    const base64 = dataUrl.split(',')[1];

                    uploadedImageData = {
                        base64: base64,
                        mimeType: processedFile.type,
                        dataUrl: dataUrl
                    };

                    photoBoothPreview.src = dataUrl;
                    photoBoothPlaceholder.classList.add('hidden');
                    photoBoothPreview.classList.remove('hidden');
                    photoBoothRemoveBtn.classList.remove('hidden');
                    photoBoothGenerateBtn.disabled = false;
                };
                reader.readAsDataURL(processedFile);
            } catch (error) {
                console.error('Error processing image:', error);
                alert('Gagal memproses gambar. Silakan coba lagi.');
            }
        });

        // Remove image handler
        photoBoothRemoveBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            uploadedImageData = null;
            photoBoothInput.value = '';
            photoBoothPreview.src = '#';
            photoBoothPreview.classList.add('hidden');
            photoBoothPlaceholder.classList.remove('hidden');
            photoBoothRemoveBtn.classList.add('hidden');
            photoBoothGenerateBtn.disabled = true;

            // Reset results
            photoBoothResultsPlaceholder.classList.remove('hidden');
            photoBoothResultsContainer.classList.add('hidden');
            photoBoothResultsGrid.innerHTML = '';
            generatedImages = [];
        });

        // Frame theme selection handler
        photoBoothFrameOptions.addEventListener('click', (e) => {
            const button = e.target.closest('button');
            if (!button) return;

            photoBoothFrameOptions.querySelectorAll('button').forEach(btn => btn.classList.remove('selected'));
            button.classList.add('selected');
            selectedFrame = button.dataset.value;

            // Show/hide custom theme input
            if (selectedFrame === 'Custom') {
                photoBoothCustomThemeContainer.classList.remove('hidden');
            } else {
                photoBoothCustomThemeContainer.classList.add('hidden');
            }
        });

        // Aspect ratio selection handler
        photoBoothRatioOptions.addEventListener('click', (e) => {
            const button = e.target.closest('button');
            if (!button) return;

            photoBoothRatioOptions.querySelectorAll('button').forEach(btn => btn.classList.remove('selected'));
            button.classList.add('selected');
            selectedRatio = button.dataset.value;
        });

        // Photo count selection handler
        photoBoothCountOptions.addEventListener('click', (e) => {
            const button = e.target.closest('button');
            if (!button) return;

            photoBoothCountOptions.querySelectorAll('button').forEach(btn => btn.classList.remove('selected'));
            button.classList.add('selected');
            selectedCount = parseInt(button.dataset.value);
        });

        // Generate button handler
        photoBoothGenerateBtn.addEventListener('click', async () => {
            if (!uploadedImageData) {
                alert('Silakan unggah foto terlebih dahulu');
                return;
            }

            // Determine frame theme
            let frameTheme = selectedFrame;
            if (selectedFrame === 'Custom' && photoBoothCustomThemeInput) {
                const customTheme = photoBoothCustomThemeInput.value.trim();
                frameTheme = customTheme || 'Classic Strip';
            }

            // Create prompt based on frame theme
            const frameDescriptions = {
                'Classic Strip': 'classic black and white photo booth strip style with film-like borders, vintage camera aesthetic, fun and nostalgic feel',
                'Vintage Polaroid': 'vintage polaroid instant photo style with white borders, retro 70s aesthetic, warm nostalgic colors',
                'Colorful Party': 'vibrant colorful party photo booth style with confetti, balloons, and festive decorations, fun celebration vibes',
                'Wedding Elegant': 'elegant wedding photo booth style with romantic decorative frames, soft lighting, flowers and elegant patterns',
                'Birthday Fun': 'fun birthday party photo booth with birthday cake, balloons, presents, and cheerful decorations',
                'Retro 80s': 'retro 1980s style photo booth with neon colors, geometric patterns, vibrant pink and blue tones, nostalgic 80s aesthetic',
                'Modern Minimal': 'modern minimalist photo booth style with clean lines, simple elegant frames, contemporary aesthetic'
            };

            const frameDescription = frameDescriptions[selectedFrame] || frameTheme;

            const prompt = `Create a professional photo booth image featuring the person from the uploaded photo.

FRAME STYLE: Apply a ${frameDescription} theme with decorative frame borders and aesthetic effects.

IMPORTANT REQUIREMENTS:
- Keep the person's face and identity EXACTLY the same as in the original photo
- Create natural, fun, and engaging photo booth poses and expressions
- Add appropriate decorative frame borders that match the ${frameTheme} theme
- Include subtle effects like lighting, filters, or overlays that enhance the photo booth aesthetic
- Make it look like a real photo booth picture with authentic styling
- Ensure high quality and professional appearance

The final result should be a complete photo booth image ready to print or share, with the person clearly recognizable and the frame style prominently featured.`;

            await generatePhotoBoothSet(prompt);
        });

        async function generatePhotoBoothSet(prompt) {
            const originalBtnHTML = photoBoothGenerateBtn.innerHTML;
            photoBoothGenerateBtn.disabled = true;
            photoBoothGenerateBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Membuat Photo Booth...';

            photoBoothResultsPlaceholder.classList.add('hidden');
            photoBoothResultsContainer.classList.remove('hidden');
            photoBoothResultsGrid.innerHTML = '';
            generatedImages = [];

            // Create placeholder cards
            for (let i = 1; i <= selectedCount; i++) {
                const card = document.createElement('div');
                card.id = `photo-booth-card-${i}`;
                card.className = 'relative group rounded-xl overflow-hidden bg-gray-100 flex items-center justify-center aspect-[3/4]';
                card.innerHTML = '<div class="animate-spin rounded-full h-10 w-10 border-b-2 border-purple-600"></div>';
                photoBoothResultsGrid.appendChild(card);
            }

            // Generate all photos in parallel
            const generationPromises = Array.from({ length: selectedCount }, (_, i) =>
                generateSinglePhotoBoothImage(i + 1, prompt)
            );
            await Promise.allSettled(generationPromises);

            photoBoothGenerateBtn.disabled = false;
            photoBoothGenerateBtn.innerHTML = originalBtnHTML;
        }

        async function generateSinglePhotoBoothImage(index, basePrompt) {
            const card = document.getElementById(`photo-booth-card-${index}`);
            try {
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-image-preview:generateContent?key=${apiKey}`;

                const finalPrompt = `${basePrompt}\n\nThis is photo booth variation number ${index}. Make this variation unique with different pose, expression, or slight styling variations while maintaining the same frame theme and person's identity.`;

                const payload = {
                    contents: [{
                        parts: [
                            { text: finalPrompt },
                            { inlineData: { mimeType: uploadedImageData.mimeType, data: uploadedImageData.base64 } }
                        ]
                    }],
                    generationConfig: {
                        responseModalities: ['IMAGE'],
                        imageConfig: { aspectRatio: selectedRatio }
                    }
                };

                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    throw new Error(`API Error: ${response.status}`);
                }

                const result = await response.json();
                const base64Data = result?.candidates?.[0]?.content?.parts?.find(p => p.inlineData)?.inlineData?.data;

                if (base64Data) {
                    const imageUrl = `data:image/png;base64,${base64Data}`;
                    const filename = `photo_booth_${index}.png`;

                    generatedImages.push({ url: imageUrl, filename: filename });

                    card.className = 'relative group rounded-xl overflow-hidden shadow-lg hover:shadow-2xl transition-all duration-300';
                    card.innerHTML = `
                        <img src="${imageUrl}" class="w-full h-full object-cover" alt="Photo Booth ${index}">
                        <div class="absolute inset-0 bg-gradient-to-t from-black/80 via-black/40 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300 flex items-end justify-center pb-4 gap-2">
                            <button data-action="preview" data-index="${index - 1}" class="action-btn bg-white/90 hover:bg-white text-gray-800 px-4 py-2 rounded-full font-semibold shadow-lg transition-all duration-200 hover:scale-105 flex items-center gap-2">
                                <i class="fas fa-eye"></i>
                                <span class="hidden sm:inline">Preview</span>
                            </button>
                            <button data-action="download" data-index="${index - 1}" class="action-btn bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600 text-white px-4 py-2 rounded-full font-semibold shadow-lg transition-all duration-200 hover:scale-105 flex items-center gap-2">
                                <i class="fas fa-download"></i>
                                <span class="hidden sm:inline">Download</span>
                            </button>
                        </div>
                    `;
                } else {
                    throw new Error('Invalid API response');
                }
            } catch (error) {
                console.error(`Error generating photo booth ${index}:`, error);
                card.innerHTML = `
                    <div class="text-center p-4">
                        <i class="fas fa-exclamation-circle text-red-500 text-3xl mb-2"></i>
                        <p class="text-xs text-red-500">Gagal membuat foto</p>
                    </div>
                `;
            }
        }

        // Event delegation for action buttons
        photoBoothResultsGrid.addEventListener('click', async (e) => {
            e.stopPropagation();

            const actionBtn = e.target.classList.contains('action-btn') ? e.target : e.target.closest('.action-btn[data-action]');
            if (!actionBtn) return;

            const action = actionBtn.dataset.action;
            const index = parseInt(actionBtn.dataset.index, 10);
            const imageData = generatedImages[index];

            if (!imageData) return;

            if (action === 'preview') {
                if (window.showPreviewModal) {
                    window.showPreviewModal(imageData.url);
                }
            } else if (action === 'download') {
                if (window.downloadDataURINew) {
                    await window.downloadDataURINew(imageData.url, imageData.filename);
                } else if (window.downloadImage) {
                    await window.downloadImage(imageData.url, imageData.filename);
                }
            }
        });

        // Download all functionality
        if (photoBoothDownloadAllBtn) {
            photoBoothDownloadAllBtn.addEventListener('click', async () => {
                if (generatedImages.length === 0) return;

                photoBoothDownloadAllBtn.disabled = true;
                photoBoothDownloadAllBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Downloading...';

                for (let i = 0; i < generatedImages.length; i++) {
                    const img = generatedImages[i];
                    if (window.downloadImage) {
                        await window.downloadImage(img.url, img.filename);
                    } else if (window.downloadDataURINew) {
                        await window.downloadDataURINew(img.url, img.filename);
                    }
                    await new Promise(resolve => setTimeout(resolve, 500));
                }

                photoBoothDownloadAllBtn.disabled = false;
                photoBoothDownloadAllBtn.innerHTML = '<i class="fas fa-download mr-2"></i>Download Semua';
            });
        }
    })();

    // ==================== EXPRESSION CHANGER ====================
    (function() {
        const apiKey = "";

        // Element references
        const expressionInput = document.getElementById('expression-input');
        const expressionUploadBox = document.getElementById('expression-upload-box');
        const expressionPreview = document.getElementById('expression-preview');
        const expressionPlaceholder = document.getElementById('expression-placeholder');
        const expressionRemoveBtn = document.getElementById('expression-remove-btn');
        const expressionGenerateBtn = document.getElementById('expression-generate-btn');
        const expressionTypeOptions = document.getElementById('expression-type-options');
        const expressionCustomContainer = document.getElementById('expression-custom-container');
        const expressionCustomInput = document.getElementById('expression-custom-input');
        const expressionIntensityOptions = document.getElementById('expression-intensity-options');
        const expressionCountOptions = document.getElementById('expression-count-options');
        const expressionResultsPlaceholder = document.getElementById('expression-results-placeholder');
        const expressionResultsContainer = document.getElementById('expression-results-container');
        const expressionResultsGrid = document.getElementById('expression-results-grid');
        const expressionDownloadAllBtn = document.getElementById('expression-download-all-btn');

        if (!expressionInput) return;

        let uploadedImageData = null;
        let generatedImages = [];
        let selectedExpression = 'Happy Smiling';
        let selectedIntensity = 'Moderate';
        let selectedCount = 4;

        // Setup image upload with HEIC support
        expressionInput.addEventListener('change', async (e) => {
            const file = e.target.files[0];
            if (!file) return;

            try {
                let processedFile = file;

                // Convert HEIC to JPEG if necessary
                if (file.type === 'image/heic' || file.name.toLowerCase().endsWith('.heic')) {
                    const heic2any = window.heic2any;
                    if (heic2any) {
                        const convertedBlob = await heic2any({ blob: file, toType: 'image/jpeg', quality: 0.9 });
                        processedFile = new File([convertedBlob], file.name.replace(/\.heic$/i, '.jpg'), { type: 'image/jpeg' });
                    }
                }

                const reader = new FileReader();
                reader.onload = (event) => {
                    const dataUrl = event.target.result;
                    const base64 = dataUrl.split(',')[1];

                    uploadedImageData = {
                        base64: base64,
                        mimeType: processedFile.type,
                        dataUrl: dataUrl
                    };

                    expressionPreview.src = dataUrl;
                    expressionPlaceholder.classList.add('hidden');
                    expressionPreview.classList.remove('hidden');
                    expressionRemoveBtn.classList.remove('hidden');
                    expressionGenerateBtn.disabled = false;
                };
                reader.readAsDataURL(processedFile);
            } catch (error) {
                console.error('Error processing image:', error);
                alert('Gagal memproses gambar. Silakan coba lagi.');
            }
        });

        // Remove image handler
        expressionRemoveBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            uploadedImageData = null;
            expressionInput.value = '';
            expressionPreview.src = '#';
            expressionPreview.classList.add('hidden');
            expressionPlaceholder.classList.remove('hidden');
            expressionRemoveBtn.classList.add('hidden');
            expressionGenerateBtn.disabled = true;

            // Reset results
            expressionResultsPlaceholder.classList.remove('hidden');
            expressionResultsContainer.classList.add('hidden');
            expressionResultsGrid.innerHTML = '';
            generatedImages = [];
        });

        // Expression type selection handler
        expressionTypeOptions.addEventListener('click', (e) => {
            const button = e.target.closest('button');
            if (!button) return;

            expressionTypeOptions.querySelectorAll('button').forEach(btn => btn.classList.remove('selected'));
            button.classList.add('selected');
            selectedExpression = button.dataset.value;

            // Show/hide custom expression input
            if (selectedExpression === 'Custom') {
                expressionCustomContainer.classList.remove('hidden');
            } else {
                expressionCustomContainer.classList.add('hidden');
            }
        });

        // Intensity selection handler
        expressionIntensityOptions.addEventListener('click', (e) => {
            const button = e.target.closest('button');
            if (!button) return;

            expressionIntensityOptions.querySelectorAll('button').forEach(btn => btn.classList.remove('selected'));
            button.classList.add('selected');
            selectedIntensity = button.dataset.value;
        });

        // Count selection handler
        expressionCountOptions.addEventListener('click', (e) => {
            const button = e.target.closest('button');
            if (!button) return;

            expressionCountOptions.querySelectorAll('button').forEach(btn => btn.classList.remove('selected'));
            button.classList.add('selected');
            selectedCount = parseInt(button.dataset.value);
        });

        // Generate button handler
        expressionGenerateBtn.addEventListener('click', async () => {
            if (!uploadedImageData) {
                alert('Silakan unggah foto terlebih dahulu');
                return;
            }

            // Determine expression
            let targetExpression = selectedExpression;
            if (selectedExpression === 'Custom' && expressionCustomInput) {
                const customExpr = expressionCustomInput.value.trim();
                targetExpression = customExpr || 'Happy Smiling';
            }

            // Map intensity to description
            const intensityMap = {
                'Subtle': 'subtle and gentle',
                'Moderate': 'natural and balanced',
                'Strong': 'strong and pronounced'
            };
            const intensityDescription = intensityMap[selectedIntensity];

            // Create detailed prompt for expression change
            const prompt = `Transform the facial expression of the person in this photo to show a ${intensityDescription} "${targetExpression}" expression.

CRITICAL REQUIREMENTS:
- Keep the person's identity, face structure, and all facial features EXACTLY the same
- ONLY change the facial expression (eyes, mouth, eyebrows positioning)
- Do NOT change: skin tone, face shape, hair, clothing, background, or any other aspect
- The expression should look completely natural and realistic, as if the person naturally made this expression
- Maintain the same lighting, angle, and photo quality
- The person must be clearly recognizable as the same individual
- Expression intensity: ${intensityDescription}

The result should be a natural-looking photo where only the facial expression has changed to "${targetExpression}" while everything else remains identical to the original.`;

            await generateExpressionSet(prompt);
        });

        async function generateExpressionSet(prompt) {
            const originalBtnHTML = expressionGenerateBtn.innerHTML;
            expressionGenerateBtn.disabled = true;
            expressionGenerateBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Mengubah Ekspresi...';

            expressionResultsPlaceholder.classList.add('hidden');
            expressionResultsContainer.classList.remove('hidden');
            expressionResultsGrid.innerHTML = '';
            generatedImages = [];

            // Create placeholder cards
            for (let i = 1; i <= selectedCount; i++) {
                const card = document.createElement('div');
                card.id = `expression-card-${i}`;
                card.className = 'relative group rounded-xl overflow-hidden bg-gray-100 flex items-center justify-center aspect-[3/4]';
                card.innerHTML = '<div class="animate-spin rounded-full h-10 w-10 border-b-2 border-blue-600"></div>';
                expressionResultsGrid.appendChild(card);
            }

            // Generate all variations in parallel
            const generationPromises = Array.from({ length: selectedCount }, (_, i) =>
                generateSingleExpression(i + 1, prompt)
            );
            await Promise.allSettled(generationPromises);

            expressionGenerateBtn.disabled = false;
            expressionGenerateBtn.innerHTML = originalBtnHTML;
        }

        async function generateSingleExpression(index, basePrompt) {
            const card = document.getElementById(`expression-card-${index}`);
            try {
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-image-preview:generateContent?key=${apiKey}`;

                const finalPrompt = `${basePrompt}\n\nThis is variation ${index}. Create a slightly different natural variation of the same expression (e.g., different smile intensity, eye openness, etc.) while maintaining the target expression type.`;

                const payload = {
                    contents: [{
                        parts: [
                            { text: finalPrompt },
                            { inlineData: { mimeType: uploadedImageData.mimeType, data: uploadedImageData.base64 } }
                        ]
                    }],
                    generationConfig: {
                        responseModalities: ['IMAGE'],
                        imageConfig: { aspectRatio: '3:4' }
                    }
                };

                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    throw new Error(`API Error: ${response.status}`);
                }

                const result = await response.json();
                const base64Data = result?.candidates?.[0]?.content?.parts?.find(p => p.inlineData)?.inlineData?.data;

                if (base64Data) {
                    const imageUrl = `data:image/png;base64,${base64Data}`;
                    const filename = `expression_${selectedExpression.replace(/\s+/g, '_').toLowerCase()}_${index}.png`;

                    generatedImages.push({ url: imageUrl, filename: filename });

                    card.className = 'relative group rounded-xl overflow-hidden shadow-lg hover:shadow-2xl transition-all duration-300';
                    card.innerHTML = `
                        <img src="${imageUrl}" class="w-full h-full object-cover" alt="Expression ${index}">
                        <div class="absolute inset-0 bg-gradient-to-t from-black/80 via-black/40 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300 flex items-end justify-center pb-4 gap-2">
                            <button data-action="preview" data-index="${index - 1}" class="action-btn bg-white/90 hover:bg-white text-gray-800 px-4 py-2 rounded-full font-semibold shadow-lg transition-all duration-200 hover:scale-105 flex items-center gap-2">
                                <i class="fas fa-eye"></i>
                                <span class="hidden sm:inline">Preview</span>
                            </button>
                            <button data-action="download" data-index="${index - 1}" class="action-btn bg-gradient-to-r from-blue-500 to-cyan-500 hover:from-blue-600 hover:to-cyan-600 text-white px-4 py-2 rounded-full font-semibold shadow-lg transition-all duration-200 hover:scale-105 flex items-center gap-2">
                                <i class="fas fa-download"></i>
                                <span class="hidden sm:inline">Download</span>
                            </button>
                        </div>
                    `;
                } else {
                    throw new Error('Invalid API response');
                }
            } catch (error) {
                console.error(`Error generating expression ${index}:`, error);
                card.innerHTML = `
                    <div class="text-center p-4">
                        <i class="fas fa-exclamation-circle text-red-500 text-3xl mb-2"></i>
                        <p class="text-xs text-red-500">Gagal mengubah ekspresi</p>
                    </div>
                `;
            }
        }

        // Event delegation for action buttons
        expressionResultsGrid.addEventListener('click', async (e) => {
            e.stopPropagation();

            const actionBtn = e.target.classList.contains('action-btn') ? e.target : e.target.closest('.action-btn[data-action]');
            if (!actionBtn) return;

            const action = actionBtn.dataset.action;
            const index = parseInt(actionBtn.dataset.index, 10);
            const imageData = generatedImages[index];

            if (!imageData) return;

            if (action === 'preview') {
                if (window.showPreviewModal) {
                    window.showPreviewModal(imageData.url);
                }
            } else if (action === 'download') {
                if (window.downloadDataURINew) {
                    await window.downloadDataURINew(imageData.url, imageData.filename);
                } else if (window.downloadImage) {
                    await window.downloadImage(imageData.url, imageData.filename);
                }
            }
        });

        // Download all functionality
        if (expressionDownloadAllBtn) {
            expressionDownloadAllBtn.addEventListener('click', async () => {
                if (generatedImages.length === 0) return;

                expressionDownloadAllBtn.disabled = true;
                expressionDownloadAllBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Downloading...';

                for (let i = 0; i < generatedImages.length; i++) {
                    const img = generatedImages[i];
                    if (window.downloadDataURINew) {
                        await window.downloadDataURINew(img.url, img.filename);
                    } else if (window.downloadImage) {
                        await window.downloadImage(img.url, img.filename);
                    }
                    await new Promise(resolve => setTimeout(resolve, 500));
                }

                expressionDownloadAllBtn.disabled = false;
                expressionDownloadAllBtn.innerHTML = '<i class="fas fa-download mr-2"></i>Download Semua';
            });
        }
    })();

    // ==================== KARIKATUR GENERATOR ====================
    (function() {
        const apiKey = "";

        // Element references
        const karikaturInput = document.getElementById('karikatur-image-input');
        const karikaturImagePreview = document.getElementById('karikatur-image-preview');
        const karikaturUploadPrompt = document.getElementById('karikatur-upload-prompt');
        const karikaturMobilePreview = document.getElementById('karikatur-mobile-preview');
        const karikaturPreviewContainer = document.getElementById('karikatur-preview-container');
        const karikaturRemovePreview = document.getElementById('karikatur-remove-preview');
        const karikaturStyleOptions = document.getElementById('karikatur-style-options');
        const karikaturCustomStyleContainer = document.getElementById('karikatur-custom-style-container');
        const karikaturCustomStyle = document.getElementById('karikatur-custom-style');
        const karikaturExaggerationOptions = document.getElementById('karikatur-exaggeration-options');
        const karikaturBackgroundOptions = document.getElementById('karikatur-background-options');
        const karikaturBackgroundDetailContainer = document.getElementById('karikatur-background-detail-container');
        const karikaturBackgroundDetail = document.getElementById('karikatur-background-detail');
        const karikaturRatioOptions = document.getElementById('karikatur-ratio-options');
        const karikaturCountOptions = document.getElementById('karikatur-count-options');
        const karikaturGenerateBtn = document.getElementById('karikatur-generate-btn');
        const karikaturPlaceholder = document.getElementById('karikatur-placeholder');
        const karikaturResultsGrid = document.getElementById('karikatur-results-grid');
        const karikaturDownloadAllBtn = document.getElementById('karikatur-download-all-btn');

        if (!karikaturInput) return;

        let uploadedImageData = null;
        let generatedImages = [];
        let selectedStyle = 'anime';
        let selectedExaggeration = 'moderate';
        let selectedBackground = 'transparent';
        let selectedRatio = '3:4';
        let selectedCount = 4;

        // Style name mapping for prompts
        const styleDescriptions = {
            'anime': 'Japanese anime/manga style with large expressive eyes, clean linework, and vibrant colors',
            'cartoon': 'Western cartoon style with exaggerated features, bold outlines, and vibrant colors like Disney or Looney Tunes',
            'pixar': 'Pixar 3D animation style with smooth textures, appealing character design, and expressive features',
            'comic': 'Comic book art style with bold lines, dramatic shading, halftone dots, and dynamic poses',
            'watercolor': 'Soft watercolor caricature with flowing colors, delicate brushstrokes, and artistic texture',
            'digital': 'Modern digital art caricature with clean rendering, smooth gradients, and polished finish',
            'sketch': 'Hand-drawn sketch style with pencil lines, cross-hatching, and artistic imperfections',
            'popart': 'Pop art style with bright colors, bold outlines, Ben-Day dots, and high contrast like Andy Warhol',
            'chibi': 'Cute chibi/kawaii style with oversized head, tiny body, and adorable proportions',
            'realistic': 'Realistic caricature maintaining photographic quality while exaggerating distinctive features',
            'vector': 'Clean vector art style with smooth shapes, flat colors, and geometric precision'
        };

        // Setup image upload with HEIC support
        karikaturInput.addEventListener('change', async (e) => {
            const file = e.target.files[0];
            if (!file) return;

            try {
                let processedFile = file;

                // Convert HEIC to JPEG if necessary
                if (file.type === 'image/heic' || file.name.toLowerCase().endsWith('.heic')) {
                    const heic2any = window.heic2any;
                    if (heic2any) {
                        const convertedBlob = await heic2any({ blob: file, toType: 'image/jpeg', quality: 0.9 });
                        processedFile = new File([convertedBlob], file.name.replace(/\.heic$/i, '.jpg'), { type: 'image/jpeg' });
                    }
                }

                const reader = new FileReader();
                reader.onload = (event) => {
                    const dataUrl = event.target.result;
                    const base64 = dataUrl.split(',')[1];

                    uploadedImageData = {
                        base64: base64,
                        mimeType: processedFile.type,
                        dataUrl: dataUrl
                    };

                    // Show desktop preview
                    karikaturImagePreview.src = dataUrl;
                    karikaturUploadPrompt.classList.add('hidden');
                    karikaturImagePreview.classList.remove('hidden');

                    // Show mobile preview
                    if (karikaturMobilePreview && karikaturPreviewContainer) {
                        karikaturMobilePreview.src = dataUrl;
                        karikaturPreviewContainer.classList.remove('hidden');
                    }

                    karikaturGenerateBtn.disabled = false;
                };
                reader.readAsDataURL(processedFile);
            } catch (error) {
                console.error('Error processing image:', error);
                alert('Gagal memproses gambar. Silakan coba lagi.');
            }
        });

        // Remove image handler
        if (karikaturRemovePreview) {
            karikaturRemovePreview.addEventListener('click', () => {
                uploadedImageData = null;
                karikaturInput.value = '';
                karikaturImagePreview.src = '';
                karikaturImagePreview.classList.add('hidden');
                karikaturUploadPrompt.classList.remove('hidden');

                if (karikaturPreviewContainer) {
                    karikaturPreviewContainer.classList.add('hidden');
                }
                if (karikaturMobilePreview) {
                    karikaturMobilePreview.src = '';
                }

                karikaturGenerateBtn.disabled = true;

                // Reset results
                karikaturPlaceholder.classList.remove('hidden');
                karikaturResultsGrid.classList.add('hidden');
                karikaturResultsGrid.innerHTML = '';
                karikaturDownloadAllBtn.classList.add('hidden');
                generatedImages = [];
            });
        }

        // Style selection handler
        karikaturStyleOptions.addEventListener('click', (e) => {
            const button = e.target.closest('button');
            if (!button) return;

            karikaturStyleOptions.querySelectorAll('button').forEach(btn => btn.classList.remove('selected'));
            button.classList.add('selected');
            selectedStyle = button.dataset.style;

            // Show/hide custom style input
            if (selectedStyle === 'custom') {
                karikaturCustomStyleContainer.classList.remove('hidden');
            } else {
                karikaturCustomStyleContainer.classList.add('hidden');
            }
        });

        // Exaggeration level selection handler
        karikaturExaggerationOptions.addEventListener('click', (e) => {
            const button = e.target.closest('button');
            if (!button) return;

            karikaturExaggerationOptions.querySelectorAll('button').forEach(btn => btn.classList.remove('selected'));
            button.classList.add('selected');
            selectedExaggeration = button.dataset.exaggeration;
        });

        // Background selection handler
        karikaturBackgroundOptions.addEventListener('click', (e) => {
            const button = e.target.closest('button');
            if (!button) return;

            karikaturBackgroundOptions.querySelectorAll('button').forEach(btn => btn.classList.remove('selected'));
            button.classList.add('selected');
            selectedBackground = button.dataset.background;

            // Show/hide background detail input
            if (selectedBackground !== 'transparent') {
                karikaturBackgroundDetailContainer.classList.remove('hidden');
            } else {
                karikaturBackgroundDetailContainer.classList.add('hidden');
            }
        });

        // Aspect ratio selection handler
        karikaturRatioOptions.addEventListener('click', (e) => {
            const button = e.target.closest('button');
            if (!button) return;

            karikaturRatioOptions.querySelectorAll('button').forEach(btn => btn.classList.remove('selected'));
            button.classList.add('selected');
            selectedRatio = button.dataset.ratio;
        });

        // Count selection handler
        karikaturCountOptions.addEventListener('click', (e) => {
            const button = e.target.closest('button');
            if (!button) return;

            karikaturCountOptions.querySelectorAll('button').forEach(btn => btn.classList.remove('selected'));
            button.classList.add('selected');
            selectedCount = parseInt(button.dataset.count);
        });

        // Generate button handler
        karikaturGenerateBtn.addEventListener('click', async () => {
            if (!uploadedImageData) {
                alert('Silakan unggah foto terlebih dahulu');
                return;
            }

            // Determine style description
            let styleDesc = styleDescriptions[selectedStyle];
            if (selectedStyle === 'custom' && karikaturCustomStyle) {
                const customStyleText = karikaturCustomStyle.value.trim();
                styleDesc = customStyleText || styleDescriptions['anime'];
            }

            // Map exaggeration level to description
            const exaggerationMap = {
                'subtle': 'subtle exaggeration maintaining realistic proportions with slight enhancement of distinctive features',
                'moderate': 'balanced exaggeration that clearly emphasizes unique facial features while remaining appealing',
                'extreme': 'strong, dramatic exaggeration with highly emphasized features for maximum caricature effect'
            };
            const exaggerationDesc = exaggerationMap[selectedExaggeration];

            // Background instructions
            let backgroundInstructions = '';
            if (selectedBackground === 'transparent') {
                backgroundInstructions = 'transparent or simple plain background';
            } else if (selectedBackground === 'solid') {
                const bgDetail = karikaturBackgroundDetail?.value.trim() || 'solid vibrant color';
                backgroundInstructions = `solid background with ${bgDetail}`;
            } else if (selectedBackground === 'gradient') {
                const bgDetail = karikaturBackgroundDetail?.value.trim() || 'smooth colorful gradient';
                backgroundInstructions = `gradient background with ${bgDetail}`;
            } else if (selectedBackground === 'scene') {
                const bgDetail = karikaturBackgroundDetail?.value.trim() || 'simple contextual scene';
                backgroundInstructions = `background scene featuring ${bgDetail}`;
            }

            // Create comprehensive prompt
            const prompt = `Create a professional caricature of the person in this photo with the following specifications:

STYLE REQUIREMENT:
${styleDesc}

EXAGGERATION LEVEL:
${exaggerationDesc}
- Emphasize the most distinctive facial features (nose, eyes, mouth, chin, forehead, etc.)
- Maintain recognizability - the person should still be clearly identifiable
- Create an appealing, flattering interpretation even with exaggeration

BACKGROUND:
${backgroundInstructions}

CRITICAL QUALITY REQUIREMENTS:
1. PROFESSIONAL QUALITY: High-resolution, polished, publication-ready artwork
2. IDENTITY PRESERVATION: Person must be clearly recognizable despite stylization
3. APPEALING RESULT: Create a flattering, attractive caricature that subjects would love
4. STYLE CONSISTENCY: Maintain consistent ${selectedStyle} artistic style throughout
5. NATURAL PROPORTIONS: Even with exaggeration, maintain overall balance and appeal
6. CLEAN EXECUTION: Sharp details, clean lines, no artifacts or distortions
7. EXPRESSIVE CHARACTER: Capture the person's personality and unique characteristics
8. COLOR HARMONY: Use appealing, well-balanced color palette appropriate for the style

TECHNICAL SPECIFICATIONS:
- Keep the person's identity recognizable
- Emphasize distinctive features through ${selectedExaggeration} exaggeration
- Apply ${selectedStyle} artistic treatment consistently
- Ensure professional quality suitable for portfolio or commercial use

Generate a stunning, professional caricature that the subject would be proud to share and display.`;

            await generateKarikaturSet(prompt);
        });

        async function generateKarikaturSet(prompt) {
            const originalBtnHTML = karikaturGenerateBtn.innerHTML;
            karikaturGenerateBtn.disabled = true;
            karikaturGenerateBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Membuat Karikatur...';

            karikaturPlaceholder.classList.add('hidden');
            karikaturResultsGrid.classList.remove('hidden');
            karikaturResultsGrid.innerHTML = '';
            karikaturDownloadAllBtn.classList.add('hidden');
            generatedImages = [];

            // Create placeholder cards
            for (let i = 1; i <= selectedCount; i++) {
                const card = document.createElement('div');
                card.id = `karikatur-card-${i}`;
                card.className = 'relative group rounded-xl overflow-hidden bg-gradient-to-br from-orange-100 to-yellow-100 flex items-center justify-center aspect-[3/4]';
                card.innerHTML = '<div class="animate-spin rounded-full h-10 w-10 border-b-2 border-orange-600"></div>';
                karikaturResultsGrid.appendChild(card);
            }

            // Generate all variations in parallel
            const generationPromises = Array.from({ length: selectedCount }, (_, i) =>
                generateSingleKarikatur(i + 1, prompt)
            );
            await Promise.allSettled(generationPromises);

            karikaturGenerateBtn.disabled = false;
            karikaturGenerateBtn.innerHTML = originalBtnHTML;

            // Show download all button if any images generated
            if (generatedImages.length > 0) {
                karikaturDownloadAllBtn.classList.remove('hidden');
            }
        }

        async function generateSingleKarikatur(index, basePrompt) {
            const card = document.getElementById(`karikatur-card-${index}`);
            try {
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-image-preview:generateContent?key=${apiKey}`;

                const finalPrompt = `${basePrompt}\n\nVariation ${index}: Create a unique interpretation with slightly different exaggeration emphasis or styling details while maintaining the core style and requirements.`;

                const payload = {
                    contents: [{
                        parts: [
                            { text: finalPrompt },
                            { inlineData: { mimeType: uploadedImageData.mimeType, data: uploadedImageData.base64 } }
                        ]
                    }],
                    generationConfig: {
                        responseModalities: ['IMAGE'],
                        imageConfig: { aspectRatio: selectedRatio }
                    }
                };

                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    throw new Error(`API Error: ${response.status}`);
                }

                const result = await response.json();
                const base64Data = result?.candidates?.[0]?.content?.parts?.find(p => p.inlineData)?.inlineData?.data;

                if (base64Data) {
                    const imageUrl = `data:image/png;base64,${base64Data}`;
                    const filename = `karikatur_${selectedStyle}_${selectedExaggeration}_${index}.png`;

                    generatedImages.push({ url: imageUrl, filename: filename });

                    card.className = 'relative group rounded-xl overflow-hidden shadow-lg hover:shadow-2xl transition-all duration-300';
                    card.innerHTML = `
                        <img src="${imageUrl}" class="w-full h-full object-cover" alt="Karikatur ${index}">
                        <div class="absolute inset-0 bg-gradient-to-t from-black/80 via-black/40 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300 flex items-end justify-center pb-4 gap-2">
                            <button data-action="preview" data-index="${index - 1}" class="action-btn bg-white/90 hover:bg-white text-gray-800 px-4 py-2 rounded-full font-semibold shadow-lg transition-all duration-200 hover:scale-105 flex items-center gap-2">
                                <i class="fas fa-eye"></i>
                                <span class="hidden sm:inline">Preview</span>
                            </button>
                            <button data-action="download" data-index="${index - 1}" class="action-btn bg-gradient-to-r from-orange-500 to-yellow-500 hover:from-orange-600 hover:to-yellow-600 text-white px-4 py-2 rounded-full font-semibold shadow-lg transition-all duration-200 hover:scale-105 flex items-center gap-2">
                                <i class="fas fa-download"></i>
                                <span class="hidden sm:inline">Download</span>
                            </button>
                        </div>
                    `;
                } else {
                    throw new Error('Invalid API response');
                }
            } catch (error) {
                console.error(`Error generating karikatur ${index}:`, error);
                card.innerHTML = `
                    <div class="text-center p-4">
                        <i class="fas fa-exclamation-circle text-red-500 text-3xl mb-2"></i>
                        <p class="text-xs text-red-500">Gagal membuat karikatur</p>
                    </div>
                `;
            }
        }

        // Event delegation for action buttons - Mobile friendly
        karikaturResultsGrid.addEventListener('click', async (e) => {
            e.stopPropagation();

            const actionBtn = e.target.classList.contains('action-btn') ? e.target : e.target.closest('.action-btn[data-action]');
            if (!actionBtn) return;

            const action = actionBtn.dataset.action;
            const index = parseInt(actionBtn.dataset.index, 10);
            const imageData = generatedImages[index];

            if (!imageData) return;

            if (action === 'preview') {
                if (window.showPreviewModal) {
                    window.showPreviewModal(imageData.url);
                }
            } else if (action === 'download') {
                if (window.downloadDataURINew) {
                    await window.downloadDataURINew(imageData.url, imageData.filename);
                } else if (window.downloadImage) {
                    await window.downloadImage(imageData.url, imageData.filename);
                }
            }
        });

        // Download all functionality with proper error handling
        if (karikaturDownloadAllBtn) {
            karikaturDownloadAllBtn.addEventListener('click', async (e) => {
                e.stopPropagation();

                if (generatedImages.length === 0 || karikaturDownloadAllBtn.disabled) return;

                const originalHTML = karikaturDownloadAllBtn.innerHTML;
                karikaturDownloadAllBtn.disabled = true;

                try {
                    for (let i = 0; i < generatedImages.length; i++) {
                        const img = generatedImages[i];
                        karikaturDownloadAllBtn.innerHTML = `<i class="fas fa-spinner fa-spin mr-2"></i><span>Downloading ${i + 1}/${generatedImages.length}...</span>`;

                        try {
                            if (window.downloadDataURINew) {
                                await window.downloadDataURINew(img.url, img.filename);
                            } else if (window.downloadImage) {
                                await window.downloadImage(img.url, img.filename);
                            }
                            await new Promise(resolve => setTimeout(resolve, 500));
                        } catch (error) {
                            console.error(`Error downloading image ${i + 1}:`, error);
                        }
                    }

                    karikaturDownloadAllBtn.innerHTML = '<i class="fas fa-check mr-2"></i><span>Selesai!</span>';
                    setTimeout(() => {
                        karikaturDownloadAllBtn.disabled = false;
                        karikaturDownloadAllBtn.innerHTML = originalHTML;
                    }, 2000);
                } catch (error) {
                    console.error('Download all error:', error);
                    karikaturDownloadAllBtn.innerHTML = '<i class="fas fa-times mr-2"></i><span>Error</span>';
                    setTimeout(() => {
                        karikaturDownloadAllBtn.disabled = false;
                        karikaturDownloadAllBtn.innerHTML = originalHTML;
                    }, 2000);
                }
            });
        }
    })();

    // ==================== PHOTO EDITOR PRO ====================
    (function() {
        // Element references
        const photoeditorInput = document.getElementById('photoeditor-image-input');
        const photoeditorImagePreview = document.getElementById('photoeditor-image-preview');
        const photoeditorUploadPrompt = document.getElementById('photoeditor-upload-prompt');
        const photoeditorMobilePreview = document.getElementById('photoeditor-mobile-preview');
        const photoeditorPreviewContainer = document.getElementById('photoeditor-preview-container');
        const photoeditorRemovePreview = document.getElementById('photoeditor-remove-preview');
        const photoeditorPresetOptions = document.getElementById('photoeditor-preset-options');
        const photoeditorPlaceholder = document.getElementById('photoeditor-placeholder');
        const photoeditorPreviewArea = document.getElementById('photoeditor-preview-area');
        const photoeditorCanvas = document.getElementById('photoeditor-canvas');
        const photoeditorResetBtn = document.getElementById('photoeditor-reset-btn');
        const photoeditorDownloadBtn = document.getElementById('photoeditor-download-btn');

        // Adjustment sliders
        const brightnessSlider = document.getElementById('photoeditor-brightness');
        const contrastSlider = document.getElementById('photoeditor-contrast');
        const saturationSlider = document.getElementById('photoeditor-saturation');
        const warmthSlider = document.getElementById('photoeditor-warmth');
        const highlightsSlider = document.getElementById('photoeditor-highlights');
        const shadowsSlider = document.getElementById('photoeditor-shadows');
        const sharpnessSlider = document.getElementById('photoeditor-sharpness');
        const vignetteSlider = document.getElementById('photoeditor-vignette');

        // Value displays
        const brightnessValue = document.getElementById('photoeditor-brightness-value');
        const contrastValue = document.getElementById('photoeditor-contrast-value');
        const saturationValue = document.getElementById('photoeditor-saturation-value');
        const warmthValue = document.getElementById('photoeditor-warmth-value');
        const highlightsValue = document.getElementById('photoeditor-highlights-value');
        const shadowsValue = document.getElementById('photoeditor-shadows-value');
        const sharpnessValue = document.getElementById('photoeditor-sharpness-value');
        const vignetteValue = document.getElementById('photoeditor-vignette-value');

        if (!photoeditorInput) return;

        let originalImage = null;
        let ctx = null;
        let selectedPreset = 'none';
        let adjustments = {
            brightness: 0,
            contrast: 0,
            saturation: 0,
            warmth: 0,
            highlights: 0,
            shadows: 0,
            sharpness: 0,
            vignette: 0
        };

        // Preset configurations
        const presets = {
            'none': { brightness: 0, contrast: 0, saturation: 0, warmth: 0, highlights: 0, shadows: 0, sharpness: 0, vignette: 0 },
            'cinematic': { brightness: -10, contrast: 15, saturation: -10, warmth: 5, highlights: -15, shadows: 10, sharpness: 10, vignette: 20 },
            'vintage': { brightness: 5, contrast: -10, saturation: -20, warmth: 25, highlights: -10, shadows: -5, sharpness: -10, vignette: 30 },
            'moody': { brightness: -15, contrast: 20, saturation: -15, warmth: -10, highlights: -20, shadows: 15, sharpness: 5, vignette: 35 },
            'vibrant': { brightness: 10, contrast: 15, saturation: 30, warmth: 0, highlights: 5, shadows: -5, sharpness: 15, vignette: 0 },
            'warm': { brightness: 8, contrast: 5, saturation: 10, warmth: 30, highlights: 0, shadows: 0, sharpness: 5, vignette: 15 },
            'cool': { brightness: 5, contrast: 10, saturation: 5, warmth: -30, highlights: 5, shadows: 0, sharpness: 10, vignette: 10 },
            'bw': { brightness: 0, contrast: 20, saturation: -100, warmth: 0, highlights: -10, shadows: 10, sharpness: 15, vignette: 20 },
            'sepia': { brightness: 5, contrast: 10, saturation: -30, warmth: 40, highlights: 0, shadows: 5, sharpness: 0, vignette: 25 },
            'dramatic': { brightness: -10, contrast: 30, saturation: 10, warmth: 0, highlights: -25, shadows: 20, sharpness: 20, vignette: 40 },
            'soft': { brightness: 10, contrast: -15, saturation: -10, warmth: 10, highlights: 10, shadows: -10, sharpness: -20, vignette: 15 },
            'hdr': { brightness: 5, contrast: 25, saturation: 20, warmth: 0, highlights: -30, shadows: 30, sharpness: 25, vignette: 0 },
            'golden': { brightness: 10, contrast: 10, saturation: 15, warmth: 35, highlights: 5, shadows: -5, sharpness: 10, vignette: 20 },
            'film': { brightness: -5, contrast: 15, saturation: -5, warmth: 10, highlights: -5, shadows: 5, sharpness: -5, vignette: 25 },
            'neon': { brightness: 15, contrast: 25, saturation: 50, warmth: -15, highlights: 10, shadows: -10, sharpness: 20, vignette: 0 },
            'pastel': { brightness: 15, contrast: -10, saturation: -15, warmth: 5, highlights: 15, shadows: -15, sharpness: -10, vignette: 10 },
            'urban': { brightness: -5, contrast: 20, saturation: 5, warmth: -5, highlights: -10, shadows: 15, sharpness: 15, vignette: 25 },
            'sunset': { brightness: 5, contrast: 15, saturation: 20, warmth: 40, highlights: -10, shadows: 5, sharpness: 10, vignette: 30 },
            'portrait': { brightness: 10, contrast: 10, saturation: 5, warmth: 15, highlights: -5, shadows: -10, sharpness: 20, vignette: 20 },
            'landscape': { brightness: 5, contrast: 15, saturation: 15, warmth: 5, highlights: -10, shadows: 10, sharpness: 25, vignette: 10 }
        };

        // Setup image upload with HEIC support
        photoeditorInput.addEventListener('change', async (e) => {
            const file = e.target.files[0];
            if (!file) return;

            try {
                let processedFile = file;

                // Convert HEIC to JPEG if necessary
                if (file.type === 'image/heic' || file.name.toLowerCase().endsWith('.heic')) {
                    const heic2any = window.heic2any;
                    if (heic2any) {
                        const convertedBlob = await heic2any({ blob: file, toType: 'image/jpeg', quality: 0.9 });
                        processedFile = new File([convertedBlob], file.name.replace(/\.heic$/i, '.jpg'), { type: 'image/jpeg' });
                    }
                }

                const reader = new FileReader();
                reader.onload = (event) => {
                    const img = new Image();
                    img.onload = () => {
                        originalImage = img;
                        setupCanvas();
                        applyEdits();

                        // Show desktop preview
                        photoeditorImagePreview.src = event.target.result;
                        photoeditorUploadPrompt.classList.add('hidden');
                        photoeditorImagePreview.classList.remove('hidden');

                        // Show mobile preview
                        if (photoeditorMobilePreview && photoeditorPreviewContainer) {
                            photoeditorMobilePreview.src = event.target.result;
                            photoeditorPreviewContainer.classList.remove('hidden');
                        }

                        // Show preview area
                        photoeditorPlaceholder.classList.add('hidden');
                        photoeditorPreviewArea.classList.remove('hidden');
                    };
                    img.src = event.target.result;
                };
                reader.readAsDataURL(processedFile);
            } catch (error) {
                console.error('Error processing image:', error);
                alert('Gagal memproses gambar. Silakan coba lagi.');
            }
        });

        // Remove image handler
        if (photoeditorRemovePreview) {
            photoeditorRemovePreview.addEventListener('click', () => {
                originalImage = null;
                photoeditorInput.value = '';
                photoeditorImagePreview.src = '';
                photoeditorImagePreview.classList.add('hidden');
                photoeditorUploadPrompt.classList.remove('hidden');

                if (photoeditorPreviewContainer) {
                    photoeditorPreviewContainer.classList.add('hidden');
                }
                if (photoeditorMobilePreview) {
                    photoeditorMobilePreview.src = '';
                }

                photoeditorPlaceholder.classList.remove('hidden');
                photoeditorPreviewArea.classList.add('hidden');
            });
        }

        // Setup canvas
        function setupCanvas() {
            if (!originalImage) return;

            // Use ORIGINAL image dimensions (no scaling)
            // Canvas internal resolution = original photo resolution
            photoeditorCanvas.width = originalImage.width;
            photoeditorCanvas.height = originalImage.height;
            ctx = photoeditorCanvas.getContext('2d', { willReadFrequently: true });

            // CSS handles display scaling automatically (defined in stylesheet)
            // Canvas will display scaled down to fit, but data remains full resolution
        }

        // Apply all edits
        function applyEdits() {
            if (!originalImage || !ctx) return;

            // Clear canvas
            ctx.clearRect(0, 0, photoeditorCanvas.width, photoeditorCanvas.height);

            // Draw original image at FULL RESOLUTION
            ctx.drawImage(originalImage, 0, 0, originalImage.width, originalImage.height);

            // Get image data
            const imageData = ctx.getImageData(0, 0, photoeditorCanvas.width, photoeditorCanvas.height);
            const data = imageData.data;

            // Apply adjustments
            for (let i = 0; i < data.length; i += 4) {
                let r = data[i];
                let g = data[i + 1];
                let b = data[i + 2];

                // Brightness
                if (adjustments.brightness !== 0) {
                    const brightness = adjustments.brightness * 2.55;
                    r += brightness;
                    g += brightness;
                    b += brightness;
                }

                // Contrast
                if (adjustments.contrast !== 0) {
                    const factor = (259 * (adjustments.contrast + 255)) / (255 * (259 - adjustments.contrast));
                    r = factor * (r - 128) + 128;
                    g = factor * (g - 128) + 128;
                    b = factor * (b - 128) + 128;
                }

                // Saturation
                if (adjustments.saturation !== 0) {
                    const gray = 0.2989 * r + 0.587 * g + 0.114 * b;
                    const satFactor = 1 + adjustments.saturation / 100;
                    r = gray + satFactor * (r - gray);
                    g = gray + satFactor * (g - gray);
                    b = gray + satFactor * (b - gray);
                }

                // Warmth (Temperature)
                if (adjustments.warmth !== 0) {
                    const warmth = adjustments.warmth / 100;
                    r += warmth * 50;
                    b -= warmth * 30;
                }

                // Highlights & Shadows
                const luminance = 0.2126 * r + 0.7152 * g + 0.0722 * b;
                if (adjustments.highlights !== 0 && luminance > 127) {
                    const factor = 1 + (adjustments.highlights / 100) * ((luminance - 127) / 128);
                    r *= factor;
                    g *= factor;
                    b *= factor;
                }
                if (adjustments.shadows !== 0 && luminance < 128) {
                    const factor = 1 + (adjustments.shadows / 100) * (1 - luminance / 128);
                    r *= factor;
                    g *= factor;
                    b *= factor;
                }

                // Clamp values
                data[i] = Math.max(0, Math.min(255, r));
                data[i + 1] = Math.max(0, Math.min(255, g));
                data[i + 2] = Math.max(0, Math.min(255, b));
            }

            ctx.putImageData(imageData, 0, 0);

            // Apply sharpness
            if (adjustments.sharpness > 0) {
                applySharpness(adjustments.sharpness / 100);
            }

            // Apply vignette
            if (adjustments.vignette > 0) {
                applyVignette(adjustments.vignette / 100);
            }
        }

        // Sharpness filter
        function applySharpness(amount) {
            const imageData = ctx.getImageData(0, 0, photoeditorCanvas.width, photoeditorCanvas.height);
            const data = imageData.data;
            const w = photoeditorCanvas.width;
            const h = photoeditorCanvas.height;
            const weight = amount * 0.5;

            const sharpenKernel = [
                0, -weight, 0,
                -weight, 1 + 4 * weight, -weight,
                0, -weight, 0
            ];

            const output = new Uint8ClampedArray(data);

            for (let y = 1; y < h - 1; y++) {
                for (let x = 1; x < w - 1; x++) {
                    for (let c = 0; c < 3; c++) {
                        let sum = 0;
                        for (let ky = -1; ky <= 1; ky++) {
                            for (let kx = -1; kx <= 1; kx++) {
                                const idx = ((y + ky) * w + (x + kx)) * 4 + c;
                                sum += data[idx] * sharpenKernel[(ky + 1) * 3 + (kx + 1)];
                            }
                        }
                        output[(y * w + x) * 4 + c] = sum;
                    }
                }
            }

            ctx.putImageData(new ImageData(output, w, h), 0, 0);
        }

        // Vignette effect
        function applyVignette(amount) {
            const imageData = ctx.getImageData(0, 0, photoeditorCanvas.width, photoeditorCanvas.height);
            const data = imageData.data;
            const w = photoeditorCanvas.width;
            const h = photoeditorCanvas.height;
            const centerX = w / 2;
            const centerY = h / 2;
            const maxDist = Math.sqrt(centerX * centerX + centerY * centerY);

            for (let y = 0; y < h; y++) {
                for (let x = 0; x < w; x++) {
                    const dist = Math.sqrt((x - centerX) ** 2 + (y - centerY) ** 2);
                    const vignette = 1 - (dist / maxDist) * amount;
                    const idx = (y * w + x) * 4;

                    data[idx] *= vignette;
                    data[idx + 1] *= vignette;
                    data[idx + 2] *= vignette;
                }
            }

            ctx.putImageData(imageData, 0, 0);
        }

        // Preset selection handler
        photoeditorPresetOptions.addEventListener('click', (e) => {
            const button = e.target.closest('button');
            if (!button) return;

            photoeditorPresetOptions.querySelectorAll('button').forEach(btn => btn.classList.remove('selected'));
            button.classList.add('selected');
            selectedPreset = button.dataset.preset;

            // Apply preset values
            const preset = presets[selectedPreset];
            if (preset) {
                adjustments = { ...preset };
                updateSliders();
                applyEdits();
            }
        });

        // Update sliders to match preset
        function updateSliders() {
            brightnessSlider.value = adjustments.brightness;
            contrastSlider.value = adjustments.contrast;
            saturationSlider.value = adjustments.saturation;
            warmthSlider.value = adjustments.warmth;
            highlightsSlider.value = adjustments.highlights;
            shadowsSlider.value = adjustments.shadows;
            sharpnessSlider.value = adjustments.sharpness;
            vignetteSlider.value = adjustments.vignette;

            brightnessValue.textContent = adjustments.brightness;
            contrastValue.textContent = adjustments.contrast;
            saturationValue.textContent = adjustments.saturation;
            warmthValue.textContent = adjustments.warmth;
            highlightsValue.textContent = adjustments.highlights;
            shadowsValue.textContent = adjustments.shadows;
            sharpnessValue.textContent = adjustments.sharpness;
            vignetteValue.textContent = adjustments.vignette;
        }

        // Manual adjustment handlers
        [brightnessSlider, contrastSlider, saturationSlider, warmthSlider, highlightsSlider, shadowsSlider, sharpnessSlider, vignetteSlider].forEach(slider => {
            if (!slider) return;
            slider.addEventListener('input', (e) => {
                const name = e.target.id.replace('photoeditor-', '');
                adjustments[name] = parseInt(e.target.value);
                document.getElementById(`photoeditor-${name}-value`).textContent = e.target.value;
                applyEdits();
            });
        });

        // Reset button
        if (photoeditorResetBtn) {
            photoeditorResetBtn.addEventListener('click', () => {
                selectedPreset = 'none';
                adjustments = { brightness: 0, contrast: 0, saturation: 0, warmth: 0, highlights: 0, shadows: 0, sharpness: 0, vignette: 0 };
                updateSliders();
                applyEdits();

                photoeditorPresetOptions.querySelectorAll('button').forEach(btn => btn.classList.remove('selected'));
                photoeditorPresetOptions.querySelector('[data-preset="none"]').classList.add('selected');
            });
        }

        // Download button
        if (photoeditorDownloadBtn) {
            photoeditorDownloadBtn.addEventListener('click', async () => {
                if (!photoeditorCanvas) return;

                // Download at ORIGINAL resolution
                console.log(`Downloading edited photo at ORIGINAL size: ${photoeditorCanvas.width}x${photoeditorCanvas.height}px`);

                const dataUrl = photoeditorCanvas.toDataURL('image/png');
                const filename = `edited_photo_${Date.now()}.png`;

                if (window.downloadDataURINew) {
                    await window.downloadDataURINew(dataUrl, filename);
                } else if (window.downloadImage) {
                    await window.downloadImage(dataUrl, filename);
                } else {
                    // Fallback
                    const link = document.createElement('a');
                    link.href = dataUrl;
                    link.download = filename;
                    link.click();
                }
            });
        }
    })();

    // ==================== AI BEAUTY EDITOR ====================
    (function() {
        const apiKey = "";

        // Element references
        const beautyInput = document.getElementById('beauty-image-input');
        const beautyImagePreview = document.getElementById('beauty-image-preview');
        const beautyUploadPrompt = document.getElementById('beauty-upload-prompt');
        const beautyMobilePreview = document.getElementById('beauty-mobile-preview');
        const beautyPreviewContainer = document.getElementById('beauty-preview-container');
        const beautyRemovePreview = document.getElementById('beauty-remove-preview');
        const beautyFeatureOptions = document.getElementById('beauty-feature-options');
        const beautyCustomRequest = document.getElementById('beauty-custom-request');
        const beautyIntensityOptions = document.getElementById('beauty-intensity-options');
        const beautyRatioOptions = document.getElementById('beauty-ratio-options');
        const beautyCountOptions = document.getElementById('beauty-count-options');
        const beautyGenerateBtn = document.getElementById('beauty-generate-btn');
        const beautyPlaceholder = document.getElementById('beauty-placeholder');
        const beautyResultsGrid = document.getElementById('beauty-results-grid');
        const beautyDownloadAllBtn = document.getElementById('beauty-download-all-btn');

        if (!beautyInput) return;

        let uploadedImageData = null;
        let generatedImages = [];
        let selectedFeatures = [];
        let selectedIntensity = 'moderate';
        let selectedRatio = '3:4';
        let selectedCount = 4;

        // Feature descriptions for AI prompts
        const featureDescriptions = {
            'smooth-skin': 'Smooth, flawless skin texture with reduced pores, even skin tone, no blemishes or imperfections, professional skin smoothing like in magazine photos',
            'brighten-face': 'Brightened, luminous face with enhanced radiance, glowing complexion, improved skin clarity, lifted shadows under eyes, overall brighter and more youthful appearance',
            'big-eyes': 'Enlarged, more prominent eyes with enhanced eye definition, bigger iris and pupils, more open and expressive eye appearance while maintaining natural proportions',
            'slim-face': 'Slimmer, more contoured V-line face shape, reduced facial width, defined cheekbones, more elegant facial proportions, oval or heart-shaped face structure',
            'sharp-nose': 'Refined, sharper nose bridge, more defined nose tip, straighter nose profile, higher nose bridge, sculpted nose structure',
            'white-teeth': 'Brightened, whiter teeth with enhanced dental brightness, natural-looking pearly white smile, improved teeth color',
            'slim-body': 'Create a noticeably slimmer, more toned physique with reduced body fat appearance, narrower waist, flatter stomach, slimmer arms and legs, more athletic and fit body shape, hourglass or athletic figure, toned muscles visible, reduced overall body width while maintaining healthy proportions - professional body slimming transformation similar to fitness magazine covers',
            'defined-jawline': 'More defined, chiseled jawline with enhanced jaw contour, sharper jaw definition, more prominent jaw structure, reduced under-chin area',
            'remove-blemish': 'Removed all skin blemishes, acne, spots, scars, and imperfections, completely clear flawless skin, professional skin retouching',
            'natural-makeup': 'Natural, subtle makeup look with enhanced features - light foundation, soft blush, natural eye definition, nude lip color, fresh and effortless beauty',
            'glam-makeup': 'Glamorous, dramatic makeup with bold eyes, defined eyebrows, contouring, highlighted cheekbones, smokey eyes or bold eyeliner, statement lip color, red carpet ready look',
            'full-beauty': 'Complete professional beauty transformation combining: smooth flawless skin, brightened glowing complexion, bigger expressive eyes, slim V-line face, sharp defined nose, white teeth, defined jawline, and glamorous makeup - total magazine-quality beauty enhancement'
        };

        // Intensity level descriptions
        const intensityLevels = {
            'subtle': 'very subtle and natural enhancement, barely noticeable changes, maintaining original appearance',
            'moderate': 'balanced and noticeable enhancement, clear improvements while keeping natural look',
            'strong': 'dramatic and bold enhancement, significant transformation, professional magazine-level editing'
        };

        // Setup image upload with HEIC support
        beautyInput.addEventListener('change', async (e) => {
            const file = e.target.files[0];
            if (!file) return;

            try {
                let processedFile = file;

                // Convert HEIC to JPEG if necessary
                if (file.type === 'image/heic' || file.name.toLowerCase().endsWith('.heic')) {
                    const heic2any = window.heic2any;
                    if (heic2any) {
                        const convertedBlob = await heic2any({ blob: file, toType: 'image/jpeg', quality: 0.9 });
                        processedFile = new File([convertedBlob], file.name.replace(/\.heic$/i, '.jpg'), { type: 'image/jpeg' });
                    }
                }

                const reader = new FileReader();
                reader.onload = (event) => {
                    const dataUrl = event.target.result;
                    const base64 = dataUrl.split(',')[1];

                    uploadedImageData = {
                        base64: base64,
                        mimeType: processedFile.type,
                        dataUrl: dataUrl
                    };

                    // Show desktop preview
                    beautyImagePreview.src = dataUrl;
                    beautyUploadPrompt.classList.add('hidden');
                    beautyImagePreview.classList.remove('hidden');

                    // Show mobile preview
                    if (beautyMobilePreview && beautyPreviewContainer) {
                        beautyMobilePreview.src = dataUrl;
                        beautyPreviewContainer.classList.remove('hidden');
                    }

                    // Enable generate button if features selected
                    updateGenerateButton();
                };
                reader.readAsDataURL(processedFile);
            } catch (error) {
                console.error('Error processing image:', error);
                alert('Gagal memproses gambar. Silakan coba lagi.');
            }
        });

        // Remove image handler
        if (beautyRemovePreview) {
            beautyRemovePreview.addEventListener('click', () => {
                uploadedImageData = null;
                beautyInput.value = '';
                beautyImagePreview.src = '';
                beautyImagePreview.classList.add('hidden');
                beautyUploadPrompt.classList.remove('hidden');

                if (beautyPreviewContainer) {
                    beautyPreviewContainer.classList.add('hidden');
                }
                if (beautyMobilePreview) {
                    beautyMobilePreview.src = '';
                }

                beautyGenerateBtn.disabled = true;

                // Reset results
                beautyPlaceholder.classList.remove('hidden');
                beautyResultsGrid.classList.add('hidden');
                beautyResultsGrid.innerHTML = '';
                beautyDownloadAllBtn.classList.add('hidden');
                generatedImages = [];
            });
        }

        // Feature selection handler (multi-select)
        beautyFeatureOptions.addEventListener('click', (e) => {
            const button = e.target.closest('button');
            if (!button) return;

            const feature = button.dataset.feature;

            if (button.classList.contains('selected')) {
                button.classList.remove('selected');
                selectedFeatures = selectedFeatures.filter(f => f !== feature);
            } else {
                button.classList.add('selected');
                selectedFeatures.push(feature);
            }

            updateGenerateButton();
        });

        // Intensity selection handler
        beautyIntensityOptions.addEventListener('click', (e) => {
            const button = e.target.closest('button');
            if (!button) return;

            beautyIntensityOptions.querySelectorAll('button').forEach(btn => btn.classList.remove('selected'));
            button.classList.add('selected');
            selectedIntensity = button.dataset.intensity;
        });

        // Aspect ratio selection handler
        beautyRatioOptions.addEventListener('click', (e) => {
            const button = e.target.closest('button');
            if (!button) return;

            beautyRatioOptions.querySelectorAll('button').forEach(btn => btn.classList.remove('selected'));
            button.classList.add('selected');
            selectedRatio = button.dataset.ratio;
        });

        // Count selection handler
        beautyCountOptions.addEventListener('click', (e) => {
            const button = e.target.closest('button');
            if (!button) return;

            beautyCountOptions.querySelectorAll('button').forEach(btn => btn.classList.remove('selected'));
            button.classList.add('selected');
            selectedCount = parseInt(button.dataset.count);
        });

        // Update generate button state
        function updateGenerateButton() {
            const hasCustomRequest = beautyCustomRequest && beautyCustomRequest.value.trim().length > 0;
            beautyGenerateBtn.disabled = !uploadedImageData || (selectedFeatures.length === 0 && !hasCustomRequest);
        }

        // Listen to custom request input
        if (beautyCustomRequest) {
            beautyCustomRequest.addEventListener('input', updateGenerateButton);
        }

        // Generate button handler
        beautyGenerateBtn.addEventListener('click', async () => {
            const hasCustomRequest = beautyCustomRequest && beautyCustomRequest.value.trim().length > 0;

            if (!uploadedImageData || (selectedFeatures.length === 0 && !hasCustomRequest)) {
                alert('Silakan unggah foto dan pilih minimal 1 fitur beauty atau isi custom request');
                return;
            }

            // Build comprehensive prompt
            let featuresList = '';
            if (selectedFeatures.length > 0) {
                featuresList = selectedFeatures.map(f => featureDescriptions[f]).join(', ');
            }

            // Add custom request if provided
            const customRequest = beautyCustomRequest ? beautyCustomRequest.value.trim() : '';
            if (customRequest) {
                if (featuresList) {
                    featuresList += `, PLUS custom enhancements: ${customRequest}`;
                } else {
                    featuresList = `Custom beauty enhancements: ${customRequest}`;
                }
            }

            const intensityDesc = intensityLevels[selectedIntensity];

            const prompt = `Apply professional AI beauty enhancement to this person's photo with the following specifications:

BEAUTY ENHANCEMENTS TO APPLY:
${featuresList}

INTENSITY LEVEL:
Apply ${intensityDesc}

CRITICAL REQUIREMENTS:
1. IDENTITY PRESERVATION: Keep the person's identity EXACTLY the same - same facial structure, same person recognizable
2. NATURAL RESULTS: All enhancements must look natural and realistic, not artificial or over-processed
3. PROFESSIONAL QUALITY: Magazine-quality beauty editing, professional retouching standards
4. SKIN TEXTURE: Maintain natural skin texture even when smoothing, avoid plastic or overly smoothed appearance
5. FACIAL HARMONY: All enhancements must work together harmoniously
6. CONSISTENT LIGHTING: Maintain consistent lighting and shadows appropriate to the original photo
7. NO DISTORTIONS: Avoid any unnatural distortions or warping effects
8. PRESERVE BACKGROUND: Keep background unchanged, only enhance the person
9. HIGH RESOLUTION: Maintain image quality and sharpness
10. REALISTIC PROPORTIONS: All adjustments must maintain realistic human proportions

TECHNICAL EXECUTION:
- Apply enhancements with ${selectedIntensity} intensity level
- Blend all changes seamlessly with the original photo
- Ensure professional, believable results that the person would be happy to use
- Focus on enhancement, not complete transformation

Generate a stunning, professionally enhanced photo that maintains the person's authentic identity while applying the selected beauty improvements.`;

            await generateBeautySet(prompt);
        });

        async function generateBeautySet(prompt) {
            const originalBtnHTML = beautyGenerateBtn.innerHTML;
            beautyGenerateBtn.disabled = true;
            beautyGenerateBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Applying Beauty Effect...';

            beautyPlaceholder.classList.add('hidden');
            beautyResultsGrid.classList.remove('hidden');
            beautyResultsGrid.innerHTML = '';
            beautyDownloadAllBtn.classList.add('hidden');
            generatedImages = [];

            // Create placeholder cards
            for (let i = 1; i <= selectedCount; i++) {
                const card = document.createElement('div');
                card.id = `beauty-card-${i}`;
                card.className = 'relative group rounded-xl overflow-hidden bg-gradient-to-br from-pink-100 to-rose-100 flex items-center justify-center aspect-[3/4]';
                card.innerHTML = '<div class="animate-spin rounded-full h-10 w-10 border-b-2 border-pink-600"></div>';
                beautyResultsGrid.appendChild(card);
            }

            // Generate all variations in parallel
            const generationPromises = Array.from({ length: selectedCount }, (_, i) =>
                generateSingleBeauty(i + 1, prompt)
            );
            await Promise.allSettled(generationPromises);

            beautyGenerateBtn.disabled = false;
            beautyGenerateBtn.innerHTML = originalBtnHTML;

            // Show download all button if any images generated
            if (generatedImages.length > 0) {
                beautyDownloadAllBtn.classList.remove('hidden');
            }
        }

        async function generateSingleBeauty(index, basePrompt) {
            const card = document.getElementById(`beauty-card-${index}`);
            try {
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-image-preview:generateContent?key=${apiKey}`;

                const finalPrompt = `${basePrompt}\n\nVariation ${index}: Create a unique professional result with slightly different beauty enhancement emphasis while maintaining all requirements.`;

                const payload = {
                    contents: [{
                        parts: [
                            { text: finalPrompt },
                            { inlineData: { mimeType: uploadedImageData.mimeType, data: uploadedImageData.base64 } }
                        ]
                    }],
                    generationConfig: {
                        responseModalities: ['IMAGE'],
                        imageConfig: { aspectRatio: selectedRatio }
                    }
                };

                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    throw new Error(`API Error: ${response.status}`);
                }

                const result = await response.json();
                const base64Data = result?.candidates?.[0]?.content?.parts?.find(p => p.inlineData)?.inlineData?.data;

                if (base64Data) {
                    const imageUrl = `data:image/png;base64,${base64Data}`;
                    const featureNames = selectedFeatures.join('_');
                    const filename = `beauty_${featureNames}_${selectedIntensity}_${index}.png`;

                    generatedImages.push({ url: imageUrl, filename: filename });

                    card.className = 'relative group rounded-xl overflow-hidden shadow-lg hover:shadow-2xl transition-all duration-300';
                    card.innerHTML = `
                        <img src="${imageUrl}" class="w-full h-full object-cover" alt="Beauty ${index}">
                        <div class="absolute inset-0 bg-gradient-to-t from-black/80 via-black/40 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300 flex items-end justify-center pb-4 gap-2">
                            <button data-action="preview" data-index="${index - 1}" class="action-btn bg-white/90 hover:bg-white text-gray-800 px-4 py-2 rounded-full font-semibold shadow-lg transition-all duration-200 hover:scale-105 flex items-center gap-2">
                                <i class="fas fa-eye"></i>
                                <span class="hidden sm:inline">Preview</span>
                            </button>
                            <button data-action="download" data-index="${index - 1}" class="action-btn bg-gradient-to-r from-pink-500 to-rose-500 hover:from-pink-600 hover:to-rose-600 text-white px-4 py-2 rounded-full font-semibold shadow-lg transition-all duration-200 hover:scale-105 flex items-center gap-2">
                                <i class="fas fa-download"></i>
                                <span class="hidden sm:inline">Download</span>
                            </button>
                        </div>
                    `;
                } else {
                    throw new Error('Invalid API response');
                }
            } catch (error) {
                console.error(`Error generating beauty ${index}:`, error);
                card.innerHTML = `
                    <div class="text-center p-4">
                        <i class="fas fa-exclamation-circle text-red-500 text-3xl mb-2"></i>
                        <p class="text-xs text-red-500">Gagal apply beauty effect</p>
                    </div>
                `;
            }
        }

        // Event delegation for action buttons - Mobile friendly
        beautyResultsGrid.addEventListener('click', async (e) => {
            e.stopPropagation();

            const actionBtn = e.target.classList.contains('action-btn') ? e.target : e.target.closest('.action-btn[data-action]');
            if (!actionBtn) return;

            const action = actionBtn.dataset.action;
            const index = parseInt(actionBtn.dataset.index, 10);
            const imageData = generatedImages[index];

            if (!imageData) return;

            if (action === 'preview') {
                if (window.showPreviewModal) {
                    window.showPreviewModal(imageData.url);
                }
            } else if (action === 'download') {
                if (window.downloadDataURINew) {
                    await window.downloadDataURINew(imageData.url, imageData.filename);
                } else if (window.downloadImage) {
                    await window.downloadImage(imageData.url, imageData.filename);
                }
            }
        });

        // Download all functionality with proper error handling
        if (beautyDownloadAllBtn) {
            beautyDownloadAllBtn.addEventListener('click', async (e) => {
                e.stopPropagation();

                if (generatedImages.length === 0 || beautyDownloadAllBtn.disabled) return;

                const originalHTML = beautyDownloadAllBtn.innerHTML;
                beautyDownloadAllBtn.disabled = true;

                try {
                    for (let i = 0; i < generatedImages.length; i++) {
                        const img = generatedImages[i];
                        beautyDownloadAllBtn.innerHTML = `<i class="fas fa-spinner fa-spin mr-2"></i><span>Downloading ${i + 1}/${generatedImages.length}...</span>`;

                        try {
                            if (window.downloadDataURINew) {
                                await window.downloadDataURINew(img.url, img.filename);
                            } else if (window.downloadImage) {
                                await window.downloadImage(img.url, img.filename);
                            }
                            await new Promise(resolve => setTimeout(resolve, 500));
                        } catch (error) {
                            console.error(`Error downloading image ${i + 1}:`, error);
                        }
                    }

                    beautyDownloadAllBtn.innerHTML = '<i class="fas fa-check mr-2"></i><span>Selesai!</span>';
                    setTimeout(() => {
                        beautyDownloadAllBtn.disabled = false;
                        beautyDownloadAllBtn.innerHTML = originalHTML;
                    }, 2000);
                } catch (error) {
                    console.error('Download all error:', error);
                    beautyDownloadAllBtn.innerHTML = '<i class="fas fa-times mr-2"></i><span>Error</span>';
                    setTimeout(() => {
                        beautyDownloadAllBtn.disabled = false;
                        beautyDownloadAllBtn.innerHTML = originalHTML;
                    }, 2000);
                }
            });
        }
    })();

    // ==================== FACE SWAP ====================
    (function() {
        const apiKey = "";

        // Element references
        const faceswapSourceInput = document.getElementById('faceswap-source-input');
        const faceswapSourceUploadBox = document.getElementById('faceswap-source-upload-box');
        const faceswapSourcePreview = document.getElementById('faceswap-source-preview');
        const faceswapSourcePlaceholder = document.getElementById('faceswap-source-placeholder');
        const faceswapSourceRemoveBtn = document.getElementById('faceswap-source-remove-btn');

        const faceswapTargetInput = document.getElementById('faceswap-target-input');
        const faceswapTargetUploadBox = document.getElementById('faceswap-target-upload-box');
        const faceswapTargetPreview = document.getElementById('faceswap-target-preview');
        const faceswapTargetPlaceholder = document.getElementById('faceswap-target-placeholder');
        const faceswapTargetRemoveBtn = document.getElementById('faceswap-target-remove-btn');

        const faceswapGenerateBtn = document.getElementById('faceswap-generate-btn');
        const faceswapRatioOptions = document.getElementById('faceswap-ratio-options');
        const faceswapCountOptions = document.getElementById('faceswap-count-options');
        const faceswapResultsPlaceholder = document.getElementById('faceswap-results-placeholder');
        const faceswapResultsContainer = document.getElementById('faceswap-results-container');
        const faceswapResultsGrid = document.getElementById('faceswap-results-grid');
        const faceswapDownloadAllBtn = document.getElementById('faceswap-download-all-btn');

        if (!faceswapSourceInput || !faceswapTargetInput) return;

        let sourceImageData = null;
        let targetImageData = null;
        let generatedImages = [];
        let selectedRatio = '3:4';
        let selectedCount = 4;

        // Setup image upload for source face with HEIC support
        setupImageUploadNew(faceswapSourceInput, faceswapSourceUploadBox, (data) => {
            sourceImageData = data;
            faceswapSourcePreview.src = data.dataUrl;
            faceswapSourcePlaceholder.classList.add('hidden');
            faceswapSourcePreview.classList.remove('hidden');
            faceswapSourceRemoveBtn.classList.remove('hidden');
            updateGenerateButton();
        });

        // Setup image upload for target photo with HEIC support
        setupImageUploadNew(faceswapTargetInput, faceswapTargetUploadBox, (data) => {
            targetImageData = data;
            faceswapTargetPreview.src = data.dataUrl;
            faceswapTargetPlaceholder.classList.add('hidden');
            faceswapTargetPreview.classList.remove('hidden');
            faceswapTargetRemoveBtn.classList.remove('hidden');
            updateGenerateButton();
        });

        // Remove source image
        if (faceswapSourceRemoveBtn) {
            faceswapSourceRemoveBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                sourceImageData = null;
                faceswapSourceInput.value = '';
                faceswapSourcePreview.src = '';
                faceswapSourcePreview.classList.add('hidden');
                faceswapSourcePlaceholder.classList.remove('hidden');
                faceswapSourceRemoveBtn.classList.add('hidden');
                updateGenerateButton();
            });
        }

        // Remove target image
        if (faceswapTargetRemoveBtn) {
            faceswapTargetRemoveBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                targetImageData = null;
                faceswapTargetInput.value = '';
                faceswapTargetPreview.src = '';
                faceswapTargetPreview.classList.add('hidden');
                faceswapTargetPlaceholder.classList.remove('hidden');
                faceswapTargetRemoveBtn.classList.add('hidden');
                updateGenerateButton();
            });
        }

        // Setup option buttons
        setupOptionButtonsNew(faceswapRatioOptions);
        setupOptionButtonsNew(faceswapCountOptions);

        // Listen to option changes
        faceswapRatioOptions.addEventListener('click', (e) => {
            const btn = e.target.closest('[data-value]');
            if (btn) selectedRatio = btn.dataset.value;
        });

        faceswapCountOptions.addEventListener('click', (e) => {
            const btn = e.target.closest('[data-value]');
            if (btn) selectedCount = parseInt(btn.dataset.value);
        });

        // Update generate button state
        function updateGenerateButton() {
            faceswapGenerateBtn.disabled = !sourceImageData || !targetImageData;
        }

        // Generate button click handler
        faceswapGenerateBtn.addEventListener('click', async () => {
            if (!sourceImageData || !targetImageData) {
                alert('Mohon upload kedua foto terlebih dahulu!');
                return;
            }

            const originalBtnHTML = faceswapGenerateBtn.innerHTML;
            faceswapGenerateBtn.disabled = true;
            faceswapGenerateBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Memproses Face Swap...';

            // Clear previous results
            generatedImages = [];
            faceswapDownloadAllBtn.classList.add('hidden');

            // Hide placeholder, show results
            faceswapResultsPlaceholder.classList.add('hidden');
            faceswapResultsContainer.classList.remove('hidden');
            faceswapResultsGrid.innerHTML = '';

            // Create placeholder cards
            for (let i = 1; i <= selectedCount; i++) {
                const card = document.createElement('div');
                card.id = `faceswap-card-${i}`;
                card.className = 'relative group rounded-xl overflow-hidden bg-gray-100 shadow-lg aspect-[3/4]';
                card.innerHTML = `
                    <div class="w-full h-full flex items-center justify-center">
                        <div class="animate-spin rounded-full h-10 w-10 border-b-2 border-orange-600"></div>
                    </div>
                    <div class="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/70 to-transparent p-2">
                        <p class="text-white text-xs text-center">Variasi ${i}</p>
                    </div>
                `;
                faceswapResultsGrid.appendChild(card);
            }

            // Generate images in parallel
            const generatePromises = Array.from({ length: selectedCount }, (_, i) =>
                generateFaceSwap(i + 1)
            );

            await Promise.allSettled(generatePromises);

            // Show download all button
            if (generatedImages.length > 0) {
                faceswapDownloadAllBtn.classList.remove('hidden');
            }

            faceswapGenerateBtn.disabled = false;
            faceswapGenerateBtn.innerHTML = originalBtnHTML;
        });

        // Generate single face swap
        async function generateFaceSwap(index) {
            try {
                const prompt = `Create a face swap image where the face from the first image is seamlessly swapped onto the person in the second image.

CRITICAL REQUIREMENTS:
1. Take the face from the SOURCE image (first image) and place it on the body/scene in the TARGET image (second image)
2. Match skin tone, lighting, and angle perfectly for a natural result
3. Preserve the TARGET image's background, body, pose, clothing, and overall composition
4. Only replace the face - keep everything else from the TARGET image unchanged
5. Ensure the swapped face blends naturally with shadows, highlights, and perspective
6. Maintain facial features from the SOURCE image while adapting to the TARGET's angle and lighting
7. Create variation ${index} with slightly different blending or lighting adjustments for variety

The result must look completely natural and photorealistic, as if the person from the SOURCE image was actually photographed in the TARGET scene.`;

                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-image-preview:generateContent?key=${apiKey}`;

                const payload = {
                    contents: [{
                        parts: [
                            { text: prompt },
                            { inlineData: { mimeType: sourceImageData.mimeType, data: sourceImageData.base64 } },
                            { inlineData: { mimeType: targetImageData.mimeType, data: targetImageData.base64 } }
                        ]
                    }],
                    generationConfig: {
                        responseModalities: ['IMAGE'],
                        imageConfig: { aspectRatio: selectedRatio }
                    }
                };

                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    const errorBody = await response.json();
                    throw new Error(errorBody.error?.message || `Error ${response.status}`);
                }

                const result = await response.json();
                const base64Data = result?.candidates?.[0]?.content?.parts?.find(p => p.inlineData)?.inlineData?.data;

                if (!base64Data) {
                    throw new Error('No image data received from API');
                }

                const imageUrl = `data:image/png;base64,${base64Data}`;
                const filename = `faceswap_result_${index}_${Date.now()}.png`;

                // Store generated image
                generatedImages.push({ url: imageUrl, filename: filename });

                // Update card with result
                const card = document.getElementById(`faceswap-card-${index}`);
                if (card) {
                    card.innerHTML = `
                        <img src="${imageUrl}" class="w-full h-full object-cover" alt="Face Swap ${index}">
                        <div class="absolute inset-0 bg-gradient-to-t from-black/80 via-black/40 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300 flex items-end justify-center pb-4 gap-2">
                            <button data-action="preview" data-index="${generatedImages.length - 1}" class="bg-white/90 hover:bg-white text-gray-800 px-4 py-2 rounded-full font-semibold shadow-lg transition-all duration-200 hover:scale-105 flex items-center gap-2 text-sm" style="touch-action: manipulation; -webkit-tap-highlight-color: transparent;">
                                <i class="fas fa-eye" style="pointer-events: none;"></i>
                                <span class="hidden sm:inline" style="pointer-events: none;">Preview</span>
                            </button>
                            <button data-action="download" data-index="${generatedImages.length - 1}" class="bg-gradient-to-r from-orange-500 to-orange-600 hover:from-orange-600 hover:to-orange-700 text-white px-4 py-2 rounded-full font-semibold shadow-lg transition-all duration-200 hover:scale-105 flex items-center gap-2 text-sm" style="touch-action: manipulation; -webkit-tap-highlight-color: transparent;">
                                <i class="fas fa-download" style="pointer-events: none;"></i>
                                <span class="hidden sm:inline" style="pointer-events: none;">Download</span>
                            </button>
                        </div>
                    `;
                }
            } catch (error) {
                console.error(`Error generating face swap ${index}:`, error);
                const card = document.getElementById(`faceswap-card-${index}`);
                if (card) {
                    card.innerHTML = `
                        <div class="w-full h-full flex flex-col items-center justify-center bg-red-50 p-4">
                            <i class="fas fa-exclamation-circle text-red-500 text-3xl mb-2"></i>
                            <p class="text-red-600 text-xs text-center">Gagal generate</p>
                            <p class="text-red-500 text-xs text-center mt-1">${error.message}</p>
                        </div>
                    `;
                }
            }
        }

        // Event delegation for action buttons
        faceswapResultsGrid.addEventListener('click', async (e) => {
            e.stopPropagation();
            // DO NOT use e.preventDefault() here - causes download button to refresh page on mobile

            const actionBtn = e.target.closest('[data-action]');
            if (!actionBtn) return;

            // Prevent double-clicks
            if (actionBtn.disabled) return;

            const action = actionBtn.dataset.action;
            const index = parseInt(actionBtn.dataset.index);
            const imageData = generatedImages[index];

            if (!imageData) return;

            if (action === 'preview') {
                if (window.showPreviewModal) {
                    window.showPreviewModal(imageData.url);
                } else {
                    window.open(imageData.url, '_blank');
                }
            } else if (action === 'download') {
                // Disable button during download to prevent double-download
                actionBtn.disabled = true;
                const originalHTML = actionBtn.innerHTML;
                actionBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';

                try {
                    if (window.downloadDataURINew) {
                        await window.downloadDataURINew(imageData.url, imageData.filename);
                    } else if (window.downloadImage) {
                        await window.downloadImage(imageData.url, imageData.filename);
                    }

                    // Show success feedback
                    actionBtn.innerHTML = '<i class="fas fa-check"></i>';
                    setTimeout(() => {
                        actionBtn.disabled = false;
                        actionBtn.innerHTML = originalHTML;
                    }, 1000);
                } catch (error) {
                    console.error('Download failed:', error);
                    actionBtn.innerHTML = '<i class="fas fa-times"></i>';
                    setTimeout(() => {
                        actionBtn.disabled = false;
                        actionBtn.innerHTML = originalHTML;
                    }, 1000);
                }
            }
        });

        // Download all button
        faceswapDownloadAllBtn.addEventListener('click', async (e) => {
            e.stopPropagation();

            // Prevent multiple clicks
            if (generatedImages.length === 0 || faceswapDownloadAllBtn.disabled) return;

            const originalHTML = faceswapDownloadAllBtn.innerHTML;
            faceswapDownloadAllBtn.disabled = true;

            try {
                for (let i = 0; i < generatedImages.length; i++) {
                    const img = generatedImages[i];
                    faceswapDownloadAllBtn.innerHTML = `<i class="fas fa-spinner fa-spin mr-2"></i><span>Downloading ${i + 1}/${generatedImages.length}...</span>`;

                    try {
                        if (window.downloadDataURINew) {
                            await window.downloadDataURINew(img.url, img.filename);
                        } else if (window.downloadImage) {
                            await window.downloadImage(img.url, img.filename);
                        }
                        await new Promise(resolve => setTimeout(resolve, 500));
                    } catch (error) {
                        console.error(`Error downloading image ${i + 1}:`, error);
                        // Continue with next image even if one fails
                    }
                }

                faceswapDownloadAllBtn.innerHTML = '<i class="fas fa-check mr-2"></i><span>Selesai!</span>';
                setTimeout(() => {
                    faceswapDownloadAllBtn.disabled = false;
                    faceswapDownloadAllBtn.innerHTML = originalHTML;
                }, 2000);
            } catch (error) {
                console.error('Download all error:', error);
                faceswapDownloadAllBtn.innerHTML = '<i class="fas fa-times mr-2"></i><span>Error</span>';
                setTimeout(() => {
                    faceswapDownloadAllBtn.disabled = false;
                    faceswapDownloadAllBtn.innerHTML = originalHTML;
                }, 2000);
            }
        });
    })();

    // ==================== BACKGROUND REMOVER ====================
    (function() {
        const apiKey = "";

        // Element references
        const bgremoverInput = document.getElementById('bgremover-input');
        const bgremoverUploadBox = document.getElementById('bgremover-upload-box');
        const bgremoverPreview = document.getElementById('bgremover-preview');
        const bgremoverPlaceholder = document.getElementById('bgremover-placeholder');
        const bgremoverRemoveBtn = document.getElementById('bgremover-remove-btn');
        const bgremoverGenerateBtn = document.getElementById('bgremover-generate-btn');
        const bgremoverBgOptions = document.getElementById('bgremover-bg-options');
        const bgremoverCustomContainer = document.getElementById('bgremover-custom-container');
        const bgremoverCustomInput = document.getElementById('bgremover-custom-input');
        const bgremoverRatioOptions = document.getElementById('bgremover-ratio-options');
        const bgremoverCountOptions = document.getElementById('bgremover-count-options');
        const bgremoverResultsPlaceholder = document.getElementById('bgremover-results-placeholder');
        const bgremoverResultsContainer = document.getElementById('bgremover-results-container');
        const bgremoverResultsGrid = document.getElementById('bgremover-results-grid');
        const bgremoverDownloadAllBtn = document.getElementById('bgremover-download-all-btn');

        if (!bgremoverInput) return;

        let uploadedImageData = null;
        let generatedImages = [];
        let selectedBgType = 'transparent';
        let selectedRatio = '1:1';
        let selectedCount = 4;

        // Setup image upload with HEIC support
        setupImageUploadNew(bgremoverInput, bgremoverUploadBox, (data) => {
            uploadedImageData = data;
            bgremoverPreview.src = data.dataUrl;
            bgremoverPlaceholder.classList.add('hidden');
            bgremoverPreview.classList.remove('hidden');
            bgremoverRemoveBtn.classList.remove('hidden');
            bgremoverGenerateBtn.disabled = false;
        });

        // Remove image
        if (bgremoverRemoveBtn) {
            bgremoverRemoveBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                uploadedImageData = null;
                bgremoverInput.value = '';
                bgremoverPreview.src = '';
                bgremoverPreview.classList.add('hidden');
                bgremoverPlaceholder.classList.remove('hidden');
                bgremoverRemoveBtn.classList.add('hidden');
                bgremoverGenerateBtn.disabled = true;
            });
        }

        // Setup option buttons
        setupOptionButtonsNew(bgremoverBgOptions);
        setupOptionButtonsNew(bgremoverRatioOptions);
        setupOptionButtonsNew(bgremoverCountOptions);

        // Listen to background type changes
        bgremoverBgOptions.addEventListener('click', (e) => {
            const btn = e.target.closest('[data-value]');
            if (btn) {
                selectedBgType = btn.dataset.value;
                if (selectedBgType === 'custom') {
                    bgremoverCustomContainer.classList.remove('hidden');
                    bgremoverCustomInput.focus();
                } else {
                    bgremoverCustomContainer.classList.add('hidden');
                }
            }
        });

        // Listen to ratio changes
        bgremoverRatioOptions.addEventListener('click', (e) => {
            const btn = e.target.closest('[data-value]');
            if (btn) selectedRatio = btn.dataset.value;
        });

        // Listen to count changes
        bgremoverCountOptions.addEventListener('click', (e) => {
            const btn = e.target.closest('[data-value]');
            if (btn) selectedCount = parseInt(btn.dataset.value);
        });

        // Generate button click handler
        bgremoverGenerateBtn.addEventListener('click', async () => {
            if (!uploadedImageData) {
                alert('Mohon upload foto terlebih dahulu!');
                return;
            }

            const originalBtnHTML = bgremoverGenerateBtn.innerHTML;
            bgremoverGenerateBtn.disabled = true;
            bgremoverGenerateBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Menghapus Background...';

            // Clear previous results
            generatedImages = [];
            bgremoverDownloadAllBtn.classList.add('hidden');

            // Hide placeholder, show results
            bgremoverResultsPlaceholder.classList.add('hidden');
            bgremoverResultsContainer.classList.remove('hidden');
            bgremoverResultsGrid.innerHTML = '';

            // Create placeholder cards
            for (let i = 1; i <= selectedCount; i++) {
                const card = document.createElement('div');
                card.id = `bgremover-card-${i}`;
                card.className = 'relative group rounded-xl overflow-hidden bg-gray-100 shadow-lg aspect-square';
                card.innerHTML = `
                    <div class="w-full h-full flex items-center justify-center">
                        <div class="animate-spin rounded-full h-10 w-10 border-b-2 border-emerald-600"></div>
                    </div>
                    <div class="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/70 to-transparent p-2">
                        <p class="text-white text-xs text-center">Variasi ${i}</p>
                    </div>
                `;
                bgremoverResultsGrid.appendChild(card);
            }

            // Generate images in parallel
            const generatePromises = Array.from({ length: selectedCount }, (_, i) =>
                generateBackgroundRemoval(i + 1)
            );

            await Promise.allSettled(generatePromises);

            // Show download all button
            if (generatedImages.length > 0) {
                bgremoverDownloadAllBtn.classList.remove('hidden');
            }

            bgremoverGenerateBtn.disabled = false;
            bgremoverGenerateBtn.innerHTML = originalBtnHTML;
        });

        // Generate single background removal
        async function generateBackgroundRemoval(index) {
            try {
                // Build background description
                let backgroundDesc = '';
                let isBlurMode = false;

                if (selectedBgType === 'transparent') {
                    backgroundDesc = 'completely transparent background with NO background elements - pure alpha channel transparency';
                } else if (selectedBgType === 'blur') {
                    backgroundDesc = 'beautifully blurred background with professional bokeh effect';
                    isBlurMode = true;
                } else if (selectedBgType === 'white') {
                    backgroundDesc = 'clean solid white background (#FFFFFF)';
                } else if (selectedBgType === 'black') {
                    backgroundDesc = 'clean solid black background (#000000)';
                } else if (selectedBgType === 'gradient-blue') {
                    backgroundDesc = 'smooth gradient background from light blue to deep blue';
                } else if (selectedBgType === 'gradient-purple') {
                    backgroundDesc = 'smooth gradient background from light purple to deep purple';
                } else if (selectedBgType === 'custom') {
                    backgroundDesc = bgremoverCustomInput.value.trim() || 'professional studio background';
                }

                let prompt = '';

                if (isBlurMode) {
                    // Special prompt for blur background
                    prompt = `Create a professional portrait-style photo with a beautifully blurred background (bokeh effect).

CRITICAL REQUIREMENTS FOR BLUR BACKGROUND:
1. Keep the main subject PERFECTLY SHARP and in focus - maintain ALL details, texture, and clarity
2. Apply a strong, natural blur (bokeh) effect to the ENTIRE background
3. The blur should be smooth and gradual, mimicking professional camera depth-of-field
4. Preserve the original background colors and general atmosphere, just heavily blurred
5. Ensure realistic bokeh with smooth, circular blur circles if there are light sources
6. The subject should stand out dramatically from the soft, dreamy blurred background
7. Maintain natural lighting, shadows, and edge transitions on the subject
8. For variation ${index}, adjust blur intensity or bokeh style slightly

The result must look like a professional portrait photo taken with a wide aperture lens (f/1.4-f/2.8), with tack-sharp subject and beautiful creamy bokeh background.`;
                } else {
                    // Standard background removal prompt
                    prompt = `Remove the background from this image and replace it with ${backgroundDesc}.

CRITICAL REQUIREMENTS:
1. Perfectly cut out the main subject with clean, smooth edges
2. Remove ALL original background elements completely
3. Replace with ONLY the specified background: ${backgroundDesc}
4. Maintain the subject's quality, details, lighting, and colors EXACTLY as in original
5. Ensure clean edge detection - no halos, artifacts, or rough cutouts
6. Keep the subject's shadows and highlights natural
7. For variation ${index}, apply slightly different edge refinement or lighting adjustment

The result must look professional with perfect background separation and natural subject preservation.`;
                }

                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-image-preview:generateContent?key=${apiKey}`;

                const payload = {
                    contents: [{
                        parts: [
                            { text: prompt },
                            { inlineData: { mimeType: uploadedImageData.mimeType, data: uploadedImageData.base64 } }
                        ]
                    }],
                    generationConfig: {
                        responseModalities: ['IMAGE'],
                        imageConfig: { aspectRatio: selectedRatio }
                    }
                };

                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    const errorBody = await response.json();
                    throw new Error(errorBody.error?.message || `Error ${response.status}`);
                }

                const result = await response.json();
                const base64Data = result?.candidates?.[0]?.content?.parts?.find(p => p.inlineData)?.inlineData?.data;

                if (!base64Data) {
                    throw new Error('No image data received from API');
                }

                const imageUrl = `data:image/png;base64,${base64Data}`;
                const bgTypeName = selectedBgType === 'custom' ? 'custom' : selectedBgType;
                const filename = `bg_removed_${bgTypeName}_${index}_${Date.now()}.png`;

                // Store generated image
                generatedImages.push({ url: imageUrl, filename: filename });

                // Update card with result
                const card = document.getElementById(`bgremover-card-${index}`);
                if (card) {
                    card.innerHTML = `
                        <img src="${imageUrl}" class="w-full h-full object-cover" alt="Background Removed ${index}">
                        <div class="absolute inset-0 bg-gradient-to-t from-black/80 via-black/40 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300 flex items-end justify-center pb-4 gap-2">
                            <button data-action="preview" data-index="${generatedImages.length - 1}" class="bg-white/90 hover:bg-white text-gray-800 px-4 py-2 rounded-full font-semibold shadow-lg transition-all duration-200 hover:scale-105 flex items-center gap-2 text-sm">
                                <i class="fas fa-eye"></i>
                                <span class="hidden sm:inline">Preview</span>
                            </button>
                            <button data-action="download" data-index="${generatedImages.length - 1}" class="bg-gradient-to-r from-emerald-500 to-emerald-600 hover:from-emerald-600 hover:to-emerald-700 text-white px-4 py-2 rounded-full font-semibold shadow-lg transition-all duration-200 hover:scale-105 flex items-center gap-2 text-sm">
                                <i class="fas fa-download"></i>
                                <span class="hidden sm:inline">Download</span>
                            </button>
                        </div>
                    `;
                }
            } catch (error) {
                console.error(`Error generating background removal ${index}:`, error);
                const card = document.getElementById(`bgremover-card-${index}`);
                if (card) {
                    card.innerHTML = `
                        <div class="w-full h-full flex flex-col items-center justify-center bg-red-50 p-4">
                            <i class="fas fa-exclamation-circle text-red-500 text-3xl mb-2"></i>
                            <p class="text-red-600 text-xs text-center">Gagal generate</p>
                            <p class="text-red-500 text-xs text-center mt-1">${error.message}</p>
                        </div>
                    `;
                }
            }
        }

        // Event delegation for action buttons
        bgremoverResultsGrid.addEventListener('click', async (e) => {
            e.stopPropagation();

            const actionBtn = e.target.closest('[data-action]');
            if (!actionBtn) return;

            const action = actionBtn.dataset.action;
            const index = parseInt(actionBtn.dataset.index);
            const imageData = generatedImages[index];

            if (!imageData) return;

            if (action === 'preview') {
                if (window.showPreviewModal) {
                    window.showPreviewModal(imageData.url);
                } else {
                    window.open(imageData.url, '_blank');
                }
            } else if (action === 'download') {
                if (window.downloadDataURINew) {
                    await window.downloadDataURINew(imageData.url, imageData.filename);
                } else if (window.downloadImage) {
                    await window.downloadImage(imageData.url, imageData.filename);
                }
            }
        });

        // Download all button
        bgremoverDownloadAllBtn.addEventListener('click', async (e) => {
            e.stopPropagation();

            if (generatedImages.length === 0) return;

            bgremoverDownloadAllBtn.disabled = true;
            const originalHTML = bgremoverDownloadAllBtn.innerHTML;
            bgremoverDownloadAllBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i><span>Downloading...</span>';

            for (let i = 0; i < generatedImages.length; i++) {
                const img = generatedImages[i];
                if (window.downloadDataURINew) {
                    await window.downloadDataURINew(img.url, img.filename);
                } else if (window.downloadImage) {
                    await window.downloadImage(img.url, img.filename);
                }
                await new Promise(resolve => setTimeout(resolve, 500));
            }

            bgremoverDownloadAllBtn.innerHTML = '<i class="fas fa-check mr-2"></i><span>Selesai!</span>';
            setTimeout(() => {
                bgremoverDownloadAllBtn.disabled = false;
                bgremoverDownloadAllBtn.innerHTML = originalHTML;
            }, 2000);
        });
    })();

    // ==================== PHOTO EXTENDER ====================
    (function() {
        const apiKey = "";

        // Element references
        const extenderInput = document.getElementById('extender-input');
        const extenderUploadBox = document.getElementById('extender-upload-box');
        const extenderPreview = document.getElementById('extender-preview');
        const extenderPlaceholder = document.getElementById('extender-placeholder');
        const extenderRemoveBtn = document.getElementById('extender-remove-btn');
        const extenderGenerateBtn = document.getElementById('extender-generate-btn');
        const extenderResultsGrid = document.getElementById('extender-results-grid');
        const extenderDownloadAllBtn = document.getElementById('extender-download-all-btn');

        // Mobile preview elements
        const extenderPreviewContainer = document.getElementById('extender-preview-container');
        const extenderImagePreview = document.getElementById('extender-image-preview');
        const extenderRemovePreview = document.getElementById('extender-remove-preview');

        let originalImageData = null;
        let selectedDirection = 'all';
        let selectedAspectRatio = '16:9';
        let selectedCount = 4;
        let generatedImages = [];

        // Setup option buttons using helper function for mobile compatibility
        const directionOptions = document.getElementById('extender-direction-options');
        const ratioOptions = document.getElementById('extender-ratio-options');
        const countOptions = document.getElementById('extender-count-options');

        setupOptionButtonsNew(directionOptions);
        setupOptionButtonsNew(ratioOptions);
        setupOptionButtonsNew(countOptions);

        // Listen to direction changes
        directionOptions.addEventListener('click', (e) => {
            const btn = e.target.closest('[data-value]');
            if (btn) {
                selectedDirection = btn.dataset.value;
                console.log('Direction selected:', selectedDirection);
            }
        });

        // Listen to ratio changes
        ratioOptions.addEventListener('click', (e) => {
            const btn = e.target.closest('[data-value]');
            if (btn) {
                selectedAspectRatio = btn.dataset.value;
                console.log('Aspect ratio selected:', selectedAspectRatio);
            }
        });

        // Listen to count changes
        countOptions.addEventListener('click', (e) => {
            const btn = e.target.closest('[data-value]');
            if (btn) {
                selectedCount = parseInt(btn.dataset.value, 10);
                console.log('Count selected:', selectedCount);
            }
        });

        // Setup image upload with HEIC support (using helper function for mobile compatibility)
        setupImageUploadNew(extenderInput, extenderUploadBox, (data) => {
            originalImageData = data.dataUrl;
            extenderPreview.src = data.dataUrl;
            extenderPreview.classList.remove('hidden');
            extenderPlaceholder.classList.add('hidden');
            extenderRemoveBtn.classList.remove('hidden');
            extenderGenerateBtn.disabled = false;

            // Show mobile preview
            if (extenderImagePreview && extenderPreviewContainer) {
                extenderImagePreview.src = data.dataUrl;
                extenderPreviewContainer.classList.remove('hidden');
            }
        });

        // Remove button
        extenderRemoveBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            originalImageData = null;
            extenderInput.value = '';
            extenderPreview.src = '';
            extenderPreview.classList.add('hidden');
            extenderPlaceholder.classList.remove('hidden');
            extenderRemoveBtn.classList.add('hidden');
            extenderGenerateBtn.disabled = true;
            extenderResultsGrid.innerHTML = '';
            generatedImages = [];
            extenderDownloadAllBtn.classList.add('hidden');

            // Hide mobile preview
            if (extenderPreviewContainer && extenderImagePreview) {
                extenderPreviewContainer.classList.add('hidden');
                extenderImagePreview.src = '';
            }
        });

        // Mobile remove preview button
        if (extenderRemovePreview) {
            extenderRemovePreview.addEventListener('click', (e) => {
                e.stopPropagation();
                originalImageData = null;
                extenderInput.value = '';
                extenderPreview.src = '';
                extenderPreview.classList.add('hidden');
                extenderPlaceholder.classList.remove('hidden');
                extenderRemoveBtn.classList.add('hidden');
                extenderGenerateBtn.disabled = true;
                extenderResultsGrid.innerHTML = '';
                generatedImages = [];
                extenderDownloadAllBtn.classList.add('hidden');

                // Hide mobile preview
                if (extenderPreviewContainer && extenderImagePreview) {
                    extenderPreviewContainer.classList.add('hidden');
                    extenderImagePreview.src = '';
                }
            });
        }

        // Generate button
        extenderGenerateBtn.addEventListener('click', async () => {
            if (!originalImageData) {
                alert('Silakan upload foto terlebih dahulu');
                return;
            }

            extenderGenerateBtn.disabled = true;
            extenderGenerateBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Membuat...';
            extenderResultsGrid.innerHTML = '';
            generatedImages = [];
            extenderDownloadAllBtn.classList.add('hidden');

            // Show results container, hide placeholder
            const resultsPlaceholder = document.getElementById('extender-results-placeholder');
            const resultsContainer = document.getElementById('extender-results-container');
            if (resultsPlaceholder) resultsPlaceholder.classList.add('hidden');
            if (resultsContainer) resultsContainer.classList.remove('hidden');

            // Create placeholder cards
            for (let i = 1; i <= selectedCount; i++) {
                const card = document.createElement('div');
                card.id = `extender-card-${i}`;
                card.className = 'relative group rounded-xl overflow-hidden bg-gray-100 flex items-center justify-center aspect-video';
                card.innerHTML = '<div class="animate-spin rounded-full h-10 w-10 border-b-2 border-sky-600"></div>';
                extenderResultsGrid.appendChild(card);
            }

            // Generate all images in parallel
            const generationPromises = Array.from({ length: selectedCount }, (_, i) =>
                generateSingleImage(i + 1)
            );
            await Promise.allSettled(generationPromises);

            extenderGenerateBtn.disabled = false;
            extenderGenerateBtn.innerHTML = '<i class="fas fa-expand-arrows-alt mr-2"></i>Perluas Foto';

            if (generatedImages.length > 0) {
                extenderDownloadAllBtn.classList.remove('hidden');
            }
        });

        async function generateSingleImage(index) {
            try {
                const base64Data = originalImageData.split(',')[1];

                // Build direction instruction
                let directionInstruction = '';
                switch(selectedDirection) {
                    case 'all':
                        directionInstruction = 'Extend the image in ALL directions (top, bottom, left, right) to expand the scene comprehensively';
                        break;
                    case 'horizontal':
                        directionInstruction = 'Extend the image HORIZONTALLY (left and right sides) to widen the scene';
                        break;
                    case 'vertical':
                        directionInstruction = 'Extend the image VERTICALLY (top and bottom) to make the scene taller';
                        break;
                    case 'left':
                        directionInstruction = 'Extend the image to the LEFT side only, adding more content on the left';
                        break;
                    case 'right':
                        directionInstruction = 'Extend the image to the RIGHT side only, adding more content on the right';
                        break;
                    case 'top':
                        directionInstruction = 'Extend the image to the TOP only, adding more content above';
                        break;
                    case 'bottom':
                        directionInstruction = 'Extend the image to the BOTTOM only, adding more content below';
                        break;
                }

                const prompt = `Create a photorealistic image that expands this scene to a ${selectedAspectRatio} aspect ratio.

DIRECTION: ${directionInstruction}

CRITICAL REQUIREMENTS:
1. Keep ALL visible content from the original photo EXACTLY as shown - preserve faces, objects, colors, details
2. The original scene must remain the focal point and stay perfectly recognizable
3. Expand the scene naturally by adding complementary content in the specified direction
4. Match the original photo's style, lighting, colors, and atmosphere PERFECTLY
5. Ensure seamless blending - no visible borders, seams, or discontinuities
6. Maintain consistent perspective, depth, and 3D spatial relationships
7. Continue any patterns, textures, or architectural elements logically
8. If objects/people are partially visible at edges, complete them naturally
9. Keep the same level of photorealism and detail throughout

STYLE & QUALITY:
- Exact color palette match (temperature, saturation, contrast)
- Same lighting direction and intensity
- Identical photographic quality and sharpness
- Consistent artistic style (maintain realism level)
- Continue weather/atmosphere (indoor/outdoor, lighting conditions)

CONTENT GUIDELINES:
- Landscapes: naturally extend terrain, sky, vegetation, water, horizon
- Interiors: logically expand room space, walls, floors, furniture, decorations
- Portraits: appropriately expand background setting and environment
- Products/Objects: show more surrounding context and environment
- Architecture: complete building structures and surroundings realistically
- Urban scenes: add consistent cityscape elements (buildings, streets, vehicles)

OUTPUT: Generate in ${selectedAspectRatio} aspect ratio with the original content preserved in its natural position, expanded seamlessly in the specified direction.

Important: This should look like ONE cohesive photograph, not a composite. The expansion should be so natural that viewers cannot identify where the original ends.`;

                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-image-preview:generateContent?key=${apiKey}`;

                const payload = {
                    contents: [{
                        parts: [
                            { text: prompt },
                            { inlineData: { mimeType: "image/png", data: base64Data } }
                        ]
                    }],
                    generationConfig: {
                        responseModalities: ['IMAGE'],
                        imageConfig: {
                            aspectRatio: selectedAspectRatio
                        }
                    }
                };

                console.log('Photo Extender - Sending request with:', {
                    direction: selectedDirection,
                    aspectRatio: selectedAspectRatio,
                    index: index
                });

                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    const errorText = await response.text();
                    console.error('API Error Response:', errorText);
                    throw new Error(`HTTP error! status: ${response.status} - ${errorText}`);
                }

                const result = await response.json();
                console.log('Photo Extender API Response:', JSON.stringify(result, null, 2));

                // Try multiple paths to find image data
                let imageData = null;

                // Method 1: Standard inline data path
                if (result?.candidates?.[0]?.content?.parts) {
                    const parts = result.candidates[0].content.parts;
                    const imagePart = parts.find(part => part.inlineData);
                    if (imagePart?.inlineData?.data) {
                        imageData = imagePart.inlineData.data;
                        console.log('Found image data via Method 1 (inlineData)');
                    }
                }

                // Method 2: Direct inline data
                if (!imageData && result?.inlineData?.data) {
                    imageData = result.inlineData.data;
                    console.log('Found image data via Method 2 (direct inlineData)');
                }

                // Method 3: Image URL
                if (!imageData && result?.candidates?.[0]?.content?.parts?.[0]?.image?.url) {
                    const imageUrl = result.candidates[0].content.parts[0].image.url;
                    console.log('Found image URL, attempting to fetch:', imageUrl);
                    // Convert URL to base64
                    try {
                        const imgResponse = await fetch(imageUrl);
                        const blob = await imgResponse.blob();
                        imageData = await new Promise((resolve) => {
                            const reader = new FileReader();
                            reader.onloadend = () => resolve(reader.result.split(',')[1]);
                            reader.readAsDataURL(blob);
                        });
                        console.log('Successfully converted URL to base64');
                    } catch (urlError) {
                        console.error('Failed to fetch image from URL:', urlError);
                    }
                }

                if (!imageData) {
                    console.error('Complete API Response:', result);
                    console.error('Available response paths:', {
                        hasCandidates: !!result?.candidates,
                        candidatesLength: result?.candidates?.length,
                        firstCandidate: result?.candidates?.[0],
                        parts: result?.candidates?.[0]?.content?.parts
                    });
                    throw new Error('No image data in response. Photo extension may not be supported by this model. Check console for details.');
                }

                const imageUrl = `data:image/png;base64,${imageData}`;
                const filename = `photo-extended-${Date.now()}-${index}.png`;

                generatedImages.push({ url: imageUrl, filename: filename });

                // Update card with image
                const card = document.getElementById(`extender-card-${index}`);
                if (card) {
                    card.innerHTML = `
                        <img src="${imageUrl}" class="w-full h-full object-cover" alt="Extended Photo ${index}">
                        <div class="absolute inset-0 bg-gradient-to-t from-black/80 via-black/40 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300 flex items-end justify-center pb-4 gap-2">
                            <button data-action="preview" data-index="${generatedImages.length - 1}" class="action-btn bg-white/90 hover:bg-white text-gray-800 px-4 py-2 rounded-full font-semibold shadow-lg transition-all duration-200 hover:scale-105 flex items-center gap-2">
                                <i class="fas fa-eye"></i>
                                <span class="hidden sm:inline">Preview</span>
                            </button>
                            <button data-action="download" data-index="${generatedImages.length - 1}" class="action-btn bg-gradient-to-r from-sky-500 to-sky-600 hover:from-sky-600 hover:to-sky-700 text-white px-4 py-2 rounded-full font-semibold shadow-lg transition-all duration-200 hover:scale-105 flex items-center gap-2">
                                <i class="fas fa-download"></i>
                                <span class="hidden sm:inline">Download</span>
                            </button>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('Error generating extended image:', error);
                const card = document.getElementById(`extender-card-${index}`);
                if (card) {
                    card.innerHTML = `
                        <div class="text-center text-red-500 p-4">
                            <i class="fas fa-exclamation-circle text-3xl mb-2"></i>
                            <p class="text-sm">Gagal membuat gambar</p>
                        </div>
                    `;
                }
            }
        }

        // Event delegation for action buttons
        extenderResultsGrid.addEventListener('click', async (e) => {
            e.stopPropagation();

            const actionBtn = e.target.closest('[data-action]');
            if (!actionBtn) return;

            const action = actionBtn.dataset.action;
            const index = parseInt(actionBtn.dataset.index, 10);
            const imageData = generatedImages[index];

            if (action === 'preview') {
                if (window.showPreviewModal) {
                    window.showPreviewModal(imageData.url);
                } else {
                    window.open(imageData.url, '_blank');
                }
            } else if (action === 'download') {
                if (window.downloadDataURINew) {
                    await window.downloadDataURINew(imageData.url, imageData.filename);
                } else if (window.downloadImage) {
                    await window.downloadImage(imageData.url, imageData.filename);
                }
            }
        });

        // Download All button
        extenderDownloadAllBtn.addEventListener('click', async (e) => {
            e.stopPropagation();

            // Prevent multiple clicks
            if (generatedImages.length === 0 || extenderDownloadAllBtn.disabled) return;

            const originalHTML = extenderDownloadAllBtn.innerHTML;
            extenderDownloadAllBtn.disabled = true;

            try {
                for (let i = 0; i < generatedImages.length; i++) {
                    const img = generatedImages[i];
                    extenderDownloadAllBtn.innerHTML = `<i class="fas fa-spinner fa-spin mr-2"></i><span>Downloading ${i + 1}/${generatedImages.length}...</span>`;

                    try {
                        if (window.downloadDataURINew) {
                            await window.downloadDataURINew(img.url, img.filename);
                        } else if (window.downloadImage) {
                            await window.downloadImage(img.url, img.filename);
                        }
                        await new Promise(resolve => setTimeout(resolve, 500));
                    } catch (error) {
                        console.error(`Error downloading image ${i + 1}:`, error);
                        // Continue with next image even if one fails
                    }
                }

                extenderDownloadAllBtn.innerHTML = '<i class="fas fa-check mr-2"></i><span>Selesai!</span>';
                setTimeout(() => {
                    extenderDownloadAllBtn.disabled = false;
                    extenderDownloadAllBtn.innerHTML = originalHTML;
                }, 2000);
            } catch (error) {
                console.error('Download all error:', error);
                extenderDownloadAllBtn.innerHTML = '<i class="fas fa-times mr-2"></i><span>Error</span>';
                setTimeout(() => {
                    extenderDownloadAllBtn.disabled = false;
                    extenderDownloadAllBtn.innerHTML = originalHTML;
                }, 2000);
            }
        });
    })();

    // ==================== STORY BOARD ====================
    (function() {
        const apiKey = "";

        // Element references
        const topicInput = document.getElementById('storyboard-topic');
        const generateBtn = document.getElementById('storyboard-generate-btn');
        const resultsGrid = document.getElementById('storyboard-results-grid');
        const downloadAllBtn = document.getElementById('storyboard-download-all-btn');

        // Modal elements
        const regenerateModal = document.getElementById('storyboard-regenerate-modal');
        const modalClose = document.getElementById('storyboard-modal-close');
        const modalCancel = document.getElementById('storyboard-modal-cancel');
        const modalRegenerateBtn = document.getElementById('storyboard-modal-regenerate');
        const modalPrompt = document.getElementById('storyboard-modal-prompt');
        const modalFrameNumber = document.getElementById('storyboard-modal-frame-number');
        const modalFrameText = document.getElementById('storyboard-modal-frame-text');
        const modalPreviewContainer = document.getElementById('storyboard-modal-preview-container');
        const modalPreviewImg = document.getElementById('storyboard-modal-preview-img');

        let selectedStoryType = 'social-media';
        let selectedFrameCount = 5;
        let selectedVisualStyle = 'sketch';
        let selectedLanguage = 'indonesian';
        let generatedImages = [];
        let sceneDescriptions = []; // Store scene descriptions for regeneration
        let currentRegenerateIndex = -1; // Track which frame is being regenerated

        // Story type buttons
        const storyTypeButtons = document.querySelectorAll('#content-story-board .option-btn-storyboard[data-value]');
        storyTypeButtons.forEach(btn => {
            // Check if it's a story type button (in step 2)
            if (btn.closest('div').previousElementSibling?.textContent?.includes('Tipe Story')) {
                btn.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();

                    const parent = this.closest('div');
                    parent.querySelectorAll('.option-btn-storyboard').forEach(b => b.classList.remove('selected'));
                    this.classList.add('selected');
                    selectedStoryType = this.dataset.value;
                });
            }
            // Check if it's a frame count button (in step 3)
            else if (btn.closest('div').previousElementSibling?.textContent?.includes('Jumlah Frame')) {
                btn.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();

                    const parent = this.closest('div');
                    parent.querySelectorAll('.option-btn-storyboard').forEach(b => b.classList.remove('selected'));
                    this.classList.add('selected');
                    selectedFrameCount = parseInt(this.dataset.value, 10);
                });
            }
            // Check if it's a visual style button (in step 4)
            else if (btn.closest('div').previousElementSibling?.textContent?.includes('Style Visual')) {
                btn.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();

                    const parent = this.closest('div');
                    parent.querySelectorAll('.option-btn-storyboard').forEach(b => b.classList.remove('selected'));
                    this.classList.add('selected');
                    selectedVisualStyle = this.dataset.value;
                });
            }
            // Check if it's a language button (in step 5)
            else if (btn.closest('div').previousElementSibling?.textContent?.includes('Bahasa Deskripsi')) {
                btn.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();

                    const parent = this.closest('div');
                    parent.querySelectorAll('.option-btn-storyboard').forEach(b => b.classList.remove('selected'));
                    this.classList.add('selected');
                    selectedLanguage = this.dataset.value;
                });
            }
        });

        // Generate button
        generateBtn.addEventListener('click', async () => {
            const topic = topicInput.value.trim();

            if (!topic) {
                alert('Silakan masukkan topik story terlebih dahulu');
                return;
            }

            generateBtn.disabled = true;
            generateBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Membuat Storyboard...';
            resultsGrid.innerHTML = '';
            generatedImages = [];
            sceneDescriptions = []; // Reset scene descriptions
            downloadAllBtn.classList.add('hidden');

            try {
                // Step 1: Generate scene descriptions
                sceneDescriptions = await generateSceneDescriptions(topic);

                if (!sceneDescriptions || sceneDescriptions.length === 0) {
                    throw new Error('Failed to generate scene descriptions');
                }

                // Step 2: Create placeholder cards
                for (let i = 0; i < selectedFrameCount; i++) {
                    const card = document.createElement('div');
                    card.id = `storyboard-card-${i + 1}`;
                    card.className = 'relative rounded-xl overflow-hidden bg-gradient-to-br from-purple-50 to-violet-50 border-2 border-purple-200';
                    card.innerHTML = `
                        <div class="aspect-video bg-gray-100 flex items-center justify-center">
                            <div class="animate-spin rounded-full h-10 w-10 border-b-2 border-purple-600"></div>
                        </div>
                        <div class="p-3 bg-white border-t-2 border-purple-100">
                            <div class="flex items-center gap-2 mb-2">
                                <div class="w-6 h-6 rounded-full bg-gradient-to-br from-purple-500 to-violet-600 text-white text-xs font-bold flex items-center justify-center">${i + 1}</div>
                                <span class="text-xs font-semibold text-gray-700">Frame ${i + 1}</span>
                            </div>
                            <p class="text-xs text-gray-600 line-clamp-2">${sceneDescriptions[i] || 'Generating...'}</p>
                        </div>
                    `;
                    resultsGrid.appendChild(card);
                }

                // Step 3: Generate images in parallel
                const generationPromises = sceneDescriptions.map((description, index) =>
                    generateFrameImage(index + 1, description)
                );
                await Promise.allSettled(generationPromises);

                generateBtn.disabled = false;
                generateBtn.innerHTML = '<i class="fas fa-film mr-2"></i>Generate Story Board';

                if (generatedImages.length > 0) {
                    downloadAllBtn.classList.remove('hidden');
                }
            } catch (error) {
                console.error('Error generating storyboard:', error);
                alert('Terjadi kesalahan saat membuat storyboard. Silakan coba lagi.');
                generateBtn.disabled = false;
                generateBtn.innerHTML = '<i class="fas fa-film mr-2"></i>Generate Story Board';
            }
        });

        async function generateSceneDescriptions(topic) {
            try {
                // Map story types to descriptions
                const storyTypeDescriptions = {
                    'social-media': 'Social media story (Instagram/TikTok format, engaging and trendy)',
                    'video-content': 'Video content (YouTube/Vlog style, informative and entertaining)',
                    'film-scene': 'Film scene (Cinematic, dramatic, with proper shot composition)',
                    'tutorial': 'Tutorial video (Step-by-step, educational, clear instructions)',
                    'marketing': 'Marketing campaign (Persuasive, brand-focused, call-to-action)',
                    'product-demo': 'Product demonstration (Feature showcase, benefits-focused)',
                    'event': 'Event coverage (Documentary style, capturing key moments)',
                    'animation': 'Animation sequence (Creative, expressive, story-driven)'
                };

                const languageInstruction = selectedLanguage === 'indonesian'
                    ? 'Write all descriptions in Bahasa Indonesia (Indonesian language).'
                    : 'Write all descriptions in English language.';

                const prompt = `You are creating a visual storyboard about: "${topic}"

MAIN TOPIC: "${topic}" - Every frame MUST directly relate to this topic!

Story Type: ${storyTypeDescriptions[selectedStoryType]}
Visual Style: ${selectedVisualStyle}
Number of Frames: ${selectedFrameCount}
${languageInstruction}

TASK:
Create ${selectedFrameCount} connected visual scenes that tell ONE complete story about "${topic}".
The story should flow naturally from beginning to end, with each frame continuing from the previous one.

REQUIREMENTS:
1. ALL frames must be about the SAME topic: "${topic}"
2. Create EXACTLY ${selectedFrameCount} scenes (no more, no less)
3. Each scene: 2-3 sentences with visual details (camera angle, subject, action, background, mood)
4. Scenes must connect: Frame 2 continues from Frame 1, Frame 3 from Frame 2, etc.
5. Story structure: Beginning (frames 1-${Math.ceil(selectedFrameCount/3)}) ‚Üí Middle (frames ${Math.ceil(selectedFrameCount/3)+1}-${Math.ceil(selectedFrameCount*2/3)}) ‚Üí End (frames ${Math.ceil(selectedFrameCount*2/3)+1}-${selectedFrameCount})

FORMAT (copy this exactly):
${Array.from({ length: selectedFrameCount }, (_, i) => {
    const frameNum = i + 1;
    return frameNum === 1
        ? `Frame 1: [Your description here - 2-3 sentences about ${topic}]`
        : `Frame ${frameNum}: [Your description here - 2-3 sentences continuing the ${topic} story]`;
}).join('\n')}

Remember: EVERY frame must be directly about "${topic}". Start creating the ${selectedFrameCount} frames now:`;

                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

                // Calculate appropriate token limit based on frame count
                // ~200 tokens per frame description for efficiency
                // For 20 frames: 20 * 200 = 4000 tokens (fits in 4096 limit)
                const tokensPerFrame = 200;
                const minTokens = selectedFrameCount * tokensPerFrame;
                const maxOutputTokens = Math.max(2048, Math.min(minTokens + 500, 8192));

                console.log(`Generating ${selectedFrameCount} frames with max ${maxOutputTokens} tokens`);

                const payload = {
                    contents: [{
                        parts: [{ text: prompt }]
                    }],
                    generationConfig: {
                        temperature: 0.9,
                        maxOutputTokens: maxOutputTokens
                    }
                };

                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const result = await response.json();
                const text = result?.candidates?.[0]?.content?.parts?.[0]?.text;

                if (!text) {
                    throw new Error('No text in response');
                }

                console.log('Raw API response:', text);

                // Parse frame descriptions with improved multi-line handling
                const frames = [];
                const frameRegex = /Frame (\d+):\s*(.*?)(?=\n\s*Frame \d+:|$)/gis;
                const matches = [...text.matchAll(frameRegex)];

                console.log(`Found ${matches.length} frame matches in response`);

                for (const match of matches) {
                    const frameNum = parseInt(match[1]);
                    let description = match[2].trim();

                    // Clean up the description
                    description = description
                        .replace(/\n+/g, ' ') // Replace newlines with spaces
                        .replace(/\s+/g, ' ')  // Normalize whitespace
                        .trim();

                    if (description) {
                        frames.push(description);
                        console.log(`Frame ${frameNum}: ${description.substring(0, 100)}...`);
                    }
                }

                // Fallback: if regex parsing fails, try line-by-line parsing
                if (frames.length === 0) {
                    console.log('Regex parsing failed, trying line-by-line...');
                    const lines = text.split('\n');
                    let currentDescription = '';

                    for (const line of lines) {
                        if (line.match(/^Frame \d+:/i)) {
                            if (currentDescription) {
                                frames.push(currentDescription.trim());
                            }
                            currentDescription = line.replace(/^Frame \d+:/i, '').trim();
                        } else if (line.trim() && currentDescription) {
                            currentDescription += ' ' + line.trim();
                        }
                    }

                    if (currentDescription) {
                        frames.push(currentDescription.trim());
                    }
                }

                console.log(`Total frames parsed: ${frames.length}, Expected: ${selectedFrameCount}`);

                // Validate and ensure we have exactly the right number of frames
                if (frames.length < selectedFrameCount) {
                    console.warn(`Warning: Only ${frames.length} frames parsed, expected ${selectedFrameCount}`);
                    // Fill missing frames with placeholder
                    while (frames.length < selectedFrameCount) {
                        frames.push(`Continuation of scene ${frames.length} - Scene ${frames.length + 1} of the story`);
                    }
                } else if (frames.length > selectedFrameCount) {
                    console.log(`Trimming ${frames.length - selectedFrameCount} extra frames`);
                }

                return frames.slice(0, selectedFrameCount);
            } catch (error) {
                console.error('Error generating scene descriptions:', error);
                // Return default descriptions as fallback
                return Array.from({ length: selectedFrameCount }, (_, i) =>
                    `Scene ${i + 1}: Visual representation of the story`
                );
            }
        }

        async function generateFrameImage(frameNumber, sceneDescription) {
            try {
                // Map visual styles to style descriptions
                const styleDescriptions = {
                    'sketch': 'hand-drawn sketch style, pencil lines, storyboard sketch, black and white or minimal color',
                    'realistic': 'photorealistic style, detailed and lifelike, professional photography quality',
                    'cartoon': 'cartoon illustration style, vibrant colors, expressive and fun',
                    'minimalist': 'minimalist design, simple shapes, clean lines, limited color palette',
                    'cinematic': 'cinematic film still, dramatic lighting, movie-quality composition',
                    'comic': 'comic book style, bold outlines, dynamic panels, graphic novel aesthetic'
                };

                const prompt = `Create a storyboard frame in ${styleDescriptions[selectedVisualStyle]}.

Scene Description: ${sceneDescription}

CRITICAL REQUIREMENTS FOR STORYBOARD FRAME:
1. Visualize the scene exactly as described
2. Apply ${selectedVisualStyle} style consistently
3. Clear composition suitable for storyboarding
4. Include visual storytelling elements
5. Frame should be self-contained but part of a sequence
6. Professional storyboard quality
7. Aspect ratio: 16:9 (landscape format suitable for video storyboard)

${selectedVisualStyle === 'sketch' ?
    'Create in hand-drawn storyboard sketch style with clear pencil lines, annotations, and professional storyboard appearance.' :
    'Create in the specified visual style with high quality and clarity.'}`;

                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-image-preview:generateContent?key=${apiKey}`;

                const payload = {
                    contents: [{
                        parts: [{ text: prompt }]
                    }],
                    generationConfig: {
                        responseModalities: ['IMAGE'],
                        imageConfig: {
                            aspectRatio: '16:9'
                        }
                    }
                };

                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const result = await response.json();
                const imageData = result?.candidates?.[0]?.content?.parts?.find(part => part.inlineData)?.inlineData?.data;

                if (!imageData) {
                    throw new Error('No image data in response');
                }

                const imageUrl = `data:image/png;base64,${imageData}`;
                const filename = `storyboard-frame-${frameNumber}-${Date.now()}.png`;

                generatedImages.push({ url: imageUrl, filename: filename, description: sceneDescription });

                // Update card with image
                const card = document.getElementById(`storyboard-card-${frameNumber}`);
                if (card) {
                    card.innerHTML = `
                        <div class="relative group">
                            <img src="${imageUrl}" class="w-full aspect-video object-cover" alt="Frame ${frameNumber}">
                            <div class="absolute inset-0 bg-gradient-to-t from-black/80 via-black/40 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300 flex flex-col items-center justify-center gap-2 p-3">
                                <div class="flex gap-2">
                                    <button data-action="preview" data-index="${generatedImages.length - 1}" class="action-btn bg-white/90 hover:bg-white text-gray-800 px-3 py-2 rounded-full font-semibold shadow-lg transition-all duration-200 hover:scale-105 flex items-center gap-2 text-sm">
                                        <i class="fas fa-eye"></i>
                                        <span class="hidden sm:inline">Preview</span>
                                    </button>
                                    <button data-action="download" data-index="${generatedImages.length - 1}" class="action-btn bg-gradient-to-r from-purple-500 to-violet-600 hover:from-purple-600 hover:to-violet-700 text-white px-3 py-2 rounded-full font-semibold shadow-lg transition-all duration-200 hover:scale-105 flex items-center gap-2 text-sm">
                                        <i class="fas fa-download"></i>
                                        <span class="hidden sm:inline">Download</span>
                                    </button>
                                </div>
                                <button data-action="regenerate" data-index="${generatedImages.length - 1}" data-frame="${frameNumber}" class="action-btn bg-gradient-to-r from-orange-500 to-amber-600 hover:from-orange-600 hover:to-amber-700 text-white px-4 py-2 rounded-full font-semibold shadow-lg transition-all duration-200 hover:scale-105 flex items-center gap-2 text-sm w-full sm:w-auto">
                                    <i class="fas fa-sync-alt"></i>
                                    <span>Regenerate</span>
                                </button>
                            </div>
                        </div>
                        <div class="p-3 bg-white border-t-2 border-purple-100">
                            <div class="flex items-center justify-between gap-2 mb-2">
                                <div class="flex items-center gap-2">
                                    <div class="w-6 h-6 rounded-full bg-gradient-to-br from-purple-500 to-violet-600 text-white text-xs font-bold flex items-center justify-center">${frameNumber}</div>
                                    <span class="text-xs font-semibold text-gray-700">Frame ${frameNumber}</span>
                                </div>
                                <button data-action="edit-prompt" data-index="${generatedImages.length - 1}" data-frame="${frameNumber}" class="action-btn text-purple-600 hover:text-purple-800 transition-colors" title="Edit Prompt">
                                    <i class="fas fa-edit text-sm"></i>
                                </button>
                            </div>
                            <p class="text-xs text-gray-600 line-clamp-3">${sceneDescription}</p>
                        </div>
                    `;
                }
            } catch (error) {
                console.error(`Error generating frame ${frameNumber}:`, error);
                const card = document.getElementById(`storyboard-card-${frameNumber}`);
                if (card) {
                    card.innerHTML = `
                        <div class="aspect-video bg-red-50 flex items-center justify-center">
                            <div class="text-center text-red-500 p-4">
                                <i class="fas fa-exclamation-circle text-3xl mb-2"></i>
                                <p class="text-sm">Gagal membuat frame</p>
                            </div>
                        </div>
                        <div class="p-3 bg-white border-t-2 border-red-100">
                            <div class="flex items-center gap-2 mb-2">
                                <div class="w-6 h-6 rounded-full bg-red-500 text-white text-xs font-bold flex items-center justify-center">${frameNumber}</div>
                                <span class="text-xs font-semibold text-red-700">Frame ${frameNumber} - Error</span>
                            </div>
                        </div>
                    `;
                }
            }
        }

        // Event delegation for action buttons
        resultsGrid.addEventListener('click', async (e) => {
            e.stopPropagation();

            const actionBtn = e.target.closest('[data-action]');
            if (!actionBtn) return;

            const action = actionBtn.dataset.action;
            const index = parseInt(actionBtn.dataset.index, 10);
            const imageData = generatedImages[index];

            if (action === 'preview') {
                if (window.showPreviewModal) {
                    window.showPreviewModal(imageData.url);
                } else {
                    window.open(imageData.url, '_blank');
                }
            } else if (action === 'download') {
                if (window.downloadDataURINew) {
                    await window.downloadDataURINew(imageData.url, imageData.filename);
                } else if (window.downloadImage) {
                    await window.downloadImage(imageData.url, imageData.filename);
                }
            } else if (action === 'regenerate' || action === 'edit-prompt') {
                // Open modal for editing prompt and regenerating
                const frameNumber = parseInt(actionBtn.dataset.frame, 10);
                currentRegenerateIndex = frameNumber - 1; // Store 0-based index

                // Set modal content
                modalFrameNumber.textContent = frameNumber;
                modalFrameText.textContent = frameNumber;
                modalPrompt.value = sceneDescriptions[currentRegenerateIndex] || '';

                // Show current image preview if exists
                if (imageData && imageData.url) {
                    modalPreviewImg.src = imageData.url;
                    modalPreviewContainer.classList.remove('hidden');
                } else {
                    modalPreviewContainer.classList.add('hidden');
                }

                // Show modal
                regenerateModal.classList.remove('hidden');
                modalPrompt.focus();
            }
        });

        // Download All button
        downloadAllBtn.addEventListener('click', async (e) => {
            e.stopPropagation();

            // Prevent multiple clicks
            if (generatedImages.length === 0 || downloadAllBtn.disabled) return;

            const originalHTML = downloadAllBtn.innerHTML;
            downloadAllBtn.disabled = true;

            try {
                for (let i = 0; i < generatedImages.length; i++) {
                    const img = generatedImages[i];
                    downloadAllBtn.innerHTML = `<i class="fas fa-spinner fa-spin mr-2"></i><span>Downloading ${i + 1}/${generatedImages.length}...</span>`;

                    try {
                        if (window.downloadDataURINew) {
                            await window.downloadDataURINew(img.url, img.filename);
                        } else if (window.downloadImage) {
                            await window.downloadImage(img.url, img.filename);
                        }
                        await new Promise(resolve => setTimeout(resolve, 500));
                    } catch (error) {
                        console.error(`Error downloading image ${i + 1}:`, error);
                        // Continue with next image even if one fails
                    }
                }

                downloadAllBtn.innerHTML = '<i class="fas fa-check mr-2"></i><span>Selesai!</span>';
                setTimeout(() => {
                    downloadAllBtn.disabled = false;
                    downloadAllBtn.innerHTML = originalHTML;
                }, 2000);
            } catch (error) {
                console.error('Download all error:', error);
                downloadAllBtn.innerHTML = '<i class="fas fa-times mr-2"></i><span>Error</span>';
                setTimeout(() => {
                    downloadAllBtn.disabled = false;
                    downloadAllBtn.innerHTML = originalHTML;
                }, 2000);
            }
        });

        // Modal close handlers
        function closeModal() {
            regenerateModal.classList.add('hidden');
            currentRegenerateIndex = -1;
            modalPrompt.value = '';
            modalPreviewContainer.classList.add('hidden');
        }

        modalClose.addEventListener('click', closeModal);
        modalCancel.addEventListener('click', closeModal);

        // Close modal when clicking outside
        regenerateModal.addEventListener('click', (e) => {
            if (e.target === regenerateModal) {
                closeModal();
            }
        });

        // Close modal with ESC key
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && !regenerateModal.classList.contains('hidden')) {
                closeModal();
            }
        });

        // Modal regenerate button
        modalRegenerateBtn.addEventListener('click', async () => {
            if (currentRegenerateIndex < 0 || currentRegenerateIndex >= selectedFrameCount) {
                alert('Invalid frame index');
                return;
            }

            const customPrompt = modalPrompt.value.trim();
            if (!customPrompt) {
                alert('Deskripsi scene tidak boleh kosong');
                modalPrompt.focus();
                return;
            }

            // Prevent double-click
            if (modalRegenerateBtn.disabled) return;

            // Show loading state
            const originalHTML = modalRegenerateBtn.innerHTML;
            modalRegenerateBtn.disabled = true;
            modalRegenerateBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Processing...';

            // Update scene description
            sceneDescriptions[currentRegenerateIndex] = customPrompt;

            // Close modal after a brief delay to show feedback
            setTimeout(() => {
                closeModal();
                modalRegenerateBtn.disabled = false;
                modalRegenerateBtn.innerHTML = originalHTML;
            }, 300);

            // Show loading state on the specific card
            const frameNumber = currentRegenerateIndex + 1;
            const card = document.getElementById(`storyboard-card-${frameNumber}`);
            if (card) {
                card.innerHTML = `
                    <div class="aspect-video bg-gradient-to-br from-purple-50 to-violet-50 flex items-center justify-center">
                        <div class="text-center">
                            <div class="animate-spin rounded-full h-10 w-10 border-b-2 border-purple-600 mx-auto mb-3"></div>
                            <p class="text-sm text-gray-600 font-semibold">Regenerating Frame ${frameNumber}...</p>
                        </div>
                    </div>
                    <div class="p-3 bg-white border-t-2 border-purple-100">
                        <div class="flex items-center gap-2 mb-2">
                            <div class="w-6 h-6 rounded-full bg-gradient-to-br from-purple-500 to-violet-600 text-white text-xs font-bold flex items-center justify-center">${frameNumber}</div>
                            <span class="text-xs font-semibold text-gray-700">Frame ${frameNumber}</span>
                        </div>
                        <p class="text-xs text-gray-600 line-clamp-2">${customPrompt}</p>
                    </div>
                `;
            }

            // Remove old image from generatedImages array
            const oldIndex = generatedImages.findIndex(img => img.filename.includes(`frame-${frameNumber}-`));
            if (oldIndex !== -1) {
                generatedImages.splice(oldIndex, 1);
            }

            // Regenerate the frame
            try {
                await generateFrameImage(frameNumber, customPrompt);
            } catch (error) {
                console.error('Error regenerating frame:', error);
                alert('Gagal regenerate frame. Silakan coba lagi.');
            }
        });
    })();

    // ==================== TWIBON ====================
    (function() {
        const apiKey = "";

        // Element references
        const photoInput = document.getElementById('twibon-input');
        const photoUploadBox = document.getElementById('twibon-upload-box');
        const photoPreview = document.getElementById('twibon-preview');
        const photoPlaceholder = document.getElementById('twibon-placeholder');
        const photoRemoveBtn = document.getElementById('twibon-remove-btn');

        const frameInput = document.getElementById('twibon-frame-input');
        const frameUploadBox = document.getElementById('twibon-frame-upload-box');
        const framePreview = document.getElementById('twibon-frame-preview');
        const framePlaceholder = document.getElementById('twibon-frame-placeholder');

        const descriptionInput = document.getElementById('twibon-description');
        const aiSection = document.getElementById('twibon-ai-section');
        const customSection = document.getElementById('twibon-custom-section');

        const generateBtn = document.getElementById('twibon-generate-btn');
        const downloadBtn = document.getElementById('twibon-download-btn');
        const resetBtn = document.getElementById('twibon-reset-btn');

        const canvas = document.getElementById('twibon-canvas');
        const ctx = canvas.getContext('2d');

        const previewContainer = document.getElementById('twibon-preview-container');
        const emptyState = document.getElementById('twibon-empty-state');

        const resultContainer = document.getElementById('twibon-result-container');
        const photoDisplay = document.getElementById('twibon-photo-display');
        const frameWrapper = document.getElementById('twibon-frame-wrapper');
        const frameDisplay = document.getElementById('twibon-frame-display');

        // Position controls
        const positionControls = document.getElementById('twibon-position-controls');
        const zoomSlider = document.getElementById('twibon-zoom-slider');
        const zoomValue = document.getElementById('twibon-zoom-value');
        const moveUpBtn = document.getElementById('twibon-move-up');
        const moveDownBtn = document.getElementById('twibon-move-down');
        const moveLeftBtn = document.getElementById('twibon-move-left');
        const moveRightBtn = document.getElementById('twibon-move-right');
        const resetPositionBtn = document.getElementById('twibon-reset-position');

        let userPhotoData = null;
        let customFrameData = null;
        let generatedFrameData = null;
        let selectedCategory = 'independence';
        let selectedStyle = 'elegant';
        let selectedAspectRatio = '1:1';

        // Photo positioning variables
        let photoScale = 1.0;
        let photoOffsetX = 0;
        let photoOffsetY = 0;
        let currentUserPhoto = null;  // Store loaded image
        let currentFrameImage = null; // Store loaded frame

        // Category buttons
        document.querySelectorAll('#content-twibon .option-btn-twibon[data-value]').forEach(btn => {
            if (btn.closest('div').previousElementSibling?.textContent?.includes('Kategori Frame')) {
                btn.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();

                    const parent = this.closest('div');
                    parent.querySelectorAll('.option-btn-twibon').forEach(b => b.classList.remove('selected'));
                    this.classList.add('selected');
                    selectedCategory = this.dataset.value;

                    // Toggle AI/Custom sections
                    if (selectedCategory === 'custom') {
                        aiSection.classList.add('hidden');
                        customSection.classList.remove('hidden');
                    } else {
                        aiSection.classList.remove('hidden');
                        customSection.classList.add('hidden');
                    }
                });
            }
            // Style buttons
            else if (btn.closest('div').previousElementSibling?.textContent?.includes('Style Frame')) {
                btn.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();

                    const parent = this.closest('div');
                    parent.querySelectorAll('.option-btn-twibon').forEach(b => b.classList.remove('selected'));
                    this.classList.add('selected');
                    selectedStyle = this.dataset.value;
                });
            }
            // Aspect ratio buttons
            else if (btn.closest('div').previousElementSibling?.textContent?.includes('Ukuran Frame')) {
                btn.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();

                    const parent = this.closest('div');
                    parent.querySelectorAll('.option-btn-twibon').forEach(b => b.classList.remove('selected'));
                    this.classList.add('selected');
                    selectedAspectRatio = this.dataset.value;

                    // Update result container aspect ratio
                    updateResultContainerAspectRatio();
                });
            }
        });

        function updateResultContainerAspectRatio() {
            if (!resultContainer) return;

            const aspectRatioMap = {
                '1:1': '1/1',
                '4:5': '4/5',
                '9:16': '9/16',
                '16:9': '16/9'
            };

            resultContainer.style.aspectRatio = aspectRatioMap[selectedAspectRatio] || '1/1';
        }

        // Upload photo
        photoUploadBox.addEventListener('click', () => {
            photoInput.click();
        });

        photoInput.addEventListener('change', async (e) => {
            const file = e.target.files[0];
            if (!file) return;

            let processedFile = file;

            // Convert HEIC to JPEG if needed
            if (file.type === 'image/heic' || file.name.toLowerCase().endsWith('.heic')) {
                try {
                    const convertedBlob = await heic2any({
                        blob: file,
                        toType: 'image/jpeg',
                        quality: 0.9
                    });
                    processedFile = new File([convertedBlob], file.name.replace(/\.heic$/i, '.jpg'), {
                        type: 'image/jpeg'
                    });
                } catch (err) {
                    console.error('HEIC conversion failed:', err);
                    alert('Gagal mengkonversi gambar HEIC. Silakan coba format lain.');
                    return;
                }
            }

            const reader = new FileReader();
            reader.onloadend = () => {
                userPhotoData = reader.result;
                photoPreview.src = reader.result;
                photoPreview.classList.remove('hidden');
                photoPlaceholder.classList.add('hidden');
                photoRemoveBtn.classList.remove('hidden');
                updateGenerateButtonState();
            };
            reader.readAsDataURL(processedFile);
        });

        // Remove photo
        photoRemoveBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            userPhotoData = null;
            photoInput.value = '';
            photoPreview.src = '';
            photoPreview.classList.add('hidden');
            photoPlaceholder.classList.remove('hidden');
            photoRemoveBtn.classList.add('hidden');

            // Hide position controls
            if (positionControls) {
                positionControls.classList.add('hidden');
            }

            // Reset position
            photoScale = 1.0;
            photoOffsetX = 0;
            photoOffsetY = 0;
            currentUserPhoto = null;
            currentFrameImage = null;

            updateGenerateButtonState();
        });

        // Upload custom frame
        frameUploadBox.addEventListener('click', () => {
            frameInput.click();
        });

        frameInput.addEventListener('change', async (e) => {
            const file = e.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onloadend = () => {
                customFrameData = reader.result;
                framePreview.src = reader.result;
                framePreview.classList.remove('hidden');
                framePlaceholder.classList.add('hidden');
            };
            reader.readAsDataURL(file);
        });

        // Position controls event handlers
        if (zoomSlider && zoomValue) {
            zoomSlider.addEventListener('input', (e) => {
                photoScale = parseInt(e.target.value) / 100;
                zoomValue.textContent = `${e.target.value}%`;
                updatePhotoTransform();
            });
        }

        if (moveUpBtn) {
            moveUpBtn.addEventListener('click', () => {
                photoOffsetY -= 20;
                updatePhotoTransform();
            });
        }

        if (moveDownBtn) {
            moveDownBtn.addEventListener('click', () => {
                photoOffsetY += 20;
                updatePhotoTransform();
            });
        }

        if (moveLeftBtn) {
            moveLeftBtn.addEventListener('click', () => {
                photoOffsetX -= 20;
                updatePhotoTransform();
            });
        }

        if (moveRightBtn) {
            moveRightBtn.addEventListener('click', () => {
                photoOffsetX += 20;
                updatePhotoTransform();
            });
        }

        if (resetPositionBtn) {
            resetPositionBtn.addEventListener('click', () => {
                photoScale = 1.0;
                photoOffsetX = 0;
                photoOffsetY = 0;
                if (zoomSlider) zoomSlider.value = 100;
                if (zoomValue) zoomValue.textContent = '100%';
                updatePhotoTransform();
            });
        }

        function updatePhotoTransform() {
            if (photoDisplay) {
                photoDisplay.style.transform = `scale(${photoScale}) translate(${photoOffsetX}px, ${photoOffsetY}px)`;
                photoDisplay.style.transformOrigin = 'center';
            }
        }

        function updateGenerateButtonState() {
            if (userPhotoData) {
                generateBtn.disabled = false;
            } else {
                generateBtn.disabled = true;
            }
        }

        // Generate button
        generateBtn.addEventListener('click', async () => {
            if (!userPhotoData) {
                alert('Silakan upload foto terlebih dahulu');
                return;
            }

            generateBtn.disabled = true;
            generateBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Generating...';

            try {
                // Step 1: Generate or use custom frame
                let frameImage;
                if (selectedCategory === 'custom' && customFrameData) {
                    // Use custom uploaded frame
                    frameImage = await loadImage(customFrameData);
                } else {
                    // Generate AI frame
                    const frameData = await generateAIFrame();
                    if (frameData) {
                        generatedFrameData = `data:image/png;base64,${frameData}`;
                        frameImage = await loadImage(generatedFrameData);
                    } else {
                        throw new Error('Failed to generate frame');
                    }
                }

                // Step 2: Display photo and frame
                console.log('Frame image loaded successfully');

                // Update container aspect ratio
                updateResultContainerAspectRatio();

                // Set photo display
                photoDisplay.src = userPhotoData;
                photoDisplay.onload = () => {
                    console.log('Photo displayed:', photoDisplay.naturalWidth, 'x', photoDisplay.naturalHeight);
                };

                // Set frame display with green screen removal
                if (selectedCategory === 'custom' && customFrameData) {
                    frameDisplay.src = customFrameData;
                    frameDisplay.onload = () => {
                        console.log('Custom frame displayed:', frameDisplay.naturalWidth, 'x', frameDisplay.naturalHeight);
                    };
                } else {
                    // Generate frame has green screen - need to remove it
                    console.log('Removing green screen from generated frame...');
                    removeGreenScreen(generatedFrameData).then(processedFrameData => {
                        console.log('Green screen removal complete, displaying frame...');
                        frameDisplay.src = processedFrameData;
                        currentFrameImage = processedFrameData; // Update stored frame

                        frameDisplay.onload = () => {
                            console.log('Frame displayed (green screen removed):', frameDisplay.naturalWidth, 'x', frameDisplay.naturalHeight);
                            // Show frame wrapper after frame loads
                            frameWrapper.classList.remove('hidden');
                        };
                    }).catch(err => {
                        console.error('Error removing green screen:', err);
                        // Fallback: use original frame
                        frameDisplay.src = generatedFrameData;
                        currentFrameImage = generatedFrameData;
                        frameWrapper.classList.remove('hidden');
                    });
                }

                // Store for download
                currentUserPhoto = userPhotoData;
                // currentFrameImage will be updated after green screen removal
                if (selectedCategory === 'custom' && customFrameData) {
                    currentFrameImage = customFrameData;
                }
                // For generated frame, currentFrameImage is set in removeGreenScreen callback above

                // Reset position/scale on new generation
                photoScale = 1.0;
                photoOffsetX = 0;
                photoOffsetY = 0;
                if (zoomSlider) zoomSlider.value = 100;
                if (zoomValue) zoomValue.textContent = '100%';
                updatePhotoTransform();

                // Show preview and position controls
                emptyState.classList.add('hidden');
                previewContainer.classList.remove('hidden');
                // frameWrapper will be shown after green screen removal or immediately for custom frame
                if (selectedCategory === 'custom' && customFrameData) {
                    frameWrapper.classList.remove('hidden');
                }
                if (positionControls) {
                    positionControls.classList.remove('hidden');
                }

                generateBtn.disabled = false;
                generateBtn.innerHTML = '<i class="fas fa-magic mr-2"></i>Generate Twibon';
            } catch (error) {
                console.error('Error generating twibon:', error);
                alert('Terjadi kesalahan saat membuat twibon. Silakan coba lagi.');
                generateBtn.disabled = false;
                generateBtn.innerHTML = '<i class="fas fa-magic mr-2"></i>Generate Twibon';
            }
        });

        async function generateAIFrame() {
            try {
                // Map categories to descriptions
                const categoryDescriptions = {
                    'independence': 'Indonesian Independence Day (HUT RI) frame with red and white colors, patriotic theme, Indonesian flag elements',
                    'holiday': 'Holiday celebration frame with festive decorations, joyful colors, celebration elements',
                    'birthday': 'Birthday celebration frame with balloons, cake, confetti, festive and joyful theme',
                    'wedding': 'Wedding frame with elegant floral decorations, romantic theme, soft colors, love elements',
                    'graduation': 'Graduation celebration frame with academic cap, diploma, achievement theme, proud moment',
                    'campaign': 'Campaign or promotional frame with bold text area, attention-grabbing design, professional look',
                    'corporate': 'Corporate or business frame with professional design, company branding elements, clean and modern'
                };

                const styleDescriptions = {
                    'elegant': 'elegant and sophisticated style with refined decorative elements',
                    'modern': 'modern and contemporary style with clean geometric shapes',
                    'minimalist': 'minimalist style with simple clean lines and subtle details',
                    'colorful': 'colorful and vibrant style with bold colors and dynamic elements'
                };

                const description = descriptionInput.value.trim() || categoryDescriptions[selectedCategory];

                const prompt = `Create a professional Twibon (photo frame/border overlay) for: ${description}

Style: ${styleDescriptions[selectedStyle]}

CRITICAL INSTRUCTION - GREEN SCREEN BACKGROUND:
The CENTER 60% of the image MUST be filled with a SOLID, VIBRANT GREEN SCREEN (#00FF00 or bright lime green).
This green area is where the user's photo will show through - DO NOT put any decorations in this area.

FRAME ELEMENTS (edges only):
1. Top edge (15% of height): Decorative banner with theme elements, text, ornaments
2. Bottom edge (15% of height): Decorative border with theme elements
3. Four corners: Ornamental corner designs
4. Left/right edges: Thin decorative borders (10% width each)

REQUIREMENTS:
- Theme: ${description}
- Style: ${selectedStyle}
- Aspect ratio: ${selectedAspectRatio}
- Center green screen area: EXACTLY #00FF00 bright green (no gradients, no shadows on green)
- Decorations: ONLY at edges (top 15%, bottom 15%, corners, sides)
- The green screen must be clean and uniform for easy removal

LAYOUT EXAMPLE:
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  TOP BANNER (15%)    ‚îÇ ‚Üê Decorations
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ‚ñë                    ‚ñë‚îÇ ‚Üê Green screen center (60%)
‚îÇ‚ñë   #00FF00 GREEN   ‚ñë‚îÇ ‚Üê This will be transparent
‚îÇ‚ñë                    ‚ñë‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ BOTTOM BORDER (15%)  ‚îÇ ‚Üê Decorations
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

Create a professional Twibon frame with clean green screen center now.`;

                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-image-preview:generateContent?key=${apiKey}`;

                const payload = {
                    contents: [{
                        parts: [{ text: prompt }]
                    }],
                    generationConfig: {
                        responseModalities: ['IMAGE'],
                        imageConfig: {
                            aspectRatio: selectedAspectRatio
                        }
                    }
                };

                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const result = await response.json();
                const imageData = result?.candidates?.[0]?.content?.parts?.find(part => part.inlineData)?.inlineData?.data;

                if (!imageData) {
                    throw new Error('No image data in response');
                }

                return imageData;
            } catch (error) {
                console.error('Error generating AI frame:', error);
                return null;
            }
        }

        function loadImage(src) {
            return new Promise((resolve, reject) => {
                const img = new Image();
                img.crossOrigin = 'anonymous';
                img.onload = () => resolve(img);
                img.onerror = reject;
                img.src = src;
            });
        }

        async function removeGreenScreen(imageDataUrl, tolerance = 80) {
            return new Promise((resolve, reject) => {
                const img = new Image();
                img.crossOrigin = 'anonymous';

                img.onload = () => {
                    // Create temporary canvas for processing
                    const tempCanvas = document.createElement('canvas');
                    const tempCtx = tempCanvas.getContext('2d');

                    tempCanvas.width = img.width;
                    tempCanvas.height = img.height;

                    // Draw image
                    tempCtx.drawImage(img, 0, 0);

                    // Get image data
                    const imageData = tempCtx.getImageData(0, 0, tempCanvas.width, tempCanvas.height);
                    const data = imageData.data;

                    let removedPixels = 0;
                    const totalPixels = data.length / 4;

                    // Process pixels - remove green
                    for (let i = 0; i < data.length; i += 4) {
                        const r = data[i];
                        const g = data[i + 1];
                        const b = data[i + 2];

                        // Method 1: Simple green detection
                        // Green channel high, red and blue low
                        const isSimpleGreen = (g > 180) && (r < 120) && (b < 120);

                        // Method 2: Color distance from pure green (#00FF00)
                        const greenDiff = Math.abs(g - 255);
                        const redDiff = Math.abs(r - 0);
                        const blueDiff = Math.abs(b - 0);
                        const colorDistance = Math.sqrt(redDiff * redDiff + greenDiff * greenDiff + blueDiff * blueDiff);

                        // Method 3: Green dominance (green channel significantly higher than others)
                        const greenDominance = g > (r * 1.5) && g > (b * 1.5) && g > 150;

                        // Remove pixel if any method detects green
                        if (isSimpleGreen || colorDistance < tolerance || greenDominance) {
                            // Make pixel transparent
                            data[i + 3] = 0;
                            removedPixels++;
                        }
                    }

                    // Put processed image data back
                    tempCtx.putImageData(imageData, 0, 0);

                    // Log statistics
                    const percentageRemoved = ((removedPixels / totalPixels) * 100).toFixed(2);
                    console.log(`Green screen removed: ${removedPixels} pixels (${percentageRemoved}% of image)`);

                    // Return as data URL
                    const processedDataUrl = tempCanvas.toDataURL('image/png');
                    resolve(processedDataUrl);
                };

                img.onerror = () => {
                    reject(new Error('Failed to load image for green screen removal'));
                };

                img.src = imageDataUrl;
            });
        }

        // Download button
        downloadBtn.addEventListener('click', async () => {
            try {
                if (!currentUserPhoto || !currentFrameImage) {
                    alert('Tidak ada twibon untuk didownload');
                    return;
                }

                // Combine on canvas for download
                await combineForDownload(currentUserPhoto, currentFrameImage);

                const dataUrl = canvas.toDataURL('image/png');
                const filename = `twibon-${selectedCategory}-${Date.now()}.png`;

                if (window.downloadDataURINew) {
                    await window.downloadDataURINew(dataUrl, filename);
                } else if (window.downloadImage) {
                    await window.downloadImage(dataUrl, filename);
                } else {
                    // Fallback download
                    const link = document.createElement('a');
                    link.download = filename;
                    link.href = dataUrl;
                    link.click();
                }
            } catch (error) {
                console.error('Error downloading twibon:', error);
                alert('Terjadi kesalahan saat download. Silakan coba lagi.');
            }
        });

        async function combineForDownload(photoDataUrl, frameDataUrl) {
            // Load images
            const photo = await loadImage(photoDataUrl);
            const frame = await loadImage(frameDataUrl);

            // Calculate canvas size
            let canvasWidth, canvasHeight;
            const maxSize = 1080;

            switch(selectedAspectRatio) {
                case '1:1':
                    canvasWidth = canvasHeight = maxSize;
                    break;
                case '4:5':
                    canvasWidth = maxSize * 0.8;
                    canvasHeight = maxSize;
                    break;
                case '9:16':
                    canvasWidth = maxSize * 0.5625;
                    canvasHeight = maxSize;
                    break;
                case '16:9':
                    canvasWidth = maxSize;
                    canvasHeight = maxSize * 0.5625;
                    break;
                default:
                    canvasWidth = canvasHeight = maxSize;
            }

            canvas.width = canvasWidth;
            canvas.height = canvasHeight;

            // Clear canvas
            ctx.clearRect(0, 0, canvasWidth, canvasHeight);

            // Calculate photo dimensions
            const photoAspect = photo.width / photo.height;
            const canvasAspect = canvasWidth / canvasHeight;

            let baseWidth, baseHeight, baseOffsetX, baseOffsetY;

            if (photoAspect > canvasAspect) {
                baseHeight = canvasHeight;
                baseWidth = baseHeight * photoAspect;
                baseOffsetX = (canvasWidth - baseWidth) / 2;
                baseOffsetY = 0;
            } else {
                baseWidth = canvasWidth;
                baseHeight = baseWidth / photoAspect;
                baseOffsetX = 0;
                baseOffsetY = (canvasHeight - baseHeight) / 2;
            }

            // Apply scale and position
            const scaledWidth = baseWidth * photoScale;
            const scaledHeight = baseHeight * photoScale;

            const scaleDiff = photoScale - 1.0;
            const centerAdjustX = (baseWidth * scaleDiff) / 2;
            const centerAdjustY = (baseHeight * scaleDiff) / 2;

            const finalX = baseOffsetX - centerAdjustX + photoOffsetX;
            const finalY = baseOffsetY - centerAdjustY + photoOffsetY;

            // Draw photo
            ctx.drawImage(photo, finalX, finalY, scaledWidth, scaledHeight);

            // Draw frame
            ctx.drawImage(frame, 0, 0, canvasWidth, canvasHeight);
        }

        // Reset button
        resetBtn.addEventListener('click', () => {
            // Clear everything
            userPhotoData = null;
            customFrameData = null;
            generatedFrameData = null;

            photoInput.value = '';
            frameInput.value = '';
            descriptionInput.value = '';

            photoPreview.src = '';
            photoPreview.classList.add('hidden');
            photoPlaceholder.classList.remove('hidden');
            photoRemoveBtn.classList.add('hidden');

            framePreview.src = '';
            framePreview.classList.add('hidden');
            framePlaceholder.classList.remove('hidden');

            // Clear displays
            photoDisplay.src = '';
            frameDisplay.src = '';
            frameWrapper.classList.add('hidden');

            ctx.clearRect(0, 0, canvas.width, canvas.height);

            previewContainer.classList.add('hidden');
            emptyState.classList.remove('hidden');

            // Hide position controls and reset position
            if (positionControls) {
                positionControls.classList.add('hidden');
            }
            photoScale = 1.0;
            photoOffsetX = 0;
            photoOffsetY = 0;
            currentUserPhoto = null;
            currentFrameImage = null;
            if (zoomSlider) zoomSlider.value = 100;
            if (zoomValue) zoomValue.textContent = '100%';

            updateGenerateButtonState();
        });
    })();

    // ==================== PROFESSIONAL HEADSHOT ====================
    (function() {
        const apiKey = "";

        // Element references
        const headshotInput = document.getElementById('headshot-input');
        const headshotUploadBox = document.getElementById('headshot-upload-box');
        const headshotPreview = document.getElementById('headshot-preview');
        const headshotPlaceholder = document.getElementById('headshot-placeholder');
        const headshotRemoveBtn = document.getElementById('headshot-remove-btn');
        const headshotGenerateBtn = document.getElementById('headshot-generate-btn');
        const headshotThemeOptions = document.getElementById('headshot-theme-options');
        const headshotCustomThemeContainer = document.getElementById('headshot-custom-theme-container');
        const headshotCustomThemeInput = document.getElementById('headshot-custom-theme-input');
        const headshotBgOptions = document.getElementById('headshot-bg-options');
        const headshotAttireOptions = document.getElementById('headshot-attire-options');
        const headshotStyleOptions = document.getElementById('headshot-style-options');
        const headshotRatioOptions = document.getElementById('headshot-ratio-options');
        const headshotCountOptions = document.getElementById('headshot-count-options');
        const headshotResultsPlaceholder = document.getElementById('headshot-results-placeholder');
        const headshotResultsContainer = document.getElementById('headshot-results-container');
        const headshotResultsGrid = document.getElementById('headshot-results-grid');
        const headshotDownloadAllBtn = document.getElementById('headshot-download-all-btn');

        if (!headshotInput) return;

        let uploadedImageData = null;
        let generatedImages = [];
        let selectedTheme = 'LinkedIn Professional';
        let selectedBackground = 'Studio White';
        let selectedAttire = 'Business Suit';
        let selectedStyle = 'Classic';
        let selectedRatio = '3:4';
        let selectedCount = 6;

        // Setup image upload with HEIC support
        headshotInput.addEventListener('change', async (e) => {
            const file = e.target.files[0];
            if (!file) return;

            try {
                let processedFile = file;

                // Convert HEIC to JPEG if necessary
                if (file.type === 'image/heic' || file.name.toLowerCase().endsWith('.heic')) {
                    const heic2any = window.heic2any;
                    if (heic2any) {
                        const convertedBlob = await heic2any({ blob: file, toType: 'image/jpeg', quality: 0.9 });
                        processedFile = new File([convertedBlob], file.name.replace(/\.heic$/i, '.jpg'), { type: 'image/jpeg' });
                    }
                }

                const reader = new FileReader();
                reader.onload = (event) => {
                    const dataUrl = event.target.result;
                    const base64 = dataUrl.split(',')[1];

                    uploadedImageData = {
                        base64: base64,
                        mimeType: processedFile.type,
                        dataUrl: dataUrl
                    };

                    headshotPreview.src = dataUrl;
                    headshotPlaceholder.classList.add('hidden');
                    headshotPreview.classList.remove('hidden');
                    headshotRemoveBtn.classList.remove('hidden');
                    headshotGenerateBtn.disabled = false;
                };
                reader.readAsDataURL(processedFile);
            } catch (error) {
                console.error('Error processing image:', error);
                alert('Gagal memproses gambar. Silakan coba lagi.');
            }
        });

        // Remove image handler
        headshotRemoveBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            uploadedImageData = null;
            headshotInput.value = '';
            headshotPreview.src = '#';
            headshotPreview.classList.add('hidden');
            headshotPlaceholder.classList.remove('hidden');
            headshotRemoveBtn.classList.add('hidden');
            headshotGenerateBtn.disabled = true;

            // Reset results
            headshotResultsPlaceholder.classList.remove('hidden');
            headshotResultsContainer.classList.add('hidden');
            headshotResultsGrid.innerHTML = '';
            generatedImages = [];
        });

        // Theme selection handler
        headshotThemeOptions.addEventListener('click', (e) => {
            const button = e.target.closest('button');
            if (!button) return;

            headshotThemeOptions.querySelectorAll('button').forEach(btn => btn.classList.remove('selected'));
            button.classList.add('selected');
            selectedTheme = button.dataset.value;

            // Show/hide custom theme input
            if (selectedTheme === 'Custom') {
                headshotCustomThemeContainer.classList.remove('hidden');
            } else {
                headshotCustomThemeContainer.classList.add('hidden');
            }
        });

        // Background selection handler
        headshotBgOptions.addEventListener('click', (e) => {
            const button = e.target.closest('button');
            if (!button) return;

            headshotBgOptions.querySelectorAll('button').forEach(btn => btn.classList.remove('selected'));
            button.classList.add('selected');
            selectedBackground = button.dataset.value;
        });

        // Attire selection handler
        headshotAttireOptions.addEventListener('click', (e) => {
            const button = e.target.closest('button');
            if (!button) return;

            headshotAttireOptions.querySelectorAll('button').forEach(btn => btn.classList.remove('selected'));
            button.classList.add('selected');
            selectedAttire = button.dataset.value;
        });

        // Style selection handler
        headshotStyleOptions.addEventListener('click', (e) => {
            const button = e.target.closest('button');
            if (!button) return;

            headshotStyleOptions.querySelectorAll('button').forEach(btn => btn.classList.remove('selected'));
            button.classList.add('selected');
            selectedStyle = button.dataset.value;
        });

        // Ratio selection handler
        headshotRatioOptions.addEventListener('click', (e) => {
            const button = e.target.closest('button');
            if (!button) return;

            headshotRatioOptions.querySelectorAll('button').forEach(btn => btn.classList.remove('selected'));
            button.classList.add('selected');
            selectedRatio = button.dataset.value;
        });

        // Count selection handler
        headshotCountOptions.addEventListener('click', (e) => {
            const button = e.target.closest('button');
            if (!button) return;

            headshotCountOptions.querySelectorAll('button').forEach(btn => btn.classList.remove('selected'));
            button.classList.add('selected');
            selectedCount = parseInt(button.dataset.value);
        });

        // Generate button handler
        headshotGenerateBtn.addEventListener('click', async () => {
            if (!uploadedImageData) {
                alert('Silakan unggah foto terlebih dahulu');
                return;
            }

            // Determine theme
            let professionalTheme = selectedTheme;
            if (selectedTheme === 'Custom' && headshotCustomThemeInput) {
                const customTheme = headshotCustomThemeInput.value.trim();
                professionalTheme = customTheme || 'LinkedIn Professional';
            }

            // Theme descriptions for better AI prompts
            const themeDescriptions = {
                'LinkedIn Professional': 'professional LinkedIn headshot with confident smile, approachable and trustworthy appearance, corporate professional look',
                'Business Executive': 'executive business headshot, authoritative yet approachable, leadership presence, sophisticated corporate style',
                'Corporate Formal': 'formal corporate headshot, serious professional demeanor, conservative business appearance',
                'Creative Professional': 'creative professional headshot, artistic and modern look, innovative and forward-thinking appearance',
                'Tech Professional': 'tech industry professional headshot, smart casual tech style, innovative and contemporary look',
                'Medical Professional': 'medical healthcare professional headshot, caring and trustworthy appearance, clean clinical professional look',
                'Legal Professional': 'legal professional headshot, trustworthy authoritative look, sophisticated law firm appearance',
                'Entrepreneur': 'entrepreneur headshot, confident dynamic look, innovative business leader appearance',
                'Academic': 'academic professional headshot, intellectual scholarly appearance, knowledgeable and approachable look',
                'Smart Casual': 'smart casual professional headshot, modern relaxed professional look, approachable business casual style',
                'Consultant': 'consultant professional headshot, expert advisor appearance, trusted professional consultant look'
            };

            const themeDescription = themeDescriptions[selectedTheme] || professionalTheme;

            // Attire descriptions
            const attireDescriptions = {
                'Business Suit': 'wearing a professional business suit with tie or formal business attire',
                'Smart Casual Blazer': 'wearing a smart casual blazer over professional shirt',
                'Professional Shirt': 'wearing a crisp professional dress shirt or blouse',
                'Industry Specific': `wearing appropriate professional attire for ${professionalTheme} industry`
            };

            const attireDescription = attireDescriptions[selectedAttire];

            // Background descriptions
            const backgroundDescriptions = {
                'Studio White': 'clean studio white background, professional photography studio lighting',
                'Professional Gray': 'professional neutral gray background with gradient lighting',
                'Navy Blue': 'professional navy blue background with elegant lighting',
                'Gradient Blue': 'professional blue gradient background with sophisticated lighting',
                'Office Interior': 'professional modern office interior background with soft bokeh effect',
                'Outdoor Professional': 'professional outdoor background with natural professional setting, blurred bokeh'
            };

            const backgroundDescription = backgroundDescriptions[selectedBackground];

            // Style descriptions
            const styleDescriptions = {
                'Classic': 'classic professional photography style with traditional lighting and composition',
                'Modern': 'modern contemporary photography style with clean lines and bright lighting',
                'Cinematic': 'cinematic professional style with dramatic depth and artistic lighting'
            };

            const styleDescription = styleDescriptions[selectedStyle];

            // Create comprehensive prompt
            const prompt = `Create a professional headshot photograph for ${themeDescription}.

CRITICAL REQUIREMENTS:
- Keep the person's identity, face, and all facial features EXACTLY the same as in the original photo
- Transform the photo into a professional headshot with the following specifications:

THEME & PURPOSE: ${professionalTheme}
- ${themeDescription}

ATTIRE: ${attireDescription}

BACKGROUND: ${backgroundDescription}

PHOTOGRAPHY STYLE: ${styleDescription}

EXPRESSION & POSE:
- Confident, professional facial expression
- Direct eye contact with camera
- Shoulders squared towards camera
- Professional headshot composition (head and shoulders)
- Natural, relaxed posture

LIGHTING & QUALITY:
- Professional studio-quality lighting
- Soft, flattering light on face
- No harsh shadows
- High-resolution professional photography quality
- Color-corrected and professionally edited look

The final result must be a high-quality professional headshot suitable for LinkedIn, CV, business profiles, and professional use. The person must be clearly recognizable as the same individual from the original photo.`;

            await generateHeadshotSet(prompt);
        });

        async function generateHeadshotSet(prompt) {
            const originalBtnHTML = headshotGenerateBtn.innerHTML;
            headshotGenerateBtn.disabled = true;
            headshotGenerateBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Membuat Headshot...';

            headshotResultsPlaceholder.classList.add('hidden');
            headshotResultsContainer.classList.remove('hidden');
            headshotResultsGrid.innerHTML = '';
            generatedImages = [];

            // Create placeholder cards
            for (let i = 1; i <= selectedCount; i++) {
                const card = document.createElement('div');
                card.id = `headshot-card-${i}`;
                card.className = 'relative group rounded-xl overflow-hidden bg-gray-100 flex items-center justify-center aspect-[3/4]';
                card.innerHTML = '<div class="animate-spin rounded-full h-10 w-10 border-b-2 border-indigo-600"></div>';
                headshotResultsGrid.appendChild(card);
            }

            // Generate all headshots in parallel
            const generationPromises = Array.from({ length: selectedCount }, (_, i) =>
                generateSingleHeadshot(i + 1, prompt)
            );
            await Promise.allSettled(generationPromises);

            headshotGenerateBtn.disabled = false;
            headshotGenerateBtn.innerHTML = originalBtnHTML;
        }

        async function generateSingleHeadshot(index, basePrompt) {
            const card = document.getElementById(`headshot-card-${index}`);
            try {
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-image-preview:generateContent?key=${apiKey}`;

                const finalPrompt = `${basePrompt}\n\nThis is professional headshot variation ${index}. Create a slightly different professional pose or angle while maintaining the same professional quality and style. Ensure natural variation in pose (slight head tilt, different shoulder angle, etc.) while keeping the professional headshot standard.`;

                const payload = {
                    contents: [{
                        parts: [
                            { text: finalPrompt },
                            { inlineData: { mimeType: uploadedImageData.mimeType, data: uploadedImageData.base64 } }
                        ]
                    }],
                    generationConfig: {
                        responseModalities: ['IMAGE'],
                        imageConfig: { aspectRatio: selectedRatio }
                    }
                };

                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    throw new Error(`API Error: ${response.status}`);
                }

                const result = await response.json();
                const base64Data = result?.candidates?.[0]?.content?.parts?.find(p => p.inlineData)?.inlineData?.data;

                if (base64Data) {
                    const imageUrl = `data:image/png;base64,${base64Data}`;
                    const filename = `professional_headshot_${selectedTheme.replace(/\s+/g, '_').toLowerCase()}_${index}.png`;

                    generatedImages.push({ url: imageUrl, filename: filename });

                    card.className = 'relative group rounded-xl overflow-hidden shadow-lg hover:shadow-2xl transition-all duration-300';
                    card.innerHTML = `
                        <img src="${imageUrl}" class="w-full h-full object-cover" alt="Professional Headshot ${index}">
                        <div class="absolute inset-0 bg-gradient-to-t from-black/80 via-black/40 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300 flex items-end justify-center pb-4 gap-2">
                            <button data-action="preview" data-index="${index - 1}" class="action-btn bg-white/90 hover:bg-white text-gray-800 px-4 py-2 rounded-full font-semibold shadow-lg transition-all duration-200 hover:scale-105 flex items-center gap-2">
                                <i class="fas fa-eye"></i>
                                <span class="hidden sm:inline">Preview</span>
                            </button>
                            <button data-action="download" data-index="${index - 1}" class="action-btn bg-gradient-to-r from-indigo-600 to-blue-600 hover:from-indigo-700 hover:to-blue-700 text-white px-4 py-2 rounded-full font-semibold shadow-lg transition-all duration-200 hover:scale-105 flex items-center gap-2">
                                <i class="fas fa-download"></i>
                                <span class="hidden sm:inline">Download</span>
                            </button>
                        </div>
                    `;
                } else {
                    throw new Error('Invalid API response');
                }
            } catch (error) {
                console.error(`Error generating headshot ${index}:`, error);
                card.innerHTML = `
                    <div class="text-center p-4">
                        <i class="fas fa-exclamation-circle text-red-500 text-3xl mb-2"></i>
                        <p class="text-xs text-red-500">Gagal membuat headshot</p>
                    </div>
                `;
            }
        }

        // Event delegation for action buttons (works on desktop & mobile)
        headshotResultsGrid.addEventListener('click', async (e) => {
            e.stopPropagation();

            const actionBtn = e.target.classList.contains('action-btn') ? e.target : e.target.closest('.action-btn[data-action]');
            if (!actionBtn) return;

            const action = actionBtn.dataset.action;
            const index = parseInt(actionBtn.dataset.index, 10);
            const imageData = generatedImages[index];

            if (!imageData) return;

            if (action === 'preview') {
                if (window.showPreviewModal) {
                    window.showPreviewModal(imageData.url);
                }
            } else if (action === 'download') {
                if (window.downloadDataURINew) {
                    await window.downloadDataURINew(imageData.url, imageData.filename);
                }
            }
        });

        // Download all functionality (works on desktop & mobile like Umrah)
        if (headshotDownloadAllBtn) {
            headshotDownloadAllBtn.addEventListener('click', async () => {
                if (generatedImages.length === 0) return;

                headshotDownloadAllBtn.disabled = true;
                headshotDownloadAllBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Downloading...';

                for (let i = 0; i < generatedImages.length; i++) {
                    const img = generatedImages[i];
                    if (window.downloadDataURINew) {
                        await window.downloadDataURINew(img.url, img.filename);
                        await new Promise(resolve => setTimeout(resolve, 500));
                    }
                }

                headshotDownloadAllBtn.disabled = false;
                headshotDownloadAllBtn.innerHTML = '<i class="fas fa-download mr-2"></i>Download Semua';
            });
        }
    })();

    // ==================== DESAIN RUMAH ====================
    (function() {
        const drTabInterior = document.getElementById('dr-tab-interior');
        const drTabEksterior = document.getElementById('dr-tab-eksterior');
        const drContentInterior = document.getElementById('dr-content-interior');
        const drContentEksterior = document.getElementById('dr-content-eksterior');

        if (!drTabInterior) return;

        function switchDesainRumahTab(tabName) {
            const isInteriorActive = tabName === 'interior';
            drTabInterior.classList.toggle('selected', isInteriorActive);
            drTabEksterior.classList.toggle('selected', !isInteriorActive);
            drContentInterior.classList.toggle('hidden', !isInteriorActive);
            drContentEksterior.classList.toggle('hidden', isInteriorActive);
        }

        drTabInterior.addEventListener('click', () => switchDesainRumahTab('interior'));
        drTabEksterior.addEventListener('click', () => switchDesainRumahTab('eksterior'));

        // --- INTERIOR ---
        const drInteriorRoomInput = document.getElementById('dr-interior-room-input');
        const drInteriorRoomUploadBox = document.getElementById('dr-interior-room-upload-box');
        const drInteriorRoomPreview = document.getElementById('dr-interior-room-preview');
        const drInteriorRoomPlaceholder = document.getElementById('dr-interior-room-placeholder');
        const drInteriorRemoveRoomBtn = document.getElementById('dr-interior-remove-room-btn');
        const drInteriorFurniturePrompt = document.getElementById('dr-interior-furniture-prompt');
        const drInteriorAddFurnitureBtn = document.getElementById('dr-interior-add-furniture-btn');
        const drInteriorAiFurnitureContainer = document.getElementById('dr-interior-ai-furniture-container');
        const drInteriorAiFurniturePlaceholder = document.getElementById('dr-interior-ai-furniture-placeholder');
        const drInteriorManualFurnitureInput = document.getElementById('dr-interior-manual-furniture-input');
        const drInteriorManualFurnitureContainer = document.getElementById('dr-interior-manual-furniture-container');
        const drInteriorInstructionInput = document.getElementById('dr-interior-instruction-input');
        const drInteriorMagicInstructionBtn = document.getElementById('dr-interior-magic-instruction-btn');
        const drInteriorRatioOptions = document.getElementById('dr-interior-ratio-options');
        const drInteriorGenerateBtn = document.getElementById('dr-interior-generate-btn');
        const drInteriorResultsContainer = document.getElementById('dr-interior-results-container');
        const drInteriorResultsGrid = document.getElementById('dr-interior-results-grid');

        let drInteriorRoomData = null;
        let drInteriorAiFurniture = [];
        let drInteriorManualFurniture = [];

        function drInteriorUpdateGenerateButtonState() {
            const hasRoom = !!drInteriorRoomData;
            const hasFurniture = drInteriorAiFurniture.length > 0 || drInteriorManualFurniture.length > 0;
            const hasInstruction = drInteriorInstructionInput.value.trim() !== '';

            drInteriorGenerateBtn.disabled = !hasRoom || !hasFurniture || !hasInstruction;
            drInteriorAddFurnitureBtn.disabled = !hasRoom || drInteriorFurniturePrompt.value.trim() === '';
            drInteriorMagicInstructionBtn.disabled = !hasRoom || !hasFurniture;
        }

        drInteriorInstructionInput.addEventListener('input', drInteriorUpdateGenerateButtonState);

        setupImageUploadNew(drInteriorRoomInput, drInteriorRoomUploadBox, (data) => {
            drInteriorRoomData = data;
            drInteriorRoomPreview.src = data.dataUrl;
            drInteriorRoomPlaceholder.classList.add('hidden');
            drInteriorRoomPreview.classList.remove('hidden');
            drInteriorRemoveRoomBtn.classList.remove('hidden');
            drInteriorUpdateGenerateButtonState();
        });

        drInteriorRemoveRoomBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            drInteriorRoomData = null;
            drInteriorRoomInput.value = '';
            drInteriorRoomPreview.src = '#';
            drInteriorRoomPreview.classList.add('hidden');
            drInteriorRoomPlaceholder.classList.remove('hidden');
            drInteriorRemoveRoomBtn.classList.add('hidden');

            document.getElementById('dr-interior-results-placeholder').classList.remove('hidden');
            drInteriorResultsContainer.classList.add('hidden');
            drInteriorResultsGrid.innerHTML = '';

            drInteriorUpdateGenerateButtonState();
        });

        drInteriorFurniturePrompt.addEventListener('input', drInteriorUpdateGenerateButtonState);

        drInteriorAddFurnitureBtn.addEventListener('click', async () => {
            const prompt = drInteriorFurniturePrompt.value.trim();
            if (!prompt) return;

            const originalBtnHTML = drInteriorAddFurnitureBtn.innerHTML;
            drInteriorAddFurnitureBtn.disabled = true;
            drInteriorAddFurnitureBtn.innerHTML = `<div class="loader-icon-umrah !border-l-white w-5 h-5"></div>`;
            drInteriorAiFurniturePlaceholder.classList.add('hidden');

            const loaderItem = document.createElement('div');
            loaderItem.className = 'aspect-square bg-gray-200 rounded-md flex items-center justify-center';
            loaderItem.innerHTML = `<div class="loader-icon-umrah w-6 h-6"></div>`;
            drInteriorAiFurnitureContainer.appendChild(loaderItem);

            try {
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-image-preview:generateContent?key=${apiKey}`;
                const finalPrompt = `A photorealistic image of a single piece of furniture: ${prompt}. The furniture should be on a plain white background, front view, no shadows.`;
                const payload = {
                    contents: [{ parts: [{ text: finalPrompt }] }],
                    generationConfig: { responseModalities: ['IMAGE'], imageConfig: { aspectRatio: '1:1' } }
                };

                const response = await fetch(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
                if (!response.ok) throw new Error(`Error ${response.status}`);

                const result = await response.json();
                const base64Data = result?.candidates?.[0]?.content?.parts?.find(p => p.inlineData)?.inlineData?.data;
                if (!base64Data) throw new Error("No image data from AI.");

                const furnitureData = {
                    base64: base64Data,
                    mimeType: 'image/png',
                    dataUrl: `data:image/png;base64,${base64Data}`
                };
                drInteriorAiFurniture.push(furnitureData);
                drInteriorRenderAiFurniture();
                drInteriorFurniturePrompt.value = '';
            } catch (error) {
                console.error("Error generating AI furniture:", error);
                alert(`Gagal membuat furnitur: ${error.message}`);
                if (drInteriorAiFurniture.length === 0) drInteriorAiFurniturePlaceholder.classList.remove('hidden');
            } finally {
                loaderItem.remove();
                drInteriorAddFurnitureBtn.innerHTML = originalBtnHTML;
                drInteriorUpdateGenerateButtonState();
            }
        });

        function drInteriorRenderAiFurniture() {
            drInteriorAiFurnitureContainer.innerHTML = '';
            if (drInteriorAiFurniture.length === 0) {
                drInteriorAiFurnitureContainer.appendChild(drInteriorAiFurniturePlaceholder);
                drInteriorAiFurniturePlaceholder.classList.remove('hidden');
            } else {
                drInteriorAiFurniturePlaceholder.classList.add('hidden');
            }

            drInteriorAiFurniture.forEach((item, index) => {
                const div = document.createElement('div');
                div.className = 'relative aspect-square';
                div.innerHTML = `
                    <img src="${item.dataUrl}" class="w-full h-full object-contain rounded-md border">
                    <button data-index="${index}" class="dr-interior-remove-ai-furniture absolute top-1 right-1 bg-red-600 text-white rounded-full p-0.5 hover:bg-red-700">
                        <i class="fas fa-times"></i>
                    </button>
                `;
                drInteriorAiFurnitureContainer.appendChild(div);
            });
            drInteriorUpdateGenerateButtonState();
        }

        drInteriorAiFurnitureContainer.addEventListener('click', (e) => {
            const removeBtn = e.target.closest('.dr-interior-remove-ai-furniture');
            if (removeBtn) {
                const index = parseInt(removeBtn.dataset.index);
                drInteriorAiFurniture.splice(index, 1);
                drInteriorRenderAiFurniture();
            }
        });

        setupImageUploadNew(drInteriorManualFurnitureInput, null, (data) => {
            drInteriorManualFurniture.push(data);
            drInteriorRenderManualFurniture();
        });

        function drInteriorRenderManualFurniture() {
            drInteriorManualFurnitureContainer.innerHTML = '';
            drInteriorManualFurniture.forEach((item, index) => {
                const div = document.createElement('div');
                div.className = 'relative aspect-square';
                div.innerHTML = `
                    <img src="${item.dataUrl}" class="w-full h-full object-contain rounded-md border">
                    <button data-index="${index}" class="dr-interior-remove-manual-furniture absolute top-1 right-1 bg-red-600 text-white rounded-full p-0.5 hover:bg-red-700">
                        <i class="fas fa-times"></i>
                    </button>
                `;
                drInteriorManualFurnitureContainer.appendChild(div);
            });

            drInteriorManualFurnitureContainer.querySelectorAll('.dr-interior-remove-manual-furniture').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const index = parseInt(e.currentTarget.dataset.index);
                    drInteriorManualFurniture.splice(index, 1);
                    drInteriorRenderManualFurniture();
                });
            });

            drInteriorUpdateGenerateButtonState();
        }

        drInteriorMagicInstructionBtn.addEventListener('click', async () => {
            const originalBtnHTML = drInteriorMagicInstructionBtn.innerHTML;
            drInteriorMagicInstructionBtn.disabled = true;
            drInteriorMagicInstructionBtn.innerHTML = `<div class="loader-icon-umrah w-5 h-5"></div>`;

            try {
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
                const systemPrompt = `You are a professional interior designer. Analyze the provided room image (the first one) and the furniture images (all subsequent ones). Based on the room's style and the available furniture, generate a concise layout instruction in Indonesian. For example: "Letakkan sofa di depan jendela, dengan meja kopi di depannya. Tambahkan lukisan di dinding di atas sofa." Respond ONLY with the instruction text.`;

                const parts = [{ text: "Buatkan instruksi desain untuk ruangan ini dengan furnitur berikut:" }, { inlineData: { mimeType: drInteriorRoomData.mimeType, data: drInteriorRoomData.base64 } }];
                [...drInteriorAiFurniture, ...drInteriorManualFurniture].forEach(furniture => {
                    parts.push({ inlineData: { mimeType: furniture.mimeType, data: furniture.base64 } });
                });
                const payload = { contents: [{ parts }], systemInstruction: { parts: [{ text: systemPrompt }] } };

                const response = await fetch(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
                if (!response.ok) throw new Error(`Error ${response.status}`);

                const result = await response.json();
                drInteriorInstructionInput.value = result.candidates[0].content.parts[0].text.trim();
            } catch (error) {
                console.error("Error generating magic instruction:", error);
                drInteriorInstructionInput.value = `Gagal membuat instruksi: ${error.message}`;
            } finally {
                drInteriorMagicInstructionBtn.innerHTML = originalBtnHTML;
                drInteriorUpdateGenerateButtonState();
            }
        });

        setupOptionButtonsNew(drInteriorRatioOptions);

        drInteriorGenerateBtn.addEventListener('click', async () => {
            const originalBtnHTML = drInteriorGenerateBtn.innerHTML;
            drInteriorGenerateBtn.disabled = true;
            drInteriorGenerateBtn.innerHTML = `<div class="loader-icon-umrah !border-l-white w-5 h-5"></div><span class="ml-2">Mendesain Ruangan...</span>`;

            document.getElementById('dr-interior-results-placeholder').classList.add('hidden');

            const aspectRatio = drInteriorRatioOptions.querySelector('.selected').dataset.value;
            const aspectClass = getAspectRatioClassNew(aspectRatio);

            drInteriorResultsContainer.classList.remove('hidden');
            drInteriorResultsGrid.innerHTML = '';
            for (let i = 1; i <= 4; i++) {
                const card = document.createElement('div');
                card.id = `dr-interior-card-${i}`;
                card.className = `card overflow-hidden bg-gray-100 flex items-center justify-center ${aspectClass}`;
                card.innerHTML = `<div class="loader-icon-umrah w-8 h-8"></div>`;
                drInteriorResultsGrid.appendChild(card);
            }

            const generationPromises = [1, 2, 3, 4].map(i => generateSingleInteriorDesign(i, aspectRatio));
            await Promise.allSettled(generationPromises);

            drInteriorGenerateBtn.disabled = false;
            drInteriorGenerateBtn.innerHTML = originalBtnHTML;
        });

        async function generateSingleInteriorDesign(id, aspectRatio) {
            const card = document.getElementById(`dr-interior-card-${id}`);
            try {
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-image-preview:generateContent?key=${apiKey}`;
                const instruction = drInteriorInstructionInput.value.trim();
                let prompt = `Your task is to photorealistically place furniture items into an existing room photo. You are given one primary image (the room) and multiple secondary images (the furniture).
                ABSOLUTE RULES: 1. DO NOT CHANGE THE ROOM's structure, walls, floor, or windows. 2. ONLY ADD the provided furniture items. 3. USE ALL furniture items provided. 4. INTEGRATE REALISTICALLY with correct scale, perspective, lighting, and shadows.
                USER'S PLACEMENT GUIDE: "${instruction}".
                FINAL OUTPUT: A single, photorealistic composite image showing the original room with the new furniture added. This is design variation number ${id}.`;

                const parts = [{ text: prompt }, { inlineData: { mimeType: drInteriorRoomData.mimeType, data: drInteriorRoomData.base64 } }];
                [...drInteriorAiFurniture, ...drInteriorManualFurniture].forEach(furniture => {
                    parts.push({ inlineData: { mimeType: furniture.mimeType, data: furniture.base64 } });
                });

                const payload = {
                    contents: [{ parts: parts }],
                    generationConfig: {
                        responseModalities: ['IMAGE'],
                        imageConfig: { aspectRatio: aspectRatio }
                    }
                };
                const response = await fetch(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
                if (!response.ok) throw new Error(`Error ${response.status}`);

                const result = await response.json();
                const base64Data = result?.candidates?.[0]?.content?.parts?.find(p => p.inlineData)?.inlineData?.data;
                if (!base64Data) throw new Error("No image data from AI for this design.");

                const imageUrl = `data:image/png;base64,${base64Data}`;
                card.innerHTML = `
                    <img src="${imageUrl}" class="w-full h-full object-cover cursor-pointer" onclick="window.open('${imageUrl}', '_blank')">
                    <div class="absolute bottom-2 right-2 flex gap-1">
                        <button onclick="window.open('${imageUrl}', '_blank')" class="bg-white hover:bg-gray-100 text-gray-800 p-2 rounded-full shadow-md" title="Lihat Gambar">
                            <i class="fas fa-eye"></i>
                        </button>
                        <button onclick="downloadDataURINew('${imageUrl}', 'desain_interior_${id}.png'); event.stopPropagation();" class="text-white p-2 rounded-full shadow-md" style="background-color: #0EA5E9;" title="Unduh Gambar">
                            <i class="fas fa-download"></i>
                        </button>
                    </div>`;
                card.classList.remove('bg-gray-100', 'flex', 'items-center', 'justify-center');
                card.classList.add('relative');
            } catch (error) {
                console.error(`Error for interior design card ${id}:`, error);
                card.innerHTML = `<div class="text-xs text-red-500 p-2 text-center break-all">Gagal: ${error.message}</div>`;
            }
        }

        // --- EKSTERIOR ---
        const drEksteriorHouseInput = document.getElementById('dr-eksterior-house-input');
        const drEksteriorHouseUploadBox = document.getElementById('dr-eksterior-house-upload-box');
        const drEksteriorHousePreview = document.getElementById('dr-eksterior-house-preview');
        const drEksteriorHousePlaceholder = document.getElementById('dr-eksterior-house-placeholder');
        const drEksteriorRemoveHouseBtn = document.getElementById('dr-eksterior-remove-house-btn');
        const drEksteriorStyleOptions = document.getElementById('dr-eksterior-style-options');
        const drEksteriorKustomContainer = document.getElementById('dr-eksterior-kustom-container');
        const drEksteriorKustomInput = document.getElementById('dr-eksterior-kustom-input');
        const drEksteriorInstructionInput = document.getElementById('dr-eksterior-instruction-input');
        const drEksteriorMagicInstructionBtn = document.getElementById('dr-eksterior-magic-instruction-btn');
        const drEksteriorRatioOptions = document.getElementById('dr-eksterior-ratio-options');
        const drEksteriorGenerateBtn = document.getElementById('dr-eksterior-generate-btn');
        const drEksteriorResultsContainer = document.getElementById('dr-eksterior-results-container');
        const drEksteriorResultsGrid = document.getElementById('dr-eksterior-results-grid');

        let drEksteriorHouseData = null;

        function drEksteriorUpdateGenerateButtonState() {
            const hasImage = !!drEksteriorHouseData;
            const hasStyle = drEksteriorStyleOptions.querySelector('.selected') !== null;
            const hasInstruction = drEksteriorInstructionInput.value.trim() !== '';

            drEksteriorGenerateBtn.disabled = !hasImage || !hasStyle || !hasInstruction;
            drEksteriorMagicInstructionBtn.disabled = !hasImage || !hasStyle;
        }

        setupImageUploadNew(drEksteriorHouseInput, drEksteriorHouseUploadBox, (data) => {
            drEksteriorHouseData = data;
            drEksteriorHousePreview.src = data.dataUrl;
            drEksteriorHousePlaceholder.classList.add('hidden');
            drEksteriorHousePreview.classList.remove('hidden');
            drEksteriorRemoveHouseBtn.classList.remove('hidden');
            drEksteriorUpdateGenerateButtonState();
        });

        drEksteriorRemoveHouseBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            drEksteriorHouseData = null;
            drEksteriorHouseInput.value = '';
            drEksteriorHousePreview.src = '#';
            drEksteriorHousePreview.classList.add('hidden');
            drEksteriorHousePlaceholder.classList.remove('hidden');
            drEksteriorRemoveHouseBtn.classList.add('hidden');

            document.getElementById('dr-eksterior-results-placeholder').classList.remove('hidden');
            drEksteriorResultsContainer.classList.add('hidden');
            drEksteriorResultsGrid.innerHTML = '';

            drEksteriorUpdateGenerateButtonState();
        });

        setupOptionButtonsNew(drEksteriorStyleOptions, true);
        drEksteriorStyleOptions.addEventListener('click', (e) => {
            const button = e.target.closest('button');
            if (button && button.dataset.value === 'Kustom') {
                drEksteriorKustomContainer.classList.toggle('hidden', !button.classList.contains('selected'));
            }
            drEksteriorUpdateGenerateButtonState();
        });

        drEksteriorInstructionInput.addEventListener('input', drEksteriorUpdateGenerateButtonState);
        setupOptionButtonsNew(drEksteriorRatioOptions);

        drEksteriorMagicInstructionBtn.addEventListener('click', async () => {
            const originalBtnHTML = drEksteriorMagicInstructionBtn.innerHTML;
            drEksteriorMagicInstructionBtn.disabled = true;
            drEksteriorMagicInstructionBtn.innerHTML = `<div class="loader-icon-umrah w-5 h-5"></div>`;

            try {
                const selectedStyles = Array.from(drEksteriorStyleOptions.querySelectorAll('.selected')).map(btn => {
                    if (btn.dataset.value === 'Kustom') {
                        return drEksteriorKustomInput.value.trim();
                    }
                    return btn.dataset.value;
                }).filter(Boolean);

                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
                const systemPrompt = `You are a professional exterior architect. Analyze the provided house photo and the user's selected renovation themes. Based on this, generate a concise design instruction in Indonesian for an AI image generator. For example: "Ganti warna cat rumah menjadi abu-abu modern, tambahkan taman minimalis di halaman depan, dan ganti pagar dengan model besi tempa hitam." Respond ONLY with the instruction text.`;
                const userQuery = `House photo provided. Renovation themes: ${selectedStyles.join(', ')}. Generate an instruction.`;

                const payload = {
                    contents: [{ parts: [{ text: userQuery }, { inlineData: { mimeType: drEksteriorHouseData.mimeType, data: drEksteriorHouseData.base64 } }] }],
                    systemInstruction: { parts: [{ text: systemPrompt }] }
                };

                const response = await fetch(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
                if (!response.ok) throw new Error(`Error ${response.status}`);

                const result = await response.json();
                drEksteriorInstructionInput.value = result.candidates[0].content.parts[0].text.trim();
                drEksteriorUpdateGenerateButtonState();

            } catch (error) {
                console.error("Error generating magic instruction:", error);
                drEksteriorInstructionInput.value = `Gagal membuat instruksi: ${error.message}`;
            } finally {
                drEksteriorMagicInstructionBtn.innerHTML = originalBtnHTML;
                drEksteriorUpdateGenerateButtonState();
            }
        });

        drEksteriorGenerateBtn.addEventListener('click', async () => {
            const originalBtnHTML = drEksteriorGenerateBtn.innerHTML;
            drEksteriorGenerateBtn.disabled = true;
            drEksteriorGenerateBtn.innerHTML = `<div class="loader-icon-umrah !border-l-white w-5 h-5"></div><span class="ml-2">Mendesain Ulang...</span>`;

            document.getElementById('dr-eksterior-results-placeholder').classList.add('hidden');

            const aspectRatio = drEksteriorRatioOptions.querySelector('.selected').dataset.value;
            const aspectClass = getAspectRatioClassNew(aspectRatio);

            drEksteriorResultsContainer.classList.remove('hidden');
            drEksteriorResultsGrid.innerHTML = '';
            for (let i = 1; i <= 4; i++) {
                const card = document.createElement('div');
                card.id = `dr-eksterior-card-${i}`;
                card.className = `card overflow-hidden bg-gray-100 flex items-center justify-center ${aspectClass}`;
                card.innerHTML = `<div class="loader-icon-umrah w-8 h-8"></div>`;
                drEksteriorResultsGrid.appendChild(card);
            }

            const generationPromises = [1, 2, 3, 4].map(i => generateSingleEksteriorDesign(i, aspectRatio));
            await Promise.allSettled(generationPromises);

            drEksteriorGenerateBtn.disabled = false;
            drEksteriorGenerateBtn.innerHTML = originalBtnHTML;
        });

        async function generateSingleEksteriorDesign(id, aspectRatio) {
            const card = document.getElementById(`dr-eksterior-card-${id}`);
            try {
                const selectedStyles = Array.from(drEksteriorStyleOptions.querySelectorAll('.selected')).map(btn => {
                    if (btn.dataset.value === 'Kustom') return drEksteriorKustomInput.value.trim();
                    return btn.dataset.value;
                }).filter(Boolean);

                const instruction = drEksteriorInstructionInput.value.trim();

                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-image-preview:generateContent?key=${apiKey}`;
                const prompt = `Redesign the exterior of the house in the provided image. CRITICAL: Maintain the core structure and shape of the original house. Focus only on changing the facade, colors, materials, and landscaping as instructed.
                - Renovation Themes: ${selectedStyles.join(', ')}.
                - Detailed Instructions: "${instruction}".
                The final result must be a photorealistic image of the redesigned house exterior. This is design variation number ${id}.`;

                const payload = {
                    contents: [{ parts: [{ text: prompt }, { inlineData: { mimeType: drEksteriorHouseData.mimeType, data: drEksteriorHouseData.base64 } }] }],
                    generationConfig: {
                        responseModalities: ['IMAGE'],
                        imageConfig: { aspectRatio: aspectRatio }
                    }
                };

                const response = await fetch(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
                if (!response.ok) throw new Error(`Error ${response.status}`);

                const result = await response.json();
                const base64Data = result?.candidates?.[0]?.content?.parts?.find(p => p.inlineData)?.inlineData?.data;
                if (!base64Data) throw new Error("No image data from AI for this design.");

                const imageUrl = `data:image/png;base64,${base64Data}`;
                card.innerHTML = `
                    <img src="${imageUrl}" class="w-full h-full object-cover cursor-pointer" onclick="window.open('${imageUrl}', '_blank')">
                    <div class="absolute bottom-2 right-2 flex gap-1">
                        <button onclick="window.open('${imageUrl}', '_blank')" class="bg-white hover:bg-gray-100 text-gray-800 p-2 rounded-full shadow-md" title="Lihat Gambar">
                            <i class="fas fa-eye"></i>
                        </button>
                        <button onclick="downloadDataURINew('${imageUrl}', 'desain_eksterior_${id}.png'); event.stopPropagation();" class="text-white p-2 rounded-full shadow-md" style="background-color: #0EA5E9;" title="Unduh Gambar">
                            <i class="fas fa-download"></i>
                        </button>
                    </div>`;
                card.classList.remove('bg-gray-100', 'flex', 'items-center', 'justify-center');
                card.classList.add('relative');
            } catch (error) {
                console.error(`Error for eksterior design card ${id}:`, error);
                card.innerHTML = `<div class="text-xs text-red-500 p-2 text-center break-all">Gagal: ${error.message}</div>`;
            }
        }
    })();

    // ==================== SKETSA GAMBAR ====================
    (function() {
        const stiImageInput = document.getElementById('sti-image-input');
        const stiUploadBox = document.getElementById('sti-upload-box');
        const stiPreview = document.getElementById('sti-preview');
        const stiPlaceholder = document.getElementById('sti-placeholder');
        const stiRemoveBtn = document.getElementById('sti-remove-btn');
        const stiPurposeOptions = document.getElementById('sti-purpose-options');
        const stiCustomPurposeContainer = document.getElementById('sti-custom-purpose-container');
        const stiCustomPurposeInput = document.getElementById('sti-custom-purpose-input');
        const stiPromptInput = document.getElementById('sti-prompt-input');
        const stiMagicPromptBtn = document.getElementById('sti-magic-prompt-btn');
        const stiRatioOptions = document.getElementById('sti-ratio-options');
        const stiGenerateBtn = document.getElementById('sti-generate-btn');
        const stiResultsContainer = document.getElementById('sti-results-container');
        const stiResultsGrid = document.getElementById('sti-results-grid');

        if (!stiImageInput) return;

        let stiImageData = null;

        function stiUpdateButtons() {
            const hasImage = !!stiImageData;
            const hasPurpose = stiPurposeOptions.querySelector('.selected') !== null;
            const hasPrompt = stiPromptInput.value.trim() !== '';

            stiGenerateBtn.disabled = !hasImage || !hasPurpose || !hasPrompt;
            stiMagicPromptBtn.disabled = !hasImage || !hasPurpose;
        }

        setupImageUploadNew(stiImageInput, stiUploadBox, (data) => {
            stiImageData = data;
            stiPreview.src = data.dataUrl;
            stiPlaceholder.classList.add('hidden');
            stiPreview.classList.remove('hidden');
            stiRemoveBtn.classList.remove('hidden');
            stiUpdateButtons();
        });

        stiRemoveBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            stiImageData = null;
            stiImageInput.value = '';
            stiPreview.src = '#';
            stiPreview.classList.add('hidden');
            stiPlaceholder.classList.remove('hidden');
            stiRemoveBtn.classList.add('hidden');

            document.getElementById('sti-results-placeholder').classList.remove('hidden');
            stiResultsContainer.classList.add('hidden');
            stiResultsGrid.innerHTML = '';

            stiUpdateButtons();
        });

        setupOptionButtonsNew(stiPurposeOptions);
        stiPurposeOptions.addEventListener('click', (e) => {
            const button = e.target.closest('button');
            if (button && button.dataset.value === 'Kustom') {
                stiCustomPurposeContainer.classList.toggle('hidden', !button.classList.contains('selected'));
            }
            stiUpdateButtons();
        });

        stiPromptInput.addEventListener('input', stiUpdateButtons);
        setupOptionButtonsNew(stiRatioOptions);

        stiMagicPromptBtn.addEventListener('click', async () => {
            const originalBtnHTML = stiMagicPromptBtn.innerHTML;
            stiMagicPromptBtn.disabled = true;
            stiMagicPromptBtn.innerHTML = `<div class="loader-icon-umrah w-5 h-5"></div>`;

            try {
                let purpose = document.querySelector('#sti-purpose-options .selected').dataset.value;
                if (purpose === 'Kustom') {
                    purpose = stiCustomPurposeInput.value.trim() || 'Gambar Digital';
                }

                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
                const systemPrompt = `You are a professional designer assistant. Analyze the provided sketch image and the user's intended purpose. Generate a concise, detailed prompt in Indonesian for an AI image generator to convert this sketch into a polished digital image. The prompt should specify the style, colors, details, and quality appropriate for the purpose. Respond ONLY with the prompt text, nothing else.`;
                const userQuery = `Sketch image provided. Purpose: ${purpose}. Generate a detailed conversion prompt.`;

                const payload = {
                    contents: [{ parts: [{ text: userQuery }, { inlineData: { mimeType: stiImageData.mimeType, data: stiImageData.base64 } }] }],
                    systemInstruction: { parts: [{ text: systemPrompt }] }
                };

                const response = await fetch(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
                if (!response.ok) throw new Error(`Error ${response.status}`);

                const result = await response.json();
                stiPromptInput.value = result.candidates[0].content.parts[0].text.trim();
                stiUpdateButtons();

            } catch (error) {
                console.error("Error generating magic prompt:", error);
                stiPromptInput.value = `Gagal membuat instruksi: ${error.message}`;
            } finally {
                stiMagicPromptBtn.innerHTML = originalBtnHTML;
                stiUpdateButtons();
            }
        });

        stiGenerateBtn.addEventListener('click', async () => {
            const originalBtnHTML = stiGenerateBtn.innerHTML;
            stiGenerateBtn.disabled = true;
            stiGenerateBtn.innerHTML = `<div class="loader-icon-umrah !border-l-white w-5 h-5"></div><span class="ml-2">Membuat Gambar...</span>`;

            document.getElementById('sti-results-placeholder').classList.add('hidden');

            const aspectRatio = stiRatioOptions.querySelector('.selected').dataset.value;
            const aspectClass = getAspectRatioClassNew(aspectRatio);

            stiResultsContainer.classList.remove('hidden');
            stiResultsGrid.innerHTML = '';
            for (let i = 1; i <= 4; i++) {
                const card = document.createElement('div');
                card.id = `sti-card-${i}`;
                card.className = `card overflow-hidden bg-gray-100 flex items-center justify-center ${aspectClass}`;
                card.innerHTML = `<div class="loader-icon-umrah w-8 h-8"></div>`;
                stiResultsGrid.appendChild(card);
            }

            const generationPromises = [1, 2, 3, 4].map(i => generateSingleSketchImage(i, aspectRatio));
            await Promise.allSettled(generationPromises);

            stiGenerateBtn.disabled = false;
            stiGenerateBtn.innerHTML = originalBtnHTML;
        });

        async function generateSingleSketchImage(id, aspectRatio) {
            const card = document.getElementById(`sti-card-${id}`);
            try {
                let purpose = document.querySelector('#sti-purpose-options .selected').dataset.value;
                if (purpose === 'Kustom') {
                    purpose = stiCustomPurposeInput.value.trim() || 'Gambar Digital';
                }

                const instruction = stiPromptInput.value.trim();

                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-image-preview:generateContent?key=${apiKey}`;
                const prompt = `Transform the provided sketch into a polished, professional digital image.
                Purpose: ${purpose}.
                Detailed Instructions: "${instruction}".
                This is variation number ${id}. Create a high-quality, finished artwork based on the sketch. The final result must be clean, professional, and suitable for its intended purpose.`;

                const payload = {
                    contents: [{ parts: [{ text: prompt }, { inlineData: { mimeType: stiImageData.mimeType, data: stiImageData.base64 } }] }],
                    generationConfig: {
                        responseModalities: ['IMAGE'],
                        imageConfig: { aspectRatio: aspectRatio }
                    }
                };

                const response = await fetch(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
                if (!response.ok) throw new Error(`Error ${response.status}`);

                const result = await response.json();
                const base64Data = result?.candidates?.[0]?.content?.parts?.find(p => p.inlineData)?.inlineData?.data;
                if (!base64Data) throw new Error("No image data from AI.");

                const imageUrl = `data:image/png;base64,${base64Data}`;
                card.innerHTML = `
                    <img src="${imageUrl}" class="w-full h-full object-cover cursor-pointer" onclick="window.open('${imageUrl}', '_blank')">
                    <div class="absolute bottom-2 right-2 flex gap-1">
                        <button onclick="window.open('${imageUrl}', '_blank')" class="bg-white hover:bg-gray-100 text-gray-800 p-2 rounded-full shadow-md" title="Lihat Gambar">
                            <i class="fas fa-eye"></i>
                        </button>
                        <button onclick="downloadDataURINew('${imageUrl}', 'sketsa_gambar_${id}.png'); event.stopPropagation();" class="text-white p-2 rounded-full shadow-md" style="background-color: #8B5CF6;" title="Unduh Gambar">
                            <i class="fas fa-download"></i>
                        </button>
                    </div>`;
                card.classList.remove('bg-gray-100', 'flex', 'items-center', 'justify-center');
                card.classList.add('relative');
            } catch (error) {
                console.error(`Error for sketch card ${id}:`, error);
                card.innerHTML = `<div class="text-xs text-red-500 p-2 text-center break-all">Gagal: ${error.message}</div>`;
            }
        }
    })();

    // ==================== BIKIN CAROUSEL ====================
    (() => {
        const crslImageInput = document.getElementById('crsl-image-input');
        const crslUploadBox = document.getElementById('crsl-upload-box');
        const crslPreview = document.getElementById('crsl-preview');
        const crslPlaceholder = document.getElementById('crsl-placeholder');
        const crslRemoveBtn = document.getElementById('crsl-remove-btn');
        const crslNameInput = document.getElementById('crsl-name-input');
        const crslDescInput = document.getElementById('crsl-desc-input');
        const crslAutoBtn = document.getElementById('crsl-auto-btn');
        const crslAutoScriptBtn = document.getElementById('crsl-auto-script-btn');
        const crslSlidesOptions = document.getElementById('crsl-slides-options');
        const crslRatioOptions = document.getElementById('crsl-ratio-options');
        const crslStyleOptions = document.getElementById('crsl-style-options');
        const crslScriptTypeOptions = document.getElementById('crsl-script-type-options');
        const crslScriptEditorContainer = document.getElementById('crsl-script-editor-container');
        const crslGenerateBtn = document.getElementById('crsl-generate-btn');
        const crslResultsContainer = document.getElementById('crsl-results-container');
        const crslResultsGrid = document.getElementById('crsl-results-grid');
        const crslKustomScriptContainer = document.getElementById('crsl-kustom-script-container');
        const crslKustomScriptInput = document.getElementById('crsl-kustom-script-input');
        const crslAutoNameTooltip = document.getElementById('crsl-auto-name-tooltip');
        const crslAutoScriptTooltip = document.getElementById('crsl-auto-script-tooltip');
        const crslTextModeToggle = document.getElementById('crsl-text-mode-toggle');
        const crslScriptSection = document.getElementById('crsl-script-section');
        const crslPositionOptions = document.getElementById('crsl-position-options');
        const crslFontOptions = document.getElementById('crsl-font-options');
        const crslFontColorOptions = document.getElementById('crsl-font-color-options');
        const crslTextSettingsSection = document.getElementById('crsl-text-settings-section');
        const crslAutoColorPreviewContainer = document.getElementById('crsl-auto-color-preview-container');
        const crslAutoColorPreview = document.getElementById('crsl-auto-color-preview');

        if (!crslImageInput) return;

        let crslImageData = null;
        let crslAutoFontColor = '#FFFFFF';
        const generatedCarousels = {};

        async function analyzeImageForFontColor(imageData) {
            return new Promise((resolve) => {
                const img = new Image();
                img.onload = () => {
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');
                    const sampleSize = 100;
                    canvas.width = sampleSize;
                    canvas.height = sampleSize;
                    ctx.drawImage(img, img.width * 0.25, img.height * 0.7, img.width * 0.5, img.height * 0.3, 0, 0, sampleSize, sampleSize);

                    const pixelData = ctx.getImageData(0, 0, sampleSize, sampleSize).data;
                    let totalBrightness = 0;
                    for (let i = 0; i < pixelData.length; i += 4) {
                        const r = pixelData[i];
                        const g = pixelData[i+1];
                        const b = pixelData[i+2];
                        const brightness = (0.299 * r + 0.587 * g + 0.114 * b) / 255;
                        totalBrightness += brightness;
                    }
                    const avgBrightness = totalBrightness / (pixelData.length / 4);
                    resolve(avgBrightness > 0.5 ? '#1f2937' : '#FFFFFF');
                };
                img.onerror = () => resolve('#FFFFFF');
                img.src = imageData.dataUrl;
            });
        }

        function showTooltip(tooltipElement) {
            tooltipElement.classList.add('visible');
            setTimeout(() => {
                tooltipElement.classList.remove('visible');
            }, 5000);
        }

        function crslUpdateButtons() {
            const hasImage = !!crslImageData;
            const hasName = crslNameInput.value.trim() !== '';
            const hasDesc = crslDescInput.value.trim() !== '';

            let scriptOk = true;
            if (crslTextModeToggle.checked) {
                const scriptTextareas = crslScriptEditorContainer.querySelectorAll('textarea');
                scriptOk = scriptTextareas.length > 0 && Array.from(scriptTextareas).every(ta => ta.value.trim() !== '');
            }

            crslGenerateBtn.disabled = !hasImage || !hasName || !hasDesc || !scriptOk;
            crslAutoBtn.disabled = !hasImage;
            crslAutoScriptBtn.disabled = !hasImage || !hasName || !hasDesc;

            if (hasImage && !hasName && !hasDesc) {
                showTooltip(crslAutoNameTooltip);
            } else if (hasImage && hasName && hasDesc) {
                if (crslTextModeToggle.checked) {
                    const scriptTextareas = crslScriptEditorContainer.querySelectorAll('textarea');
                    if (scriptTextareas.length > 0 && Array.from(scriptTextareas).every(ta => ta.value.trim() === '')) {
                        showTooltip(crslAutoScriptTooltip);
                    }
                }
            }
        }

        function crslDisplayScriptEditor() {
            if (!crslTextModeToggle.checked) {
                crslScriptEditorContainer.innerHTML = '';
                crslScriptEditorContainer.classList.add('hidden');
                crslUpdateButtons();
                return;
            }

            const slideCount = parseInt(crslSlidesOptions.querySelector('.selected').dataset.value);
            crslScriptEditorContainer.innerHTML = '';
            for (let i = 0; i < slideCount; i++) {
                const slideEl = document.createElement('div');
                slideEl.className = 'flex flex-col gap-1';
                slideEl.innerHTML = `
                    <label for="crsl-slide-text-${i}" class="text-sm font-semibold text-gray-700">Slide ${i + 1}</label>
                    <textarea id="crsl-slide-text-${i}" class="w-full p-2 text-sm rounded-lg border focus:ring-2 focus:outline-none" rows="2" placeholder="Klik 'Buat Script Otomatis' atau isi manual..."></textarea>
                `;
                crslScriptEditorContainer.appendChild(slideEl);
            }
            crslScriptEditorContainer.querySelectorAll('textarea').forEach(ta => ta.addEventListener('input', crslUpdateButtons));
            crslScriptEditorContainer.classList.remove('hidden');
            crslUpdateButtons();
        }

        crslTextModeToggle.addEventListener('change', () => {
            const isTextMode = crslTextModeToggle.checked;
            crslScriptSection.classList.toggle('hidden', !isTextMode);
            crslTextSettingsSection.classList.toggle('hidden', !isTextMode);
            if (isTextMode) {
                crslDisplayScriptEditor();
            }
            crslUpdateButtons();
        });

        setupOptionButtonsNew(crslPositionOptions);
        setupOptionButtonsNew(crslFontOptions);
        setupOptionButtonsNew(crslFontColorOptions);
        setupOptionButtonsNew(crslSlidesOptions);
        setupOptionButtonsNew(crslRatioOptions);
        setupOptionButtonsNew(crslStyleOptions);
        setupOptionButtonsNew(crslScriptTypeOptions);

        crslDisplayScriptEditor();

        setupImageUploadNew(crslImageInput, crslUploadBox, async (data) => {
            crslImageData = data;
            crslPreview.src = data.dataUrl;
            crslPlaceholder.classList.add('hidden');
            crslPreview.classList.remove('hidden');
            crslRemoveBtn.classList.remove('hidden');
            crslDisplayScriptEditor();
            crslUpdateButtons();

            crslAutoColorPreviewContainer.style.display = 'flex';
            crslAutoColorPreview.style.backgroundColor = 'transparent';
            crslAutoFontColor = await analyzeImageForFontColor(data);
            crslAutoColorPreview.style.backgroundColor = crslAutoFontColor;
        });

        crslRemoveBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            crslImageData = null;
            crslImageInput.value = '';
            crslNameInput.value = '';
            crslDescInput.value = '';
            crslPreview.src = '#';
            crslPreview.classList.add('hidden');
            crslPlaceholder.classList.remove('hidden');
            crslRemoveBtn.classList.add('hidden');
            crslScriptEditorContainer.innerHTML = '';
            crslScriptEditorContainer.classList.add('hidden');

            document.getElementById('crsl-results-placeholder').classList.remove('hidden');
            crslResultsContainer.classList.add('hidden');
            crslResultsGrid.innerHTML = '';

            crslUpdateButtons();
        });

        [crslNameInput, crslDescInput].forEach(el => el.addEventListener('input', crslUpdateButtons));

        crslSlidesOptions.addEventListener('click', () => {
            if(crslImageData) crslDisplayScriptEditor();
        });

        crslScriptTypeOptions.addEventListener('click', (e) => {
            const button = e.target.closest('button');
            if (button) {
                const isKustom = button.dataset.type === 'kustom';
                crslKustomScriptContainer.classList.toggle('hidden', !isKustom);
                if (isKustom) {
                    crslKustomScriptInput.focus();
                }
            }
            if(crslImageData) crslDisplayScriptEditor();
        });

        crslAutoBtn.addEventListener('click', async () => {
            if (!crslImageData) return;
            crslAutoNameTooltip.classList.remove('visible');
            const originalBtnHTML = crslAutoBtn.innerHTML;
            crslAutoBtn.disabled = true;
            crslAutoBtn.innerHTML = `<div class="loader-icon-umrah w-4 h-4"></div><span class="ml-2">Memproses...</span>`;
            try {
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
                const systemPrompt = `Analyze the product image. Respond with a JSON object containing two keys: "productName" (a suitable name for the product) and "shortDescription" (a brief, appealing description, max 15 words). Both must be in Indonesian.`;
                const payload = {
                    contents: [{ parts: [ { text: "Analyze this product." }, { inlineData: { mimeType: crslImageData.mimeType, data: crslImageData.base64 } } ] }],
                    systemInstruction: { parts: [{ text: systemPrompt }] },
                    generationConfig: { responseMimeType: "application/json" }
                };
                const response = await fetch(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
                if (!response.ok) {
                    const errorBody = await response.json();
                    throw new Error(errorBody.error?.message || `Error ${response.status}`);
                }

                const result = await response.json();
                const data = JSON.parse(result.candidates[0].content.parts[0].text);
                crslNameInput.value = data.productName || '';
                crslDescInput.value = data.shortDescription || '';
                crslUpdateButtons();
            } catch(e) {
                console.error("Failed to auto-generate details:", e);
                alert(`Gagal membuat detail otomatis: ${e.message}`);
            } finally {
                crslAutoBtn.innerHTML = originalBtnHTML;
                crslAutoBtn.disabled = false;
            }
        });

        crslAutoScriptBtn.addEventListener('click', async () => {
            if (!crslImageData || !crslNameInput.value || !crslDescInput.value) return;
            crslAutoScriptTooltip.classList.remove('visible');
            const originalBtnHTML = crslAutoScriptBtn.innerHTML;
            crslAutoScriptBtn.disabled = true;
            crslAutoScriptBtn.innerHTML = `<div class="loader-icon-umrah w-4 h-4"></div><span class="ml-2">Menulis...</span>`;

            const textareas = crslScriptEditorContainer.querySelectorAll('textarea');
            textareas.forEach(ta => {
                ta.value = "AI sedang menulis...";
                ta.disabled = true;
            });

            try {
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

                const slideCount = parseInt(crslSlidesOptions.querySelector('.selected').dataset.value);
                let scriptType = crslScriptTypeOptions.querySelector('.selected').dataset.type;
                if (scriptType === 'kustom') {
                    scriptType = crslKustomScriptInput.value.trim() || 'Showcase';
                }
                const productName = crslNameInput.value;
                const productDesc = crslDescInput.value;

                const systemPrompt = `You are an expert social media copywriter. Generate a script for a product carousel with exactly ${slideCount} slides in Indonesian. The response MUST be a JSON array of strings, with each string representing the text for one slide.
CRITICAL: The text for each individual slide MUST NOT exceed 20 words.
The script must follow this structure:
1. The first slide MUST be a compelling hook to grab attention.
2. The middle ${slideCount - 2 > 0 ? slideCount - 2 : 0} slides are the main content, providing value.
3. The last slide MUST be a clear Call to Action (CTA).
The script's tone and content must be tailored to the chosen script type.`;

                const userQuery = `Product Name: ${productName}\nProduct Description: ${productDesc}\nScript Type: ${scriptType}\nNumber of Slides: ${slideCount}`;

                const payload = {
                    contents: [{ parts: [{ text: userQuery }] }],
                    systemInstruction: { parts: [{ text: systemPrompt }] },
                    generationConfig: {
                        responseMimeType: "application/json",
                        responseSchema: { type: "ARRAY", items: { "type": "STRING" } }
                    }
                };

                const response = await fetch(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
                if (!response.ok) {
                    const errorBody = await response.json();
                    throw new Error(errorBody.error?.message || `Error ${response.status}`);
                }

                const result = await response.json();
                const scriptArray = JSON.parse(result.candidates[0].content.parts[0].text);

                if (scriptArray && scriptArray.length > 0) {
                    textareas.forEach((ta, index) => {
                        ta.value = scriptArray[index] || '';
                    });
                } else {
                    throw new Error("AI returned an empty or invalid script.");
                }
                crslUpdateButtons();
            } catch(e) {
                console.error("Failed to auto-generate script:", e);
                textareas.forEach(ta => ta.value = "Gagal membuat script. Coba lagi.");
                alert(`Gagal membuat script otomatis: ${e.message}`);
            } finally {
                crslAutoScriptBtn.innerHTML = originalBtnHTML;
                textareas.forEach(ta => ta.disabled = false);
                crslUpdateButtons();
            }
        });

        async function generateSingleCarouselSlide(slideNumber, slideText, style, aspectRatio, isTextMode) {
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-image-preview:generateContent?key=${apiKey}`;

            let finalPrompt = `Create a professional and visually appealing product marketing image for a carousel slide.
- Product: Use the provided image as the central product.
- Style: The overall aesthetic must be '${style}'.
- Task: Create a unique background or scene that showcases the product. For this slide (number ${slideNumber}), create a slightly different composition or background to ensure variety.`;

            if (isTextMode) {
                 finalPrompt += `
- CRITICAL: The composition must leave ample, clean space where text could be placed over it later. The main product must not be obstructed.
- ABSOLUTE RULE: DO NOT add any text, words, or numbers to the image. The image must be purely visual, as text will be added separately.`;
            } else {
                finalPrompt += `
- This is a visual-only slide. Create an engaging and dynamic shot of the product without any text overlay space consideration.`;
            }

            finalPrompt += `
- The final image must have an aspect ratio of ${aspectRatio}.`;

            const payload = {
                contents: [{ parts: [{ text: finalPrompt }, { inlineData: { mimeType: crslImageData.mimeType, data: crslImageData.base64 } }] }],
                generationConfig: {
                    responseModalities: ['IMAGE'],
                    imageConfig: { aspectRatio: aspectRatio }
                },
            };

            const response = await fetch(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
            if (!response.ok) {
                const errorBody = await response.json();
                throw new Error(errorBody.error?.message || `Error ${response.status}`);
            }
            const result = await response.json();
            const base64Data = result?.candidates?.[0]?.content?.parts?.find(p => p.inlineData)?.inlineData?.data;
            if (!base64Data) throw new Error("No image data from AI for this slide.");

            return base64Data;
        }

        function setupCarousel(carouselId) {
            const carousel = document.getElementById(carouselId);
            if (!carousel) return;

            const slides = carousel.querySelector('.carousel-slides');
            const dots = carousel.querySelectorAll('.carousel-dot');
            const totalSlides = slides.children.length;
            let currentIndex = 0;

            function goToSlide(index) {
                currentIndex = (index + totalSlides) % totalSlides;
                slides.style.transform = `translateX(-${currentIndex * 100}%)`;
                dots.forEach((dot, i) => dot.classList.toggle('active', i === currentIndex));
            }

            carousel.querySelector('.prev').addEventListener('click', () => goToSlide(currentIndex - 1));
            carousel.querySelector('.next').addEventListener('click', () => goToSlide(currentIndex + 1));
            dots.forEach(dot => dot.addEventListener('click', () => goToSlide(parseInt(dot.dataset.slideTo))));
        }

        function renderCarouselResult(cardId, images, style, aspectRatio) {
            const card = document.getElementById(cardId);
            if (!card) return;

            function getPositionClasses(position) {
                let classes = '';
                if (position.includes('top')) classes += 'items-start ';
                else if (position.includes('middle')) classes += 'items-center ';
                else classes += 'items-end ';
                classes += 'justify-center text-center';
                return classes;
            }

            const slidesHTML = images.map((img) => {
                const positionClass = getPositionClasses(img.position);
                const textOverlay = img.text ?
                    `<div class="absolute inset-0 flex p-6 md:p-8 lg:p-10 pointer-events-none ${positionClass}">
                        <p class="text-lg lg:text-xl font-bold max-w-[90%]" style="color: ${img.fontColor}; font-family: ${img.font}; text-shadow: 2px 2px 5px rgba(0,0,0,0.9);">${img.text}</p>
                    </div>` : '';

                return `<div class="carousel-slide relative bg-black">
                            <img src="${img.src}" alt="${img.title}" class="w-full h-full object-contain">
                            ${textOverlay}
                        </div>`;
            }).join('');

            const dotsHTML = images.map((_, i) => `<div class="carousel-dot ${i === 0 ? 'active' : ''}" data-slide-to="${i}"></div>`).join('');

            const carouselContainer = card.querySelector('.carousel-container');
            carouselContainer.innerHTML = `
                <div class="carousel-slides">${slidesHTML}</div>
                <button class="carousel-nav prev"><i class="fas fa-chevron-left"></i></button>
                <button class="carousel-nav next"><i class="fas fa-chevron-right"></i></button>
                <div class="carousel-dots">${dotsHTML}</div>
            `;
            setupCarousel(cardId);
        }

        crslGenerateBtn.addEventListener('click', async () => {
            const originalBtnHTML = crslGenerateBtn.innerHTML;
            crslGenerateBtn.disabled = true;
            crslGenerateBtn.innerHTML = `<div class="loader-icon-umrah !border-l-white w-5 h-5"></div><span class="ml-2">Membuat Carousel...</span>`;

            document.getElementById('crsl-results-placeholder').classList.add('hidden');

            const slideCount = parseInt(crslSlidesOptions.querySelector('.selected').dataset.value);
            const aspectRatio = crslRatioOptions.querySelector('.selected').dataset.value;
            const style = crslStyleOptions.querySelector('.selected').dataset.value;
            const isTextMode = crslTextModeToggle.checked;
            const position = crslPositionOptions.querySelector('.selected').dataset.value;
            const font = crslFontOptions.querySelector('.selected').dataset.value;
            const selectedFontColor = crslFontColorOptions.querySelector('.selected').dataset.value;
            const fontColor = selectedFontColor === 'auto' ? crslAutoFontColor : selectedFontColor;
            const productName = crslNameInput.value.trim();

            const aspectClass = getAspectRatioClassNew(aspectRatio);

            crslResultsContainer.classList.remove('hidden');
            crslResultsGrid.innerHTML = '';

            const cardId = `crsl-result-${Date.now()}`;
            const card = document.createElement('div');
            card.id = cardId;
            card.className = 'desktop-carousel-frame';
            card.innerHTML = `
                <div class="carousel-container ${aspectClass} bg-gray-200 flex items-center justify-center">
                    <div class="loader-icon-umrah w-12 h-12"></div>
                </div>
                <div class="mt-3 text-center text-sm text-gray-600">Sedang membuat ${slideCount} slide...</div>
            `;
            crslResultsGrid.appendChild(card);

            try {
                const images = [];
                const textareas = isTextMode ? crslScriptEditorContainer.querySelectorAll('textarea') : [];

                for (let i = 0; i < slideCount; i++) {
                    card.querySelector('.text-sm').textContent = `Membuat slide ${i + 1}/${slideCount}...`;
                    const slideText = isTextMode ? textareas[i].value.trim() : '';
                    const base64Data = await generateSingleCarouselSlide(i + 1, slideText, style, aspectRatio, isTextMode);
                    const imageUrl = `data:image/png;base64,${base64Data}`;

                    images.push({
                        src: imageUrl,
                        title: `Slide ${i + 1}`,
                        text: slideText,
                        position: position,
                        font: font,
                        fontColor: fontColor
                    });
                }

                generatedCarousels[cardId] = {
                    productName: productName,
                    images: images
                };

                renderCarouselResult(cardId, images, style, aspectRatio);

                card.querySelector('.text-sm').innerHTML = `
                    <button class="crsl-open-download-btn font-semibold"
                            style="color: #EC4899;"
                            data-carousel-id="${cardId}">
                        <i class="fas fa-download mr-1"></i> Unduh Semua Slide
                    </button>
                `;

            } catch (error) {
                console.error("Error generating carousel:", error);
                card.innerHTML = `<div class="text-xs text-red-500 p-4 text-center">Gagal: ${error.message}</div>`;
            } finally {
                crslGenerateBtn.disabled = false;
                crslGenerateBtn.innerHTML = originalBtnHTML;
            }
        });

        document.body.addEventListener('click', async (e) => {
            const openDownloadBtn = e.target.closest('.crsl-open-download-btn');
            if (openDownloadBtn) {
                e.stopPropagation();
                const carouselId = openDownloadBtn.dataset.carouselId;
                const carouselData = generatedCarousels[carouselId];
                if (!carouselData) return;

                // Download all carousel slides
                openDownloadBtn.disabled = true;
                openDownloadBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-1"></i> Mengunduh...';

                for (let i = 0; i < carouselData.images.length; i++) {
                    const img = carouselData.images[i];
                    const filename = `carousel_${carouselData.productName}_slide_${i + 1}.png`.replace(/[^a-z0-9_]/gi, '_');
                    if (window.downloadDataURINew) {
                        await window.downloadDataURINew(img.src, filename);
                        // Add delay between downloads to prevent browser blocking
                        await new Promise(resolve => setTimeout(resolve, 300));
                    } else if (window.downloadImage) {
                        await window.downloadImage(img.src, filename);
                        // Add delay between downloads to prevent browser blocking
                        await new Promise(resolve => setTimeout(resolve, 300));
                    }
                }

                openDownloadBtn.disabled = false;
                openDownloadBtn.innerHTML = '<i class="fas fa-check mr-1"></i> Selesai!';
                setTimeout(() => {
                    openDownloadBtn.innerHTML = '<i class="fas fa-download mr-1"></i> Unduh Semua Slide';
                }, 2000);
            }
        });
    })();

    // ==================== LOGO GENERATOR ====================
    (() => {
        const logoBrandName = document.getElementById('logo-brand-name');
        const logoTagline = document.getElementById('logo-tagline');
        const logoBusinessDesc = document.getElementById('logo-business-desc');
        const logoIndustryOptions = document.getElementById('logo-industry-options');
        const logoTypeOptions = document.getElementById('logo-type-options');
        const logoStyleOptions = document.getElementById('logo-style-options');
        const logoColorSchemeOptions = document.getElementById('logo-color-scheme-options');
        const logoColorPaletteOptions = document.getElementById('logo-color-palette-options');
        const logoRefInput = document.getElementById('logo-ref-input');
        const logoRefUploadBox = document.getElementById('logo-ref-upload-box');
        const logoRefPreview = document.getElementById('logo-ref-preview');
        const logoRefPlaceholder = document.getElementById('logo-ref-placeholder');
        const logoRefRemoveBtn = document.getElementById('logo-ref-remove-btn');
        const logoGenerateBtn = document.getElementById('logo-generate-btn');
        const logoResultsPlaceholder = document.getElementById('logo-results-placeholder');
        const logoResultsContainer = document.getElementById('logo-results-container');
        const logoResultsGrid = document.getElementById('logo-results-grid');
        const logoDownloadAllBtn = document.getElementById('logo-download-all-btn');

        if (!logoBrandName) return;

        const apiKey = "";
        let logoRefImageData = null;
        let generatedLogos = []; // Track generated logos for Download All

        // Setup option buttons
        setupOptionButtonsNew(logoIndustryOptions);
        setupOptionButtonsNew(logoTypeOptions);
        setupOptionButtonsNew(logoColorSchemeOptions);

        // Setup checkbox buttons for styles (multi-select)
        if (logoStyleOptions) {
            logoStyleOptions.addEventListener('click', (e) => {
                const btn = e.target.closest('.checkbox-btn-logo');
                if (btn) {
                    btn.classList.toggle('active');
                    updateLogoGenerateButton();
                }
            });
        }

        // Setup color palette selection
        if (logoColorPaletteOptions) {
            logoColorPaletteOptions.addEventListener('click', (e) => {
                const chip = e.target.closest('.logo-color-chip');
                if (chip) {
                    // Toggle selection
                    const wasSelected = chip.classList.contains('selected');
                    logoColorPaletteOptions.querySelectorAll('.logo-color-chip').forEach(c => c.classList.remove('selected'));
                    if (!wasSelected) {
                        chip.classList.add('selected');
                    }
                }
            });
        }

        // Reference image upload
        setupImageUploadNew(logoRefInput, logoRefUploadBox, (data) => {
            logoRefImageData = data;
            logoRefPreview.src = data.dataUrl;
            logoRefPlaceholder.classList.add('hidden');
            logoRefPreview.classList.remove('hidden');
            logoRefRemoveBtn.classList.remove('hidden');
        });

        if (logoRefRemoveBtn) {
            logoRefRemoveBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                logoRefImageData = null;
                logoRefInput.value = '';
                logoRefPreview.src = '#';
                logoRefPreview.classList.add('hidden');
                logoRefPlaceholder.classList.remove('hidden');
                logoRefRemoveBtn.classList.add('hidden');
            });
        }

        // Update generate button state
        function updateLogoGenerateButton() {
            const hasName = logoBrandName.value.trim() !== '';
            const hasDesc = logoBusinessDesc.value.trim() !== '';
            logoGenerateBtn.disabled = !hasName || !hasDesc;
        }

        [logoBrandName, logoBusinessDesc].forEach(el => {
            if (el) el.addEventListener('input', updateLogoGenerateButton);
        });

        // Generate logos
        if (logoGenerateBtn) {
            logoGenerateBtn.addEventListener('click', async () => {
                const brandName = logoBrandName.value.trim();
                const tagline = logoTagline.value.trim();
                const businessDesc = logoBusinessDesc.value.trim();

                if (!brandName || !businessDesc) {
                    alert('Mohon isi Nama Brand dan Deskripsi Bisnis!');
                    return;
                }

                // Get selected options
                const industry = logoIndustryOptions.querySelector('.selected')?.dataset.value || 'General Business';
                const logoType = logoTypeOptions.querySelector('.selected')?.dataset.value || 'combination';
                const colorScheme = logoColorSchemeOptions.querySelector('.selected')?.dataset.value || 'colorful';

                // Get selected styles (multi-select)
                const selectedStyles = Array.from(logoStyleOptions.querySelectorAll('.active')).map(btn => btn.dataset.value);
                const styleString = selectedStyles.length > 0 ? selectedStyles.join(', ') : 'Modern Professional';

                // Get selected color palette
                const selectedColorChip = logoColorPaletteOptions.querySelector('.logo-color-chip.selected');
                const selectedColors = selectedColorChip ? selectedColorChip.dataset.colors : null;

                // Save original button state
                const originalBtnHTML = logoGenerateBtn.innerHTML;
                logoGenerateBtn.disabled = true;
                logoGenerateBtn.innerHTML = `<div class="loader-icon-logo mr-2"></div><span>Generating 6 Logos...</span>`;

                // Clear previous logos and hide download all button
                generatedLogos = [];
                if (logoDownloadAllBtn) logoDownloadAllBtn.classList.add('hidden');

                // Hide placeholder, show results
                logoResultsPlaceholder.classList.add('hidden');
                logoResultsContainer.classList.remove('hidden');
                logoResultsGrid.innerHTML = '';

                try {
                    // Generate 6 logo variations
                    for (let i = 1; i <= 6; i++) {
                        const cardId = `logo-card-${Date.now()}-${i}`;
                        const card = document.createElement('div');
                        card.id = cardId;
                        card.className = 'logo-preview-card p-4';
                        card.innerHTML = `
                            <div class="aspect-square bg-gray-100 rounded-lg flex items-center justify-center relative">
                                <div class="loader-icon-logo"></div>
                                <span class="logo-variation-badge">Variation ${i}</span>
                            </div>
                            <div class="mt-3 text-center">
                                <p class="text-sm text-gray-600">Generating variation ${i}...</p>
                            </div>
                        `;
                        logoResultsGrid.appendChild(card);

                        // Generate this variation
                        try {
                            const variationPrompt = buildLogoPrompt(brandName, tagline, businessDesc, industry, logoType, styleString, colorScheme, selectedColors, i);
                            const logoImage = await generateSingleLogo(variationPrompt, logoRefImageData);

                            // Store generated logo
                            const filename = `${brandName.replace(/\s+/g, '_')}_logo_v${i}.png`;
                            generatedLogos.push({
                                url: logoImage,
                                filename: filename
                            });

                            // Show download all button
                            if (generatedLogos.length > 0 && logoDownloadAllBtn) {
                                logoDownloadAllBtn.classList.remove('hidden');
                            }

                            // Update card with result
                            const cardEl = document.getElementById(cardId);
                            if (cardEl) {
                                cardEl.innerHTML = `
                                    <div class="aspect-square bg-white rounded-lg flex items-center justify-center relative overflow-hidden border-2 border-gray-200">
                                        <img src="${logoImage}" alt="Logo Variation ${i}" class="w-full h-full object-contain p-4">
                                        <span class="logo-variation-badge">V${i}</span>
                                    </div>
                                    <div class="mt-3 flex gap-2">
                                        <button class="logo-action-btn flex-1 text-sm" data-action="logo-preview" data-image="${logoImage}">
                                            <i class="fas fa-eye mr-1"></i> Preview
                                        </button>
                                        <button class="logo-action-btn flex-1 text-sm" data-action="logo-download" data-image="${logoImage}" data-filename="${filename}">
                                            <i class="fas fa-download mr-1"></i> Download
                                        </button>
                                    </div>
                                    <p class="text-xs text-center text-gray-500 mt-2">Style: ${styleString.split(',')[0]}</p>
                                `;
                            }
                        } catch (err) {
                            console.error(`Error generating variation ${i}:`, err);
                            const cardEl = document.getElementById(cardId);
                            if (cardEl) {
                                cardEl.innerHTML = `
                                    <div class="aspect-square bg-red-50 rounded-lg flex items-center justify-center">
                                        <div class="text-center p-4">
                                            <i class="fas fa-exclamation-circle text-red-500 text-2xl mb-2"></i>
                                            <p class="text-xs text-red-600">Failed to generate</p>
                                        </div>
                                    </div>
                                `;
                            }
                        }
                    }

                    // Show success message
                    showModal('Logo Generator', `‚ú® Berhasil! ${brandName} memiliki 6 variasi logo profesional. Download logo favorit Anda!`, 'success');

                } catch (error) {
                    console.error('Logo generation error:', error);
                    showModal('Error', `Gagal generate logo: ${error.message}`, 'error');
                    logoResultsPlaceholder.classList.remove('hidden');
                    logoResultsContainer.classList.add('hidden');
                } finally {
                    logoGenerateBtn.disabled = false;
                    logoGenerateBtn.innerHTML = originalBtnHTML;
                }
            });
        }

        // Build prompt for logo generation
        function buildLogoPrompt(brandName, tagline, businessDesc, industry, logoType, style, colorScheme, colors, variationNumber) {
            let prompt = `Create a professional logo design for "${brandName}".\n\n`;

            prompt += `BUSINESS CONTEXT:\n`;
            prompt += `- Industry: ${industry}\n`;
            prompt += `- Description: ${businessDesc}\n`;
            if (tagline) prompt += `- Tagline: "${tagline}"\n`;

            prompt += `\nLOGO SPECIFICATIONS:\n`;
            prompt += `- Logo Type: ${logoType.charAt(0).toUpperCase() + logoType.slice(1)}\n`;

            if (logoType === 'wordmark') {
                prompt += `  * Create a text-only logo using the brand name "${brandName}"\n`;
                prompt += `  * Focus on unique typography and letterforms\n`;
                prompt += `  * The logo must be purely typographic without any icons or symbols\n`;
            } else if (logoType === 'symbol') {
                prompt += `  * Create an icon/symbol-only logo without any text\n`;
                prompt += `  * The symbol should represent the brand essence\n`;
                prompt += `  * Must be recognizable and work at small sizes\n`;
            } else if (logoType === 'combination') {
                prompt += `  * Combine both "${brandName}" text and a symbolic icon\n`;
                prompt += `  * Balance the text and icon harmoniously\n`;
                prompt += `  * Create a cohesive design that works together\n`;
            } else if (logoType === 'emblem') {
                prompt += `  * Create a badge/emblem style logo\n`;
                prompt += `  * Place "${brandName}" within a shape or frame\n`;
                prompt += `  * Design should have a classic, trustworthy feel\n`;
            }

            prompt += `\nDESIGN STYLE:\n`;
            prompt += `- Style: ${style}\n`;
            prompt += `- Color Scheme: ${colorScheme}\n`;

            if (colors) {
                prompt += `- REQUIRED COLOR PALETTE: Use these specific colors: ${colors}\n`;
                prompt += `- CRITICAL: The logo MUST incorporate these colors prominently\n`;
            } else {
                prompt += `- Choose colors that best represent ${industry} and convey ${style}\n`;
            }

            prompt += `\nVARIATION ${variationNumber} REQUIREMENTS:\n`;
            if (variationNumber === 1) prompt += `- Create a bold, impactful version with strong visual weight\n`;
            else if (variationNumber === 2) prompt += `- Create a minimalist, clean version with lots of negative space\n`;
            else if (variationNumber === 3) prompt += `- Create a dynamic version with movement or energy\n`;
            else if (variationNumber === 4) prompt += `- Create an elegant, refined version with sophisticated details\n`;
            else if (variationNumber === 5) prompt += `- Create a geometric version using shapes and structured forms\n`;
            else if (variationNumber === 6) prompt += `- Create a creative version pushing boundaries while staying professional\n`;

            prompt += `\nTECHNICAL REQUIREMENTS:\n`;
            prompt += `- Design on a clean white background\n`;
            prompt += `- Ensure the logo is centered and prominent\n`;
            prompt += `- Logo should be scalable and work at any size\n`;
            prompt += `- Avoid any decorative borders, frames, or backgrounds unless it's part of the emblem design\n`;
            prompt += `- CRITICAL: Do NOT add any mockups, devices, or presentation elements\n`;
            prompt += `- Output only the logo itself\n\n`;

            prompt += `Create a unique, memorable, and professional logo that will make ${brandName} stand out in the ${industry} industry.`;

            return prompt;
        }

        // Generate single logo
        async function generateSingleLogo(prompt, referenceImageData) {
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-image-preview:generateContent?key=${apiKey}`;

            const parts = [{ text: prompt }];

            // Add reference image if provided
            if (referenceImageData) {
                parts.push({
                    inlineData: {
                        mimeType: referenceImageData.mimeType,
                        data: referenceImageData.base64
                    }
                });
                parts[0].text += `\n\nA reference logo image is provided. Draw inspiration from its style, composition, and aesthetic qualities, but create a completely original logo for "${logoBrandName.value}". Do not copy or replicate the reference.`;
            }

            const payload = {
                contents: [{ parts }],
                generationConfig: {
                    responseModalities: ['IMAGE'],
                    imageConfig: { aspectRatio: '1:1' }
                }
            };

            const response = await fetch(apiUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });

            if (!response.ok) {
                const errorBody = await response.json();
                throw new Error(errorBody.error?.message || `Error ${response.status}`);
            }

            const result = await response.json();
            const base64Data = result?.candidates?.[0]?.content?.parts?.find(p => p.inlineData)?.inlineData?.data;

            if (!base64Data) {
                throw new Error('No logo image data received from API');
            }

            return `data:image/png;base64,${base64Data}`;
        }

        // Event delegation for logo action buttons
        if (logoResultsGrid) {
            logoResultsGrid.addEventListener('click', async (e) => {
                e.stopPropagation();

                const actionBtn = e.target.closest('[data-action^="logo-"]');
                if (!actionBtn) return;

                const action = actionBtn.dataset.action;
                const imageUrl = actionBtn.dataset.image;

                if (action === 'logo-preview') {
                    // Use preview modal for better mobile UX
                    if (window.showPreviewModal) {
                        window.showPreviewModal(imageUrl);
                    } else {
                        // Fallback to new tab
                        window.open(imageUrl, '_blank');
                    }
                } else if (action === 'logo-download') {
                    const filename = actionBtn.dataset.filename;
                    if (window.downloadDataURINew) {
                        await window.downloadDataURINew(imageUrl, filename);
                    } else if (window.downloadImage) {
                        await window.downloadImage(imageUrl, filename);
                    }
                }
            });
        }

        // Download All button
        if (logoDownloadAllBtn) {
            logoDownloadAllBtn.addEventListener('click', async (e) => {
                e.stopPropagation();

                if (generatedLogos.length === 0) return;

                logoDownloadAllBtn.disabled = true;
                const originalHTML = logoDownloadAllBtn.innerHTML;
                logoDownloadAllBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i><span>Downloading...</span>';

                for (let i = 0; i < generatedLogos.length; i++) {
                    const logo = generatedLogos[i];
                    if (window.downloadDataURINew) {
                        await window.downloadDataURINew(logo.url, logo.filename);
                    } else if (window.downloadImage) {
                        await window.downloadImage(logo.url, logo.filename);
                    }
                    // Add delay between downloads for better UX
                    await new Promise(resolve => setTimeout(resolve, 500));
                }

                logoDownloadAllBtn.innerHTML = '<i class="fas fa-check mr-2"></i><span>Selesai!</span>';
                setTimeout(() => {
                    logoDownloadAllBtn.disabled = false;
                    logoDownloadAllBtn.innerHTML = originalHTML;
                }, 2000);
            });
        }

        // Helper function to show modal
        function showModal(title, message, type = 'info') {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4';

            const bgColor = type === 'success' ? 'bg-green-50' : type === 'error' ? 'bg-red-50' : 'bg-purple-50';
            const iconColor = type === 'success' ? 'text-green-600' : type === 'error' ? 'text-red-600' : 'text-purple-600';
            const icon = type === 'success' ? 'fa-check-circle' : type === 'error' ? 'fa-exclamation-circle' : 'fa-info-circle';

            modal.innerHTML = `
                <div class="${bgColor} rounded-2xl p-6 max-w-md w-full shadow-2xl">
                    <div class="text-center">
                        <i class="fas ${icon} ${iconColor} text-5xl mb-4"></i>
                        <h3 class="text-2xl font-bold text-gray-800 mb-3">${title}</h3>
                        <p class="text-gray-600 mb-6">${message}</p>
                        <button onclick="this.closest('.fixed').remove()" class="logo-action-btn">
                            <i class="fas fa-times mr-2"></i> Tutup
                        </button>
                    </div>
                </div>
            `;

            document.body.appendChild(modal);
            modal.addEventListener('click', (e) => {
                if (e.target === modal) modal.remove();
            });
        }

    })();

    // ==================== MASCOT GENERATOR ====================
    (() => {
        const mascotRefInput = document.getElementById('mascot-ref-input');
        const mascotRefUploadBox = document.getElementById('mascot-ref-upload-box');
        const mascotRefPreview = document.getElementById('mascot-ref-preview');
        const mascotRefPlaceholder = document.getElementById('mascot-ref-placeholder');
        const mascotRefRemoveBtn = document.getElementById('mascot-ref-remove-btn');
        const mascotName = document.getElementById('mascot-name');
        const mascotDescription = document.getElementById('mascot-description');
        const mascotTypeOptions = document.getElementById('mascot-type-options');
        const mascotStyleOptions = document.getElementById('mascot-style-options');
        const mascotPersonalityOptions = document.getElementById('mascot-personality-options');
        const mascotPoseOptions = document.getElementById('mascot-pose-options');
        const mascotBgOptions = document.getElementById('mascot-bg-options');
        const mascotGenerateBtn = document.getElementById('mascot-generate-btn');
        const mascotResultsPlaceholder = document.getElementById('mascot-results-placeholder');
        const mascotResultsContainer = document.getElementById('mascot-results-container');
        const mascotResultsGrid = document.getElementById('mascot-results-grid');
        const mascotRefDisplayImg = document.getElementById('mascot-ref-display-img');

        if (!mascotRefInput) return;

        const apiKey = "";
        let mascotRefImageData = null;

        // Setup option buttons
        setupOptionButtonsNew(mascotTypeOptions);
        setupOptionButtonsNew(mascotStyleOptions);
        setupOptionButtonsNew(mascotPoseOptions);
        setupOptionButtonsNew(mascotBgOptions);

        // Setup checkbox buttons for personality (multi-select)
        if (mascotPersonalityOptions) {
            mascotPersonalityOptions.addEventListener('click', (e) => {
                const btn = e.target.closest('.checkbox-btn-mascot');
                if (btn) {
                    btn.classList.toggle('active');
                }
            });
        }

        // Reference image upload (REQUIRED)
        setupImageUploadNew(mascotRefInput, mascotRefUploadBox, (data) => {
            mascotRefImageData = data;
            mascotRefPreview.src = data.dataUrl;
            mascotRefPlaceholder.classList.add('hidden');
            mascotRefPreview.classList.remove('hidden');
            mascotRefRemoveBtn.classList.remove('hidden');
            updateMascotGenerateButton();
        });

        if (mascotRefRemoveBtn) {
            mascotRefRemoveBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                mascotRefImageData = null;
                mascotRefInput.value = '';
                mascotRefPreview.src = '#';
                mascotRefPreview.classList.add('hidden');
                mascotRefPlaceholder.classList.remove('hidden');
                mascotRefRemoveBtn.classList.add('hidden');
                updateMascotGenerateButton();
            });
        }

        // Update generate button state
        function updateMascotGenerateButton() {
            const hasRef = !!mascotRefImageData;
            const hasName = mascotName.value.trim() !== '';
            const hasDesc = mascotDescription.value.trim() !== '';
            mascotGenerateBtn.disabled = !hasRef || !hasName || !hasDesc;
        }

        [mascotName, mascotDescription].forEach(el => {
            if (el) el.addEventListener('input', updateMascotGenerateButton);
        });

        // Generate mascots
        if (mascotGenerateBtn) {
            mascotGenerateBtn.addEventListener('click', async () => {
                if (!mascotRefImageData) {
                    alert('Upload gambar referensi mascot terlebih dahulu!');
                    return;
                }

                const name = mascotName.value.trim();
                const description = mascotDescription.value.trim();

                if (!name || !description) {
                    alert('Mohon isi Nama Mascot dan Deskripsi Karakter!');
                    return;
                }

                // Get selected options
                const type = mascotTypeOptions.querySelector('.selected')?.dataset.value || 'Character';
                const style = mascotStyleOptions.querySelector('.selected')?.dataset.value || 'Cute Kawaii';
                const pose = mascotPoseOptions.querySelector('.selected')?.dataset.value || 'Standing';
                const background = mascotBgOptions.querySelector('.selected')?.dataset.value || 'transparent';

                // Get selected personalities (multi-select)
                const personalities = Array.from(mascotPersonalityOptions.querySelectorAll('.active'))
                    .map(btn => btn.dataset.value);
                const personalityString = personalities.length > 0 ? personalities.join(', ') : 'Friendly';

                // Save original button state
                const originalBtnHTML = mascotGenerateBtn.innerHTML;
                mascotGenerateBtn.disabled = true;
                mascotGenerateBtn.innerHTML = `<div class="loader-icon-mascot mr-2"></div><span>Generating 4 Mascots...</span>`;

                // Hide placeholder, show results
                mascotResultsPlaceholder.classList.add('hidden');
                mascotResultsContainer.classList.remove('hidden');
                mascotResultsGrid.innerHTML = '';

                // Set reference display
                mascotRefDisplayImg.src = mascotRefImageData.dataUrl;

                try {
                    // Generate 4 mascot variations
                    for (let i = 1; i <= 4; i++) {
                        const cardId = `mascot-card-${Date.now()}-${i}`;
                        const card = document.createElement('div');
                        card.id = cardId;
                        card.className = 'mascot-preview-card p-4';
                        card.innerHTML = `
                            <div class="aspect-square bg-gray-100 rounded-lg flex items-center justify-center relative">
                                <div class="loader-icon-mascot"></div>
                                <span class="mascot-variation-badge">Variation ${i}</span>
                            </div>
                            <div class="mt-3 text-center">
                                <p class="text-sm text-gray-600">Generating variation ${i}...</p>
                            </div>
                        `;
                        mascotResultsGrid.appendChild(card);

                        // Generate this variation
                        try {
                            const variationPrompt = buildMascotPrompt(name, description, type, style, pose, background, personalityString, i);
                            const mascotImage = await generateSingleMascot(variationPrompt, mascotRefImageData);

                            // Update card with result
                            const cardEl = document.getElementById(cardId);
                            if (cardEl) {
                                cardEl.innerHTML = `
                                    <div class="aspect-square bg-white rounded-lg flex items-center justify-center relative overflow-hidden border-2 border-gray-200 p-2">
                                        <img src="${mascotImage}" alt="Mascot Variation ${i}" class="w-full h-full object-contain">
                                        <span class="mascot-variation-badge">V${i}</span>
                                    </div>
                                    <div class="mt-3 space-y-2">
                                        <div class="flex gap-2">
                                            <button class="mascot-action-btn flex-1 text-sm" data-action="mascot-preview" data-image="${mascotImage}">
                                                <i class="fas fa-eye mr-1"></i> View
                                            </button>
                                            <button class="mascot-action-btn flex-1 text-sm" data-action="mascot-download" data-image="${mascotImage}" data-filename="${name.replace(/\s+/g, '_')}_mascot_v${i}.png">
                                                <i class="fas fa-download mr-1"></i> Download
                                            </button>
                                        </div>
                                        <p class="text-xs text-center text-gray-600">${pose} pose</p>
                                    </div>
                                `;
                            }
                        } catch (err) {
                            console.error(`Error generating mascot variation ${i}:`, err);
                            const cardEl = document.getElementById(cardId);
                            if (cardEl) {
                                cardEl.innerHTML = `
                                    <div class="aspect-square bg-red-50 rounded-lg flex items-center justify-center">
                                        <div class="text-center p-4">
                                            <i class="fas fa-exclamation-circle text-red-500 text-2xl mb-2"></i>
                                            <p class="text-xs text-red-600">Failed to generate</p>
                                        </div>
                                    </div>
                                `;
                            }
                        }
                    }

                    // Show success modal
                    showMascotModal('Mascot Generator', `üéâ Berhasil! ${name} punya 4 variasi mascot keren yang mirip dengan referensi Anda!`, 'success');

                } catch (error) {
                    console.error('Mascot generation error:', error);
                    showMascotModal('Error', `Gagal generate mascot: ${error.message}`, 'error');
                    mascotResultsPlaceholder.classList.remove('hidden');
                    mascotResultsContainer.classList.add('hidden');
                } finally {
                    mascotGenerateBtn.disabled = false;
                    mascotGenerateBtn.innerHTML = originalBtnHTML;
                }
            });
        }

        // Build prompt for mascot generation with reference image
        function buildMascotPrompt(name, description, type, style, pose, background, personality, variationNumber) {
            let prompt = `CRITICAL INSTRUCTION: Analyze the provided reference image carefully and create a NEW mascot character that follows the EXACT SAME visual style, design approach, and artistic characteristics.\n\n`;

            prompt += `MASCOT SPECIFICATIONS:\n`;
            prompt += `- Character Name: "${name}"\n`;
            prompt += `- Character Type: ${type}\n`;
            prompt += `- Description: ${description}\n`;
            prompt += `- Personality Traits: ${personality}\n\n`;

            prompt += `REFERENCE IMAGE ANALYSIS:\n`;
            prompt += `You are provided with a reference image showing a mascot/character. Study it carefully and identify:\n`;
            prompt += `1. The overall art style (line work, shading, rendering technique)\n`;
            prompt += `2. The proportions and body structure\n`;
            prompt += `3. The level of detail and complexity\n`;
            prompt += `4. The color palette and color usage style\n`;
            prompt += `5. The character design principles (cute factors, exaggeration, simplification)\n`;
            prompt += `6. The visual weight and balance\n`;
            prompt += `7. The drawing/rendering technique (2D flat, 3D render, sketch, etc.)\n\n`;

            prompt += `YOUR TASK:\n`;
            prompt += `Create a COMPLETELY NEW ${type} mascot character named "${name}" that:\n`;
            prompt += `- Uses the EXACT SAME art style as the reference\n`;
            prompt += `- Has similar proportions and body structure principles\n`;
            prompt += `- Matches the level of detail and rendering quality\n`;
            prompt += `- Follows the same design philosophy and aesthetic\n`;
            prompt += `- BUT is a unique character with its own identity based on: ${description}\n\n`;

            prompt += `VISUAL STYLE REQUIREMENTS:\n`;
            prompt += `- Primary Style: ${style}\n`;
            prompt += `- The character MUST look like it was designed by the same artist as the reference\n`;
            prompt += `- Match the color harmony approach from the reference\n`;
            prompt += `- Use similar line weights and outlines as the reference\n`;
            prompt += `- Apply the same level of shading/highlights as seen in reference\n\n`;

            prompt += `POSE & COMPOSITION:\n`;
            prompt += `- Pose: ${pose}\n`;
            prompt += `- The pose should be natural and fit the character's personality: ${personality}\n`;
            prompt += `- Center the character in the frame\n`;
            prompt += `- Ensure the full character is visible\n\n`;

            prompt += `BACKGROUND:\n`;
            prompt += `- Background type: ${background}\n`;
            if (background === 'transparent') {
                prompt += `- Use a clean transparent or solid white background\n`;
                prompt += `- No environment elements, just the character\n`;
            } else if (background === 'solid color') {
                prompt += `- Use a simple solid color background that complements the character\n`;
            } else {
                prompt += `- Use a subtle gradient background that doesn't distract from the character\n`;
            }

            prompt += `\nVARIATION ${variationNumber} SPECIFIC INSTRUCTIONS:\n`;
            if (variationNumber === 1) {
                prompt += `- This is the most faithful interpretation of the reference style\n`;
                prompt += `- Stay closest to the reference's design principles\n`;
            } else if (variationNumber === 2) {
                prompt += `- Add slight personality variations while keeping the core style\n`;
                prompt += `- Emphasize the ${personality} traits more\n`;
            } else if (variationNumber === 3) {
                prompt += `- Introduce minor style evolution while maintaining consistency\n`;
                prompt += `- Adjust proportions slightly but keep the reference aesthetic\n`;
            } else if (variationNumber === 4) {
                prompt += `- Create a more expressive version with enhanced personality\n`;
                prompt += `- Push the ${personality} characteristics further\n`;
            }

            prompt += `\nFINAL REMINDERS:\n`;
            prompt += `- The mascot should look professionally designed\n`;
            prompt += `- Perfect for brand representation and marketing\n`;
            prompt += `- Memorable, unique, but clearly inspired by the reference style\n`;
            prompt += `- High quality, clean artwork suitable for commercial use\n`;
            prompt += `- Make sure it truly embodies: ${description}\n`;

            return prompt;
        }

        // Generate single mascot with reference image
        async function generateSingleMascot(prompt, referenceImageData) {
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-image-preview:generateContent?key=${apiKey}`;

            const parts = [
                { text: prompt },
                {
                    inlineData: {
                        mimeType: referenceImageData.mimeType,
                        data: referenceImageData.base64
                    }
                }
            ];

            const payload = {
                contents: [{ parts }],
                generationConfig: {
                    responseModalities: ['IMAGE'],
                    imageConfig: { aspectRatio: '1:1' }
                }
            };

            const response = await fetch(apiUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });

            if (!response.ok) {
                const errorBody = await response.json();
                throw new Error(errorBody.error?.message || `Error ${response.status}`);
            }

            const result = await response.json();
            const base64Data = result?.candidates?.[0]?.content?.parts?.find(p => p.inlineData)?.inlineData?.data;

            if (!base64Data) {
                throw new Error('No mascot image data received from API');
            }

            return `data:image/png;base64,${base64Data}`;
        }

        // Event delegation for mascot action buttons
        if (mascotResultsGrid) {
            mascotResultsGrid.addEventListener('click', async (e) => {
                e.stopPropagation();

                const actionBtn = e.target.closest('[data-action^="mascot-"]');
                if (!actionBtn) return;

                const action = actionBtn.dataset.action;
                const imageUrl = actionBtn.dataset.image;

                if (action === 'mascot-preview') {
                    window.open(imageUrl, '_blank');
                } else if (action === 'mascot-download') {
                    const filename = actionBtn.dataset.filename;
                    if (window.downloadDataURINew) {
                        await window.downloadDataURINew(imageUrl, filename);
                    } else if (window.downloadImage) {
                        await window.downloadImage(imageUrl, filename);
                    }
                }
            });
        }

        // Helper function to show modal
        function showMascotModal(title, message, type = 'info') {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4';

            const bgColor = type === 'success' ? 'bg-green-50' : type === 'error' ? 'bg-red-50' : 'bg-amber-50';
            const iconColor = type === 'success' ? 'text-green-600' : type === 'error' ? 'text-red-600' : 'text-amber-600';
            const icon = type === 'success' ? 'fa-check-circle' : type === 'error' ? 'fa-exclamation-circle' : 'fa-info-circle';

            modal.innerHTML = `
                <div class="${bgColor} rounded-2xl p-6 max-w-md w-full shadow-2xl">
                    <div class="text-center">
                        <i class="fas ${icon} ${iconColor} text-5xl mb-4"></i>
                        <h3 class="text-2xl font-bold text-gray-800 mb-3">${title}</h3>
                        <p class="text-gray-600 mb-6">${message}</p>
                        <button onclick="this.closest('.fixed').remove()" class="mascot-action-btn">
                            <i class="fas fa-times mr-2"></i> Tutup
                        </button>
                    </div>
                </div>
            `;

            document.body.appendChild(modal);
            modal.addEventListener('click', (e) => {
                if (e.target === modal) modal.remove();
            });
        }

    })();

    // ============================================
    // AFFILIATE & E-COMMERCE FEATURES
    // ============================================

    // 1. GENERATOR DESKRIPSI PRODUK SEO
    setupToggleButtons('#content-deskripsi-produk', 'desc-platform-btn');
    setupToggleButtons('#content-deskripsi-produk', 'desc-length-btn');

    const descGenerateBtn = document.getElementById('desc-generate-btn');
    if (descGenerateBtn) {
        descGenerateBtn.addEventListener('click', async () => {
            const productName = document.getElementById('desc-product-name').value.trim();
            const productLink = document.getElementById('desc-product-link').value.trim();
            const category = document.getElementById('desc-product-category').value;
            const features = document.getElementById('desc-product-features').value.trim();
            const platform = document.querySelector('.desc-platform-btn.active').dataset.platform;
            const length = document.querySelector('.desc-length-btn.active').dataset.length;

            if (!productName) {
                alert('Mohon isi nama produk!');
                return;
            }

            const outputContainer = document.getElementById('desc-output-container');
            const placeholder = document.getElementById('desc-placeholder');
            const output = document.getElementById('desc-output');
            const platformLabel = document.getElementById('desc-platform-label');

            // Show loading
            descGenerateBtn.disabled = true;
            descGenerateBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Generating...';
            placeholder.classList.add('hidden');
            outputContainer.classList.remove('hidden');
            output.innerHTML = '<div class="text-center text-gray-500"><i class="fas fa-spinner fa-spin text-2xl"></i></div>';

            try {
                const apiKey = "";
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

                const prompt = `Kamu adalah seorang copywriter profesional e-commerce dengan spesialisasi di ${platform === 'shopee' ? 'Shopee' : 'TikTok Shop'}. Buatkan deskripsi produk yang SANGAT MENARIK, PROFESIONAL, dan OPTIMAL untuk SEO.

INFORMASI PRODUK:
üì¶ Nama Produk: ${productName}
${category ? `üè∑Ô∏è Kategori: ${category}` : ''}
${features ? `‚ú® Fitur/Keunggulan: ${features}` : ''}
${productLink ? `üîó Link: ${productLink}` : ''}

PANJANG DESKRIPSI: ${length === 'short' ? 'PENDEK (3-4 paragraf padat, 200-300 kata, cocok untuk TikTok Shop)' : 'PANJANG (5-7 paragraf detail, 400-600 kata, cocok untuk Shopee)'}

STRUKTUR WAJIB YANG HARUS KAMU BUAT:

1Ô∏è‚É£ PEMBUKA MENARIK (1 paragraf)
   - Hook pembuka yang eye-catching dengan emoji
   - Highlight manfaat utama produk
   - Ciptakan sense of urgency atau eksklusivitas

2Ô∏è‚É£ DESKRIPSI DETAIL PRODUK (2-3 paragraf)
   - Jelaskan fitur dan spesifikasi lengkap
   - Sebutkan bahan/material, ukuran, varian warna (jika ada)
   - Emphasize unique selling point (USP)
   - Gunakan kata-kata sensory (lembut, halus, premium, dll)

3Ô∏è‚É£ MANFAAT & KEUNGGULAN (bullet points)
   Gunakan simbol ‚úì atau ‚≠ê untuk list:
   ‚úì Minimal 5-7 poin keunggulan
   ‚úì Fokus pada benefit, bukan hanya feature
   ‚úì Gunakan angka spesifik jika memungkinkan (misal: "Tahan hingga 24 jam")

4Ô∏è‚É£ CARA PENGGUNAAN/TIPS (jika relevan)
   - Berikan panduan singkat cara pakai/merawat
   - Tambahkan tips memaksimalkan produk

5Ô∏è‚É£ TESTIMONI/SOCIAL PROOF (1 paragraf pendek)
   - Sebutkan "Sudah dipercaya ribuan customer"
   - Highlight rating tinggi/best seller (jika disebutkan)
   - Mention BPOM/sertifikat (jika produk kesehatan/kecantikan)

6Ô∏è‚É£ SPESIFIKASI TEKNIS (bullet points)
   Buat list spesifikasi seperti:
   üìè Ukuran: ...
   ‚öñÔ∏è Berat: ...
   üé® Varian: ...
   üì¶ Isi Paket: ...

7Ô∏è‚É£ GARANSI & KEAMANAN BELANJA
   - Sebutkan garansi produk/uang kembali
   ${platform === 'shopee' ? '- Highlight "Gratis Ongkir", "COD tersedia", "Garansi Shopee"' : '- Mention "Free Shipping", "COD available"'}

8Ô∏è‚É£ CALL TO ACTION KUAT
   - Buat CTA yang compelling dan urgent
   ${platform === 'shopee' ? '- "Klik BELI SEKARANG" atau "Masukkan keranjang sebelum kehabisan!"' : '- "Check keranjang kuning!" atau "Link di bio, buruan checkout!"'}

9Ô∏è‚É£ HASHTAG STRATEGIS (10-15 hashtag)
   - Mix hashtag trending + niche specific
   - Include hashtag kategori produk
   - Tambahkan hashtag promo/diskon
   - Format: #HashtagProduk #KategoriProduk #${platform === 'shopee' ? 'Shopee' : 'TikTokShop'} #PromoHariIni #dll

ATURAN FORMATTING:
‚ùå JANGAN gunakan markdown (**bold**, __italic__, ## heading)
‚ùå JANGAN gunakan tanda ** atau __ atau ## atau ###
‚úÖ Gunakan HURUF KAPITAL untuk EMPHASIZE
‚úÖ Gunakan emoji yang RELEVAN dan menarik (tapi jangan berlebihan)
‚úÖ Gunakan simbol ‚úì ‚≠ê ‚û§ üî• üíØ untuk bullet points
‚úÖ Spasi antar section untuk readability
‚úÖ Gunakan line breaks untuk memisahkan paragraf

TONE & STYLE:
- ${platform === 'shopee' ? 'Profesional tapi tetap friendly, persuasive namun trustworthy' : 'Energik, casual, trendy, relatable untuk Gen Z/Milenial'}
- Hindari kata-kata terlalu formal atau kaku
- Natural seperti rekomendasi teman
- Fokus pada BENEFIT bukan hanya feature
- Ciptakan FOMO (Fear of Missing Out)

OUTPUT FORMAT:
[Tulis deskripsi lengkap sesuai struktur di atas, tanpa markdown, plain text compatible untuk Shopee/TikTok]`;

                const payload = {
                    contents: [{ parts: [{ text: prompt }] }],
                    generationConfig: {
                        temperature: 0.9,
                        maxOutputTokens: 3072
                    }
                };

                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error?.message || `HTTP error! status: ${response.status}`);
                }

                const result = await response.json();

                if (!result.candidates || !result.candidates[0].content || !result.candidates[0].content.parts || !result.candidates[0].content.parts[0].text) {
                    throw new Error("Invalid response structure from API.");
                }

                let description = result.candidates[0].content.parts[0].text;

                // Bersihkan markdown dari hasil
                description = cleanMarkdown(description);

                output.textContent = description;
                platformLabel.textContent = platform === 'shopee' ? 'Shopee' : 'TikTok Shop';

            } catch (error) {
                console.error('Error:', error);
                output.innerHTML = `<div class="text-red-500">Gagal generate deskripsi: ${error.message}</div>`;
            } finally {
                descGenerateBtn.disabled = false;
                descGenerateBtn.innerHTML = '<i class="fas fa-sparkles mr-2"></i>Generate Deskripsi';
            }
        });

        setupCopyButton('desc-copy-btn', 'desc-output');
    }

    // 2. GENERATOR IDE KONTEN TIKTOK
    setupToggleButtons('#content-ide-konten-tiktok', 'tiktok-type-btn');
    setupToggleButtons('#content-ide-konten-tiktok', 'tiktok-duration-btn');

    const tiktokGenerateBtn = document.getElementById('tiktok-generate-btn');
    if (tiktokGenerateBtn) {
        tiktokGenerateBtn.addEventListener('click', async () => {
            const category = document.getElementById('tiktok-category').value;
            const product = document.getElementById('tiktok-product').value.trim();
            const audience = document.getElementById('tiktok-audience').value;
            const type = document.querySelector('.tiktok-type-btn.active').dataset.type;
            const duration = document.querySelector('.tiktok-duration-btn.active').dataset.duration;

            if (!category) {
                alert('Mohon pilih kategori produk!');
                return;
            }

            const outputContainer = document.getElementById('tiktok-output-container');
            const placeholder = document.getElementById('tiktok-placeholder');
            const hookOutput = document.getElementById('tiktok-hook');
            const structureOutput = document.getElementById('tiktok-structure');
            const audioOutput = document.getElementById('tiktok-audio');
            const hashtagsOutput = document.getElementById('tiktok-hashtags');

            // Show loading
            tiktokGenerateBtn.disabled = true;
            tiktokGenerateBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Generating...';
            placeholder.classList.add('hidden');
            outputContainer.classList.remove('hidden');
            hookOutput.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
            structureOutput.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
            audioOutput.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
            hashtagsOutput.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';

            try {
                const apiKey = "";
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

                const durationText = duration === 'short' ? '15-30 detik' : duration === 'medium' ? '30-60 detik' : '60+ detik';
                const typeText = type === 'review' ? 'Review produk' : type === 'tutorial' ? 'Tutorial penggunaan' : type === 'unboxing' ? 'Unboxing' : 'Perbandingan produk';

                const prompt = `Kamu adalah Content Creator Strategist TikTok PROFESIONAL yang ahli membuat konten VIRAL dan high-converting untuk affiliate marketing. Buatkan ide konten TikTok yang DETAIL, STRATEGIS, dan PROVEN untuk meningkatkan penjualan.

BRIEF KONTEN:
üéØ Kategori: ${category}
${product ? `üì¶ Produk: ${product}` : ''}
üë• Target Audience: ${audience}
üé¨ Tipe Konten: ${typeText}
‚è±Ô∏è Durasi Target: ${durationText}

STRUKTUR LENGKAP YANG HARUS KAMU BUAT:

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
1Ô∏è‚É£ HOOK PEMBUKA (0-3 detik pertama)
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

Buat 3 ALTERNATIF HOOK PEMBUKA yang POWERFUL dan PROVEN STOP SCROLLING:

HOOK A (Pattern: Shock Value)
[Buat hook yang mengejutkan/controversial tapi masih relevan]
Contoh format: "STOP! [Fakta mengejutkan]..." atau "Jangan [action] sebelum lihat ini!"

HOOK B (Pattern: Problem-Solution)
[Buat hook yang langsung address pain point audience]
Contoh format: "Kamu tipe yang [masalah]? Ini solusinya..." atau "POV: [situasi relatable]"

HOOK C (Pattern: Curiosity Gap)
[Buat hook yang bikin penasaran dengan angka/list]
Contoh format: "[Angka] alasan kenapa..." atau "Ternyata [fakta unik]..."

PILIHAN TERBAIK: [Sebutkan Hook A/B/C yang paling cocok dan jelaskan kenapa]

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
2Ô∏è‚É£ STRUKTUR VIDEO (SECOND BY SECOND BREAKDOWN)
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

Berikan TIMELINE DETAIL dari DETIK 0 hingga SELESAI:

‚è∞ 0-3 detik:
[Hook pembuka - visual apa yang ditampilkan, text overlay apa, ekspresi/gesture]

‚è∞ 4-8 detik:
[Problem statement atau transisi - apa yang dilakukan, bagaimana menunjukkan masalah]

‚è∞ 9-15 detik:
[Introduction produk - cara show produk, angle kamera, fokus pada apa]

‚è∞ 16-25 detik:
[Demo/tutorial/before-after - step by step apa yang ditunjukkan]

‚è∞ 26-35 detik:
[Key benefits & features - highlight 2-3 manfaat utama dengan visual]

‚è∞ 36-45 detik:
[Social proof/testimonial/hasil - tampilkan bukti, review, atau hasil]

‚è∞ 46-60+ detik:
[CTA & closing - cara ajak audience klik link, urgency/promo, ending memorable]

CATATAN PENTING:
- Sebutkan text overlay yang harus muncul
- Detailkan transisi antar scene
- Jelaskan ekspresi/energy yang dibutuhkan

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
3Ô∏è‚É£ SARAN AUDIO/MUSIK TRENDING
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

Berikan 5 REKOMENDASI AUDIO dengan REASONING:

üéµ Audio #1: [Nama lagu/sound trending]
   - Vibe: [Energetik/Chill/Emotional/dll]
   - Cocok untuk: [Scene tertentu]
   - Kenapa: [Alasan strategis kenapa audio ini cocok]

üéµ Audio #2: [Nama lagu/sound trending]
   - Vibe: [...]
   - Cocok untuk: [...]
   - Kenapa: [...]

[Lanjutkan untuk Audio #3, #4, #5]

ALTERNATIF: Voiceover sendiri (jika produk butuh penjelasan detail)

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
4Ô∏è‚É£ HASHTAG STRATEGY (15-20 hashtag)
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

KATEGORI HASHTAG:

üî• TRENDING HASHTAG (3-5):
#[hashtag viral saat ini] #[...] #[...]

üéØ NICHE HASHTAG (4-6):
#[hashtag kategori produk specific] #[...] #[...]

üìç LOKASI HASHTAG (2-3):
#FYPIndonesia #[...] #[...]

üí∞ AFFILIATE/PROMO HASHTAG (3-4):
#TikTokShop #[...] #[...]

üè∑Ô∏è BRANDED/PRODUK HASHTAG (2-3):
#[nama brand/produk] #[...]

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
5Ô∏è‚É£ CAPTION COPYWRITING
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

Tulis CAPTION LENGKAP yang:
- Opening menarik (1-2 kalimat)
- Body menjelaskan value proposition (2-3 kalimat)
- CTA jelas dan urgent (1 kalimat)
- Include emoji yang relevan
- Maksimal 150 karakter (optimal untuk TikTok)

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
6Ô∏è‚É£ PRO TIPS & BEST PRACTICES
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

TIPS EXECUTION:
‚úì [Tip teknis untuk shooting/lighting/angle]
‚úì [Tip editing/transisi yang cocok]
‚úì [Tip timing posting optimal]

TIPS ENGAGEMENT:
‚úì [Cara encourage comment]
‚úì [Cara bikin audience penasaran baca caption]
‚úì [Strategi reply comment untuk boost algorithm]

TIPS CONVERSION:
‚úì [Cara subtle tapi efektif promosi link]
‚úì [Strategi create urgency/FOMO]
‚úì [Follow-up content ideas]

ATURAN FORMATTING:
‚ùå NO markdown (**bold**, __italic__, ## heading)
‚ùå NO tanda ** atau __ atau ## atau ###
‚úÖ Gunakan HURUF KAPITAL untuk EMPHASIZE
‚úÖ Gunakan emoji STRATEGIS (jangan berlebihan)
‚úÖ Gunakan simbol ‚îÅ ‚îÄ ‚Ä¢ ‚úì ‚û§ untuk structure
‚úÖ Spasi clear untuk readability

TONE & APPROACH:
- AUTHENTIC, bukan overly scripted
- RELATABLE untuk ${audience}
- ENGAGING tapi bukan clickbait menyesatkan
- STRATEGIC dengan clear goal (awareness ‚Üí interest ‚Üí click)
- TRENDY tapi timeless (bisa re-use format)

OUTPUT FORMAT:
[Tulis semua section lengkap sesuai struktur di atas, detail, actionable, dan siap execute]`;

                const payload = {
                    contents: [{ parts: [{ text: prompt }] }],
                    generationConfig: {
                        temperature: 1.0,
                        maxOutputTokens: 4096
                    }
                };

                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error?.message || `HTTP error! status: ${response.status}`);
                }

                const result = await response.json();

                if (!result.candidates || !result.candidates[0].content || !result.candidates[0].content.parts || !result.candidates[0].content.parts[0].text) {
                    throw new Error("Invalid response structure from API.");
                }

                let content = result.candidates[0].content.parts[0].text;

                // Bersihkan markdown dari hasil
                content = cleanMarkdown(content);

                console.log('TikTok content received:', content);

                // Parse output dengan pattern yang lebih flexible
                // Match untuk Hook Pembuka (1Ô∏è‚É£)
                const hookMatch = content.match(/1Ô∏è‚É£\s*HOOK PEMBUKA[^\n]*\n‚îÅ+\n([\s\S]*?)(?=\n‚îÅ+\n2Ô∏è‚É£|$)/i);

                // Match untuk Struktur Video (2Ô∏è‚É£)
                const structureMatch = content.match(/2Ô∏è‚É£\s*STRUKTUR VIDEO[^\n]*\n‚îÅ+\n([\s\S]*?)(?=\n‚îÅ+\n3Ô∏è‚É£|$)/i);

                // Match untuk Saran Audio (3Ô∏è‚É£)
                const audioMatch = content.match(/3Ô∏è‚É£\s*SARAN AUDIO[^\n]*\n‚îÅ+\n([\s\S]*?)(?=\n‚îÅ+\n4Ô∏è‚É£|$)/i);

                // Match untuk Hashtag (4Ô∏è‚É£)
                const hashtagMatch = content.match(/4Ô∏è‚É£\s*HASHTAG STRATEGY[^\n]*\n‚îÅ+\n([\s\S]*?)(?=\n‚îÅ+\n5Ô∏è‚É£|$)/i);

                // Jika parsing berhasil, tampilkan per section
                if (hookMatch || structureMatch || audioMatch || hashtagMatch) {
                    hookOutput.textContent = hookMatch ? hookMatch[1].trim() : 'Bagian hook tidak ditemukan dalam hasil';
                    structureOutput.textContent = structureMatch ? structureMatch[1].trim() : 'Bagian struktur tidak ditemukan dalam hasil';
                    audioOutput.textContent = audioMatch ? audioMatch[1].trim() : 'Bagian audio tidak ditemukan dalam hasil';
                    hashtagsOutput.textContent = hashtagMatch ? hashtagMatch[1].trim() : 'Bagian hashtag tidak ditemukan dalam hasil';
                } else {
                    // Fallback: jika parsing gagal, tampilkan semua content di setiap section
                    console.warn('TikTok parsing failed, showing raw content');
                    hookOutput.textContent = content;
                    structureOutput.textContent = '(Lihat di section Hook Pembuka)';
                    audioOutput.textContent = '(Lihat di section Hook Pembuka)';
                    hashtagsOutput.textContent = '(Lihat di section Hook Pembuka)';
                }

            } catch (error) {
                console.error('Error:', error);
                const errorMsg = `<div class="text-red-500 text-xs">Gagal: ${error.message}</div>`;
                hookOutput.innerHTML = errorMsg;
                structureOutput.innerHTML = errorMsg;
                audioOutput.innerHTML = errorMsg;
                hashtagsOutput.innerHTML = errorMsg;
            } finally {
                tiktokGenerateBtn.disabled = false;
                tiktokGenerateBtn.innerHTML = '<i class="fas fa-magic mr-2"></i>Generate Ide Konten';
            }
        });

        // Setup copy buttons for TikTok outputs (works on desktop & mobile)
        document.querySelectorAll('.tiktok-copy-btn').forEach(btn => {
            const handleCopy = async (e) => {
                e.stopPropagation();

                const targetId = btn.dataset.target;
                const target = document.getElementById(targetId);
                if (!target || !target.textContent) {
                    console.warn('Target not found or empty:', targetId);
                    return;
                }

                try {
                    await navigator.clipboard.writeText(target.textContent);
                    const originalHTML = btn.innerHTML;
                    btn.innerHTML = '<i class="fas fa-check"></i>';
                    btn.classList.add('text-green-600');
                    setTimeout(() => {
                        btn.innerHTML = originalHTML;
                        btn.classList.remove('text-green-600');
                    }, 2000);
                } catch (err) {
                    console.error('Failed to copy:', err);
                    alert('Gagal menyalin. Silakan coba lagi.');
                }
            };

            btn.addEventListener('click', handleCopy);
        });
    }

    // 3. GENERATOR SCRIPT STORY IKLAN
    setupToggleButtons('#content-script-story-iklan', 'story-tone-btn');
    setupToggleButtons('#content-script-story-iklan', 'story-length-btn');

    const storyScriptGenerateBtn = document.getElementById('story-script-generate-btn');
    if (storyScriptGenerateBtn) {
        storyScriptGenerateBtn.addEventListener('click', async () => {
            const targetAudience = document.getElementById('story-target-audience').value;
            const productName = document.getElementById('story-product-name').value.trim();
            const problem = document.getElementById('story-problem').value.trim();
            const benefits = document.getElementById('story-benefits').value.trim();
            const tone = document.querySelector('.story-tone-btn.active').dataset.tone;
            const length = document.querySelector('.story-length-btn.active').dataset.length;
            const affiliateLink = document.getElementById('story-affiliate-link').value.trim();

            if (!targetAudience || !productName || !problem) {
                alert('Mohon isi semua field yang wajib (*)!');
                return;
            }

            const outputContainer = document.getElementById('story-script-output-container');
            const placeholder = document.getElementById('story-script-placeholder');
            const scriptOutput = document.getElementById('story-script-output');
            const ctaOutput = document.getElementById('story-cta');

            // Show loading
            storyScriptGenerateBtn.disabled = true;
            storyScriptGenerateBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Generating...';
            placeholder.classList.add('hidden');
            outputContainer.classList.remove('hidden');
            scriptOutput.innerHTML = '<div class="text-center text-gray-500"><i class="fas fa-spinner fa-spin"></i></div>';
            ctaOutput.innerHTML = '<div class="text-center text-gray-500"><i class="fas fa-spinner fa-spin"></i></div>';

            try {
                const apiKey = "";
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

                const toneText = tone === 'friendly' ? 'Ramah dan bersahabat' : tone === 'professional' ? 'Profesional dan informatif' : tone === 'casual' ? 'Santai dan relatable' : 'Antusias dan energik';
                const lengthText = length === 'short' ? '30-60 detik' : '60-120 detik';

                const prompt = `Buatkan script narasi iklan produk affiliate yang natural dan meyakinkan dengan detail:

Target Audience: ${targetAudience}
Produk: ${productName}
Masalah yang Dipecahkan: ${problem}
${benefits ? `Manfaat/Solusi: ${benefits}` : ''}
Tone: ${toneText}
Durasi: ${lengthText}
${affiliateLink ? `Link Affiliate: ${affiliateLink}` : ''}

Buat script narasi dengan struktur STORY TELLING yang natural:

1. OPENING - Personal Hook (5-10 detik):
   Mulai dengan pengalaman pribadi atau situasi yang relatable dengan target audience
   Contoh: "Dulu aku juga ngalamin yang sama..." atau "Tau gak sih, aku sempat frustasi karena..."

2. PROBLEM IDENTIFICATION (10-15 detik):
   Jelaskan masalah secara detail dengan bahasa yang emosional dan relatable
   Buat audience merasa "Ini gue banget!"

3. DISCOVERY MOMENT (10-15 detik):
   Ceritakan bagaimana menemukan produk ini (jangan langsung jualan)
   Contoh: "Sampai akhirnya temen aku rekomendasiin..." atau "Iseng-iseng coba..."

4. EXPERIENCE & RESULTS (15-20 detik):
   Sharing pengalaman menggunakan produk dengan jujur
   Sebutkan hasil nyata (before-after jika ada)
   Tetap natural, boleh sebutkan kekurangan kecil tapi dibalance dengan kelebihan

5. RECOMMENDATION (10-15 detik):
   Rekomendasikan produk dengan tulus, bukan hard selling
   Sebutkan untuk siapa produk ini cocok

6. SOFT CTA (5-10 detik):
   Call-to-action yang soft dan tidak memaksa
   ${affiliateLink ? `Sebutkan link tersedia di deskripsi/bio` : 'Arahkan untuk mencari produk'}

PENTING:
- Gunakan bahasa ${targetAudience} yang natural
- Jangan terlalu formal kecuali tone professional
- Sertakan filler words yang wajar (seperti "gitu", "jadi", "nah", "terus")
- Buat terasa seperti sharing ke teman, bukan iklan
- Hindari klaim berlebihan
- JANGAN gunakan format markdown seperti **bold** atau __underline__
- JANGAN gunakan tanda ** atau __ sama sekali
- Gunakan HURUF KAPITAL atau emoji jika perlu penekanan
- Format harus plain text yang bisa langsung direcord
- Script harus natural seperti berbicara spontan

Tulis script dalam format paragraf yang bisa langsung dibaca/direcord tanpa tanda markdown.`;

                const payload = {
                    contents: [{ parts: [{ text: prompt }] }],
                    generationConfig: {
                        temperature: 0.9,
                        maxOutputTokens: 2048
                    }
                };

                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error?.message || `HTTP error! status: ${response.status}`);
                }

                const result = await response.json();

                if (!result.candidates || !result.candidates[0].content || !result.candidates[0].content.parts || !result.candidates[0].content.parts[0].text) {
                    throw new Error("Invalid response structure from API.");
                }

                let script = result.candidates[0].content.parts[0].text;

                // Bersihkan markdown dari hasil
                script = cleanMarkdown(script);

                scriptOutput.textContent = script;

                // Generate CTA suggestion
                let ctaText = '‚ú® "Link ada di bio ya, atau bisa search langsung nama produknya!"\n';
                ctaText += 'üí´ "Kalau mau coba, aku tinggalin link di deskripsi ya!"\n';
                ctaText += 'üî• "Swipe up atau check keranjang kuning untuk info lengkapnya!"';
                ctaOutput.textContent = ctaText;

            } catch (error) {
                console.error('Error:', error);
                scriptOutput.innerHTML = `<div class="text-red-500">Gagal generate script: ${error.message}</div>`;
                ctaOutput.innerHTML = '';
            } finally {
                storyScriptGenerateBtn.disabled = false;
                storyScriptGenerateBtn.innerHTML = '<i class="fas fa-wand-magic-sparkles mr-2"></i>Generate Script Story';
            }
        });

        setupCopyButton('story-script-copy-btn', 'story-script-output');
    }

    // ============================================
    // ALAT BISNIS FEATURES
    // ============================================

    // 1. RENCANA BISNIS & SWOT
    const bpGenerateBtn = document.getElementById('bp-generate-btn');
    if (bpGenerateBtn) {
        bpGenerateBtn.addEventListener('click', async () => {
            const jenisBisnis = document.getElementById('bp-jenis-bisnis').value.trim();
            const lokasi = document.getElementById('bp-lokasi').value.trim();
            const targetPasar = document.getElementById('bp-target-pasar').value.trim();
            const modal = document.getElementById('bp-modal').value.trim();
            const infoTambahan = document.getElementById('bp-info-tambahan').value.trim();

            if (!jenisBisnis) {
                alert('Mohon isi jenis bisnis!');
                return;
            }

            const outputContainer = document.getElementById('bp-output-container');
            const placeholder = document.getElementById('bp-placeholder');
            const output = document.getElementById('bp-output');

            // Show loading
            bpGenerateBtn.disabled = true;
            bpGenerateBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Generating...';
            placeholder.classList.add('hidden');
            outputContainer.classList.remove('hidden');
            output.innerHTML = '<div class="text-center text-gray-500"><i class="fas fa-spinner fa-spin text-2xl"></i></div>';

            try {
                const apiKey = "";
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

                const prompt = `Buatkan rencana bisnis dan analisis SWOT profesional untuk bisnis berikut:

Jenis Bisnis: ${jenisBisnis}
${lokasi ? `Lokasi: ${lokasi}` : ''}
${targetPasar ? `Target Pasar: ${targetPasar}` : ''}
${modal ? `Modal Awal: ${modal}` : ''}
${infoTambahan ? `Info Tambahan: ${infoTambahan}` : ''}

Format output harus mencakup:

1. RINGKASAN EKSEKUTIF
   - Visi dan misi bisnis
   - Tujuan utama (jangka pendek & panjang)

2. ANALISIS PASAR
   - Target market dan segmentasi
   - Analisis kompetitor
   - Peluang pasar

3. STRATEGI BISNIS
   - Model bisnis
   - Strategi pemasaran
   - Strategi operasional
   - Strategi SDM
   - Strategi keuangan

4. ANALISIS SWOT
   STRENGTHS (Kekuatan):
   ‚Ä¢ [3-5 poin kekuatan internal]

   WEAKNESSES (Kelemahan):
   ‚Ä¢ [3-5 poin kelemahan internal]

   OPPORTUNITIES (Peluang):
   ‚Ä¢ [3-5 poin peluang eksternal]

   THREATS (Ancaman):
   ‚Ä¢ [3-5 poin ancaman eksternal]

5. PROYEKSI KEUANGAN (1-3 tahun)
   - Estimasi modal awal
   - Proyeksi revenue
   - Break-even point
   - ROI timeline

6. RENCANA AKSI
   - Milestone 3 bulan pertama
   - Target 6 bulan
   - Roadmap 1-3 tahun

PENTING:
- JANGAN gunakan format markdown seperti **bold** atau __underline__
- Gunakan HURUF KAPITAL untuk judul
- Gunakan simbol ‚Ä¢ ‚úì ‚û§ untuk bullet points
- Berikan analisis yang realistis dan actionable
- Sesuaikan dengan jenis bisnis dan skala yang sesuai

Berikan output yang profesional dan mudah dipahami.`;

                const payload = {
                    contents: [{ parts: [{ text: prompt }] }],
                    generationConfig: {
                        temperature: 0.9,
                        maxOutputTokens: 2048
                    }
                };

                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error?.message || `HTTP error! status: ${response.status}`);
                }

                const result = await response.json();

                if (!result.candidates || !result.candidates[0].content || !result.candidates[0].content.parts || !result.candidates[0].content.parts[0].text) {
                    throw new Error("Invalid response structure from API.");
                }

                let businessPlan = result.candidates[0].content.parts[0].text;
                businessPlan = cleanMarkdown(businessPlan);
                output.textContent = businessPlan;

            } catch (error) {
                console.error('Error:', error);
                output.innerHTML = `<div class="text-red-500">Gagal generate rencana bisnis: ${error.message}</div>`;
            } finally {
                bpGenerateBtn.disabled = false;
                bpGenerateBtn.innerHTML = '<i class="fas fa-sparkles mr-2"></i>Generate Rencana Bisnis';
            }
        });

        setupCopyButton('bp-copy-btn', 'bp-output');
    }

    // 2. HR ASSISTANT
    const hrGenerateBtn = document.getElementById('hr-generate-btn');
    if (hrGenerateBtn) {
        hrGenerateBtn.addEventListener('click', async () => {
            const posisi = document.getElementById('hr-posisi').value.trim();
            const industri = document.getElementById('hr-industri').value.trim();
            const level = document.getElementById('hr-level').value;
            const keahlian = document.getElementById('hr-keahlian').value.trim();

            if (!posisi) {
                alert('Mohon isi nama posisi!');
                return;
            }

            const outputContainer = document.getElementById('hr-output-container');
            const placeholder = document.getElementById('hr-placeholder');
            const output = document.getElementById('hr-output');

            // Show loading
            hrGenerateBtn.disabled = true;
            hrGenerateBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Generating...';
            placeholder.classList.add('hidden');
            outputContainer.classList.remove('hidden');
            output.innerHTML = '<div class="text-center text-gray-500"><i class="fas fa-spinner fa-spin text-2xl"></i></div>';

            try {
                const apiKey = "";
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

                const levelText = {
                    'entry': 'Entry Level / Fresh Graduate',
                    'junior': 'Junior (1-3 tahun)',
                    'senior': 'Senior (3-5 tahun)',
                    'lead': 'Lead / Supervisor',
                    'manager': 'Manager',
                    'director': 'Director / C-Level'
                }[level] || 'Entry Level';

                const prompt = `Buatkan Job Description (JD) profesional untuk posisi berikut:

Posisi: ${posisi}
${industri ? `Industri/Bidang: ${industri}` : ''}
Level: ${levelText}
${keahlian ? `Keahlian Khusus: ${keahlian}` : ''}

Format JD harus mencakup:

1. RINGKASAN POSISI
   [1-2 paragraf overview tentang posisi ini]

2. TANGGUNG JAWAB UTAMA
   ‚Ä¢ [5-8 tanggung jawab spesifik]
   ‚Ä¢ Gunakan action verbs (mengelola, mengembangkan, menganalisis, dll)
   ‚Ä¢ Sesuaikan dengan level ${levelText}

3. KUALIFIKASI
   Pendidikan:
   ‚Ä¢ [Requirement pendidikan]

   Pengalaman:
   ‚Ä¢ [Pengalaman yang dibutuhkan]

   Keahlian Teknis:
   ‚Ä¢ [Hard skills spesifik]

   Keahlian Non-Teknis:
   ‚Ä¢ [Soft skills yang diperlukan]

4. NILAI TAMBAH (Nice to Have)
   ‚Ä¢ [2-4 kualifikasi bonus]

5. BENEFIT & FASILITAS
   ‚Ä¢ [4-6 benefit yang menarik]

6. PERTANYAAN INTERVIEW (BONUS)
   ‚Ä¢ [3-5 pertanyaan interview yang sesuai untuk posisi ini]

PENTING:
- JANGAN gunakan format markdown
- Gunakan bahasa profesional tapi friendly
- Sesuaikan tanggung jawab dengan level (${levelText})
- Buat deskripsi yang menarik kandidat berkualitas`;

                const payload = {
                    contents: [{ parts: [{ text: prompt }] }],
                    generationConfig: {
                        temperature: 0.9,
                        maxOutputTokens: 2048
                    }
                };

                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error?.message || `HTTP error! status: ${response.status}`);
                }

                const result = await response.json();

                if (!result.candidates || !result.candidates[0].content || !result.candidates[0].content.parts || !result.candidates[0].content.parts[0].text) {
                    throw new Error("Invalid response structure from API.");
                }

                let hrContent = result.candidates[0].content.parts[0].text;
                hrContent = cleanMarkdown(hrContent);
                output.textContent = hrContent;

            } catch (error) {
                console.error('Error:', error);
                output.innerHTML = `<div class="text-red-500">Gagal generate HR content: ${error.message}</div>`;
            } finally {
                hrGenerateBtn.disabled = false;
                hrGenerateBtn.innerHTML = '<i class="fas fa-sparkles mr-2"></i>Generate Job Description';
            }
        });

        setupCopyButton('hr-copy-btn', 'hr-output');
    }

    // 3. KONTEN MARKETING MULTI-PLATFORM
    const kmGenerateBtn = document.getElementById('km-generate-btn');
    if (kmGenerateBtn) {
        kmGenerateBtn.addEventListener('click', async () => {
            const produk = document.getElementById('km-produk').value.trim();
            const promosi = document.getElementById('km-promosi').value.trim();
            const info = document.getElementById('km-info').value.trim();

            const platforms = [];
            if (document.getElementById('km-platform-ig').checked) platforms.push('instagram');
            if (document.getElementById('km-platform-fb').checked) platforms.push('facebook');
            if (document.getElementById('km-platform-email').checked) platforms.push('email');
            if (document.getElementById('km-platform-ads').checked) platforms.push('google-ads');

            if (!produk || platforms.length === 0) {
                alert('Mohon isi nama produk/layanan dan pilih minimal 1 platform!');
                return;
            }

            const outputContainer = document.getElementById('km-output-container');
            const placeholder = document.getElementById('km-placeholder');
            const output = document.getElementById('km-output');

            // Show loading
            kmGenerateBtn.disabled = true;
            kmGenerateBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Generating...';
            placeholder.classList.add('hidden');
            outputContainer.classList.remove('hidden');
            output.innerHTML = '<div class="text-center text-gray-500"><i class="fas fa-spinner fa-spin text-2xl"></i></div>';

            try {
                const apiKey = "";
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

                const platformNames = {
                    'instagram': 'Instagram',
                    'facebook': 'Facebook',
                    'email': 'Email Marketing',
                    'google-ads': 'Google Ads'
                };

                const selectedPlatforms = platforms.map(p => platformNames[p]).join(', ');

                const prompt = `Buatkan konten marketing multi-platform untuk:

Produk/Layanan: ${produk}
${promosi ? `Jenis Promosi: ${promosi}` : ''}
${info ? `Info Tambahan: ${info}` : ''}
Platform: ${selectedPlatforms}

Buatkan konten yang dioptimalkan untuk SETIAP platform yang dipilih:

${platforms.includes('instagram') ? `
=== INSTAGRAM ===
üì± FEED POST:
[Caption engaging dengan emoji, max 2200 karakter]
[Call-to-action yang jelas]
[Hashtag relevan]

üì∏ STORY IDEAS:
‚Ä¢ [2-3 ide konten story dengan sticker/poll]
` : ''}

${platforms.includes('facebook') ? `
=== FACEBOOK ===
üì¢ POST:
[Caption storytelling approach]
[Include pertanyaan untuk engagement]
[CTA yang jelas]
[Hashtag relevan]
` : ''}

${platforms.includes('email') ? `
=== EMAIL MARKETING ===
üìß SUBJECT LINE:
[5 variasi subject line yang menarik]

üìù EMAIL BODY:
[Header/Hero text]
[Body copy dengan benefit produk]
[CTA button text]
[Footer text]
` : ''}

${platforms.includes('google-ads') ? `
=== GOOGLE ADS ===
üîç SEARCH ADS:
Headline 1: [Max 30 karakter]
Headline 2: [Max 30 karakter]
Headline 3: [Max 30 karakter]
Description 1: [Max 90 karakter]
Description 2: [Max 90 karakter]

üì± DISPLAY ADS:
Short Headline: [Max 30 karakter]
Long Headline: [Max 90 karakter]
Description: [Max 90 karakter]
` : ''}

TIPS IMPLEMENTASI:
‚Ä¢ Best time to post untuk setiap platform
‚Ä¢ Visual suggestions (jenis foto/video yang cocok)
‚Ä¢ Call-to-action yang efektif

PENTING:
- JANGAN gunakan format markdown **bold**
- Sesuaikan konten dengan karakteristik SETIAP platform
- Fokus pada benefit produk dan promosi
- Gunakan emoji secukupnya, tidak berlebihan
- Include sense of urgency jika ada promosi terbatas`;

                const payload = {
                    contents: [{ parts: [{ text: prompt }] }],
                    generationConfig: {
                        temperature: 0.9,
                        maxOutputTokens: 2048
                    }
                };

                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error?.message || `HTTP error! status: ${response.status}`);
                }

                const result = await response.json();

                if (!result.candidates || !result.candidates[0].content || !result.candidates[0].content.parts || !result.candidates[0].content.parts[0].text) {
                    throw new Error("Invalid response structure from API.");
                }

                let marketingContent = result.candidates[0].content.parts[0].text;
                marketingContent = cleanMarkdown(marketingContent);
                output.textContent = marketingContent;

            } catch (error) {
                console.error('Error:', error);
                output.innerHTML = `<div class="text-red-500">Gagal generate konten marketing: ${error.message}</div>`;
            } finally {
                kmGenerateBtn.disabled = false;
                kmGenerateBtn.innerHTML = '<i class="fas fa-sparkles mr-2"></i>Generate Konten Marketing';
            }
        });

        setupCopyButton('km-copy-btn', 'km-output');
    }

    // 4. RISET PASAR & IDE PRODUK
    const rmGenerateBtn = document.getElementById('rm-generate-btn');
    if (rmGenerateBtn) {
        rmGenerateBtn.addEventListener('click', async () => {
            const bisnis = document.getElementById('rm-bisnis').value.trim();
            const tujuan = document.getElementById('rm-tujuan').value;
            const target = document.getElementById('rm-target').value.trim();
            const preferensi = document.getElementById('rm-preferensi').value.trim();

            if (!bisnis) {
                alert('Mohon isi jenis bisnis saat ini!');
                return;
            }

            const outputContainer = document.getElementById('rm-output-container');
            const placeholder = document.getElementById('rm-placeholder');
            const output = document.getElementById('rm-output');

            // Show loading
            rmGenerateBtn.disabled = true;
            rmGenerateBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Generating...';
            placeholder.classList.add('hidden');
            outputContainer.classList.remove('hidden');
            output.innerHTML = '<div class="text-center text-gray-500"><i class="fas fa-spinner fa-spin text-2xl"></i></div>';

            try {
                const apiKey = "";
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

                const tujuanText = {
                    'produk-baru': 'Ide Produk/Menu Baru',
                    'ekspansi': 'Peluang Ekspansi Bisnis',
                    'tren': 'Analisis Tren Pasar',
                    'kompetitor': 'Analisis Kompetitor'
                }[tujuan] || 'Riset Pasar';

                const prompt = `Lakukan riset pasar dan berikan rekomendasi untuk bisnis berikut:

Jenis Bisnis: ${bisnis}
Tujuan Riset: ${tujuanText}
${target ? `Lokasi/Target Market: ${target}` : ''}
${preferensi ? `Preferensi Khusus: ${preferensi}` : ''}

Buatkan analisis dan rekomendasi yang fokus pada: ${tujuanText}

Format output harus mencakup:

1. RINGKASAN EKSEKUTIF
   ‚Ä¢ Key findings dari riset
   ‚Ä¢ Rekomendasi utama

2. ANALISIS PASAR
   ‚Ä¢ Overview kondisi pasar saat ini
   ‚Ä¢ Tren yang relevan dengan bisnis Anda
   ‚Ä¢ Ukuran pasar dan proyeksi pertumbuhan

3. ANALISIS KOMPETITOR
   ‚Ä¢ Kompetitor utama (3-5)
   ‚Ä¢ Keunggulan dan kelemahan mereka
   ‚Ä¢ Gap opportunity yang bisa dimanfaatkan

4. REKOMENDASI SPESIFIK
   ${tujuan === 'produk-baru' ? `
   ‚Ä¢ 5-7 ide produk/menu baru yang potensial
   ‚Ä¢ Target market untuk setiap produk
   ‚Ä¢ Estimasi harga dan profitability
   ‚Ä¢ Cara validasi ide sebelum launch` : ''}

   ${tujuan === 'ekspansi' ? `
   ‚Ä¢ Peluang ekspansi (lokasi baru, channel baru, dll)
   ‚Ä¢ Market potential untuk ekspansi
   ‚Ä¢ Resources yang dibutuhkan
   ‚Ä¢ Timeline dan milestone` : ''}

   ${tujuan === 'tren' ? `
   ‚Ä¢ 5-7 tren terkini yang relevan
   ‚Ä¢ Impact tren terhadap bisnis Anda
   ‚Ä¢ Cara memanfaatkan tren
   ‚Ä¢ Prediksi tren masa depan` : ''}

   ${tujuan === 'kompetitor' ? `
   ‚Ä¢ Analisis detail 3-5 kompetitor utama
   ‚Ä¢ Pricing strategy mereka
   ‚Ä¢ Marketing approach mereka
   ‚Ä¢ Cara differentiate dari kompetitor` : ''}

5. ACTION PLAN
   ‚Ä¢ Langkah konkret yang bisa dilakukan (prioritas tinggi)
   ‚Ä¢ Timeline implementasi
   ‚Ä¢ Estimasi investasi (jika relevan)

6. RISK & MITIGATION
   ‚Ä¢ Risiko yang perlu diantisipasi
   ‚Ä¢ Strategi mitigasi risiko

PENTING:
- JANGAN gunakan format markdown **bold**
- Berikan data dan insight yang realistis untuk pasar Indonesia
- Fokus pada actionable recommendations
- Sesuaikan dengan jenis bisnis: ${bisnis}`;

                const payload = {
                    contents: [{ parts: [{ text: prompt }] }],
                    generationConfig: {
                        temperature: 0.9,
                        maxOutputTokens: 2048
                    }
                };

                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error?.message || `HTTP error! status: ${response.status}`);
                }

                const result = await response.json();

                if (!result.candidates || !result.candidates[0].content || !result.candidates[0].content.parts || !result.candidates[0].content.parts[0].text) {
                    throw new Error("Invalid response structure from API.");
                }

                let marketResearch = result.candidates[0].content.parts[0].text;
                marketResearch = cleanMarkdown(marketResearch);
                output.textContent = marketResearch;

            } catch (error) {
                console.error('Error:', error);
                output.innerHTML = `<div class="text-red-500">Gagal generate riset pasar: ${error.message}</div>`;
            } finally {
                rmGenerateBtn.disabled = false;
                rmGenerateBtn.innerHTML = '<i class="fas fa-sparkles mr-2"></i>Generate Riset & Ide';
            }
        });

        setupCopyButton('rm-copy-btn', 'rm-output');
    }

    // 5. FINANCIAL FORECAST / SIMULATOR ANGGARAN
    const ffGenerateBtn = document.getElementById('ff-generate-btn');
    if (ffGenerateBtn) {
        ffGenerateBtn.addEventListener('click', async () => {
            const pendapatan = document.getElementById('ff-pendapatan').value.trim();
            const tipe = document.getElementById('ff-tipe').value;
            const industri = document.getElementById('ff-industri').value.trim();
            const skenario = document.getElementById('ff-skenario').value;
            const detail = document.getElementById('ff-detail').value.trim();

            if (!pendapatan) {
                alert('Mohon isi proyeksi pendapatan bulanan!');
                return;
            }

            const outputContainer = document.getElementById('ff-output-container');
            const placeholder = document.getElementById('ff-placeholder');
            const output = document.getElementById('ff-output');

            // Show loading
            ffGenerateBtn.disabled = true;
            ffGenerateBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Generating...';
            placeholder.classList.add('hidden');
            outputContainer.classList.remove('hidden');
            output.innerHTML = '<div class="text-center text-gray-500"><i class="fas fa-spinner fa-spin text-2xl"></i></div>';

            try {
                const apiKey = "";
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

                const tipeText = {
                    'umkm': 'UMKM / Bisnis Kecil',
                    'menengah': 'Bisnis Menengah',
                    'besar': 'Bisnis Besar',
                    'startup': 'Startup'
                }[tipe] || 'UMKM';

                const skenarioText = {
                    'normal': 'Normal - Alokasi Anggaran Standar',
                    'growth': 'Growth - Fokus Ekspansi & Marketing',
                    'efficiency': 'Efficiency - Fokus Penghematan',
                    'custom': 'Custom Scenario'
                }[skenario] || 'Normal';

                const prompt = `Buatkan financial forecast dan simulasi anggaran untuk bisnis berikut:

Proyeksi Pendapatan Bulanan: ${pendapatan}
Tipe Bisnis: ${tipeText}
${industri ? `Industri: ${industri}` : ''}
Skenario: ${skenarioText}
${detail ? `Detail Tambahan: ${detail}` : ''}

Buatkan analisis finansial dan simulasi anggaran yang mencakup:

1. RINGKASAN EKSEKUTIF
   ‚Ä¢ Proyeksi pendapatan bulanan: ${pendapatan}
   ‚Ä¢ Tipe bisnis: ${tipeText}
   ‚Ä¢ Skenario: ${skenarioText}

2. ALOKASI ANGGARAN BULANAN (BREAKDOWN)
   Berdasarkan pendapatan ${pendapatan}, buatkan alokasi anggaran untuk:

   BIAYA OPERASIONAL:
   ‚Ä¢ Gaji & SDM: [X%] = Rp [...]
   ‚Ä¢ Sewa/Utilitas: [X%] = Rp [...]
   ‚Ä¢ Bahan Baku/Inventory: [X%] = Rp [...]
   ‚Ä¢ Marketing & Promosi: [X%] = Rp [...]
   ‚Ä¢ Operasional Lainnya: [X%] = Rp [...]

   INVESTASI & PENGEMBANGAN:
   ‚Ä¢ [Sesuaikan dengan skenario ${skenarioText}]

   CADANGAN & PROFIT:
   ‚Ä¢ Emergency Fund: [X%] = Rp [...]
   ‚Ä¢ Net Profit Target: [X%] = Rp [...]

   TOTAL: 100% = ${pendapatan}

3. PROYEKSI CASH FLOW (6 BULAN)
   Bulan 1-6:
   ‚Ä¢ Revenue: [...]
   ‚Ä¢ Total Expenses: [...]
   ‚Ä¢ Net Cash Flow: [...]
   ‚Ä¢ Cumulative Cash: [...]

4. ANALISIS SKENARIO
   ${skenario === 'growth' ? 'Fokus pada ekspansi dan marketing (alokasi marketing lebih tinggi)' : ''}
   ${skenario === 'efficiency' ? 'Fokus pada penghematan (optimasi biaya operasional)' : ''}
   ${skenario === 'normal' ? 'Alokasi standar balanced' : ''}
   ${skenario === 'custom' ? 'Sesuaikan dengan detail yang diberikan' : ''}

5. KEY FINANCIAL RATIOS
   ‚Ä¢ Profit Margin Target: [...]%
   ‚Ä¢ Operating Ratio: [...]%
   ‚Ä¢ Cash Reserve Ratio: [...]%
   ‚Ä¢ Marketing to Revenue Ratio: [...]%

6. TIPS PENGELOLAAN KEUANGAN
   Berdasarkan tipe bisnis (${tipeText}):
   ‚Ä¢ [3-5 tips spesifik untuk mengelola keuangan]
   ‚Ä¢ Red flags yang perlu diwaspadai
   ‚Ä¢ Strategi optimasi cash flow

7. REKOMENDASI PRIORITAS
   ‚Ä¢ Top 3 hal yang harus diperhatikan
   ‚Ä¢ Area yang bisa di-optimalkan
   ‚Ä¢ Warning signs jika ada cash flow issue

8. TEMPLATE TRACKING BULANAN
   [Berikan format sederhana untuk tracking harian/mingguan]

PENTING:
- JANGAN gunakan format markdown **bold**
- Gunakan angka realistis untuk industri ${industri || 'bisnis'}
- Sesuaikan alokasi dengan tipe bisnis ${tipeText}
- Format angka dengan pemisah ribuan (Rp 10.000.000)
- Berikan insight yang actionable dan praktis`;

                const payload = {
                    contents: [{ parts: [{ text: prompt }] }],
                    generationConfig: {
                        temperature: 0.9,
                        maxOutputTokens: 2048
                    }
                };

                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error?.message || `HTTP error! status: ${response.status}`);
                }

                const result = await response.json();

                if (!result.candidates || !result.candidates[0].content || !result.candidates[0].content.parts || !result.candidates[0].content.parts[0].text) {
                    throw new Error("Invalid response structure from API.");
                }

                let financialForecast = result.candidates[0].content.parts[0].text;
                financialForecast = cleanMarkdown(financialForecast);
                output.textContent = financialForecast;

            } catch (error) {
                console.error('Error:', error);
                output.innerHTML = `<div class="text-red-500">Gagal generate financial forecast: ${error.message}</div>`;
            } finally {
                ffGenerateBtn.disabled = false;
                ffGenerateBtn.innerHTML = '<i class="fas fa-sparkles mr-2"></i>Generate Proyeksi Anggaran';
            }
        });

        setupCopyButton('ff-copy-btn', 'ff-output');
    }

    // ============================================
    // POSTER GENERATOR
    // ============================================

    (function() {
        const apiKey = "";
        let posterImageData = null;
        let generatedPosters = [];

        // Elements
        const uploadBox = document.getElementById('poster-upload-box');
        const imageInput = document.getElementById('poster-image-input');
        const previewContainer = document.getElementById('poster-preview-container');
        const previewImage = document.getElementById('poster-preview-image');
        const removeImageBtn = document.getElementById('poster-remove-image');

        const posterType = document.getElementById('poster-type');
        const posterTitle = document.getElementById('poster-title');
        const posterSubtitle = document.getElementById('poster-subtitle');
        const posterDescription = document.getElementById('poster-description');
        const posterContact = document.getElementById('poster-contact');

        const generateBtn = document.getElementById('poster-generate-btn');
        const resultsGrid = document.getElementById('poster-results-grid');
        const placeholder = document.getElementById('poster-placeholder');
        const downloadAllBtn = document.getElementById('poster-download-all-btn');

        if (!uploadBox) return;

        // Toggle button handlers
        setupToggleButtons('#content-poster-generator', 'poster-color-btn');
        setupToggleButtons('#content-poster-generator', 'poster-style-btn');
        setupToggleButtons('#content-poster-generator', 'poster-size-btn');
        setupToggleButtons('#content-poster-generator', 'poster-count-btn');

        // Upload handling
        uploadBox.addEventListener('click', () => imageInput.click());

        uploadBox.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadBox.style.borderColor = '#8B5CF6';
        });

        uploadBox.addEventListener('dragleave', () => {
            uploadBox.style.borderColor = '#D1D5DB';
        });

        uploadBox.addEventListener('drop', async (e) => {
            e.preventDefault();
            uploadBox.style.borderColor = '#D1D5DB';
            const file = e.dataTransfer.files[0];
            if (file) await handleImageUpload(file);
        });

        imageInput.addEventListener('change', async (e) => {
            const file = e.target.files[0];
            if (file) await handleImageUpload(file);
        });

        removeImageBtn.addEventListener('click', () => {
            posterImageData = null;
            previewContainer.classList.add('hidden');
            uploadBox.classList.remove('hidden');
            imageInput.value = '';
        });

        async function handleImageUpload(file) {
            if (!file.type.startsWith('image/')) {
                alert('Please upload an image file!');
                return;
            }

            try {
                let processedFile = file;

                // Convert HEIC to JPEG if needed
                if (file.type === 'image/heic' || file.name.toLowerCase().endsWith('.heic')) {
                    try {
                        const convertedBlob = await heic2any({
                            blob: file,
                            toType: 'image/jpeg',
                            quality: 0.9
                        });
                        processedFile = new File([convertedBlob], file.name.replace(/\.heic$/i, '.jpg'), {
                            type: 'image/jpeg'
                        });
                    } catch (err) {
                        console.error('HEIC conversion failed:', err);
                        alert('Failed to convert HEIC image');
                        return;
                    }
                }

                const reader = new FileReader();
                reader.onload = (e) => {
                    const base64 = e.target.result.split(',')[1];
                    posterImageData = {
                        mimeType: processedFile.type,
                        data: base64
                    };

                    previewImage.src = e.target.result;
                    uploadBox.classList.add('hidden');
                    previewContainer.classList.remove('hidden');
                };
                reader.readAsDataURL(processedFile);

            } catch (error) {
                console.error('Error uploading image:', error);
                alert('Error uploading image');
            }
        }

        // Generate button handler
        generateBtn.addEventListener('click', async () => {
            const title = posterTitle.value.trim();

            if (!title) {
                alert('Mohon isi judul poster!');
                return;
            }

            const type = posterType.value;
            const subtitle = posterSubtitle.value.trim();
            const description = posterDescription.value.trim();
            const contact = posterContact.value.trim();

            const selectedColor = document.querySelector('.poster-color-btn.active').dataset.color;
            const selectedStyle = document.querySelector('.poster-style-btn.active').dataset.style;
            const selectedRatio = document.querySelector('.poster-size-btn.active').dataset.ratio;
            const selectedCount = parseInt(document.querySelector('.poster-count-btn.active').dataset.count);

            // Show loading
            generateBtn.disabled = true;
            generateBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Generating...';
            placeholder.classList.add('hidden');
            resultsGrid.classList.remove('hidden');
            resultsGrid.innerHTML = '';
            generatedPosters = [];

            // Create placeholder cards
            for (let i = 1; i <= selectedCount; i++) {
                const card = document.createElement('div');
                card.id = `poster-card-${i}`;
                card.className = 'relative group rounded-xl overflow-hidden bg-gray-100 flex items-center justify-center';
                card.style.aspectRatio = selectedRatio.replace(':', '/');
                card.innerHTML = '<div class="animate-spin rounded-full h-10 w-10 border-b-2 border-purple-600"></div>';
                resultsGrid.appendChild(card);
            }

            // Build comprehensive prompt
            const typeDescriptions = {
                'event': 'Event atau acara',
                'promo': 'Promosi, sale, atau diskon',
                'social-media': 'Social media post',
                'workshop': 'Workshop atau pelatihan',
                'seminar': 'Seminar atau webinar',
                'concert': 'Konser atau musik',
                'sport': 'Olahraga atau turnamen',
                'movie': 'Film atau cinema',
                'food': 'Makanan atau kuliner',
                'recruitment': 'Lowongan kerja',
                'announcement': 'Pengumuman atau informasi',
                'custom': 'Custom'
            };

            const colorDescriptions = {
                'vibrant': 'warna vibrant dengan gradien orange ke merah yang energik',
                'professional': 'warna profesional dengan gradien biru gelap yang corporate',
                'elegant': 'warna elegant hitam dan abu-abu yang sophisticated',
                'nature': 'warna natural hijau yang fresh',
                'sunset': 'warna sunset orange ke merah yang warm',
                'ocean': 'warna ocean biru cyan yang refreshing',
                'pastel': 'warna pastel pink dan ungu yang soft',
                'neon': 'warna neon purple dan pink yang eye-catching'
            };

            const styleDescriptions = {
                'modern': 'style modern dengan typography clean, geometric shapes, dan layout balanced',
                'minimalist': 'style minimalist dengan banyak white space, simple elements, dan fokus pada typography',
                'bold': 'style bold dengan warna kontras tinggi, typography tebal, dan visual impactful',
                'vintage': 'style vintage retro dengan texture aged, typography classic',
                'professional': 'style professional corporate dengan layout formal dan typography readable',
                'creative': 'style creative artistic dengan elemen unik dan layout experimental',
                'elegant': 'style elegant dengan typography serif, ornaments, dan layout symmetrical',
                'playful': 'style playful fun dengan ilustrasi cheerful dan typography rounded'
            };

            const basePrompt = `Create a professional poster design for ${typeDescriptions[type]}.

POSTER CONTENT:
Title: ${title}
${subtitle ? `Subtitle: ${subtitle}` : ''}
${description ? `Details: ${description}` : ''}
${contact ? `Contact: ${contact}` : ''}

DESIGN SPECIFICATIONS:
- Color Theme: ${colorDescriptions[selectedColor]}
- Design Style: ${styleDescriptions[selectedStyle]}
- Aspect Ratio: ${selectedRatio}
- Layout: Sesuaikan dengan jenis ${typeDescriptions[type]}

IMPORTANT DESIGN REQUIREMENTS:
1. TYPOGRAPHY:
   - Title harus BOLD, LARGE, dan menjadi focal point
   - Gunakan hierarchy yang jelas (title >> subtitle >> details)
   - Font readable dan sesuai dengan style yang dipilih
   - Kerning dan spacing yang profesional

2. LAYOUT & COMPOSITION:
   - Balance visual weight dengan baik
   - Gunakan grid system untuk alignment
   - White space yang cukup, jangan terlalu crowded
   - Visual flow yang natural dari top ke bottom

3. COLOR USAGE:
   - Apply ${colorDescriptions[selectedColor]}
   - Gunakan kontras yang baik untuk readability
   - Background dan foreground yang harmonis
   - Accent colors untuk highlight important info

4. VISUAL ELEMENTS:
   - Tambahkan decorative elements sesuai ${styleDescriptions[selectedStyle]}
   ${posterImageData ? '- Integrasikan uploaded image sebagai focal point atau background element' : '- Tambahkan relevant icons atau illustrations'}
   - Border atau frame jika sesuai dengan style
   - Pattern atau texture subtle untuk depth

5. INFORMATION HIERARCHY:
   - Title: Paling prominent di top atau center
   ${subtitle ? '- Subtitle: Secondary emphasis' : ''}
   ${description ? '- Details: Clear dan organized dengan bullet points atau sections' : ''}
   ${contact ? '- Contact info: Bottom atau corner dengan good visibility' : ''}

6. PROFESSIONAL TOUCHES:
   - Shadows atau depth untuk dimension
   - Consistent style throughout
   - Print-ready quality
   - Instagram/social media ready

FINAL OUTPUT:
Generate a complete, print-ready poster yang eye-catching, professional, dan sesuai untuk ${typeDescriptions[type]}. Make it STUNNING dan ready to use!`;

            // Generate all posters in parallel
            const generationPromises = Array.from({ length: selectedCount }, (_, i) =>
                generateSinglePoster(i + 1, basePrompt, selectedRatio, posterImageData)
            );

            await Promise.allSettled(generationPromises);

            // Enable download all if successful
            if (generatedPosters.length > 0) {
                downloadAllBtn.classList.remove('hidden');
            }

            generateBtn.disabled = false;
            generateBtn.innerHTML = '<i class="fas fa-magic mr-2"></i>Generate Poster';
        });

        async function generateSinglePoster(index, prompt, aspectRatio, imageData) {
            const card = document.getElementById(`poster-card-${index}`);

            try {
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-image-preview:generateContent?key=${apiKey}`;

                const parts = [{ text: prompt }];

                if (imageData) {
                    parts.push({
                        inlineData: {
                            mimeType: imageData.mimeType,
                            data: imageData.data
                        }
                    });
                }

                const payload = {
                    contents: [{ parts }],
                    generationConfig: {
                        responseModalities: ['IMAGE'],
                        imageConfig: {
                            aspectRatio: aspectRatio
                        }
                    }
                };

                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const result = await response.json();

                if (result?.candidates?.[0]?.content?.parts?.[0]?.inlineData) {
                    const base64Data = result.candidates[0].content.parts[0].inlineData.data;
                    const mimeType = result.candidates[0].content.parts[0].inlineData.mimeType || 'image/png';
                    const imageUrl = `data:${mimeType};base64,${base64Data}`;

                    const filename = `poster_${Date.now()}_${index}.png`;
                    generatedPosters.push({ url: imageUrl, filename });

                    // Update card with image
                    card.innerHTML = `
                        <img src="${imageUrl}" class="w-full h-full object-cover" alt="Poster ${index}">
                        <div class="absolute inset-0 bg-gradient-to-t from-black/80 via-black/40 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300 flex items-end justify-center pb-4 gap-2">
                            <button data-action="preview" data-index="${generatedPosters.length - 1}" class="action-btn bg-white/90 hover:bg-white text-gray-800 px-4 py-2 rounded-full font-semibold shadow-lg transition-all duration-200 hover:scale-105 flex items-center gap-2">
                                <i class="fas fa-eye"></i>
                                <span class="hidden sm:inline">Preview</span>
                            </button>
                            <button data-action="download" data-index="${generatedPosters.length - 1}" class="action-btn bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600 text-white px-4 py-2 rounded-full font-semibold shadow-lg transition-all duration-200 hover:scale-105 flex items-center gap-2">
                                <i class="fas fa-download"></i>
                                <span class="hidden sm:inline">Download</span>
                            </button>
                        </div>
                    `;
                } else {
                    throw new Error('No image data in response');
                }

            } catch (error) {
                console.error(`Error generating poster ${index}:`, error);
                card.innerHTML = `
                    <div class="text-center p-4">
                        <i class="fas fa-exclamation-triangle text-red-500 text-3xl mb-2"></i>
                        <p class="text-sm text-red-600">Generation failed</p>
                    </div>
                `;
            }
        }

        // Event delegation for action buttons
        resultsGrid.addEventListener('click', async (e) => {
            e.stopPropagation();

            const actionBtn = e.target.classList.contains('action-btn') ?
                            e.target : e.target.closest('.action-btn[data-action]');
            if (!actionBtn) return;

            const action = actionBtn.dataset.action;
            const index = parseInt(actionBtn.dataset.index, 10);
            const posterData = generatedPosters[index];

            if (action === 'preview') {
                window.showPreviewModal(posterData.url);
            } else if (action === 'download') {
                if (window.downloadDataURINew) {
                    await window.downloadDataURINew(posterData.url, posterData.filename);
                } else if (window.downloadImage) {
                    await window.downloadImage(posterData.url, posterData.filename);
                }
            }
        });

        // Download all
        downloadAllBtn.addEventListener('click', async () => {
            if (generatedPosters.length === 0) return;

            downloadAllBtn.disabled = true;
            downloadAllBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Downloading...';

            for (let i = 0; i < generatedPosters.length; i++) {
                const poster = generatedPosters[i];
                if (window.downloadDataURINew) {
                    await window.downloadDataURINew(poster.url, poster.filename);
                } else if (window.downloadImage) {
                    await window.downloadImage(poster.url, poster.filename);
                }
                await new Promise(resolve => setTimeout(resolve, 500));
            }

            downloadAllBtn.disabled = false;
            downloadAllBtn.innerHTML = '<i class="fas fa-download mr-2"></i>Download Semua';
        });

    })();

    // ==================== OBJECT REMOVER ====================
    (function() {
        const apiKey = "";
        const uploadInput = document.getElementById('remover-upload-input');
        const uploadBox = document.getElementById('remover-upload-box');
        const uploadPlaceholder = document.getElementById('remover-upload-placeholder');
        const previewContainer = document.getElementById('remover-preview-container');
        const previewImage = document.getElementById('remover-preview-image');
        const changePhotoBtn = document.getElementById('remover-change-photo-btn');
        const modeSection = document.getElementById('remover-mode-section');
        const manualTools = document.getElementById('remover-manual-tools');
        const autoOptions = document.getElementById('remover-auto-options');
        const variationSection = document.getElementById('remover-variation-section');
        const generateSection = document.getElementById('remover-generate-section');
        const generateBtn = document.getElementById('remover-generate-btn');
        const resultsSection = document.getElementById('remover-results-section');
        const resultsGrid = document.getElementById('remover-results-grid');
        const downloadAllBtn = document.getElementById('remover-download-all-btn');

        // Canvas elements
        const canvas = document.getElementById('remover-canvas');
        const ctx = canvas ? canvas.getContext('2d') : null;
        const brushSizeSlider = document.getElementById('remover-brush-size');
        const brushSizeValue = document.getElementById('brush-size-value');
        const undoBtn = document.getElementById('remover-undo-btn');
        const redoBtn = document.getElementById('remover-redo-btn');
        const clearBtn = document.getElementById('remover-clear-btn');
        const resetBtn = document.getElementById('remover-reset-btn');

        let uploadedImage = null;
        let uploadedImageData = null;
        let selectedMode = 'auto';
        let selectedVariations = 2;
        let isDrawing = false;
        let brushSize = 20;
        let maskHistory = [];
        let historyIndex = -1;
        let generatedResults = [];

        // Upload handling
        if (uploadBox && uploadInput) {
            uploadBox.addEventListener('click', () => uploadInput.click());

            uploadBox.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadBox.style.borderColor = '#EF4444';
            });

            uploadBox.addEventListener('dragleave', () => {
                uploadBox.style.borderColor = '#D1D5DB';
            });

            uploadBox.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadBox.style.borderColor = '#D1D5DB';
                const file = e.dataTransfer.files[0];
                if (file) handleFileUpload(file);
            });

            uploadInput.addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (file) handleFileUpload(file);
            });
        }

        if (changePhotoBtn) {
            changePhotoBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                uploadInput.click();
            });
        }

        async function handleFileUpload(file) {
            try {
                let processedFile = file;

                // HEIC conversion
                if (file.name.toLowerCase().endsWith('.heic')) {
                    try {
                        const convertedBlob = await heic2any({
                            blob: file,
                            toType: 'image/jpeg',
                            quality: 0.9
                        });
                        processedFile = new File([convertedBlob], file.name.replace(/\.heic$/i, '.jpg'), {
                            type: 'image/jpeg'
                        });
                    } catch (err) {
                        console.error('HEIC conversion error:', err);
                        alert('Gagal mengonversi file HEIC. Silakan gunakan format JPG/PNG.');
                        return;
                    }
                }

                const reader = new FileReader();
                reader.onload = (e) => {
                    const img = new Image();
                    img.onload = () => {
                        uploadedImage = img;

                        // Convert to base64
                        const tempCanvas = document.createElement('canvas');
                        tempCanvas.width = img.width;
                        tempCanvas.height = img.height;
                        const tempCtx = tempCanvas.getContext('2d');
                        tempCtx.drawImage(img, 0, 0);
                        const base64 = tempCanvas.toDataURL('image/png').split(',')[1];

                        uploadedImageData = {
                            data: base64,
                            mimeType: 'image/png'
                        };

                        // Show preview
                        previewImage.src = e.target.result;
                        uploadPlaceholder.classList.add('hidden');
                        previewContainer.classList.remove('hidden');

                        // Show next sections
                        modeSection.classList.remove('hidden');
                        updateUIBasedOnMode();
                        variationSection.classList.remove('hidden');
                        generateSection.classList.remove('hidden');

                        // Setup canvas for manual mode
                        if (canvas) {
                            setupCanvas(img);
                        }
                    };
                    img.src = e.target.result;
                };
                reader.readAsDataURL(processedFile);
            } catch (error) {
                console.error('Upload error:', error);
                alert('Gagal mengupload foto. Silakan coba lagi.');
            }
        }

        function setupCanvas(img) {
            const maxWidth = 800;
            const scale = Math.min(1, maxWidth / img.width);

            canvas.width = img.width * scale;
            canvas.height = img.height * scale;

            drawCanvas();
            saveMaskHistory();
        }

        function drawCanvas() {
            if (!canvas || !ctx || !uploadedImage) return;

            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.drawImage(uploadedImage, 0, 0, canvas.width, canvas.height);
        }

        // Mode selection
        document.querySelectorAll('.remover-mode-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.remover-mode-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                selectedMode = btn.dataset.mode;
                updateUIBasedOnMode();
            });
        });

        function updateUIBasedOnMode() {
            if (selectedMode === 'manual') {
                manualTools.classList.remove('hidden');
                autoOptions.classList.add('hidden');
            } else {
                manualTools.classList.add('hidden');
                autoOptions.classList.remove('hidden');
            }
        }

        // Variation selection
        document.querySelectorAll('.remover-variation-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.remover-variation-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                selectedVariations = parseInt(btn.dataset.count);
            });
        });

        // Brush controls
        if (brushSizeSlider && brushSizeValue) {
            brushSizeSlider.addEventListener('input', (e) => {
                brushSize = parseInt(e.target.value);
                brushSizeValue.textContent = brushSize;
            });
        }

        // Canvas drawing
        if (canvas) {
            let lastX = 0;
            let lastY = 0;

            canvas.addEventListener('mousedown', startDrawing);
            canvas.addEventListener('mousemove', draw);
            canvas.addEventListener('mouseup', stopDrawing);
            canvas.addEventListener('mouseout', stopDrawing);

            // Touch support
            canvas.addEventListener('touchstart', (e) => {
                e.preventDefault();
                const touch = e.touches[0];
                const rect = canvas.getBoundingClientRect();
                lastX = touch.clientX - rect.left;
                lastY = touch.clientY - rect.top;
                isDrawing = true;
            });

            canvas.addEventListener('touchmove', (e) => {
                e.preventDefault();
                if (!isDrawing) return;
                const touch = e.touches[0];
                const rect = canvas.getBoundingClientRect();
                drawLine(lastX, lastY, touch.clientX - rect.left, touch.clientY - rect.top);
            });

            canvas.addEventListener('touchend', stopDrawing);

            function startDrawing(e) {
                isDrawing = true;
                const rect = canvas.getBoundingClientRect();
                lastX = e.clientX - rect.left;
                lastY = e.clientY - rect.top;
            }

            function draw(e) {
                if (!isDrawing) return;
                const rect = canvas.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;
                drawLine(lastX, lastY, x, y);
            }

            function drawLine(x1, y1, x2, y2) {
                ctx.strokeStyle = 'rgba(239, 68, 68, 0.5)';
                ctx.lineWidth = brushSize;
                ctx.lineCap = 'round';
                ctx.lineJoin = 'round';

                ctx.beginPath();
                ctx.moveTo(x1, y1);
                ctx.lineTo(x2, y2);
                ctx.stroke();

                lastX = x2;
                lastY = y2;
            }

            function stopDrawing() {
                if (isDrawing) {
                    isDrawing = false;
                    saveMaskHistory();
                }
            }
        }

        // History management
        function saveMaskHistory() {
            if (!canvas) return;

            historyIndex++;
            maskHistory = maskHistory.slice(0, historyIndex);
            maskHistory.push(canvas.toDataURL());

            if (maskHistory.length > 20) {
                maskHistory.shift();
                historyIndex--;
            }
        }

        if (undoBtn) {
            undoBtn.addEventListener('click', () => {
                if (historyIndex > 0) {
                    historyIndex--;
                    loadMaskFromHistory();
                }
            });
        }

        if (redoBtn) {
            redoBtn.addEventListener('click', () => {
                if (historyIndex < maskHistory.length - 1) {
                    historyIndex++;
                    loadMaskFromHistory();
                }
            });
        }

        function loadMaskFromHistory() {
            if (!canvas || !ctx || historyIndex < 0 || historyIndex >= maskHistory.length) return;

            const img = new Image();
            img.onload = () => {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                ctx.drawImage(img, 0, 0);
            };
            img.src = maskHistory[historyIndex];
        }

        if (clearBtn) {
            clearBtn.addEventListener('click', () => {
                if (confirm('Hapus semua tandakan?')) {
                    drawCanvas();
                    saveMaskHistory();
                }
            });
        }

        if (resetBtn) {
            resetBtn.addEventListener('click', () => {
                if (confirm('Reset ke foto asli?')) {
                    historyIndex = 0;
                    maskHistory = [];
                    drawCanvas();
                    saveMaskHistory();
                }
            });
        }

        // Generate button
        if (generateBtn) {
            generateBtn.addEventListener('click', async () => {
                if (!uploadedImageData) {
                    alert('Silakan upload foto terlebih dahulu!');
                    return;
                }

                generateBtn.disabled = true;
                generateBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Menghapus Object...';

                resultsSection.classList.remove('hidden');
                resultsGrid.innerHTML = '';
                generatedResults = [];

                // Create placeholder cards
                for (let i = 1; i <= selectedVariations; i++) {
                    const card = document.createElement('div');
                    card.id = `remover-card-${i}`;
                    card.className = 'relative group rounded-xl overflow-hidden bg-gray-100 flex items-center justify-center aspect-[3/4]';
                    card.innerHTML = '<div class="animate-spin rounded-full h-10 w-10 border-b-2 border-red-600"></div>';
                    resultsGrid.appendChild(card);
                }

                // Generate results
                const generationPromises = Array.from({ length: selectedVariations }, (_, i) =>
                    generateSingleResult(i + 1)
                );
                await Promise.allSettled(generationPromises);

                if (generatedResults.length > 0) {
                    downloadAllBtn.classList.remove('hidden');
                }

                generateBtn.disabled = false;
                generateBtn.innerHTML = '<i class="fas fa-magic mr-2"></i>Hapus Object Sekarang';
            });
        }

        async function generateSingleResult(index) {
            const card = document.getElementById(`remover-card-${index}`);

            try {
                let prompt = '';
                let maskData = null;

                if (selectedMode === 'manual') {
                    // Extract mask from canvas
                    const maskCanvas = document.createElement('canvas');
                    maskCanvas.width = canvas.width;
                    maskCanvas.height = canvas.height;
                    const maskCtx = maskCanvas.getContext('2d');

                    // Get only the red mask layer
                    maskCtx.drawImage(canvas, 0, 0);
                    const imageData = maskCtx.getImageData(0, 0, maskCanvas.width, maskCanvas.height);
                    const data = imageData.data;

                    // Create black/white mask (white = areas to remove)
                    for (let i = 0; i < data.length; i += 4) {
                        const red = data[i];
                        const isMarked = red > 200; // Red marked areas

                        data[i] = isMarked ? 255 : 0;     // R
                        data[i + 1] = isMarked ? 255 : 0; // G
                        data[i + 2] = isMarked ? 255 : 0; // B
                        data[i + 3] = 255;                // A
                    }

                    maskCtx.putImageData(imageData, 0, 0);
                    maskData = maskCanvas.toDataURL('image/png').split(',')[1];

                    prompt = `Remove the marked objects from this image and fill the areas seamlessly with appropriate background.

CRITICAL REQUIREMENTS:
1. COMPLETE REMOVAL: Completely remove all marked/masked areas
2. SEAMLESS INPAINTING: Fill removed areas with natural, contextually appropriate background
3. PERFECT BLENDING: Ensure no visible seams, artifacts, or traces of removed objects
4. PRESERVE QUALITY: Maintain original image quality, lighting, and color consistency
5. NATURAL RESULT: Make it look like removed objects never existed

The masked areas (in white) should be intelligently filled based on surrounding context. Generate a clean, professional result.`;
                } else {
                    // Auto mode
                    prompt = `Automatically detect and remove unwanted objects, distractions, or imperfections from this image.

OBJECTS TO DETECT AND REMOVE:
- People or objects in background that distract from main subject
- Watermarks, logos, or text overlays
- Wires, poles, or infrastructure elements
- Photobombers or unwanted people
- Trash, debris, or clutter
- Any other distracting elements

CRITICAL REQUIREMENTS:
1. SMART DETECTION: Identify what is the main subject vs unwanted elements
2. COMPLETE REMOVAL: Remove ALL detected unwanted objects
3. SEAMLESS INPAINTING: Fill removed areas naturally with appropriate background
4. PERFECT BLENDING: No visible seams, artifacts, or traces
5. PRESERVE MAIN SUBJECT: Keep the main subject/person completely intact
6. NATURAL RESULT: Final image should look clean and professional

Generate a clean, distraction-free version of this image.`;
                }

                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-image-preview:generateContent?key=${apiKey}`;

                const parts = [{ text: prompt }];

                // Add original image
                parts.push({
                    inlineData: {
                        mimeType: uploadedImageData.mimeType,
                        data: uploadedImageData.data
                    }
                });

                // Add mask if manual mode
                if (maskData) {
                    parts.push({
                        inlineData: {
                            mimeType: 'image/png',
                            data: maskData
                        }
                    });
                }

                const payload = {
                    contents: [{ parts }],
                    generationConfig: {
                        responseModalities: ['IMAGE']
                    }
                };

                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const result = await response.json();

                if (result?.candidates?.[0]?.content?.parts?.[0]?.inlineData) {
                    const base64Data = result.candidates[0].content.parts[0].inlineData.data;
                    const mimeType = result.candidates[0].content.parts[0].inlineData.mimeType || 'image/png';
                    const imageUrl = `data:${mimeType};base64,${base64Data}`;

                    const filename = `object_removed_${Date.now()}_${index}.png`;
                    generatedResults.push({ url: imageUrl, filename });

                    card.innerHTML = `
                        <img src="${imageUrl}" class="w-full h-full object-cover" alt="Result ${index}">
                        <div class="absolute inset-0 bg-gradient-to-t from-black/80 via-black/40 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300 flex items-end justify-center pb-4 gap-2">
                            <button data-action="preview" data-index="${generatedResults.length - 1}" class="action-btn bg-white/90 hover:bg-white text-gray-800 px-4 py-2 rounded-full font-semibold shadow-lg transition-all duration-200 hover:scale-105 flex items-center gap-2">
                                <i class="fas fa-eye"></i>
                                <span class="hidden sm:inline">Preview</span>
                            </button>
                            <button data-action="download" data-index="${generatedResults.length - 1}" class="action-btn bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white px-4 py-2 rounded-full font-semibold shadow-lg transition-all duration-200 hover:scale-105 flex items-center gap-2">
                                <i class="fas fa-download"></i>
                                <span class="hidden sm:inline">Download</span>
                            </button>
                        </div>
                    `;
                } else {
                    throw new Error('No image data in response');
                }

            } catch (error) {
                console.error(`Error removing object ${index}:`, error);
                card.innerHTML = `
                    <div class="text-center p-4">
                        <i class="fas fa-exclamation-triangle text-red-500 text-3xl mb-2"></i>
                        <p class="text-sm text-red-600">Generation failed</p>
                    </div>
                `;
            }
        }

        // Results action buttons
        if (resultsGrid) {
            resultsGrid.addEventListener('click', async (e) => {
                e.stopPropagation();

                const actionBtn = e.target.classList.contains('action-btn') ?
                                  e.target : e.target.closest('.action-btn[data-action]');
                if (!actionBtn) return;

                const action = actionBtn.dataset.action;
                const index = parseInt(actionBtn.dataset.index, 10);
                const resultData = generatedResults[index];

                if (action === 'preview') {
                    window.showPreviewModal(resultData.url);
                } else if (action === 'download') {
                    if (window.downloadDataURINew) {
                        await window.downloadDataURINew(resultData.url, resultData.filename);
                    } else if (window.downloadImage) {
                        await window.downloadImage(resultData.url, resultData.filename);
                    }
                }
            });
        }

        // Download all
        if (downloadAllBtn) {
            downloadAllBtn.addEventListener('click', async () => {
                if (generatedResults.length === 0) return;

                downloadAllBtn.disabled = true;
                downloadAllBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Downloading...';

                for (let i = 0; i < generatedResults.length; i++) {
                    const result = generatedResults[i];
                    if (window.downloadDataURINew) {
                        await window.downloadDataURINew(result.url, result.filename);
                    } else if (window.downloadImage) {
                        await window.downloadImage(result.url, result.filename);
                    }
                    await new Promise(resolve => setTimeout(resolve, 500));
                }

                downloadAllBtn.disabled = false;
                downloadAllBtn.innerHTML = '<i class="fas fa-download mr-2"></i>Download Semua';
            });
        }

    })();

});
</script>

<!-- Mobile Bottom Navigation -->
<nav class="mobile-bottom-nav">
    <div class="mobile-tabs-container">
        <!-- BERANDA -->
        <button data-tab="beranda" class="mobile-tab-btn active">
            <i class="fas fa-home"></i>
            <span>Beranda</span>
        </button>

        <!-- PHOTO STUDIO -->
        <button data-tab="mockup-studio" class="mobile-tab-btn">
            <i class="fas fa-palette"></i>
            <span>Mockup</span>
        </button>
        <button data-tab="pov-tangan" class="mobile-tab-btn">
            <i class="fas fa-hand-holding"></i>
            <span>POV</span>
        </button>

        <!-- UGC CONTENT -->
        <button data-tab="affiliate" class="mobile-tab-btn">
            <i class="fas fa-rocket"></i>
            <span>Produk</span>
        </button>
        <button data-tab="virtual-tryon" class="mobile-tab-btn">
            <i class="fas fa-tshirt"></i>
            <span>Try-On</span>
        </button>
        <button data-tab="pose-fashion" class="mobile-tab-btn">
            <i class="fas fa-user-tie"></i>
            <span>Pose</span>
        </button>
        <button data-tab="food-selfie" class="mobile-tab-btn">
            <i class="fas fa-utensils"></i>
            <span>Food</span>
        </button>
        <button data-tab="product-review" class="mobile-tab-btn">
            <i class="fas fa-star"></i>
            <span>Review</span>
        </button>
        <button data-tab="product-ads" class="mobile-tab-btn">
            <i class="fas fa-bullhorn"></i>
            <span>Ads</span>
        </button>
        <button data-tab="professional-headshot" class="mobile-tab-btn">
            <i class="fas fa-user-tie"></i>
            <span>Headshot</span>
            <span class="new-badge">NEW</span>
        </button>

        <!-- AFFILIATE & E-COMMERCE -->
        <button data-tab="deskripsi-produk" class="mobile-tab-btn">
            <i class="fas fa-tags"></i>
            <span>Deskripsi</span>
        </button>
        <button data-tab="ide-konten-tiktok" class="mobile-tab-btn">
            <i class="fab fa-tiktok"></i>
            <span>TikTok</span>
        </button>
        <button data-tab="script-story-iklan" class="mobile-tab-btn">
            <i class="fas fa-book-open"></i>
            <span>Script</span>
        </button>

        <!-- ALAT BISNIS -->
        <button data-tab="rencana-bisnis" class="mobile-tab-btn">
            <i class="fas fa-chart-line"></i>
            <span>Bisnis</span>
        </button>
        <button data-tab="hr-assistant" class="mobile-tab-btn">
            <i class="fas fa-users"></i>
            <span>HR</span>
        </button>
        <button data-tab="konten-marketing" class="mobile-tab-btn">
            <i class="fas fa-bullhorn"></i>
            <span>Marketing</span>
        </button>
        <button data-tab="riset-pasar" class="mobile-tab-btn">
            <i class="fas fa-search-dollar"></i>
            <span>Riset</span>
        </button>
        <button data-tab="financial-forecast" class="mobile-tab-btn">
            <i class="fas fa-calculator"></i>
            <span>Anggaran</span>
        </button>

        <!-- FAMILY & LIFESTYLE -->
        <button data-tab="family" class="mobile-tab-btn">
            <i class="fas fa-users"></i>
            <span>Keluarga</span>
        </button>
        <button data-tab="new-born" class="mobile-tab-btn">
            <i class="fas fa-baby"></i>
            <span>Bayi</span>
        </button>
        <button data-tab="profesi-anak" class="mobile-tab-btn">
            <i class="fas fa-user-tie"></i>
            <span>Profesi</span>
        </button>
        <button data-tab="wedding" class="mobile-tab-btn">
            <i class="fas fa-ring"></i>
            <span>Wedding</span>
        </button>
        <button data-tab="umrah-haji" class="mobile-tab-btn">
            <i class="fas fa-kaaba"></i>
            <span>Umrah</span>
        </button>
        <button data-tab="passport-photo" class="mobile-tab-btn">
            <i class="fas fa-id-card"></i>
            <span>Pas Foto</span>
        </button>
        <button data-tab="photo-booth" class="mobile-tab-btn">
            <i class="fas fa-camera-retro"></i>
            <span>Photo Booth</span>
            <span class="new-badge">NEW</span>
        </button>
        <button data-tab="desain-rumah" class="mobile-tab-btn">
            <i class="fas fa-home"></i>
            <span>Rumah</span>
        </button>
        <button data-tab="sketsa-gambar" class="mobile-tab-btn">
            <i class="fas fa-pencil-ruler"></i>
            <span>Sketsa</span>
        </button>
        <button data-tab="bikin-carousel" class="mobile-tab-btn">
            <i class="fas fa-images"></i>
            <span>Carousel</span>
        </button>

        <!-- CREATIVE TOOLS -->
        <button data-tab="miniature" class="mobile-tab-btn">
            <i class="fas fa-user-astronaut"></i>
            <span>Miniatur</span>
        </button>
        <button data-tab="karikatur" class="mobile-tab-btn">
            <i class="fas fa-palette"></i>
            <span>Karikatur</span>
            <span class="new-badge">NEW</span>
        </button>
        <button data-tab="photo-editor" class="mobile-tab-btn">
            <i class="fas fa-sliders-h"></i>
            <span>Editor</span>
            <span class="new-badge">NEW</span>
        </button>
        <button data-tab="ai-beauty" class="mobile-tab-btn">
            <i class="fas fa-wand-magic-sparkles"></i>
            <span>Beauty</span>
            <span class="new-badge">NEW</span>
        </button>
        <button data-tab="halu" class="mobile-tab-btn">
            <i class="fas fa-brain"></i>
            <span>Halu</span>
        </button>
        <button data-tab="sticker" class="mobile-tab-btn">
            <i class="fas fa-smile"></i>
            <span>Sticker</span>
        </button>
        <button data-tab="hair-generator" class="mobile-tab-btn">
            <i class="fas fa-cut"></i>
            <span>Rambut</span>
        </button>
        <button data-tab="expression-changer" class="mobile-tab-btn">
            <i class="fas fa-face-laugh-beam"></i>
            <span>Ekspresi</span>
        </button>
        <button data-tab="face-swap" class="mobile-tab-btn">
            <i class="fas fa-face-grin-stars"></i>
            <span>Face Swap</span>
            <span class="new-badge">NEW</span>
        </button>
        <button data-tab="bg-remover" class="mobile-tab-btn">
            <i class="fas fa-scissors"></i>
            <span>Hapus BG</span>
            <span class="new-badge">NEW</span>
        </button>
        <button data-tab="photo-extender" class="mobile-tab-btn">
            <i class="fas fa-expand-arrows-alt"></i>
            <span>Perluas</span>
            <span class="new-badge">NEW</span>
        </button>
        <button data-tab="story-board" class="mobile-tab-btn">
            <i class="fas fa-film"></i>
            <span>Storyboard</span>
            <span class="new-badge">NEW</span>
        </button>
        <button data-tab="twibon" class="mobile-tab-btn">
            <i class="fas fa-image"></i>
            <span>Twibon</span>
            <span class="new-badge">NEW</span>
        </button>
        <button data-tab="story-update" class="mobile-tab-btn">
            <i class="fas fa-instagram"></i>
            <span>Story</span>
        </button>
        <button data-tab="photo-angle" class="mobile-tab-btn">
            <i class="fas fa-cube"></i>
            <span>Angle</span>
            <span class="new-badge">NEW</span>
        </button>
        <button data-tab="style-matcher" class="mobile-tab-btn">
            <i class="fas fa-magic"></i>
            <span>Style</span>
            <span class="new-badge">NEW</span>
        </button>
        <button data-tab="thumbnail-generator" class="mobile-tab-btn">
            <i class="fas fa-rectangle-ad"></i>
            <span>Thumbnail</span>
            <span class="new-badge">NEW</span>
        </button>
        <button data-tab="cover-photo-generator" class="mobile-tab-btn">
            <i class="fas fa-image-portrait"></i>
            <span>Cover</span>
            <span class="new-badge">NEW</span>
        </button>
        <button data-tab="photo-restoration" class="mobile-tab-btn">
            <i class="fas fa-clock-rotate-left"></i>
            <span>Restore</span>
            <span class="new-badge">NEW</span>
        </button>
        <button data-tab="object-remover" class="mobile-tab-btn">
            <i class="fas fa-eraser"></i>
            <span>Hapus</span>
            <span class="new-badge">NEW</span>
        </button>
        <button data-tab="logo-generator" class="mobile-tab-btn">
            <i class="fas fa-palette"></i>
            <span>Logo</span>
            <span class="new-badge">NEW</span>
        </button>
        <button data-tab="mascot-generator" class="mobile-tab-btn">
            <i class="fas fa-dragon"></i>
            <span>Mascot</span>
            <span class="new-badge">NEW</span>
        </button>
        <button data-tab="poster-generator" class="mobile-tab-btn">
            <i class="fas fa-image"></i>
            <span>Poster</span>
            <span class="new-badge">NEW</span>
        </button>

        <!-- VIDEO & AUDIO -->
        <button data-tab="veo" class="mobile-tab-btn">
            <i class="fas fa-video"></i>
            <span>VEO</span>
        </button>
        <button data-tab="opal" class="mobile-tab-btn">
            <i class="fas fa-magic"></i>
            <span>Opal</span>
        </button>
        <button data-tab="voice-over" class="mobile-tab-btn">
            <i class="fas fa-microphone"></i>
            <span>Voice</span>
        </button>
        <button data-tab="video-analyzer" class="mobile-tab-btn">
            <i class="fas fa-chart-line"></i>
            <span>Analyzer</span>
        </button>
    </div>
</nav>

</body>
</html>